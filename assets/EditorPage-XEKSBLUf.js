var WU=Object.defineProperty;var HU=(e,t,n)=>t in e?WU(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Xu=(e,t,n)=>HU(e,typeof t!="symbol"?t+"":t,n);import{P as GU,Q as YU,R as jy,S as rf,U as qy,v as XU,V as op,W as Qv,X as BC,Y as Vy,Z as KU,m as QU,q as JU,g as ZU,r as ri,c as ks,w as bh,h as up,n as ej,d as wm,a as cN,L as Fg,J as tj,$ as nj,O as fN,N as ij,H as Ra,a0 as rj,a1 as sj,E as Mg,a2 as aj,s as oj,F as Wy,I as UC,G as uj}from"./index-DxzG9-mq.js";import{u as lj,a as cj,l as fj}from"./lz-string-DTnUNcw2.js";import{a as Hy,c as hj,h as dj}from"./render-C87WS6ya.js";import{Q as pj}from"./QPage-BW6SOV56.js";import{_ as hN}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Cw={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},gj=Object.keys(Cw);Cw.all=!0;function jC(e){const t={};for(const n of gj)e[n]===!0&&(t[n]=!0);return Object.keys(t).length===0?Cw:(t.horizontal===!0?t.left=t.right=!0:t.left===!0&&t.right===!0&&(t.horizontal=!0),t.vertical===!0?t.up=t.down=!0:t.up===!0&&t.down===!0&&(t.vertical=!0),t.horizontal===!0&&t.vertical===!0&&(t.all=!0),t)}const mj=["INPUT","TEXTAREA"];function qC(e,t){return t.event===void 0&&e.target!==void 0&&e.target.draggable!==!0&&typeof t.handler=="function"&&mj.includes(e.target.nodeName.toUpperCase())===!1&&(e.qClonedBy===void 0||e.qClonedBy.indexOf(t.uid)===-1)}function yj(){if(window.getSelection!==void 0){const e=window.getSelection();e.empty!==void 0?e.empty():e.removeAllRanges!==void 0&&(e.removeAllRanges(),GU.is.mobile!==!0&&e.addRange(document.createRange()))}else document.selection!==void 0&&document.selection.empty()}function Gy(e,t,n){const i=Qv(e);let r,s=i.left-t.event.x,a=i.top-t.event.y,o=Math.abs(s),u=Math.abs(a);const l=t.direction;l.horizontal===!0&&l.vertical!==!0?r=s<0?"left":"right":l.horizontal!==!0&&l.vertical===!0?r=a<0?"up":"down":l.up===!0&&a<0?(r="up",o>u&&(l.left===!0&&s<0?r="left":l.right===!0&&s>0&&(r="right"))):l.down===!0&&a>0?(r="down",o>u&&(l.left===!0&&s<0?r="left":l.right===!0&&s>0&&(r="right"))):l.left===!0&&s<0?(r="left",o<u&&(l.up===!0&&a<0?r="up":l.down===!0&&a>0&&(r="down"))):l.right===!0&&s>0&&(r="right",o<u&&(l.up===!0&&a<0?r="up":l.down===!0&&a>0&&(r="down")));let c=!1;if(r===void 0&&n===!1){if(t.event.isFirst===!0||t.event.lastDir===void 0)return{};r=t.event.lastDir,c=!0,r==="left"||r==="right"?(i.left-=s,o=0,s=0):(i.top-=a,u=0,a=0)}return{synthetic:c,payload:{evt:e,touch:t.event.mouse!==!0,mouse:t.event.mouse===!0,position:i,direction:r,isFirst:t.event.isFirst,isFinal:n===!0,duration:Date.now()-t.event.time,distance:{x:o,y:u},offset:{x:s,y:a},delta:{x:i.left-t.event.lastX,y:i.top-t.event.lastY}}}}let xj=0;const vj=YU({name:"touch-pan",beforeMount(e,{value:t,modifiers:n}){if(n.mouse!==!0&&rf.has.touch!==!0)return;function i(s,a){n.mouse===!0&&a===!0?QU(s):(n.stop===!0&&Vy(s),n.prevent===!0&&BC(s))}const r={uid:"qvtp_"+xj++,handler:t,modifiers:n,direction:jC(n),noop:XU,mouseStart(s){qC(s,r)&&KU(s)&&(op(r,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),r.start(s,!0))},touchStart(s){if(qC(s,r)){const a=s.target;op(r,"temp",[[a,"touchmove","move","notPassiveCapture"],[a,"touchcancel","end","passiveCapture"],[a,"touchend","end","passiveCapture"]]),r.start(s)}},start(s,a){if(rf.is.firefox===!0&&qy(e,!0),r.lastEvt=s,a===!0||n.stop===!0){if(r.direction.all!==!0&&(a!==!0||r.modifiers.mouseAllDir!==!0&&r.modifiers.mousealldir!==!0)){const l=s.type.indexOf("mouse")!==-1?new MouseEvent(s.type,s):new TouchEvent(s.type,s);s.defaultPrevented===!0&&BC(l),s.cancelBubble===!0&&Vy(l),Object.assign(l,{qKeyEvent:s.qKeyEvent,qClickOutside:s.qClickOutside,qAnchorHandled:s.qAnchorHandled,qClonedBy:s.qClonedBy===void 0?[r.uid]:s.qClonedBy.concat(r.uid)}),r.initialEvent={target:s.target,event:l}}Vy(s)}const{left:o,top:u}=Qv(s);r.event={x:o,y:u,time:Date.now(),mouse:a===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:o,lastY:u}},move(s){if(r.event===void 0)return;const a=Qv(s),o=a.left-r.event.x,u=a.top-r.event.y;if(o===0&&u===0)return;r.lastEvt=s;const l=r.event.mouse===!0,c=()=>{i(s,l);let d;n.preserveCursor!==!0&&n.preservecursor!==!0&&(d=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),l===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),yj(),r.styleCleanup=p=>{if(r.styleCleanup=void 0,d!==void 0&&(document.documentElement.style.cursor=d),document.body.classList.remove("non-selectable"),l===!0){const g=()=>{document.body.classList.remove("no-pointer-events--children")};p!==void 0?setTimeout(()=>{g(),p()},50):g()}else p!==void 0&&p()}};if(r.event.detected===!0){r.event.isFirst!==!0&&i(s,r.event.mouse);const{payload:d,synthetic:p}=Gy(s,r,!1);d!==void 0&&(r.handler(d)===!1?r.end(s):(r.styleCleanup===void 0&&r.event.isFirst===!0&&c(),r.event.lastX=d.position.left,r.event.lastY=d.position.top,r.event.lastDir=p===!0?void 0:d.direction,r.event.isFirst=!1));return}if(r.direction.all===!0||l===!0&&(r.modifiers.mouseAllDir===!0||r.modifiers.mousealldir===!0)){c(),r.event.detected=!0,r.move(s);return}const f=Math.abs(o),h=Math.abs(u);f!==h&&(r.direction.horizontal===!0&&f>h||r.direction.vertical===!0&&f<h||r.direction.up===!0&&f<h&&u<0||r.direction.down===!0&&f<h&&u>0||r.direction.left===!0&&f>h&&o<0||r.direction.right===!0&&f>h&&o>0?(r.event.detected=!0,r.move(s)):r.end(s,!0))},end(s,a){if(r.event!==void 0){if(jy(r,"temp"),rf.is.firefox===!0&&qy(e,!1),a===!0)r.styleCleanup!==void 0&&r.styleCleanup(),r.event.detected!==!0&&r.initialEvent!==void 0&&r.initialEvent.target.dispatchEvent(r.initialEvent.event);else if(r.event.detected===!0){r.event.isFirst===!0&&r.handler(Gy(s===void 0?r.lastEvt:s,r).payload);const{payload:o}=Gy(s===void 0?r.lastEvt:s,r,!0),u=()=>{r.handler(o)};r.styleCleanup!==void 0?r.styleCleanup(u):u()}r.event=void 0,r.initialEvent=void 0,r.lastEvt=void 0}}};if(e.__qtouchpan=r,n.mouse===!0){const s=n.mouseCapture===!0||n.mousecapture===!0?"Capture":"";op(r,"main",[[e,"mousedown","mouseStart",`passive${s}`]])}rf.has.touch===!0&&op(r,"main",[[e,"touchstart","touchStart",`passive${n.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const n=e.__qtouchpan;n!==void 0&&(t.oldValue!==t.value&&(typeof value!="function"&&n.end(),n.handler=t.value),n.direction=jC(t.modifiers))},beforeUnmount(e){const t=e.__qtouchpan;t!==void 0&&(t.event!==void 0&&t.end(),jy(t,"main"),jy(t,"temp"),rf.is.firefox===!0&&qy(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchpan)}}),bj=JU({name:"QSplitter",props:{...lj,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:e=>["%","px"].includes(e)},limits:{type:Array,validator:e=>e.length!==2||typeof e[0]!="number"||typeof e[1]!="number"?!1:e[0]>=0&&e[0]<=e[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(e,{slots:t,emit:n}){const{proxy:{$q:i}}=ZU(),r=cj(e,i),s=ri(null),a={before:ri(null),after:ri(null)},o=ks(()=>`q-splitter no-wrap ${e.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${e.disable===!0?"disabled":"workable"}`+(r.value===!0?" q-splitter--dark":"")),u=ks(()=>e.horizontal===!0?"height":"width"),l=ks(()=>e.reverse!==!0?"before":"after"),c=ks(()=>e.limits!==void 0?e.limits:e.unit==="%"?[10,90]:[50,1/0]);function f(w){return(e.unit==="%"?w:Math.round(w))+e.unit}const h=ks(()=>({[l.value]:{[u.value]:f(e.modelValue)}}));let d,p,g,m,y;function x(w){if(w.isFirst===!0){const _=s.value.getBoundingClientRect()[u.value];d=e.horizontal===!0?"up":"left",p=e.unit==="%"?100:_,g=Math.min(p,c.value[1],Math.max(c.value[0],e.modelValue)),m=(e.reverse!==!0?1:-1)*(e.horizontal===!0?1:i.lang.rtl===!0?-1:1)*(e.unit==="%"?_===0?0:100/_:1),s.value.classList.add("q-splitter--active");return}if(w.isFinal===!0){y!==e.modelValue&&n("update:modelValue",y),s.value.classList.remove("q-splitter--active");return}const E=g+m*(w.direction===d?-1:1)*w.distance[e.horizontal===!0?"y":"x"];y=Math.min(p,c.value[1],Math.max(c.value[0],E)),a[l.value].value.style[u.value]=f(y),e.emitImmediately===!0&&e.modelValue!==y&&n("update:modelValue",y)}const v=ks(()=>[[vj,x,void 0,{[e.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function b(w,E){w<E[0]?n("update:modelValue",E[0]):w>E[1]&&n("update:modelValue",E[1])}return bh(()=>e.modelValue,w=>{b(w,c.value)}),bh(()=>e.limits,()=>{ej(()=>{b(e.modelValue,c.value)})}),()=>{const w=[up("div",{ref:a.before,class:["q-splitter__panel q-splitter__before"+(e.reverse===!0?" col":""),e.beforeClass],style:h.value.before},Hy(t.before)),up("div",{class:["q-splitter__separator",e.separatorClass],style:e.separatorStyle,"aria-disabled":e.disable===!0?"true":void 0},[hj("div",{class:"q-splitter__separator-area absolute-full"},Hy(t.separator),"sep",e.disable!==!0,()=>v.value)]),up("div",{ref:a.after,class:["q-splitter__panel q-splitter__after"+(e.reverse===!0?"":" col"),e.afterClass],style:h.value.after},Hy(t.after))];return up("div",{class:o.value,ref:s},dj(t.default,w))}}}),wj=/("(?:[^\\"]|\\.)*")|[:,]/g;function Yy(e,t={}){const n=JSON.stringify([1],void 0,t.indent===void 0?2:t.indent).slice(2,-3),i=n===""?1/0:t.maxLength===void 0?80:t.maxLength;let{replacer:r}=t;return function s(a,o,u){a&&typeof a.toJSON=="function"&&(a=a.toJSON());const l=JSON.stringify(a,r);if(l===void 0)return l;const c=i-o.length-u;if(l.length<=c){const f=l.replace(wj,(h,d)=>d||`${h} `);if(f.length<=c)return f}if(r!=null&&(a=JSON.parse(l),r=void 0),typeof a=="object"&&a!==null){const f=o+n,h=[];let d=0,p,g;if(Array.isArray(a)){p="[",g="]";const{length:m}=a;for(;d<m;d++)h.push(s(a[d],f,d===m-1?0:1)||"null")}else{p="{",g="}";const m=Object.keys(a),{length:y}=m;for(;d<y;d++){const x=m[d],v=`${JSON.stringify(x)}: `,b=s(a[x],f,v.length+(d===y-1?0:1));b!==void 0&&h.push(v+b)}}if(h.length>0)return[p,n+h.join(`,
${f}`),g].join(`
${o}`)}return l}(e,"",0)}function Jn(e,t,n){return e.fields=t||[],e.fname=n,e}function dt(e){return e==null?null:e.fname}function dn(e){return e==null?null:e.fields}function dN(e){return e.length===1?_j(e[0]):Ej(e)}const _j=e=>function(t){return t[e]},Ej=e=>{const t=e.length;return function(n){for(let i=0;i<t;++i)n=n[e[i]];return n}};function P(e){throw Error(e)}function rs(e){const t=[],n=e.length;let i=null,r=0,s="",a,o,u;e=e+"";function l(){t.push(s+e.substring(a,o)),s="",a=o+1}for(a=o=0;o<n;++o)if(u=e[o],u==="\\")s+=e.substring(a,o++),a=o;else if(u===i)l(),i=null,r=-1;else{if(i)continue;a===r&&u==='"'||a===r&&u==="'"?(a=o+1,i=u):u==="."&&!r?o>a?l():a=o+1:u==="["?(o>a&&l(),r=a=o+1):u==="]"&&(r||P("Access path missing open bracket: "+e),r>0&&l(),r=0,a=o+1)}return r&&P("Access path missing closing bracket: "+e),i&&P("Access path missing closing quote: "+e),o>a&&(o++,l()),t}function Mi(e,t,n){const i=rs(e);return e=i.length===1?i[0]:e,Jn((n&&n.get||dN)(i),[e],t||e)}const ad=Mi("id"),yn=Jn(e=>e,[],"identity"),Ea=Jn(()=>0,[],"zero"),xc=Jn(()=>1,[],"one"),Oi=Jn(()=>!0,[],"true"),ga=Jn(()=>!1,[],"false");function Sj(e,t,n){const i=[t].concat([].slice.call(n));console[e].apply(console,i)}const pN=0,$w=1,Tw=2,gN=3,mN=4;function Fw(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Sj,i=e||pN;return{level(r){return arguments.length?(i=+r,this):i},error(){return i>=$w&&n(t||"error","ERROR",arguments),this},warn(){return i>=Tw&&n(t||"warn","WARN",arguments),this},info(){return i>=gN&&n(t||"log","INFO",arguments),this},debug(){return i>=mN&&n(t||"log","DEBUG",arguments),this}}}var L=Array.isArray;function K(e){return e===Object(e)}const VC=e=>e!=="__proto__";function vc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((i,r)=>{for(const s in r)if(s==="signals")i.signals=kj(i.signals,r.signals);else{const a=s==="legend"?{layout:1}:s==="style"?!0:null;bc(i,s,r[s],a)}return i},{})}function bc(e,t,n,i){if(!VC(t))return;let r,s;if(K(n)&&!L(n)){s=K(e[t])?e[t]:e[t]={};for(r in n)i&&(i===!0||i[r])?bc(s,r,n[r]):VC(r)&&(s[r]=n[r])}else e[t]=n}function kj(e,t){if(e==null)return t;const n={},i=[];function r(s){n[s.name]||(n[s.name]=1,i.push(s))}return t.forEach(r),e.forEach(r),i}function Fe(e){return e[e.length-1]}function fn(e){return e==null||e===""?null:+e}const yN=e=>t=>e*Math.exp(t),xN=e=>t=>Math.log(e*t),vN=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),bN=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Og=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function _m(e,t,n,i){const r=n(e[0]),s=n(Fe(e)),a=(s-r)*t;return[i(r-a),i(s-a)]}function wN(e,t){return _m(e,t,fn,yn)}function _N(e,t){var n=Math.sign(e[0]);return _m(e,t,xN(n),yN(n))}function EN(e,t,n){return _m(e,t,Og(n),Og(1/n))}function SN(e,t,n){return _m(e,t,vN(n),bN(n))}function Em(e,t,n,i,r){const s=i(e[0]),a=i(Fe(e)),o=t!=null?i(t):(s+a)/2;return[r(o+(s-o)*n),r(o+(a-o)*n)]}function Mw(e,t,n){return Em(e,t,n,fn,yn)}function Ow(e,t,n){const i=Math.sign(e[0]);return Em(e,t,n,xN(i),yN(i))}function Ng(e,t,n,i){return Em(e,t,n,Og(i),Og(1/i))}function Nw(e,t,n,i){return Em(e,t,n,vN(i),bN(i))}function kN(e){return 1+~~(new Date(e).getMonth()/3)}function AN(e){return 1+~~(new Date(e).getUTCMonth()/3)}function Q(e){return e!=null?L(e)?e:[e]:[]}function CN(e,t,n){let i=e[0],r=e[1],s;return r<i&&(s=r,r=i,i=s),s=r-i,s>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-s),i+s]}function we(e){return typeof e=="function"}const Aj="descending";function Rw(e,t,n){n=n||{},t=Q(t)||[];const i=[],r=[],s={},a=n.comparator||Cj;return Q(e).forEach((o,u)=>{o!=null&&(i.push(t[u]===Aj?-1:1),r.push(o=we(o)?o:Mi(o,null,n)),(dn(o)||[]).forEach(l=>s[l]=1))}),r.length===0?null:Jn(a(r,i),Object.keys(s))}const wc=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),Cj=(e,t)=>e.length===1?$j(e[0],t[0]):Tj(e,t,e.length),$j=(e,t)=>function(n,i){return wc(e(n),e(i))*t},Tj=(e,t,n)=>(t.push(0),function(i,r){let s,a=0,o=-1;for(;a===0&&++o<n;)s=e[o],a=wc(s(i),s(r));return a*t[o]});function xn(e){return we(e)?e:()=>e}function Dw(e,t){let n;return i=>{n&&clearTimeout(n),n=setTimeout(()=>(t(i),n=null),e)}}function ve(e){for(let t,n,i=1,r=arguments.length;i<r;++i){t=arguments[i];for(n in t)e[n]=t[n]}return e}function Yr(e,t){let n=0,i,r,s,a;if(e&&(i=e.length))if(t==null){for(r=e[n];n<i&&(r==null||r!==r);r=e[++n]);for(s=a=r;n<i;++n)r=e[n],r!=null&&(r<s&&(s=r),r>a&&(a=r))}else{for(r=t(e[n]);n<i&&(r==null||r!==r);r=t(e[++n]));for(s=a=r;n<i;++n)r=t(e[n]),r!=null&&(r<s&&(s=r),r>a&&(a=r))}return[s,a]}function $N(e,t){const n=e.length;let i=-1,r,s,a,o,u;if(t==null){for(;++i<n;)if(s=e[i],s!=null&&s>=s){r=a=s;break}if(i===n)return[-1,-1];for(o=u=i;++i<n;)s=e[i],s!=null&&(r>s&&(r=s,o=i),a<s&&(a=s,u=i))}else{for(;++i<n;)if(s=t(e[i],i,e),s!=null&&s>=s){r=a=s;break}if(i===n)return[-1,-1];for(o=u=i;++i<n;)s=t(e[i],i,e),s!=null&&(r>s&&(r=s,o=i),a<s&&(a=s,u=i))}return[o,u]}function Z(e,t){return Object.hasOwn(e,t)}const lp={};function _c(e){let t={},n;function i(s){return Z(t,s)&&t[s]!==lp}const r={size:0,empty:0,object:t,has:i,get(s){return i(s)?t[s]:void 0},set(s,a){return i(s)||(++r.size,t[s]===lp&&--r.empty),t[s]=a,this},delete(s){return i(s)&&(--r.size,++r.empty,t[s]=lp),this},clear(){r.size=r.empty=0,r.object=t={}},test(s){return arguments.length?(n=s,r):n},clean(){const s={};let a=0;for(const o in t){const u=t[o];u!==lp&&(!n||!n(u))&&(s[o]=u,++a)}r.size=a,r.empty=0,r.object=t=s}};return e&&Object.keys(e).forEach(s=>{r.set(s,e[s])}),r}function TN(e,t,n,i,r,s){if(!n&&n!==0)return s;const a=+n;let o=e[0],u=Fe(e),l;u<o&&(l=o,o=u,u=l),l=Math.abs(t-o);const c=Math.abs(u-t);return l<c&&l<=a?i:c<=a?r:s}function Y(e,t,n){const i=e.prototype=Object.create(t.prototype);return Object.defineProperty(i,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),ve(i,n)}function gl(e,t,n,i){let r=t[0],s=t[t.length-1],a;return r>s&&(a=r,r=s,s=a),n=n===void 0||n,i=i===void 0||i,(n?r<=e:r<e)&&(i?e<=s:e<s)}function ao(e){return typeof e=="boolean"}function Da(e){return Object.prototype.toString.call(e)==="[object Date]"}function FN(e){return e&&we(e[Symbol.iterator])}function Ie(e){return typeof e=="number"}function MN(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function J(e){return typeof e=="string"}function Iw(e,t,n){e&&(e=t?Q(e).map(o=>o.replace(/\\(.)/g,"$1")):Q(e));const i=e&&e.length,r=n&&n.get||dN,s=o=>r(t?[o]:rs(o));let a;if(!i)a=function(){return""};else if(i===1){const o=s(e[0]);a=function(u){return""+o(u)}}else{const o=e.map(s);a=function(u){let l=""+o[0](u),c=0;for(;++c<i;)l+="|"+o[c](u);return l}}return Jn(a,e,"key")}function ON(e,t){const n=e[0],i=Fe(e),r=+t;return r?r===1?i:n+r*(i-n):n}const Fj=1e4;function NN(e){e=+e||Fj;let t,n,i;const r=()=>{t={},n={},i=0},s=(a,o)=>(++i>e&&(n=t,t={},i=1),t[a]=o);return r(),{clear:r,has:a=>Z(t,a)||Z(n,a),get:a=>Z(t,a)?t[a]:Z(n,a)?s(a,n[a]):void 0,set:(a,o)=>Z(t,a)?t[a]=o:s(a,o)}}function RN(e,t,n,i){const r=t.length,s=n.length;if(!s)return t;if(!r)return n;const a=i||new t.constructor(r+s);let o=0,u=0,l=0;for(;o<r&&u<s;++l)a[l]=e(t[o],n[u])>0?n[u++]:t[o++];for(;o<r;++o,++l)a[l]=t[o];for(;u<s;++u,++l)a[l]=n[u];return a}function Nf(e,t){let n="";for(;--t>=0;)n+=e;return n}function DN(e,t,n,i){const r=n||" ",s=e+"",a=t-s.length;return a<=0?s:i==="left"?Nf(r,a)+s:i==="center"?Nf(r,~~(a/2))+s+Nf(r,Math.ceil(a/2)):s+Nf(r,a)}function od(e){return e&&Fe(e)-e[0]||0}function G(e){return L(e)?"["+e.map(G)+"]":K(e)||J(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Pw(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const Mj=e=>Ie(e)||Da(e)?e:Date.parse(e);function Lw(e,t){return t=t||Mj,e==null||e===""?null:t(e)}function zw(e){return e==null||e===""?null:e+""}function ur(e){const t={},n=e.length;for(let i=0;i<n;++i)t[e[i]]=!0;return t}function IN(e,t,n,i){const r=i??"…",s=e+"",a=s.length,o=Math.max(0,t-r.length);return a<=t?s:n==="left"?r+s.slice(a-o):n==="center"?s.slice(0,Math.ceil(o/2))+r+s.slice(a-~~(o/2)):s.slice(0,o)+r}function xa(e,t,n){if(e)if(t){const i=e.length;for(let r=0;r<i;++r){const s=t(e[r]);s&&n(s,r,e)}}else e.forEach(n)}var WC={},Xy={},Ky=34,sf=10,Qy=13;function PN(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function Oj(e,t){var n=PN(e);return function(i,r){return t(n(i),r,e)}}function HC(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function zn(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function Nj(e){return e<0?"-"+zn(-e,6):e>9999?"+"+zn(e,6):zn(e,4)}function Rj(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Nj(e.getUTCFullYear())+"-"+zn(e.getUTCMonth()+1,2)+"-"+zn(e.getUTCDate(),2)+(r?"T"+zn(t,2)+":"+zn(n,2)+":"+zn(i,2)+"."+zn(r,3)+"Z":i?"T"+zn(t,2)+":"+zn(n,2)+":"+zn(i,2)+"Z":n||t?"T"+zn(t,2)+":"+zn(n,2)+"Z":"")}function Dj(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(f,h){var d,p,g=r(f,function(m,y){if(d)return d(m,y-1);p=m,d=h?Oj(m,h):PN(m)});return g.columns=p||[],g}function r(f,h){var d=[],p=f.length,g=0,m=0,y,x=p<=0,v=!1;f.charCodeAt(p-1)===sf&&--p,f.charCodeAt(p-1)===Qy&&--p;function b(){if(x)return Xy;if(v)return v=!1,WC;var E,_=g,k;if(f.charCodeAt(_)===Ky){for(;g++<p&&f.charCodeAt(g)!==Ky||f.charCodeAt(++g)===Ky;);return(E=g)>=p?x=!0:(k=f.charCodeAt(g++))===sf?v=!0:k===Qy&&(v=!0,f.charCodeAt(g)===sf&&++g),f.slice(_+1,E-1).replace(/""/g,'"')}for(;g<p;){if((k=f.charCodeAt(E=g++))===sf)v=!0;else if(k===Qy)v=!0,f.charCodeAt(g)===sf&&++g;else if(k!==n)continue;return f.slice(_,E)}return x=!0,f.slice(_,p)}for(;(y=b())!==Xy;){for(var w=[];y!==WC&&y!==Xy;)w.push(y),y=b();h&&(w=h(w,m++))==null||d.push(w)}return d}function s(f,h){return f.map(function(d){return h.map(function(p){return c(d[p])}).join(e)})}function a(f,h){return h==null&&(h=HC(f)),[h.map(c).join(e)].concat(s(f,h)).join(`
`)}function o(f,h){return h==null&&(h=HC(f)),s(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?Rj(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:i,parseRows:r,format:a,formatBody:o,formatRows:u,formatRow:l,formatValue:c}}function Ij(e){return e}function Pj(e){if(e==null)return Ij;var t,n,i=e.scale[0],r=e.scale[1],s=e.translate[0],a=e.translate[1];return function(o,u){u||(t=n=0);var l=2,c=o.length,f=new Array(c);for(f[0]=(t+=o[0])*i+s,f[1]=(n+=o[1])*r+a;l<c;)f[l]=o[l],++l;return f}}function Lj(e,t){for(var n,i=e.length,r=i-t;r<--i;)n=e[r],e[r++]=e[i],e[i]=n}function zj(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return GC(e,n)})}:GC(e,t)}function GC(e,t){var n=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,s=LN(e,t);return n==null&&i==null?{type:"Feature",properties:r,geometry:s}:i==null?{type:"Feature",id:n,properties:r,geometry:s}:{type:"Feature",id:n,bbox:i,properties:r,geometry:s}}function LN(e,t){var n=Pj(e.transform),i=e.arcs;function r(c,f){f.length&&f.pop();for(var h=i[c<0?~c:c],d=0,p=h.length;d<p;++d)f.push(n(h[d],d));c<0&&Lj(f,p)}function s(c){return n(c)}function a(c){for(var f=[],h=0,d=c.length;h<d;++h)r(c[h],f);return f.length<2&&f.push(f[0]),f}function o(c){for(var f=a(c);f.length<4;)f.push(f[0]);return f}function u(c){return c.map(o)}function l(c){var f=c.type,h;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(l)};case"Point":h=s(c.coordinates);break;case"MultiPoint":h=c.coordinates.map(s);break;case"LineString":h=a(c.arcs);break;case"MultiLineString":h=c.arcs.map(a);break;case"Polygon":h=u(c.arcs);break;case"MultiPolygon":h=c.arcs.map(u);break;default:return null}return{type:f,coordinates:h}}return l(t)}function Bj(e,t){var n={},i={},r={},s=[],a=-1;t.forEach(function(l,c){var f=e.arcs[l<0?~l:l],h;f.length<3&&!f[1][0]&&!f[1][1]&&(h=t[++a],t[a]=l,t[c]=h)}),t.forEach(function(l){var c=o(l),f=c[0],h=c[1],d,p;if(d=r[f])if(delete r[d.end],d.push(l),d.end=h,p=i[h]){delete i[p.start];var g=p===d?d:d.concat(p);i[g.start=d.start]=r[g.end=p.end]=g}else i[d.start]=r[d.end]=d;else if(d=i[h])if(delete i[d.start],d.unshift(l),d.start=f,p=r[f]){delete r[p.end];var m=p===d?d:p.concat(d);i[m.start=p.start]=r[m.end=d.end]=m}else i[d.start]=r[d.end]=d;else d=[l],i[d.start=f]=r[d.end=h]=d});function o(l){var c=e.arcs[l<0?~l:l],f=c[0],h;return e.transform?(h=[0,0],c.forEach(function(d){h[0]+=d[0],h[1]+=d[1]})):h=c[c.length-1],l<0?[h,f]:[f,h]}function u(l,c){for(var f in l){var h=l[f];delete c[h.start],delete h.start,delete h.end,h.forEach(function(d){n[d<0?~d:d]=1}),s.push(h)}}return u(r,i),u(i,r),t.forEach(function(l){n[l<0?~l:l]||s.push([l])}),s}function Uj(e){return LN(e,jj.apply(this,arguments))}function jj(e,t,n){var i,r,s;if(arguments.length>1)i=qj(e,t,n);else for(r=0,i=new Array(s=e.arcs.length);r<s;++r)i[r]=r;return{type:"MultiLineString",arcs:Bj(e,i)}}function qj(e,t,n){var i=[],r=[],s;function a(f){var h=f<0?~f:f;(r[h]||(r[h]=[])).push({i:f,g:s})}function o(f){f.forEach(a)}function u(f){f.forEach(o)}function l(f){f.forEach(u)}function c(f){switch(s=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":o(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":l(f.arcs);break}}return c(t),r.forEach(n==null?function(f){i.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&i.push(f[0].i)}),i}function Ls(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Vj(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ec(e){let t,n,i;e.length!==2?(t=Ls,n=(o,u)=>Ls(e(o),u),i=(o,u)=>e(o)-u):(t=e===Ls||e===Vj?e:Wj,n=e,i=e);function r(o,u,l=0,c=o.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(o[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(o,u,l=0,c=o.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(o[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function a(o,u,l=0,c=o.length){const f=r(o,u,l,c-1);return f>l&&i(o[f-1],u)>-i(o[f],u)?f-1:f}return{left:r,center:a,right:s}}function Wj(){return 0}function zN(e){return e===null?NaN:+e}function*Hj(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)(i=t(i,++n,e))!=null&&(i=+i)>=i&&(yield i)}}const BN=Ec(Ls),ja=BN.right,Gj=BN.left;Ec(zN).center;function Yj(e,t){let n=0,i,r=0,s=0;if(t===void 0)for(let a of e)a!=null&&(a=+a)>=a&&(i=a-r,r+=i/++n,s+=i*(a-r));else{let a=-1;for(let o of e)(o=t(o,++a,e))!=null&&(o=+o)>=o&&(i=o-r,r+=i/++n,s+=i*(o-r))}if(n>1)return s/(n-1)}function Xj(e,t){const n=Yj(e,t);return n&&Math.sqrt(n)}class Tn{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let i=0;for(let r=0;r<this._n&&r<32;r++){const s=n[r],a=t+s,o=Math.abs(t)<Math.abs(s)?t-(a-s):s-(a-t);o&&(n[i++]=o),t=a}return n[i]=t,this._n=i+1,this}valueOf(){const t=this._partials;let n=this._n,i,r,s,a=0;if(n>0){for(a=t[--n];n>0&&(i=a,r=t[--n],a=i+r,s=r-(a-i),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(r=s*2,i=a+r,r==i-a&&(a=i))}return a}}class YC extends Map{constructor(t,n=qN){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,r]of t)this.set(i,r)}get(t){return super.get(Jv(this,t))}has(t){return super.has(Jv(this,t))}set(t,n){return super.set(UN(this,t),n)}delete(t){return super.delete(jN(this,t))}}class Rg extends Set{constructor(t,n=qN){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const i of t)this.add(i)}has(t){return super.has(Jv(this,t))}add(t){return super.add(UN(this,t))}delete(t){return super.delete(jN(this,t))}}function Jv({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function UN({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function jN({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function qN(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Kj(e,t){return Array.from(t,n=>e[n])}function Qj(e=Ls){if(e===Ls)return VN;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,n)=>{const i=e(t,n);return i||i===0?i:(e(n,n)===0)-(e(t,t)===0)}}function VN(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const Jj=Math.sqrt(50),Zj=Math.sqrt(10),eq=Math.sqrt(2);function Dg(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),a=s>=Jj?10:s>=Zj?5:s>=eq?2:1;let o,u,l;return r<0?(l=Math.pow(10,-r)/a,o=Math.round(e*l),u=Math.round(t*l),o/l<e&&++o,u/l>t&&--u,l=-l):(l=Math.pow(10,r)*a,o=Math.round(e/l),u=Math.round(t/l),o*l<e&&++o,u*l>t&&--u),u<o&&.5<=n&&n<2?Dg(e,t,n*2):[o,u,l]}function Zv(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,s,a]=i?Dg(t,e,n):Dg(e,t,n);if(!(s>=r))return[];const o=s-r+1,u=new Array(o);if(i)if(a<0)for(let l=0;l<o;++l)u[l]=(s-l)/-a;else for(let l=0;l<o;++l)u[l]=(s-l)*a;else if(a<0)for(let l=0;l<o;++l)u[l]=(r+l)/-a;else for(let l=0;l<o;++l)u[l]=(r+l)*a;return u}function eb(e,t,n){return t=+t,e=+e,n=+n,Dg(e,t,n)[2]}function qa(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?eb(t,e,n):eb(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}function Ko(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n<i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n<r||n===void 0&&r>=r)&&(n=r)}return n}function tb(e,t){let n;if(t===void 0)for(const i of e)i!=null&&(n>i||n===void 0&&i>=i)&&(n=i);else{let i=-1;for(let r of e)(r=t(r,++i,e))!=null&&(n>r||n===void 0&&r>=r)&&(n=r)}return n}function WN(e,t,n=0,i=1/0,r){if(t=Math.floor(t),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(e.length-1,i)),!(n<=t&&t<=i))return e;for(r=r===void 0?VN:Qj(r);i>n;){if(i-n>600){const u=i-n+1,l=t-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),d=Math.max(n,Math.floor(t-l*f/u+h)),p=Math.min(i,Math.floor(t+(u-l)*f/u+h));WN(e,t,d,p,r)}const s=e[t];let a=n,o=i;for(af(e,n,t),r(e[i],s)>0&&af(e,n,i);a<o;){for(af(e,a,o),++a,--o;r(e[a],s)<0;)++a;for(;r(e[o],s)>0;)--o}r(e[n],s)===0?af(e,n,o):(++o,af(e,o,i)),o<=t&&(n=o+1),t<=o&&(i=o-1)}return e}function af(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function nb(e,t,n){if(e=Float64Array.from(Hj(e,n)),!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return tb(e);if(t>=1)return Ko(e);var i,r=(i-1)*t,s=Math.floor(r),a=Ko(WN(e,s).subarray(0,s+1)),o=tb(e.subarray(s+1));return a+(o-a)*(r-s)}}function HN(e,t,n=zN){if(!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return+n(e[0],0,e);if(t>=1)return+n(e[i-1],i-1,e);var i,r=(i-1)*t,s=Math.floor(r),a=+n(e[s],s,e),o=+n(e[s+1],s+1,e);return a+(o-a)*(r-s)}}function tq(e,t){let n=0,i=0;if(t===void 0)for(let r of e)r!=null&&(r=+r)>=r&&(++n,i+=r);else{let r=-1;for(let s of e)(s=t(s,++r,e))!=null&&(s=+s)>=s&&(++n,i+=s)}if(n)return i/n}function GN(e,t){return nb(e,.5,t)}function*nq(e){for(const t of e)yield*t}function YN(e){return Array.from(nq(e))}function si(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(r);++i<r;)s[i]=e+i*n;return s}function XN(e,t){let n=0;for(let i of e)(i=+i)&&(n+=i);return n}function iq(e,...t){e=new Rg(e),t=t.map(rq);e:for(const n of e)for(const i of t)if(!i.has(n)){e.delete(n);continue e}return e}function rq(e){return e instanceof Rg?e:new Rg(e)}function sq(...e){const t=new Rg;for(const n of e)for(const i of n)t.add(i);return t}function aq(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ig(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function Dl(e){return e=Ig(Math.abs(e)),e?e[1]:NaN}function oq(e,t){return function(n,i){for(var r=n.length,s=[],a=0,o=e[0],u=0;r>0&&o>0&&(u+o+1>i&&(o=Math.max(1,i-u)),s.push(n.substring(r-=o,r+o)),!((u+=o+1)>i));)o=e[a=(a+1)%e.length];return s.reverse().join(t)}}function uq(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var lq=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function au(e){if(!(t=lq.exec(e)))throw new Error("invalid format: "+e);var t;return new Bw({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}au.prototype=Bw.prototype;function Bw(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Bw.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function cq(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var KN;function fq(e,t){var n=Ig(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(KN=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,a=i.length;return s===a?i:s>a?i+new Array(s-a+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Ig(e,Math.max(0,t+s-1))[0]}function XC(e,t){var n=Ig(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const KC={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:aq,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>XC(e*100,t),r:XC,s:fq,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function QC(e){return e}var JC=Array.prototype.map,ZC=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function QN(e){var t=e.grouping===void 0||e.thousands===void 0?QC:oq(JC.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?QC:uq(JC.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"−":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=au(f);var h=f.fill,d=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,x=f.comma,v=f.precision,b=f.trim,w=f.type;w==="n"?(x=!0,w="g"):KC[w]||(v===void 0&&(v=12),b=!0,w="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var E=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",_=g==="$"?i:/[%p]/.test(w)?a:"",k=KC[w],A=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function T($){var R=E,O=_,F,C,M;if(w==="c")O=k($)+O,$="";else{$=+$;var D=$<0||1/$<0;if($=isNaN($)?u:k(Math.abs($),v),b&&($=cq($)),D&&+$==0&&p!=="+"&&(D=!1),R=(D?p==="("?p:o:p==="-"||p==="("?"":p)+R,O=(w==="s"?ZC[8+KN/3]:"")+O+(D&&p==="("?")":""),A){for(F=-1,C=$.length;++F<C;)if(M=$.charCodeAt(F),48>M||M>57){O=(M===46?r+$.slice(F+1):$.slice(F))+O,$=$.slice(0,F);break}}}x&&!m&&($=t($,1/0));var B=R.length+$.length+O.length,z=B<y?new Array(y-B+1).join(h):"";switch(x&&m&&($=t(z+$,z.length?y-O.length:1/0),z=""),d){case"<":$=R+$+O+z;break;case"=":$=R+z+$+O;break;case"^":$=z.slice(0,B=z.length>>1)+R+$+O+z.slice(B);break;default:$=z+R+$+O;break}return s($)}return T.toString=function(){return f+""},T}function c(f,h){var d=l((f=au(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Dl(h)/3)))*3,g=Math.pow(10,-p),m=ZC[8+p/3];return function(y){return d(g*y)+m}}return{format:l,formatPrefix:c}}var cp,Sm,Uw;hq({thousands:",",grouping:[3],currency:["$",""]});function hq(e){return cp=QN(e),Sm=cp.format,Uw=cp.formatPrefix,cp}function JN(e){return Math.max(0,-Dl(Math.abs(e)))}function ZN(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Dl(t)/3)))*3-Dl(Math.abs(e)))}function eR(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Dl(t)-Dl(e))+1}const Jy=new Date,Zy=new Date;function Ft(e,t,n,i){function r(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return r.floor=s=>(e(s=new Date(+s)),s),r.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),r.round=s=>{const a=r(s),o=r.ceil(s);return s-a<o-s?a:o},r.offset=(s,a)=>(t(s=new Date(+s),a==null?1:Math.floor(a)),s),r.range=(s,a,o)=>{const u=[];if(s=r.ceil(s),o=o==null?1:Math.floor(o),!(s<a)||!(o>0))return u;let l;do u.push(l=new Date(+s)),t(s,o),e(s);while(l<s&&s<a);return u},r.filter=s=>Ft(a=>{if(a>=a)for(;e(a),!s(a);)a.setTime(a-1)},(a,o)=>{if(a>=a)if(o<0)for(;++o<=0;)for(;t(a,-1),!s(a););else for(;--o>=0;)for(;t(a,1),!s(a););}),n&&(r.count=(s,a)=>(Jy.setTime(+s),Zy.setTime(+a),e(Jy),e(Zy),Math.floor(n(Jy,Zy))),r.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?r.filter(i?a=>i(a)%s===0:a=>r.count(0,a)%s===0):r)),r}const Il=Ft(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Il.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ft(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):Il);Il.range;const Ms=1e3,ki=Ms*60,Os=ki*60,Hs=Os*24,jw=Hs*7,e$=Hs*30,ex=Hs*365,Ns=Ft(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Ms)},(e,t)=>(t-e)/Ms,e=>e.getUTCSeconds());Ns.range;const km=Ft(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ms)},(e,t)=>{e.setTime(+e+t*ki)},(e,t)=>(t-e)/ki,e=>e.getMinutes());km.range;const Am=Ft(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*ki)},(e,t)=>(t-e)/ki,e=>e.getUTCMinutes());Am.range;const Cm=Ft(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Ms-e.getMinutes()*ki)},(e,t)=>{e.setTime(+e+t*Os)},(e,t)=>(t-e)/Os,e=>e.getHours());Cm.range;const $m=Ft(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Os)},(e,t)=>(t-e)/Os,e=>e.getUTCHours());$m.range;const zs=Ft(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ki)/Hs,e=>e.getDate()-1);zs.range;const Ia=Ft(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Hs,e=>e.getUTCDate()-1);Ia.range;const tR=Ft(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Hs,e=>Math.floor(e/Hs));tR.range;function Tu(e){return Ft(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*ki)/jw)}const Sc=Tu(0),Pg=Tu(1),dq=Tu(2),pq=Tu(3),Pl=Tu(4),gq=Tu(5),mq=Tu(6);Sc.range;Pg.range;dq.range;pq.range;Pl.range;gq.range;mq.range;function Fu(e){return Ft(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/jw)}const kc=Fu(0),Lg=Fu(1),yq=Fu(2),xq=Fu(3),Ll=Fu(4),vq=Fu(5),bq=Fu(6);kc.range;Lg.range;yq.range;xq.range;Ll.range;vq.range;bq.range;const wh=Ft(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());wh.range;const _h=Ft(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());_h.range;const Xr=Ft(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Xr.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ft(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Xr.range;const Kr=Ft(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Kr.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Ft(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Kr.range;function nR(e,t,n,i,r,s){const a=[[Ns,1,Ms],[Ns,5,5*Ms],[Ns,15,15*Ms],[Ns,30,30*Ms],[s,1,ki],[s,5,5*ki],[s,15,15*ki],[s,30,30*ki],[r,1,Os],[r,3,3*Os],[r,6,6*Os],[r,12,12*Os],[i,1,Hs],[i,2,2*Hs],[n,1,jw],[t,1,e$],[t,3,3*e$],[e,1,ex]];function o(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=Ec(([,,m])=>m).right(a,h);if(d===a.length)return e.every(qa(l/ex,c/ex,f));if(d===0)return Il.every(Math.max(qa(l,c,f),1));const[p,g]=a[h/a[d-1][2]<a[d][2]/h?d-1:d];return p.every(g)}return[o,u]}const[wq,_q]=nR(Kr,_h,kc,tR,$m,Am),[Eq,Sq]=nR(Xr,wh,Sc,zs,Cm,km),Qt="year",Hn="quarter",pn="month",At="week",Gn="date",cn="day",Qr="dayofyear",fi="hours",hi="minutes",Ni="seconds",lr="milliseconds",qw=[Qt,Hn,pn,At,Gn,cn,Qr,fi,hi,Ni,lr],tx=qw.reduce((e,t,n)=>(e[t]=1+n,e),{});function Vw(e){const t=Q(e).slice(),n={};return t.length||P("Missing time unit."),t.forEach(r=>{Z(tx,r)?n[r]=1:P(`Invalid time unit: ${r}.`)}),(n[At]||n[cn]?1:0)+(n[Hn]||n[pn]||n[Gn]?1:0)+(n[Qr]?1:0)>1&&P(`Incompatible time units: ${e}`),t.sort((r,s)=>tx[r]-tx[s]),t}const kq={[Qt]:"%Y ",[Hn]:"Q%q ",[pn]:"%b ",[Gn]:"%d ",[At]:"W%U ",[cn]:"%a ",[Qr]:"%j ",[fi]:"%H:00",[hi]:"00:%M",[Ni]:":%S",[lr]:".%L",[`${Qt}-${pn}`]:"%Y-%m ",[`${Qt}-${pn}-${Gn}`]:"%Y-%m-%d ",[`${fi}-${hi}`]:"%H:%M"};function iR(e,t){const n=ve({},kq,t),i=Vw(e),r=i.length;let s="",a=0,o,u;for(a=0;a<r;)for(o=i.length;o>a;--o)if(u=i.slice(a,o).join("-"),n[u]!=null){s+=n[u],a=o;break}return s.trim()}const Uo=new Date;function Ww(e){return Uo.setFullYear(e),Uo.setMonth(0),Uo.setDate(1),Uo.setHours(0,0,0,0),Uo}function rR(e){return aR(new Date(e))}function sR(e){return ib(new Date(e))}function aR(e){return zs.count(Ww(e.getFullYear())-1,e)}function ib(e){return Sc.count(Ww(e.getFullYear())-1,e)}function rb(e){return Ww(e).getDay()}function Aq(e,t,n,i,r,s,a){if(0<=e&&e<100){const o=new Date(-1,t,n,i,r,s,a);return o.setFullYear(e),o}return new Date(e,t,n,i,r,s,a)}function oR(e){return lR(new Date(e))}function uR(e){return sb(new Date(e))}function lR(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Ia.count(t-1,e)}function sb(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return kc.count(t-1,e)}function ab(e){return Uo.setTime(Date.UTC(e,0,1)),Uo.getUTCDay()}function Cq(e,t,n,i,r,s,a){if(0<=e&&e<100){const o=new Date(Date.UTC(-1,t,n,i,r,s,a));return o.setUTCFullYear(n.y),o}return new Date(Date.UTC(e,t,n,i,r,s,a))}function cR(e,t,n,i,r){const s=t||1,a=Fe(e),o=(y,x,v)=>(v=v||y,$q(n[v],i[v],y===a&&s,x)),u=new Date,l=ur(e),c=l[Qt]?o(Qt):xn(2012),f=l[pn]?o(pn):l[Hn]?o(Hn):Ea,h=l[At]&&l[cn]?o(cn,1,At+cn):l[At]?o(At,1):l[cn]?o(cn,1):l[Gn]?o(Gn,1):l[Qr]?o(Qr,1):xc,d=l[fi]?o(fi):Ea,p=l[hi]?o(hi):Ea,g=l[Ni]?o(Ni):Ea,m=l[lr]?o(lr):Ea;return function(y){u.setTime(+y);const x=c(u);return r(x,f(u),h(u,x),d(u),p(u),g(u),m(u))}}function $q(e,t,n,i){const r=n<=1?e:i?(s,a)=>i+n*Math.floor((e(s,a)-i)/n):(s,a)=>n*Math.floor(e(s,a)/n);return t?(s,a)=>t(r(s,a),a):r}function zl(e,t,n){return t+e*7-(n+6)%7}const Tq={[Qt]:e=>e.getFullYear(),[Hn]:e=>Math.floor(e.getMonth()/3),[pn]:e=>e.getMonth(),[Gn]:e=>e.getDate(),[fi]:e=>e.getHours(),[hi]:e=>e.getMinutes(),[Ni]:e=>e.getSeconds(),[lr]:e=>e.getMilliseconds(),[Qr]:e=>aR(e),[At]:e=>ib(e),[At+cn]:(e,t)=>zl(ib(e),e.getDay(),rb(t)),[cn]:(e,t)=>zl(1,e.getDay(),rb(t))},Fq={[Hn]:e=>3*e,[At]:(e,t)=>zl(e,0,rb(t))};function fR(e,t){return cR(e,t||1,Tq,Fq,Aq)}const Mq={[Qt]:e=>e.getUTCFullYear(),[Hn]:e=>Math.floor(e.getUTCMonth()/3),[pn]:e=>e.getUTCMonth(),[Gn]:e=>e.getUTCDate(),[fi]:e=>e.getUTCHours(),[hi]:e=>e.getUTCMinutes(),[Ni]:e=>e.getUTCSeconds(),[lr]:e=>e.getUTCMilliseconds(),[Qr]:e=>lR(e),[At]:e=>sb(e),[cn]:(e,t)=>zl(1,e.getUTCDay(),ab(t)),[At+cn]:(e,t)=>zl(sb(e),e.getUTCDay(),ab(t))},Oq={[Hn]:e=>3*e,[At]:(e,t)=>zl(e,0,ab(t))};function hR(e,t){return cR(e,t||1,Mq,Oq,Cq)}const Nq={[Qt]:Xr,[Hn]:wh.every(3),[pn]:wh,[At]:Sc,[Gn]:zs,[cn]:zs,[Qr]:zs,[fi]:Cm,[hi]:km,[Ni]:Ns,[lr]:Il},Rq={[Qt]:Kr,[Hn]:_h.every(3),[pn]:_h,[At]:kc,[Gn]:Ia,[cn]:Ia,[Qr]:Ia,[fi]:$m,[hi]:Am,[Ni]:Ns,[lr]:Il};function Ac(e){return Nq[e]}function Cc(e){return Rq[e]}function dR(e,t,n){return e?e.offset(t,n):void 0}function pR(e,t,n){return dR(Ac(e),t,n)}function gR(e,t,n){return dR(Cc(e),t,n)}function mR(e,t,n,i){return e?e.range(t,n,i):void 0}function yR(e,t,n,i){return mR(Ac(e),t,n,i)}function xR(e,t,n,i){return mR(Cc(e),t,n,i)}const Rf=1e3,Df=Rf*60,If=Df*60,Tm=If*24,Dq=Tm*7,t$=Tm*30,ob=Tm*365,vR=[Qt,pn,Gn,fi,hi,Ni,lr],Pf=vR.slice(0,-1),Lf=Pf.slice(0,-1),zf=Lf.slice(0,-1),Iq=zf.slice(0,-1),Pq=[Qt,At],n$=[Qt,pn],bR=[Qt],of=[[Pf,1,Rf],[Pf,5,5*Rf],[Pf,15,15*Rf],[Pf,30,30*Rf],[Lf,1,Df],[Lf,5,5*Df],[Lf,15,15*Df],[Lf,30,30*Df],[zf,1,If],[zf,3,3*If],[zf,6,6*If],[zf,12,12*If],[Iq,1,Tm],[Pq,1,Dq],[n$,1,t$],[n$,3,3*t$],[bR,1,ob]];function wR(e){const t=e.extent,n=e.maxbins||40,i=Math.abs(od(t))/n;let r=Ec(o=>o[2]).right(of,i),s,a;return r===of.length?(s=bR,a=qa(t[0]/ob,t[1]/ob,n)):r?(r=of[i/of[r-1][2]<of[r][2]/i?r-1:r],s=r[0],a=r[1]):(s=vR,a=Math.max(qa(t[0],t[1],n),1)),{units:s,step:a}}function nx(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function ix(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function uf(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function _R(e){var t=e.dateTime,n=e.date,i=e.time,r=e.periods,s=e.days,a=e.shortDays,o=e.months,u=e.shortMonths,l=lf(r),c=cf(r),f=lf(s),h=cf(s),d=lf(a),p=cf(a),g=lf(o),m=cf(o),y=lf(u),x=cf(u),v={a:D,A:B,b:z,B:ee,c:null,d:u$,e:u$,f:aV,g:mV,G:xV,H:iV,I:rV,j:sV,L:ER,m:oV,M:uV,p:he,q:le,Q:f$,s:h$,S:lV,u:cV,U:fV,V:hV,w:dV,W:pV,x:null,X:null,y:gV,Y:yV,Z:vV,"%":c$},b={a:me,A:Xe,b:ye,B:nn,c:null,d:l$,e:l$,f:EV,g:NV,G:DV,H:bV,I:wV,j:_V,L:kR,m:SV,M:kV,p:Ao,q:da,Q:f$,s:h$,S:AV,u:CV,U:$V,V:TV,w:FV,W:MV,x:null,X:null,y:OV,Y:RV,Z:IV,"%":c$},w={a:T,A:$,b:R,B:O,c:F,d:a$,e:a$,f:Zq,g:s$,G:r$,H:o$,I:o$,j:Xq,L:Jq,m:Yq,M:Kq,p:A,q:Gq,Q:tV,s:nV,S:Qq,u:jq,U:qq,V:Vq,w:Uq,W:Wq,x:C,X:M,y:s$,Y:r$,Z:Hq,"%":eV};v.x=E(n,v),v.X=E(i,v),v.c=E(t,v),b.x=E(n,b),b.X=E(i,b),b.c=E(t,b);function E(te,be){return function(Ee){var H=[],qt=-1,Ue=0,rn=te.length,Ot,Ar,ap;for(Ee instanceof Date||(Ee=new Date(+Ee));++qt<rn;)te.charCodeAt(qt)===37&&(H.push(te.slice(Ue,qt)),(Ar=i$[Ot=te.charAt(++qt)])!=null?Ot=te.charAt(++qt):Ar=Ot==="e"?" ":"0",(ap=be[Ot])&&(Ot=ap(Ee,Ar)),H.push(Ot),Ue=qt+1);return H.push(te.slice(Ue,qt)),H.join("")}}function _(te,be){return function(Ee){var H=uf(1900,void 0,1),qt=k(H,te,Ee+="",0),Ue,rn;if(qt!=Ee.length)return null;if("Q"in H)return new Date(H.Q);if("s"in H)return new Date(H.s*1e3+("L"in H?H.L:0));if(be&&!("Z"in H)&&(H.Z=0),"p"in H&&(H.H=H.H%12+H.p*12),H.m===void 0&&(H.m="q"in H?H.q:0),"V"in H){if(H.V<1||H.V>53)return null;"w"in H||(H.w=1),"Z"in H?(Ue=ix(uf(H.y,0,1)),rn=Ue.getUTCDay(),Ue=rn>4||rn===0?Lg.ceil(Ue):Lg(Ue),Ue=Ia.offset(Ue,(H.V-1)*7),H.y=Ue.getUTCFullYear(),H.m=Ue.getUTCMonth(),H.d=Ue.getUTCDate()+(H.w+6)%7):(Ue=nx(uf(H.y,0,1)),rn=Ue.getDay(),Ue=rn>4||rn===0?Pg.ceil(Ue):Pg(Ue),Ue=zs.offset(Ue,(H.V-1)*7),H.y=Ue.getFullYear(),H.m=Ue.getMonth(),H.d=Ue.getDate()+(H.w+6)%7)}else("W"in H||"U"in H)&&("w"in H||(H.w="u"in H?H.u%7:"W"in H?1:0),rn="Z"in H?ix(uf(H.y,0,1)).getUTCDay():nx(uf(H.y,0,1)).getDay(),H.m=0,H.d="W"in H?(H.w+6)%7+H.W*7-(rn+5)%7:H.w+H.U*7-(rn+6)%7);return"Z"in H?(H.H+=H.Z/100|0,H.M+=H.Z%100,ix(H)):nx(H)}}function k(te,be,Ee,H){for(var qt=0,Ue=be.length,rn=Ee.length,Ot,Ar;qt<Ue;){if(H>=rn)return-1;if(Ot=be.charCodeAt(qt++),Ot===37){if(Ot=be.charAt(qt++),Ar=w[Ot in i$?be.charAt(qt++):Ot],!Ar||(H=Ar(te,Ee,H))<0)return-1}else if(Ot!=Ee.charCodeAt(H++))return-1}return H}function A(te,be,Ee){var H=l.exec(be.slice(Ee));return H?(te.p=c.get(H[0].toLowerCase()),Ee+H[0].length):-1}function T(te,be,Ee){var H=d.exec(be.slice(Ee));return H?(te.w=p.get(H[0].toLowerCase()),Ee+H[0].length):-1}function $(te,be,Ee){var H=f.exec(be.slice(Ee));return H?(te.w=h.get(H[0].toLowerCase()),Ee+H[0].length):-1}function R(te,be,Ee){var H=y.exec(be.slice(Ee));return H?(te.m=x.get(H[0].toLowerCase()),Ee+H[0].length):-1}function O(te,be,Ee){var H=g.exec(be.slice(Ee));return H?(te.m=m.get(H[0].toLowerCase()),Ee+H[0].length):-1}function F(te,be,Ee){return k(te,t,be,Ee)}function C(te,be,Ee){return k(te,n,be,Ee)}function M(te,be,Ee){return k(te,i,be,Ee)}function D(te){return a[te.getDay()]}function B(te){return s[te.getDay()]}function z(te){return u[te.getMonth()]}function ee(te){return o[te.getMonth()]}function he(te){return r[+(te.getHours()>=12)]}function le(te){return 1+~~(te.getMonth()/3)}function me(te){return a[te.getUTCDay()]}function Xe(te){return s[te.getUTCDay()]}function ye(te){return u[te.getUTCMonth()]}function nn(te){return o[te.getUTCMonth()]}function Ao(te){return r[+(te.getUTCHours()>=12)]}function da(te){return 1+~~(te.getUTCMonth()/3)}return{format:function(te){var be=E(te+="",v);return be.toString=function(){return te},be},parse:function(te){var be=_(te+="",!1);return be.toString=function(){return te},be},utcFormat:function(te){var be=E(te+="",b);return be.toString=function(){return te},be},utcParse:function(te){var be=_(te+="",!0);return be.toString=function(){return te},be}}}var i$={"-":"",_:" ",0:"0"},Ut=/^\s*\d+/,Lq=/^%/,zq=/[\\^$*+?|[\]().{}]/g;function Pe(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",s=r.length;return i+(s<n?new Array(n-s+1).join(t)+r:r)}function Bq(e){return e.replace(zq,"\\$&")}function lf(e){return new RegExp("^(?:"+e.map(Bq).join("|")+")","i")}function cf(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function Uq(e,t,n){var i=Ut.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function jq(e,t,n){var i=Ut.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function qq(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function Vq(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function Wq(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function r$(e,t,n){var i=Ut.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function s$(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function Hq(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function Gq(e,t,n){var i=Ut.exec(t.slice(n,n+1));return i?(e.q=i[0]*3-3,n+i[0].length):-1}function Yq(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function a$(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function Xq(e,t,n){var i=Ut.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function o$(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function Kq(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function Qq(e,t,n){var i=Ut.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function Jq(e,t,n){var i=Ut.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function Zq(e,t,n){var i=Ut.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function eV(e,t,n){var i=Lq.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function tV(e,t,n){var i=Ut.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function nV(e,t,n){var i=Ut.exec(t.slice(n));return i?(e.s=+i[0],n+i[0].length):-1}function u$(e,t){return Pe(e.getDate(),t,2)}function iV(e,t){return Pe(e.getHours(),t,2)}function rV(e,t){return Pe(e.getHours()%12||12,t,2)}function sV(e,t){return Pe(1+zs.count(Xr(e),e),t,3)}function ER(e,t){return Pe(e.getMilliseconds(),t,3)}function aV(e,t){return ER(e,t)+"000"}function oV(e,t){return Pe(e.getMonth()+1,t,2)}function uV(e,t){return Pe(e.getMinutes(),t,2)}function lV(e,t){return Pe(e.getSeconds(),t,2)}function cV(e){var t=e.getDay();return t===0?7:t}function fV(e,t){return Pe(Sc.count(Xr(e)-1,e),t,2)}function SR(e){var t=e.getDay();return t>=4||t===0?Pl(e):Pl.ceil(e)}function hV(e,t){return e=SR(e),Pe(Pl.count(Xr(e),e)+(Xr(e).getDay()===4),t,2)}function dV(e){return e.getDay()}function pV(e,t){return Pe(Pg.count(Xr(e)-1,e),t,2)}function gV(e,t){return Pe(e.getFullYear()%100,t,2)}function mV(e,t){return e=SR(e),Pe(e.getFullYear()%100,t,2)}function yV(e,t){return Pe(e.getFullYear()%1e4,t,4)}function xV(e,t){var n=e.getDay();return e=n>=4||n===0?Pl(e):Pl.ceil(e),Pe(e.getFullYear()%1e4,t,4)}function vV(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Pe(t/60|0,"0",2)+Pe(t%60,"0",2)}function l$(e,t){return Pe(e.getUTCDate(),t,2)}function bV(e,t){return Pe(e.getUTCHours(),t,2)}function wV(e,t){return Pe(e.getUTCHours()%12||12,t,2)}function _V(e,t){return Pe(1+Ia.count(Kr(e),e),t,3)}function kR(e,t){return Pe(e.getUTCMilliseconds(),t,3)}function EV(e,t){return kR(e,t)+"000"}function SV(e,t){return Pe(e.getUTCMonth()+1,t,2)}function kV(e,t){return Pe(e.getUTCMinutes(),t,2)}function AV(e,t){return Pe(e.getUTCSeconds(),t,2)}function CV(e){var t=e.getUTCDay();return t===0?7:t}function $V(e,t){return Pe(kc.count(Kr(e)-1,e),t,2)}function AR(e){var t=e.getUTCDay();return t>=4||t===0?Ll(e):Ll.ceil(e)}function TV(e,t){return e=AR(e),Pe(Ll.count(Kr(e),e)+(Kr(e).getUTCDay()===4),t,2)}function FV(e){return e.getUTCDay()}function MV(e,t){return Pe(Lg.count(Kr(e)-1,e),t,2)}function OV(e,t){return Pe(e.getUTCFullYear()%100,t,2)}function NV(e,t){return e=AR(e),Pe(e.getUTCFullYear()%100,t,2)}function RV(e,t){return Pe(e.getUTCFullYear()%1e4,t,4)}function DV(e,t){var n=e.getUTCDay();return e=n>=4||n===0?Ll(e):Ll.ceil(e),Pe(e.getUTCFullYear()%1e4,t,4)}function IV(){return"+0000"}function c$(){return"%"}function f$(e){return+e}function h$(e){return Math.floor(+e/1e3)}var Ku,Hw,CR,Gw,$R;PV({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function PV(e){return Ku=_R(e),Hw=Ku.format,CR=Ku.parse,Gw=Ku.utcFormat,$R=Ku.utcParse,Ku}function Bf(e){const t={};return n=>t[n]||(t[n]=e(n))}function LV(e,t){return n=>{const i=e(n),r=i.indexOf(t);if(r<0)return i;let s=zV(i,r);const a=s<i.length?i.slice(s):"";for(;--s>r;)if(i[s]!=="0"){++s;break}return i.slice(0,s)+a}}function zV(e,t){let n=e.lastIndexOf("e"),i;if(n>0)return n;for(n=e.length;--n>t;)if(i=e.charCodeAt(n),i>=48&&i<=57)return n+1}function TR(e){const t=Bf(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(i){const r=au(i||",");if(r.precision==null){switch(r.precision=12,r.type){case"%":r.precision-=2;break;case"e":r.precision-=1;break}return LV(t(r),t(".1f")(1)[1])}else return t(r)},formatSpan(i,r,s,a){a=au(a??",f");const o=qa(i,r,s),u=Math.max(Math.abs(i),Math.abs(r));let l;if(a.precision==null)switch(a.type){case"s":return isNaN(l=ZN(o,u))||(a.precision=l),n(a,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=eR(o,u))||(a.precision=l-(a.type==="e"));break}case"f":case"%":{isNaN(l=JN(o))||(a.precision=l-(a.type==="%")*2);break}}return t(a)}}}let ub;FR();function FR(){return ub=TR({format:Sm,formatPrefix:Uw})}function MR(e){return TR(QN(e))}function zg(e){return arguments.length?ub=MR(e):ub}function d$(e,t,n){n=n||{},K(n)||P(`Invalid time multi-format specifier: ${n}`);const i=t(Ni),r=t(hi),s=t(fi),a=t(Gn),o=t(At),u=t(pn),l=t(Hn),c=t(Qt),f=e(n[lr]||".%L"),h=e(n[Ni]||":%S"),d=e(n[hi]||"%I:%M"),p=e(n[fi]||"%I %p"),g=e(n[Gn]||n[cn]||"%a %d"),m=e(n[At]||"%b %d"),y=e(n[pn]||"%B"),x=e(n[Hn]||"%B"),v=e(n[Qt]||"%Y");return b=>(i(b)<b?f:r(b)<b?h:s(b)<b?d:a(b)<b?p:u(b)<b?o(b)<b?g:m:c(b)<b?l(b)<b?y:x:v)(b)}function OR(e){const t=Bf(e.format),n=Bf(e.utcFormat);return{timeFormat:i=>J(i)?t(i):d$(t,Ac,i),utcFormat:i=>J(i)?n(i):d$(n,Cc,i),timeParse:Bf(e.parse),utcParse:Bf(e.utcParse)}}let lb;NR();function NR(){return lb=OR({format:Hw,parse:CR,utcFormat:Gw,utcParse:$R})}function RR(e){return OR(_R(e))}function Eh(e){return arguments.length?lb=RR(e):lb}const cb=(e,t)=>ve({},e,t);function DR(e,t){const n=e?MR(e):zg(),i=t?RR(t):Eh();return cb(n,i)}function Yw(e,t){const n=arguments.length;return n&&n!==2&&P("defaultLocale expects either zero or two arguments."),n?cb(zg(e),Eh(t)):cb(zg(),Eh())}function BV(){return FR(),NR(),Yw()}const UV=/^(data:|([A-Za-z]+:)?\/\/)/,jV=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,qV=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,p$="file://";function VV(e,t){return n=>({options:n||{},sanitize:HV,load:WV,fileAccess:!1,file:GV(t),http:XV(e)})}async function WV(e,t){const n=await this.sanitize(e,t),i=n.href;return n.localFile?this.file(i):this.http(i,t)}async function HV(e,t){t=ve({},this.options,t);const n=this.fileAccess,i={href:null};let r,s,a;const o=jV.test(e.replace(qV,""));(e==null||typeof e!="string"||!o)&&P("Sanitize failure, invalid URI: "+G(e));const u=UV.test(e);return(a=t.baseURL)&&!u&&(!e.startsWith("/")&&!a.endsWith("/")&&(e="/"+e),e=a+e),s=(r=e.startsWith(p$))||t.mode==="file"||t.mode!=="http"&&!u&&n,r?e=e.slice(p$.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(i,"localFile",{value:!!s}),i.href=e,t.target&&(i.target=t.target+""),t.rel&&(i.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(i.crossOrigin=t.crossOrigin+""),i}function GV(e){return e?t=>new Promise((n,i)=>{e.readFile(t,(r,s)=>{r?i(r):n(s)})}):YV}async function YV(){P("No file system access.")}function XV(e){return e?async function(t,n){const i=ve({},this.options.http,n),r=n&&n.response,s=await e(t,i);return s.ok?we(s[r])?s[r]():s.text():P(s.status+""+s.statusText)}:KV}async function KV(){P("No HTTP fetch method available.")}const QV=e=>e!=null&&e===e,JV=e=>e==="true"||e==="false"||e===!0||e===!1,ZV=e=>!Number.isNaN(Date.parse(e)),IR=e=>!Number.isNaN(+e)&&!(e instanceof Date),eW=e=>IR(e)&&Number.isInteger(+e),fb={boolean:Pw,integer:fn,number:fn,date:Lw,string:zw,unknown:yn},fp=[JV,eW,IR,ZV],tW=["boolean","integer","number","date"];function PR(e,t){if(!e||!e.length)return"unknown";const n=e.length,i=fp.length,r=fp.map((s,a)=>a+1);for(let s=0,a=0,o,u;s<n;++s)for(u=t?e[s][t]:e[s],o=0;o<i;++o)if(r[o]&&QV(u)&&!fp[o](u)&&(r[o]=0,++a,a===fp.length))return"string";return tW[r.reduce((s,a)=>s===0?a:s,0)-1]}function LR(e,t){return t.reduce((n,i)=>(n[i]=PR(e,i),n),{})}function g$(e){const t=function(n,i){const r={delimiter:e};return Xw(n,i?ve(i,r):r)};return t.responseType="text",t}function Xw(e,t){return t.header&&(e=t.header.map(G).join(t.delimiter)+`
`+e),Dj(t.delimiter).parse(e+"")}Xw.responseType="text";function nW(e){return typeof Buffer=="function"&&we(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function Kw(e,t){const n=t&&t.property?Mi(t.property):yn;return K(e)&&!nW(e)?iW(n(e),t):n(JSON.parse(e))}Kw.responseType="json";function iW(e,t){return!L(e)&&FN(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const rW={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function zR(e,t){let n,i,r,s;return e=Kw(e,t),t&&t.feature?(n=zj,r=t.feature):t&&t.mesh?(n=Uj,r=t.mesh,s=rW[t.filter]):P("Missing TopoJSON feature or mesh parameter."),i=(i=e.objects[r])?n(e,i,s):P("Invalid TopoJSON object: "+r),i&&i.features||[i]}zR.responseType="json";const tg={dsv:Xw,csv:g$(","),tsv:g$("	"),json:Kw,topojson:zR};function Qw(e,t){return arguments.length>1?(tg[e]=t,this):Z(tg,e)?tg[e]:null}function BR(e){const t=Qw(e);return t&&t.responseType||"text"}function UR(e,t,n,i){t=t||{};const r=Qw(t.type||"json");return r||P("Unknown data format type: "+t.type),e=r(e,t),t.parse&&sW(e,t.parse,n,i),Z(e,"columns")&&delete e.columns,e}function sW(e,t,n,i){if(!e.length)return;const r=Eh();n=n||r.timeParse,i=i||r.utcParse;let s=e.columns||Object.keys(e[0]),a,o,u,l,c,f;t==="auto"&&(t=LR(e,s)),s=Object.keys(t);const h=s.map(d=>{const p=t[d];let g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(g[0]==="utc"?i:n)(m);if(!fb[p])throw Error("Illegal format pattern: "+d+":"+p);return fb[p]});for(u=0,c=e.length,f=s.length;u<c;++u)for(a=e[u],l=0;l<f;++l)o=s[l],a[o]=h[l](a[o])}const Fm=VV(typeof fetch<"u"&&fetch,null);function Mm(e){const t=e||yn,n=[],i={};return n.add=r=>{const s=t(r);return i[s]||(i[s]=1,n.push(r)),n},n.remove=r=>{const s=t(r);if(i[s]){i[s]=0;const a=n.indexOf(r);a>=0&&n.splice(a,1)}return n},n}async function ng(e,t){try{await t(e)}catch(n){e.error(n)}}const jR=Symbol("vega_id");let aW=1;function Om(e){return!!(e&&oe(e))}function oe(e){return e[jR]}function qR(e,t){return e[jR]=t,e}function ze(e){const t=e===Object(e)?e:{data:e};return oe(t)?t:qR(t,aW++)}function Jw(e){return Nm(e,ze({}))}function Nm(e,t){for(const n in e)t[n]=e[n];return t}function VR(e,t){return qR(t,oe(e))}function Mu(e,t){return e?t?(n,i)=>e(n,i)||oe(t(n))-oe(t(i)):(n,i)=>e(n,i)||oe(n)-oe(i):null}function WR(e){return e&&e.constructor===Ou}function Ou(){const e=[],t=[],n=[],i=[],r=[];let s=null,a=!1;return{constructor:Ou,insert(o){const u=Q(o),l=u.length;for(let c=0;c<l;++c)e.push(u[c]);return this},remove(o){const u=we(o)?i:t,l=Q(o),c=l.length;for(let f=0;f<c;++f)u.push(l[f]);return this},modify(o,u,l){const c={field:u,value:xn(l)};return we(o)?(c.filter=o,r.push(c)):(c.tuple=o,n.push(c)),this},encode(o,u){return we(o)?r.push({filter:o,field:u}):n.push({tuple:o,field:u}),this},clean(o){return s=o,this},reflow(){return a=!0,this},pulse(o,u){const l={},c={};let f,h,d,p,g,m;for(f=0,h=u.length;f<h;++f)l[oe(u[f])]=1;for(f=0,h=t.length;f<h;++f)g=t[f],l[oe(g)]=-1;for(f=0,h=i.length;f<h;++f)p=i[f],u.forEach(x=>{p(x)&&(l[oe(x)]=-1)});for(f=0,h=e.length;f<h;++f)g=e[f],m=oe(g),l[m]?l[m]=1:o.add.push(ze(e[f]));for(f=0,h=u.length;f<h;++f)g=u[f],l[oe(g)]<0&&o.rem.push(g);function y(x,v,b){b?x[v]=b(x):o.encode=v,a||(c[oe(x)]=x)}for(f=0,h=n.length;f<h;++f)d=n[f],g=d.tuple,p=d.field,m=l[oe(g)],m>0&&(y(g,p,d.value),o.modifies(p));for(f=0,h=r.length;f<h;++f)d=r[f],p=d.filter,u.forEach(x=>{p(x)&&l[oe(x)]>0&&y(x,d.field,d.value)}),o.modifies(d.field);if(a)o.mod=t.length||i.length?u.filter(x=>l[oe(x)]>0):u.slice();else for(m in c)o.mod.push(c[m]);return(s||s==null&&(t.length||i.length))&&o.clean(!0),o}}}const ig="_:mod:_";function Rm(){Object.defineProperty(this,ig,{writable:!0,value:{}})}Rm.prototype={set(e,t,n,i){const r=this,s=r[e],a=r[ig];return t!=null&&t>=0?(s[t]!==n||i)&&(s[t]=n,a[t+":"+e]=-1,a[e]=-1):(s!==n||i)&&(r[e]=n,a[e]=L(n)?1+n.length:-1),r},modified(e,t){const n=this[ig];if(arguments.length){if(L(e)){for(let i=0;i<e.length;++i)if(n[e[i]])return!0;return!1}}else{for(const i in n)if(n[i])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[ig]={},this}};let oW=0;const uW="pulse",lW=new Rm,cW=1,fW=2;function Ke(e,t,n,i){this.id=++oW,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,i)}function m$(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Ke.prototype={targets(){return this._targets||(this._targets=Mm(ad))},set(e){return this.value!==e?(this.value=e,1):0},skip:m$(cW),modified:m$(fW),parameters(e,t,n){t=t!==!1;const i=this._argval=this._argval||new Rm,r=this._argops=this._argops||[],s=[];let a,o,u,l;const c=(f,h,d)=>{d instanceof Ke?(d!==this&&(t&&d.targets().add(this),s.push(d)),r.push({op:d,name:f,index:h})):i.set(f,h,d)};for(a in e)if(o=e[a],a===uW)Q(o).forEach(f=>{f instanceof Ke?f!==this&&(f.targets().add(this),s.push(f)):P("Pulse parameters must be operator instances.")}),this.source=o;else if(L(o))for(i.set(a,-1,Array(u=o.length)),l=0;l<u;++l)c(a,l,o[l]);else c(a,-1,o);return this.marshall().clear(),n&&(r.initonly=!0),s},marshall(e){const t=this._argval||lW,n=this._argops;let i,r,s,a;if(n){const o=n.length;for(r=0;r<o;++r)i=n[r],s=i.op,a=s.modified()&&s.stamp===e,t.set(i.name,i.index,s.value,a);if(n.initonly){for(r=0;r<o;++r)i=n[r],i.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,i,r;if(e)for(t=0,n=e.length;t<n;++t)i=e[t],r=i.op,r._targets&&r._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),i=t.call(this,n,e);if(n.clear(),i!==this.value)this.value=i;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function hW(e,t,n,i){let r=1,s;return e instanceof Ke?s=e:e&&e.prototype instanceof Ke?s=new e:we(e)?s=new Ke(null,e):(r=0,s=new Ke(e,t)),this.rank(s),r&&(i=n,n=t),n&&this.connect(s,s.parameters(n,i)),this.touch(s),s}function dW(e,t){const n=e.rank,i=t.length;for(let r=0;r<i;++r)if(n<t[r].rank){this.rerank(e);return}}let pW=0;function Dm(e,t,n){this.id=++pW,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function ma(e,t,n){return new Dm(e,t,n)}Dm.prototype={_filter:Oi,_apply:yn,targets(){return this._targets||(this._targets=Mm(ad))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,i=n?n.length:0;for(let r=0;r<i;++r)n[r].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=ma(e);return this.targets().add(t),t},apply(e){const t=ma(null,e);return this.targets().add(t),t},merge(){const e=ma();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=ma();return this.targets().add(ma(null,null,Dw(e,n=>{const i=n.dataflow;t.receive(n),i&&i.run&&i.run()}))),t},between(e,t){let n=!1;return e.targets().add(ma(null,null,()=>n=!0)),t.targets().add(ma(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=Oi,this._targets=null}};function gW(e,t,n,i){const r=this,s=ma(n,i),a=function(l){l.dataflow=r;try{s.receive(l)}catch(c){r.error(c)}finally{r.run()}};let o;typeof e=="string"&&typeof document<"u"?o=document.querySelectorAll(e):o=Q(e);const u=o.length;for(let l=0;l<u;++l)o[l].addEventListener(t,a);return s}function mW(e,t){const n=this.locale();return UR(e,t,n.timeParse,n.utcParse)}function yW(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function xW(e,t){const n=this;let i=0,r;try{r=await n.loader().load(e,{context:"dataflow",response:BR(t&&t.type)});try{r=n.parse(r,t)}catch(s){i=-2,n.warn("Data ingestion failed",e,s)}}catch(s){i=-1,n.warn("Loading failed",e,s)}return{data:r,status:i}}async function vW(e,t,n){const i=this,r=i._pending||bW(i);r.requests+=1;const s=await i.request(t,n);return i.pulse(e,i.changeset().remove(Oi).insert(s.data||[])),r.done(),s}function bW(e){let t;const n=new Promise(i=>t=i);return n.requests=0,n.done=()=>{--n.requests===0&&(e._pending=null,t(e))},e._pending=n}const wW={skip:!0};function _W(e,t,n,i,r){return(e instanceof Ke?SW:EW)(this,e,t,n,i,r),this}function EW(e,t,n,i,r,s){const a=ve({},s,wW);let o,u;we(n)||(n=xn(n)),i===void 0?o=l=>e.touch(n(l)):we(i)?(u=new Ke(null,i,r,!1),o=l=>{u.evaluate(l);const c=n(l),f=u.value;WR(f)?e.pulse(c,f,s):e.update(c,f,a)}):o=l=>e.update(n(l),i,a),t.apply(o)}function SW(e,t,n,i,r,s){if(i===void 0)t.targets().add(n);else{const a=s||{},o=new Ke(null,kW(n,i),r,!1);o.modified(a.force),o.rank=t.rank,t.targets().add(o),n&&(o.skip(!0),o.value=n.value,o.targets().add(n),e.connect(n,[o]))}}function kW(e,t){return t=we(t)?t:xn(t),e?function(n,i){const r=t(n,i);return e.skip()||(e.skip(r!==this.value).value=r),r}:t}function AW(e){e.rank=++this._rank}function CW(e){const t=[e];let n,i,r;for(;t.length;)if(this.rank(n=t.pop()),i=n._targets)for(r=i.length;--r>=0;)t.push(n=i[r]),n===e&&P("Cycle detected in dataflow graph.")}const Bg={},Rr=1,va=2,Ss=4,$W=Rr|va,y$=Rr|Ss,Qu=Rr|va|Ss,x$=8,ff=16,v$=32,b$=64;function Pa(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function rx(e,t){const n=[];return xa(e,t,i=>n.push(i)),n}function w$(e,t){const n={};return e.visit(t,i=>{n[oe(i)]=1}),i=>n[oe(i)]?null:i}function hp(e,t){return e?(n,i)=>e(n,i)&&t(n,i):t}Pa.prototype={StopPropagation:Bg,ADD:Rr,REM:va,MOD:Ss,ADD_REM:$W,ADD_MOD:y$,ALL:Qu,REFLOW:x$,SOURCE:ff,NO_SOURCE:v$,NO_FIELDS:b$,fork(e){return new Pa(this.dataflow).init(this,e)},clone(){const e=this.fork(Qu);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(Qu|ff)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new Pa(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&b$)&&(n.fields=e.fields),t&Rr?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&va?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&Ss?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&v$?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||Qu;return t&Rr&&this.add.length||t&va&&this.rem.length||t&Ss&&this.mod.length},reflow(e){if(e)return this.fork(Qu).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(Ss,w$(this,Rr))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return L(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?L(e)?e.some(i=>n[i]):n[e]:!!n:!1},filter(e,t){const n=this;return e&Rr&&(n.addF=hp(n.addF,t)),e&va&&(n.remF=hp(n.remF,t)),e&Ss&&(n.modF=hp(n.modF,t)),e&ff&&(n.srcF=hp(n.srcF,t)),n},materialize(e){e=e||Qu;const t=this;return e&Rr&&t.addF&&(t.add=rx(t.add,t.addF),t.addF=null),e&va&&t.remF&&(t.rem=rx(t.rem,t.remF),t.remF=null),e&Ss&&t.modF&&(t.mod=rx(t.mod,t.modF),t.modF=null),e&ff&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,i=t;if(e&ff)return xa(n.source,n.srcF,i),n;e&Rr&&xa(n.add,n.addF,i),e&va&&xa(n.rem,n.remF,i),e&Ss&&xa(n.mod,n.modF,i);const r=n.source;if(e&x$&&r){const s=n.add.length+n.mod.length;s===r.length||(s?xa(r,w$(n,y$),i):xa(r,n.srcF,i))}return n}};function Zw(e,t,n,i){const r=this;let s=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=i||null,this.pulses=n;for(const a of n)if(a.stamp===t){if(a.fields){const o=r.fields||(r.fields={});for(const u in a.fields)o[u]=1}a.changed(r.ADD)&&(s|=r.ADD),a.changed(r.REM)&&(s|=r.REM),a.changed(r.MOD)&&(s|=r.MOD)}this.changes=s}Y(Zw,Pa,{fork(e){const t=new Pa(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?L(e)?e.some(i=>n[i]):n[e]:0},filter(){P("MultiPulse does not support filtering.")},materialize(){P("MultiPulse does not support materialization.")},visit(e,t){const n=this,i=n.pulses,r=i.length;let s=0;if(e&n.SOURCE)for(;s<r;++s)i[s].visit(e,t);else for(;s<r;++s)i[s].stamp===n.stamp&&i[s].visit(e,t);return n}});async function TW(e,t,n){const i=this,r=[];if(i._pulse)return HR(i);if(i._pending&&await i._pending,t&&await ng(i,t),!i._touched.length)return i.debug("Dataflow invoked, but nothing to do."),i;const s=++i._clock;i._pulse=new Pa(i,s,e),i._touched.forEach(c=>i._enqueue(c,!0)),i._touched=Mm(ad);let a=0,o,u,l;try{for(;i._heap.size()>0;){if(o=i._heap.pop(),o.rank!==o.qrank){i._enqueue(o,!0);continue}u=o.run(i._getPulse(o,e)),u.then?u=await u:u.async&&(r.push(u.async),u=Bg),u!==Bg&&o._targets&&o._targets.forEach(c=>i._enqueue(c)),++a}}catch(c){i._heap.clear(),l=c}if(i._input={},i._pulse=null,i.debug(`Pulse ${s}: ${a} operators`),l&&(i._postrun=[],i.error(l)),i._postrun.length){const c=i._postrun.sort((f,h)=>h.priority-f.priority);i._postrun=[];for(let f=0;f<c.length;++f)await ng(i,c[f].callback)}return n&&await ng(i,n),r.length&&Promise.all(r).then(c=>i.runAsync(null,()=>{c.forEach(f=>{try{f(i)}catch(h){i.error(h)}})})),i}async function FW(e,t,n){for(;this._running;)await this._running;const i=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(i,i),this._running}function MW(e,t,n){return this._pulse?HR(this):(this.evaluate(e,t,n),this)}function OW(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(i){this.error(i)}}function HR(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function NW(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function RW(e,t){const n=e.source,i=this._clock;return n&&L(n)?new Zw(this,i,n.map(r=>r.pulse),t):this._input[e.id]||DW(this._pulse,n&&n.pulse)}function DW(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==Bg&&(e.source=t.source),e)}const e_={skip:!1,force:!1};function IW(e,t){const n=t||e_;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function PW(e,t,n){const i=n||e_;return(e.set(t)||i.force)&&this.touch(e,i),this}function LW(e,t,n){this.touch(e,n||e_);const i=new Pa(this,this._clock+(this._pulse?0:1)),r=e.pulse&&e.pulse.source||[];return i.target=e,this._input[e.id]=t.pulse(i,r),this}function zW(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),GR(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let i;return t.length?(i=t[0],t[0]=n,BW(t,0,e)):i=n,i}}}function GR(e,t,n,i){let r,s;const a=e[n];for(;n>t;){if(s=n-1>>1,r=e[s],i(a,r)<0){e[n]=r,n=s;continue}break}return e[n]=a}function BW(e,t,n){const i=t,r=e.length,s=e[t];let a=(t<<1)+1,o;for(;a<r;)o=a+1,o<r&&n(e[a],e[o])>=0&&(a=o),e[t]=e[a],t=a,a=(t<<1)+1;return e[t]=s,GR(e,i,t,n)}function Sl(){this.logger(Fw()),this.logLevel($w),this._clock=0,this._rank=0,this._locale=Yw();try{this._loader=Fm()}catch{}this._touched=Mm(ad),this._input={},this._pulse=null,this._heap=zW((e,t)=>e.qrank-t.qrank),this._postrun=[]}function hf(e){return function(){return this._log[e].apply(this,arguments)}}Sl.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:hf("error"),warn:hf("warn"),info:hf("info"),debug:hf("debug"),logLevel:hf("level"),cleanThreshold:1e4,add:hW,connect:dW,rank:AW,rerank:CW,pulse:LW,touch:IW,update:PW,changeset:Ou,ingest:yW,parse:mW,preload:vW,request:xW,events:gW,on:_W,evaluate:TW,run:MW,runAsync:FW,runAfter:OW,_enqueue:NW,_getPulse:RW};function N(e,t){Ke.call(this,e,null,t)}Y(N,Ke,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const Bl={};function YR(e){const t=XR(e);return t&&t.Definition||null}function XR(e){return e=e&&e.toLowerCase(),Z(Bl,e)?Bl[e]:null}function*KR(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of e)i=t(i,++n,e),i!=null&&i!==""&&(i=+i)>=i&&(yield i)}}function t_(e,t,n){const i=Float64Array.from(KR(e,n));return i.sort(Ls),t.map(r=>HN(i,r))}function n_(e,t){return t_(e,[.25,.5,.75],t)}function i_(e,t){const n=e.length,i=Xj(e,t),r=n_(e,t),s=(r[2]-r[0])/1.34;return 1.06*(Math.min(i,s)||i||Math.abs(r[0])||1)*Math.pow(n,-.2)}function QR(e){const t=e.maxbins||20,n=e.base||10,i=Math.log(n),r=e.divide||[5,2];let s=e.extent[0],a=e.extent[1],o,u,l,c,f,h;const d=e.span||a-s||Math.abs(s)||1;if(e.step)o=e.step;else if(e.steps){for(c=d/t,f=0,h=e.steps.length;f<h&&e.steps[f]<c;++f);o=e.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(t)/i),l=e.minstep||0,o=Math.max(l,Math.pow(n,Math.round(Math.log(d)/i)-u));Math.ceil(d/o)>t;)o*=n;for(f=0,h=r.length;f<h;++f)c=o/r[f],c>=l&&d/c<=t&&(o=c)}c=Math.log(o);const p=c>=0?0:~~(-c/i)+1,g=Math.pow(n,-p-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(s/o+g)*o,s=s<c?c-o:c,a=Math.ceil(a/o)*o),{start:s,stop:a===s?s+o:a,step:o}}var Ri=Math.random;function UW(e){Ri=e}function JR(e,t,n,i){if(!e.length)return[void 0,void 0];const r=Float64Array.from(KR(e,i)),s=r.length,a=t;let o,u,l,c;for(l=0,c=Array(a);l<a;++l){for(o=0,u=0;u<s;++u)o+=r[~~(Ri()*s)];c[l]=o/s}return c.sort(Ls),[nb(c,n/2),nb(c,1-n/2)]}function ZR(e,t,n,i){i=i||(h=>h);const r=e.length,s=new Float64Array(r);let a=0,o=1,u=i(e[0]),l=u,c=u+t,f;for(;o<r;++o){if(f=i(e[o]),f>=c){for(l=(u+l)/2;a<o;++a)s[a]=l;c=f+t,u=f}l=f}for(l=(u+l)/2;a<o;++a)s[a]=l;return n?jW(s,t+t/4):s}function jW(e,t){const n=e.length;let i=0,r=1,s,a;for(;e[i]===e[r];)++r;for(;r<n;){for(s=r+1;e[r]===e[s];)++s;if(e[r]-e[r-1]<t){for(a=r+(i+s-r-r>>1);a<r;)e[a++]=e[r];for(;a>r;)e[a--]=e[i]}i=r,r=s}return e}function qW(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function VW(e,t){t==null&&(t=e,e=0);let n,i,r;const s={min(a){return arguments.length?(n=a||0,r=i-n,s):n},max(a){return arguments.length?(i=a||0,r=i-n,s):i},sample(){return n+Math.floor(r*Ri())},pdf(a){return a===Math.floor(a)&&a>=n&&a<i?1/r:0},cdf(a){const o=Math.floor(a);return o<n?0:o>=i?1:(o-n+1)/r},icdf(a){return a>=0&&a<=1?n-1+Math.floor(a*r):NaN}};return s.min(e).max(t)}const eD=Math.sqrt(2*Math.PI),WW=Math.SQRT2;let df=NaN;function Im(e,t){e=e||0,t=t??1;let n=0,i=0,r,s;if(df===df)n=df,df=NaN;else{do n=Ri()*2-1,i=Ri()*2-1,r=n*n+i*i;while(r===0||r>1);s=Math.sqrt(-2*Math.log(r)/r),n*=s,df=i*s}return e+n*t}function r_(e,t,n){n=n??1;const i=(e-(t||0))/n;return Math.exp(-.5*i*i)/(n*eD)}function Pm(e,t,n){t=t||0,n=n??1;const i=(e-t)/n,r=Math.abs(i);let s;if(r>37)s=0;else{const a=Math.exp(-r*r/2);let o;r<7.07106781186547?(o=.0352624965998911*r+.700383064443688,o=o*r+6.37396220353165,o=o*r+33.912866078383,o=o*r+112.079291497871,o=o*r+221.213596169931,o=o*r+220.206867912376,s=a*o,o=.0883883476483184*r+1.75566716318264,o=o*r+16.064177579207,o=o*r+86.7807322029461,o=o*r+296.564248779674,o=o*r+637.333633378831,o=o*r+793.826512519948,o=o*r+440.413735824752,s=s/o):(o=r+.65,o=r+4/o,o=r+3/o,o=r+2/o,o=r+1/o,s=a/o/2.506628274631)}return i>0?1-s:s}function Lm(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*WW*HW(2*e-1)}function HW(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}function s_(e,t){let n,i;const r={mean(s){return arguments.length?(n=s||0,r):n},stdev(s){return arguments.length?(i=s??1,r):i},sample:()=>Im(n,i),pdf:s=>r_(s,n,i),cdf:s=>Pm(s,n,i),icdf:s=>Lm(s,n,i)};return r.mean(e).stdev(t)}function a_(e,t){const n=s_();let i=0;const r={data(s){return arguments.length?(e=s,i=s?s.length:0,r.bandwidth(t)):e},bandwidth(s){return arguments.length?(t=s,!t&&e&&(t=i_(e)),r):t},sample(){return e[~~(Ri()*i)]+t*n.sample()},pdf(s){let a=0,o=0;for(;o<i;++o)a+=n.pdf((s-e[o])/t);return a/t/i},cdf(s){let a=0,o=0;for(;o<i;++o)a+=n.cdf((s-e[o])/t);return a/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(e)}function o_(e,t){return e=e||0,t=t??1,Math.exp(e+Im()*t)}function u_(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const i=(Math.log(e)-t)/n;return Math.exp(-.5*i*i)/(n*eD*e)}function l_(e,t,n){return Pm(Math.log(e),t,n)}function c_(e,t,n){return Math.exp(Lm(e,t,n))}function tD(e,t){let n,i;const r={mean(s){return arguments.length?(n=s||0,r):n},stdev(s){return arguments.length?(i=s??1,r):i},sample:()=>o_(n,i),pdf:s=>u_(s,n,i),cdf:s=>l_(s,n,i),icdf:s=>c_(s,n,i)};return r.mean(e).stdev(t)}function nD(e,t){let n=0,i;function r(a){const o=[];let u=0,l;for(l=0;l<n;++l)u+=o[l]=a[l]==null?1:+a[l];for(l=0;l<n;++l)o[l]/=u;return o}const s={weights(a){return arguments.length?(i=r(t=a||[]),s):t},distributions(a){return arguments.length?(a?(n=a.length,e=a):(n=0,e=[]),s.weights(t)):e},sample(){const a=Ri();let o=e[n-1],u=i[0],l=0;for(;l<n-1;u+=i[++l])if(a<u){o=e[l];break}return o.sample()},pdf(a){let o=0,u=0;for(;u<n;++u)o+=i[u]*e[u].pdf(a);return o},cdf(a){let o=0,u=0;for(;u<n;++u)o+=i[u]*e[u].cdf(a);return o},icdf(){throw Error("Mixture icdf not supported.")}};return s.distributions(e).weights(t)}function f_(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Ri()}function h_(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function d_(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function p_(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function iD(e,t){let n,i;const r={min(s){return arguments.length?(n=s||0,r):n},max(s){return arguments.length?(i=s??1,r):i},sample:()=>f_(n,i),pdf:s=>h_(s,n,i),cdf:s=>d_(s,n,i),icdf:s=>p_(s,n,i)};return t==null&&(t=e??1,e=0),r.min(e).max(t)}function g_(e,t,n){let i=0,r=0;for(const s of e){const a=n(s);t(s)==null||a==null||isNaN(a)||(i+=(a-i)/++r)}return{coef:[i],predict:()=>i,rSquared:0}}function ud(e,t,n,i){const r=i-e*e,s=Math.abs(r)<1e-24?0:(n-e*t)/r;return[t-s*e,s]}function zm(e,t,n,i){e=e.filter(d=>{let p=t(d),g=n(d);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),i&&e.sort((d,p)=>t(d)-t(p));const r=e.length,s=new Float64Array(r),a=new Float64Array(r);let o=0,u=0,l=0,c,f,h;for(h of e)s[o]=c=+t(h),a[o]=f=+n(h),++o,u+=(c-u)/o,l+=(f-l)/o;for(o=0;o<r;++o)s[o]-=u,a[o]-=l;return[s,a,u,l]}function ld(e,t,n,i){let r=-1,s,a;for(const o of e)s=t(o),a=n(o),s!=null&&(s=+s)>=s&&a!=null&&(a=+a)>=a&&i(s,a,++r)}function $c(e,t,n,i,r){let s=0,a=0;return ld(e,t,n,(o,u)=>{const l=u-r(o),c=u-i;s+=l*l,a+=c*c}),1-s/a}function m_(e,t,n){let i=0,r=0,s=0,a=0,o=0;ld(e,t,n,(c,f)=>{++o,i+=(c-i)/o,r+=(f-r)/o,s+=(c*f-s)/o,a+=(c*c-a)/o});const u=ud(i,r,s,a),l=c=>u[0]+u[1]*c;return{coef:u,predict:l,rSquared:$c(e,t,n,r,l)}}function rD(e,t,n){let i=0,r=0,s=0,a=0,o=0;ld(e,t,n,(c,f)=>{++o,c=Math.log(c),i+=(c-i)/o,r+=(f-r)/o,s+=(c*f-s)/o,a+=(c*c-a)/o});const u=ud(i,r,s,a),l=c=>u[0]+u[1]*Math.log(c);return{coef:u,predict:l,rSquared:$c(e,t,n,r,l)}}function sD(e,t,n){const[i,r,s,a]=zm(e,t,n);let o=0,u=0,l=0,c=0,f=0,h,d,p;ld(e,t,n,(x,v)=>{h=i[f++],d=Math.log(v),p=h*v,o+=(v*d-o)/f,u+=(p-u)/f,l+=(p*d-l)/f,c+=(h*p-c)/f});const[g,m]=ud(u/a,o/a,l/a,c/a),y=x=>Math.exp(g+m*(x-s));return{coef:[Math.exp(g-m*s),m],predict:y,rSquared:$c(e,t,n,a,y)}}function aD(e,t,n){let i=0,r=0,s=0,a=0,o=0,u=0;ld(e,t,n,(f,h)=>{const d=Math.log(f),p=Math.log(h);++u,i+=(d-i)/u,r+=(p-r)/u,s+=(d*p-s)/u,a+=(d*d-a)/u,o+=(h-o)/u});const l=ud(i,r,s,a),c=f=>l[0]*Math.pow(f,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:$c(e,t,n,o,c)}}function y_(e,t,n){const[i,r,s,a]=zm(e,t,n),o=i.length;let u=0,l=0,c=0,f=0,h=0,d,p,g,m;for(d=0;d<o;)p=i[d],g=r[d++],m=p*p,u+=(m-u)/d,l+=(m*p-l)/d,c+=(m*m-c)/d,f+=(p*g-f)/d,h+=(m*g-h)/d;const y=c-u*u,x=u*y-l*l,v=(h*u-f*l)/x,b=(f*y-h*l)/x,w=-v*u,E=_=>(_=_-s,v*_*_+b*_+w+a);return{coef:[w-b*s+v*s*s+a,b-2*v*s,v],predict:E,rSquared:$c(e,t,n,a,E)}}function oD(e,t,n,i){if(i===0)return g_(e,t,n);if(i===1)return m_(e,t,n);if(i===2)return y_(e,t,n);const[r,s,a,o]=zm(e,t,n),u=r.length,l=[],c=[],f=i+1;let h,d,p,g,m;for(h=0;h<f;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(r[p],h)*s[p];for(l.push(g),m=new Float64Array(f),d=0;d<f;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(r[p],h+d);m[d]=g}c.push(m)}c.push(l);const y=YW(c),x=v=>{v-=a;let b=o+y[0]+y[1]*v+y[2]*v*v;for(h=3;h<f;++h)b+=y[h]*Math.pow(v,h);return b};return{coef:GW(f,y,-a,o),predict:x,rSquared:$c(e,t,n,o,x)}}function GW(e,t,n,i){const r=Array(e);let s,a,o,u;for(s=0;s<e;++s)r[s]=0;for(s=e-1;s>=0;--s)for(o=t[s],u=1,r[s]+=o,a=1;a<=s;++a)u*=(s+1-a)/a,r[s-a]+=o*Math.pow(n,a)*u;return r[0]+=i,r}function YW(e){const t=e.length-1,n=[];let i,r,s,a,o;for(i=0;i<t;++i){for(a=i,r=i+1;r<t;++r)Math.abs(e[i][r])>Math.abs(e[i][a])&&(a=r);for(s=i;s<t+1;++s)o=e[s][i],e[s][i]=e[s][a],e[s][a]=o;for(r=i+1;r<t;++r)for(s=t;s>=i;s--)e[s][r]-=e[s][i]*e[i][r]/e[i][i]}for(r=t-1;r>=0;--r){for(o=0,s=r+1;s<t;++s)o+=e[s][r]*n[s];n[r]=(e[t][r]-o)/e[r][r]}return n}const _$=2,E$=1e-12;function uD(e,t,n,i){const[r,s,a,o]=zm(e,t,n,!0),u=r.length,l=Math.max(2,~~(i*u)),c=new Float64Array(u),f=new Float64Array(u),h=new Float64Array(u).fill(1);for(let d=-1;++d<=_$;){const p=[0,l-1];for(let m=0;m<u;++m){const y=r[m],x=p[0],v=p[1],b=y-r[x]>r[v]-y?x:v;let w=0,E=0,_=0,k=0,A=0;const T=1/Math.abs(r[b]-y||1);for(let O=x;O<=v;++O){const F=r[O],C=s[O],M=XW(Math.abs(y-F)*T)*h[O],D=F*M;w+=M,E+=D,_+=C*M,k+=C*D,A+=F*D}const[$,R]=ud(E/w,_/w,k/w,A/w);c[m]=$+R*y,f[m]=Math.abs(s[m]-c[m]),KW(r,m+1,p)}if(d===_$)break;const g=GN(f);if(Math.abs(g)<E$)break;for(let m=0,y,x;m<u;++m)y=f[m]/(6*g),h[m]=y>=1?E$:(x=1-y*y)*x}return QW(r,c,a,o)}function XW(e){return(e=1-e*e*e)*e*e}function KW(e,t,n){const i=e[t];let r=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>r&&e[s]-i<=i-e[r];)n[0]=++r,n[1]=s,++s}function QW(e,t,n,i){const r=e.length,s=[];let a=0,o=0,u=[],l;for(;a<r;++a)l=e[a]+n,u[0]===l?u[1]+=(t[a]-u[1])/++o:(o=0,u[1]+=i,u=[l,t[a]],s.push(u));return u[1]+=i,s}const JW=.5*Math.PI/180;function Bm(e,t,n,i){n=n||25,i=Math.max(n,i||200);const r=g=>[g,e(g)],s=t[0],a=t[1],o=a-s,u=o/i,l=[r(s)],c=[];if(n===i){for(let g=1;g<i;++g)l.push(r(s+g/n*o));return l.push(r(a)),l}else{c.push(r(a));for(let g=n;--g>0;)c.push(r(s+g/n*o))}let f=l[0],h=c[c.length-1];const d=1/o,p=ZW(f[1],c);for(;h;){const g=r((f[0]+h[0])/2);g[0]-f[0]>=u&&eH(f,g,h,d,p)>JW?c.push(g):(f=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function ZW(e,t){let n=e,i=e;const r=t.length;for(let s=0;s<r;++s){const a=t[s][1];a<n&&(n=a),a>i&&(i=a)}return 1/(i-n)}function eH(e,t,n,i,r){const s=Math.atan2(r*(n[1]-e[1]),i*(n[0]-e[0])),a=Math.atan2(r*(t[1]-e[1]),i*(t[0]-e[0]));return Math.abs(s-a)}function tH(e){return t=>{const n=e.length;let i=1,r=String(e[0](t));for(;i<n;++i)r+="|"+e[i](t);return r}}function hb(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:tH(e)}function lD(e,t,n){return n||e+(t?"_"+t:"")}const sx=()=>{},nH={init:sx,add:sx,rem:sx,idx:0},Sh={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.valid?e.sum:void 0,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3},exponential:{init:(e,t)=>{e.exp=0,e.exp_r=t},value:e=>e.valid?e.exp*(1-e.exp_r)/(1-e.exp_r**e.valid):void 0,add:(e,t)=>e.exp=e.exp_r*e.exp+t,rem:(e,t)=>e.exp=(e.exp-t/e.exp_r**(e.valid-1))/e.exp_r},exponentialb:{value:e=>e.valid?e.exp*(1-e.exp_r):void 0,req:["exponential"],idx:1}},cd=Object.keys(Sh).filter(e=>e!=="__count__");function iH(e,t){return(n,i)=>ve({name:e,aggregate_param:i,out:n||e},nH,t)}[...cd,"__count__"].forEach(e=>{Sh[e]=iH(e,Sh[e])});function cD(e,t,n){return Sh[e](n,t)}function fD(e,t){return e.idx-t.idx}function rH(e){const t={};e.forEach(i=>t[i.name]=i);const n=i=>{i.req&&i.req.forEach(r=>{t[r]||n(t[r]=Sh[r]())})};return e.forEach(n),Object.values(t).sort(fD)}function sH(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.aggregate_param==null?e.init(this):e.init(this,e.aggregate_param))}function aH(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t)))}function oH(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t)))}function uH(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function hD(e,t){const n=t||yn,i=rH(e),r=e.slice().sort(fD);function s(a){this._ops=i,this._out=r,this.cell=a,this.init()}return s.prototype.init=sH,s.prototype.add=aH,s.prototype.rem=oH,s.prototype.set=uH,s.prototype.get=n,s.fields=e.map(a=>a.out),s}function x_(e){this._key=e?Mi(e):oe,this.reset()}const tn=x_.prototype;tn.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};tn.add=function(e){this._add.push(e)};tn.rem=function(e){this._rem.push(e)};tn.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,i=e.length,r=t.length,s=Array(i-r),a={};let o,u,l;for(o=0;o<r;++o)a[n(t[o])]=1;for(o=0,u=0;o<i;++o)a[n(l=e[o])]?a[n(l)]=0:s[u++]=l;return this._rem=[],this._add=s};tn.distinct=function(e){const t=this.values(),n={};let i=t.length,r=0,s;for(;--i>=0;)s=e(t[i])+"",Z(n,s)||(n[s]=1,++r);return r};tn.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=$N(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext};tn.argmin=function(e){return this.extent(e)[0]||{}};tn.argmax=function(e){return this.extent(e)[1]||{}};tn.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0};tn.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0};tn.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=n_(this.values(),e),this._get=e),this._q};tn.q1=function(e){return this.quartile(e)[0]};tn.q2=function(e){return this.quartile(e)[1]};tn.q3=function(e){return this.quartile(e)[2]};tn.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=JR(this.values(),1e3,.05,e),this._get=e),this._ci};tn.ci0=function(e){return this.ci(e)[0]};tn.ci1=function(e){return this.ci(e)[1]};function Va(e){N.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Va.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:cd},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};Y(Va,N,{transform(e,t){const n=this,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.modified();return n.stamp=i.stamp,n.value&&(r||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=r?n.init(e):Object.create(null),t.visit(t.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),i.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&i.clean(!0).runAfter(()=>this.clean()),n.changes(i)},cross(){const e=this,t=e.value,n=e._dnames,i=n.map(()=>({})),r=n.length;function s(o){let u,l,c,f;for(u in o)for(c=o[u].tuple,l=0;l<r;++l)i[l][f=c[n[l]]]=f}s(e._prev),s(t);function a(o,u,l){const c=n[l],f=i[l++];for(const h in f){const d=o?o+"|"+h:h;u[c]=f[h],l<r?a(d,u,l):t[d]||e.cell(d,u)}}a("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],i={};function r(x){const v=Q(dn(x)),b=v.length;let w=0,E;for(;w<b;++w)i[E=v[w]]||(i[E]=1,t.push(E))}this._dims=Q(e.groupby),this._dnames=this._dims.map(x=>{const v=dt(x);return r(x),n.push(v),v}),this.cellkey=e.key?e.key:hb(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],a=e.ops||["count"],o=e.aggregate_params||[null],u=e.as||[],l=s.length,c={};let f,h,d,p,g,m,y;for(l!==a.length&&P("Unmatched number of fields and aggregate ops."),y=0;y<l;++y){if(f=s[y],h=a[y],d=o[y]||null,f==null&&h!=="count"&&P("Null aggregate field specified."),g=dt(f),m=lD(h,g,u[y]),n.push(m),h==="count"){this._counts.push(m);continue}p=c[g],p||(r(f),p=c[g]=[],p.field=f,this._measures.push(p)),h!=="count"&&(this._countOnly=!1),p.push(cD(h,d,m))}return this._measures=this._measures.map(x=>hD(x,x.field)),Object.create(null)},cellkey:hb(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const i=this._measures,r=i.length;n.agg=Array(r);for(let s=0;s<r;++s)n.agg[s]=new i[s](n)}return n.store&&(n.data=new x_),n},newtuple(e,t){const n=this._dnames,i=this._dims,r=i.length,s={};for(let a=0;a<r;++a)s[n[a]]=i[a](e);return t?VR(t.tuple,s):ze(s)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const i=n.agg;for(let r=0,s=i.length;r<s;++r)i[r].add(i[r].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const i=n.agg;for(let r=0,s=i.length;r<s;++r)i[r].rem(i[r].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let i=0,r=n.length;i<r;++i)t[n[i]]=e.num;if(!this._countOnly){const i=e.agg;for(let r=0,s=i.length;r<s;++r)i[r].set(t)}return t},changes(e){const t=this._adds,n=this._mods,i=this._prev,r=this._drop,s=e.add,a=e.rem,o=e.mod;let u,l,c,f;if(i)for(l in i)u=i[l],(!r||u.num)&&a.push(u.tuple);for(c=0,f=this._alen;c<f;++c)s.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(u.num===0&&r?a:o).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const lH=1e-14;function v_(e){N.call(this,null,e)}v_.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};Y(v_,N,{transform(e,t){const n=e.interval!==!1,i=this._bins(e),r=i.start,s=i.step,a=e.as||["bin0","bin1"],o=a[0],u=a[1];let l;return e.modified()?(t=t.reflow(!0),l=t.SOURCE):l=t.modified(dn(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?c=>{const f=i(c);c[o]=f,c[u]=f==null?null:r+s*(1+(f-r)/s)}:c=>c[o]=i(c)),t.modifies(n?a:o)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=QR(e),i=n.step;let r=n.start,s=r+Math.ceil((n.stop-r)/i)*i,a,o;(a=e.anchor)!=null&&(o=a-(r+i*Math.floor((a-r)/i)),r+=o,s+=o);const u=function(l){let c=fn(t(l));return c==null?null:c<r?-1/0:c>s?1/0:(c=Math.max(r,Math.min(c,s-i)),r+i*Math.floor(lH+(c-r)/i))};return u.start=r,u.stop=n.stop,u.step=i,this.value=Jn(u,dn(t),e.name||"bin_"+dt(t))}});function dD(e,t,n){const i=e;let r=t||[],s=n||[],a={},o=0;return{add:u=>s.push(u),remove:u=>a[i(u)]=++o,size:()=>r.length,data:(u,l)=>(o&&(r=r.filter(c=>!a[i(c)]),a={},o=0),l&&u&&r.sort(u),s.length&&(r=u?RN(u,r,s.sort(u)):r.concat(s),s=[]),r)}}function b_(e){N.call(this,[],e)}b_.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};Y(b_,N,{transform(e,t){const n=t.fork(t.ALL),i=dD(oe,this.value,n.materialize(n.ADD).add),r=e.sort,s=t.changed()||r&&(e.modified("sort")||t.modified(r.fields));return n.visit(n.REM,i.remove),this.modified(s),this.value=n.source=i.data(Mu(r),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function pD(e){Ke.call(this,null,cH,e)}Y(pD,Ke);function cH(e){return this.value&&!e.modified()?this.value:Rw(e.fields,e.orders)}function w_(e){N.call(this,null,e)}w_.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function fH(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}Y(w_,N,{transform(e,t){const n=f=>h=>{for(var d=fH(o(h),e.case,s)||[],p,g=0,m=d.length;g<m;++g)a.test(p=d[g])||f(p)},i=this._parameterCheck(e,t),r=this._counts,s=this._match,a=this._stop,o=e.field,u=e.as||["text","count"],l=n(f=>r[f]=1+(r[f]||0)),c=n(f=>r[f]-=1);return i?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,i=this._tuples||(this._tuples={}),r=t[0],s=t[1],a=e.fork(e.NO_SOURCE|e.NO_FIELDS);let o,u,l;for(o in n)u=i[o],l=n[o]||0,!u&&l?(i[o]=u=ze({}),u[r]=o,u[s]=l,a.add.push(u)):l===0?(u&&a.rem.push(u),n[o]=null,i[o]=null):u[s]!==l&&(u[s]=l,a.mod.push(u));return a.modifies(t)}});function __(e){N.call(this,null,e)}__.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};Y(__,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.as||["a","b"],r=i[0],s=i[1],a=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let o=this.value;return a?(o&&(n.rem=o),o=t.materialize(t.SOURCE).source,n.add=this.value=hH(o,r,s,e.filter||Oi)):n.mod=o,n.source=this.value,n.modifies(i)}});function hH(e,t,n,i){for(var r=[],s={},a=e.length,o=0,u,l;o<a;++o)for(s[t]=l=e[o],u=0;u<a;++u)s[n]=e[u],i(s)&&(r.push(ze(s)),s={},s[t]=l);return r}const S$={kde:a_,mixture:nD,normal:s_,lognormal:tD,uniform:iD},dH="distributions",k$="function",pH="field";function gD(e,t){const n=e[k$];Z(S$,n)||P("Unknown distribution function: "+n);const i=S$[n]();for(const r in e)r===pH?i.data((e.from||t()).map(e[r])):r===dH?i[r](e[r].map(s=>gD(s,t))):typeof i[r]===k$&&i[r](e[r]);return i}function E_(e){N.call(this,null,e)}const mD=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],gH={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:mD},{name:"weights",type:"number",array:!0}]};E_.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:mD.concat(gH)},{name:"as",type:"string",array:!0,default:["value","density"]}]};Y(E_,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=gD(e.distribution,mH(t)),r=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let a=e.method||"pdf";a!=="pdf"&&a!=="cdf"&&P("Invalid density method: "+a),!e.extent&&!i.data&&P("Missing density extent parameter."),a=i[a];const o=e.as||["value","density"],u=e.extent||Yr(i.data()),l=Bm(a,u,r,s).map(c=>{const f={};return f[o[0]]=c[0],f[o[1]]=c[1],ze(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function mH(e){return()=>e.materialize(e.SOURCE).source}function yD(e,t){return e?e.map((n,i)=>t[i]||dt(n)):null}function S_(e,t,n){const i=[],r=f=>f(u);let s,a,o,u,l,c;if(t==null)i.push(e.map(n));else for(s={},a=0,o=e.length;a<o;++a)u=e[a],l=t.map(r),c=s[l],c||(s[l]=c=[],c.dims=l,i.push(c)),c.push(n(u));return i}const xD="bin";function k_(e){N.call(this,null,e)}k_.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:xD}]};const yH=(e,t)=>od(Yr(e,t))/30;Y(k_,N,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,i=S_(t.source,e.groupby,yn),r=e.smooth||!1,s=e.field,a=e.step||yH(n,s),o=Mu((p,g)=>s(p)-s(g)),u=e.as||xD,l=i.length;let c=1/0,f=-1/0,h=0,d;for(;h<l;++h){const p=i[h].sort(o);d=-1;for(const g of ZR(p,a,r,s))g<c&&(c=g),g>f&&(f=g),p[++d][u]=g}return this.value={start:c,stop:f,step:a},t.reflow(!0).modifies(u)}});function vD(e){Ke.call(this,null,xH,e),this.modified(!0)}Y(vD,Ke);function xH(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Jn(n=>t(n,e),dn(t),dt(t))}function A_(e){N.call(this,[void 0,void 0],e)}A_.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};Y(A_,N,{transform(e,t){const n=this.value,i=e.field,r=t.changed()||t.modified(i.fields)||e.modified("field");let s=n[0],a=n[1];if((r||s==null)&&(s=1/0,a=-1/0),t.visit(r?t.SOURCE:t.ADD,o=>{const u=fn(i(o));u!=null&&(u<s&&(s=u),u>a&&(a=u))}),!Number.isFinite(s)||!Number.isFinite(a)){let o=dt(i);o&&(o=` for field "${o}"`),t.dataflow.warn(`Infinite extent${o}: [${s}, ${a}]`),s=a=void 0}this.value=[s,a]}});function C_(e,t){Ke.call(this,e),this.parent=t,this.count=0}Y(C_,Ke,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function Um(e){N.call(this,{},e),this._keys=_c();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let i=0,r=t.active;i<r;++i)n(t[i],i,t)}}Y(Um,N,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,i){const r=this.value;let s=Z(r,e)&&r[e],a,o;return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(o=i||(o=this._group[e])&&o.tuple,a=n.dataflow,s=new C_(n.fork(n.NO_SOURCE),this),a.add(s).connect(t(a,e,o)),r[e]=s,this.activate(s)),s},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const i=e[n].detachSubflow;i&&i(),delete e[n],++t}if(t){const n=this._targets.filter(i=>i&&i.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,i=e?e.length:0;let r=0;for(;r<i;++r)t[r]=e[r];for(;r<n&&t[r]!=null;++r)t[r]=null;t.active=i},transform(e,t){const n=t.dataflow,i=e.key,r=e.subflow,s=this._keys,a=e.modified("key"),o=u=>this.subflow(u,r,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,u=>{const l=oe(u),c=s.get(l);c!==void 0&&(s.delete(l),o(c).rem(u))}),t.visit(t.ADD,u=>{const l=i(u);s.set(oe(u),l),o(l).add(u)}),a||t.modified(i.fields)?t.visit(t.MOD,u=>{const l=oe(u),c=s.get(l),f=i(u);c===f?o(f).mod(u):(s.set(l,f),o(c).rem(u),o(f).add(u))}):t.changed(t.MOD)&&t.visit(t.MOD,u=>{o(s.get(oe(u))).mod(u)}),a&&t.visit(t.REFLOW,u=>{const l=oe(u),c=s.get(l),f=i(u);c!==f&&(s.set(l,f),o(c).rem(u),o(f).add(u))}),t.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}});function bD(e){Ke.call(this,null,vH,e)}Y(bD,Ke);function vH(e){return this.value&&!e.modified()?this.value:L(e.name)?Q(e.name).map(t=>Mi(t)):Mi(e.name,e.as)}function $_(e){N.call(this,_c(),e)}$_.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};Y($_,N,{transform(e,t){const n=t.dataflow,i=this.value,r=t.fork(),s=r.add,a=r.rem,o=r.mod,u=e.expr;let l=!0;t.visit(t.REM,f=>{const h=oe(f);i.has(h)?i.delete(h):a.push(f)}),t.visit(t.ADD,f=>{u(f,e)?s.push(f):i.set(oe(f),1)});function c(f){const h=oe(f),d=u(f,e),p=i.get(h);d&&p?(i.delete(h),s.push(f)):!d&&!p?(i.set(h,1),a.push(f)):l&&d&&!p&&o.push(f)}return t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),i.empty>n.cleanThreshold&&n.runAfter(i.clean),r}});function T_(e){N.call(this,[],e)}T_.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};Y(T_,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=yD(i,e.as||[]),s=e.index||null,a=r.length;return n.rem=this.value,t.visit(t.SOURCE,o=>{const u=i.map(p=>p(o)),l=u.reduce((p,g)=>Math.max(p,g.length),0);let c=0,f,h,d;for(;c<l;++c){for(h=Jw(o),f=0;f<a;++f)h[r[f]]=(d=u[f][c])==null?null:d;s&&(h[s]=c),n.add.push(h)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(r)}});function F_(e){N.call(this,[],e)}F_.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};Y(F_,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=i.map(dt),s=e.as||["key","value"],a=s[0],o=s[1],u=i.length;return n.rem=this.value,t.visit(t.SOURCE,l=>{for(let c=0,f;c<u;++c)f=Jw(l),f[a]=r[c],f[o]=i[c](l),n.add.push(f)}),this.value=n.source=n.add,n.modifies(s)}});function M_(e){N.call(this,null,e)}M_.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};Y(M_,N,{transform(e,t){const n=e.expr,i=e.as,r=e.modified(),s=e.initonly?t.ADD:r?t.SOURCE:t.modified(n.fields)||t.modified(i)?t.ADD_MOD:t.ADD;return r&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(i),t.visit(s,a=>a[i]=n(a,e))}});function wD(e){N.call(this,[],e)}Y(wD,N,{transform(e,t){const n=t.fork(t.ALL),i=e.generator;let r=this.value,s=e.size-r.length,a,o,u;if(s>0){for(a=[];--s>=0;)a.push(u=ze(i(e))),r.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(a):a}else o=r.slice(0,-s),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(o):o,r=r.slice(-s);return n.source=this.value=r,n}});const dp={value:"value",median:GN,mean:tq,min:tb,max:Ko},bH=[];function O_(e){N.call(this,[],e)}O_.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function wH(e){var t=e.method||dp.value,n;if(dp[t]==null)P("Unrecognized imputation method: "+t);else return t===dp.value?(n=e.value!==void 0?e.value:0,()=>n):dp[t]}function _H(e){const t=e.field;return n=>n?t(n):NaN}Y(O_,N,{transform(e,t){var n=t.fork(t.ALL),i=wH(e),r=_H(e),s=dt(e.field),a=dt(e.key),o=(e.groupby||[]).map(dt),u=EH(t.source,e.groupby,e.key,e.keyvals),l=[],c=this.value,f=u.domain.length,h,d,p,g,m,y,x,v,b,w;for(m=0,v=u.length;m<v;++m)for(h=u[m],p=h.values,d=NaN,x=0;x<f;++x)if(h[x]==null){for(g=u.domain[x],w={_impute:!0},y=0,b=p.length;y<b;++y)w[o[y]]=p[y];w[a]=g,w[s]=Number.isNaN(d)?d=i(h,r):d,l.push(ze(w))}return l.length&&(n.add=n.materialize(n.ADD).add.concat(l)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=l,n}});function EH(e,t,n,i){var r=y=>y(m),s=[],a=i?i.slice():[],o={},u={},l,c,f,h,d,p,g,m;for(a.forEach((y,x)=>o[y]=x+1),h=0,g=e.length;h<g;++h)m=e[h],p=n(m),d=o[p]||(o[p]=a.push(p)),c=(l=t?t.map(r):bH)+"",(f=u[c])||(f=u[c]=[],s.push(f),f.values=l),f[d-1]=m;return s.domain=a,s}function N_(e){Va.call(this,e)}N_.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:cd},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};Y(N_,Va,{transform(e,t){const n=this,i=e.modified();let r;return n.value&&(i||t.modified(n._inputs,!0))?(r=n.value=i?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(r=n.value=n.value||this.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),n.changes(),t.visit(t.SOURCE,s=>{ve(s,r[n.cellkey(s)].tuple)}),t.reflow(i).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n)this.celltuple(e[n]),e[n]=null;for(n=0,i=this._mlen;n<i;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function R_(e){N.call(this,null,e)}R_.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};Y(R_,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=S_(i,e.groupby,e.field),s=(e.groupby||[]).map(dt),a=e.bandwidth,o=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,f=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;o!=="pdf"&&o!=="cdf"&&P("Invalid density method: "+o),e.resolve==="shared"&&(c||(c=Yr(i,e.field)),f=h=e.steps||h),r.forEach(d=>{const p=a_(d,a)[o],g=e.counts?d.length:1,m=c||Yr(d);Bm(p,m,f,h).forEach(y=>{const x={};for(let v=0;v<s.length;++v)x[s[v]]=d.dims[v];x[u[0]]=y[0],x[u[1]]=y[1]*g,l.push(ze(x))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function _D(e){Ke.call(this,null,SH,e)}Y(_D,Ke);function SH(e){return this.value&&!e.modified()?this.value:Iw(e.fields,e.flat)}function ED(e){N.call(this,[],e),this._pending=null}Y(ED,N,{transform(e,t){const n=t.dataflow;return this._pending?ax(this,t,this._pending):kH(e)?t.StopPropagation:e.values?ax(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(r=>(this._pending=Q(r.data),s=>s.touch(this)))}:n.request(e.url,e.format).then(i=>ax(this,t,Q(i.data)))}});function kH(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function ax(e,t,n){n.forEach(ze);const i=t.fork(t.NO_FIELDS&t.NO_SOURCE);return i.rem=e.value,e.value=i.source=i.add=n,e._pending=null,i.rem.length&&i.clean(!0),i}function D_(e){N.call(this,{},e)}D_.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};Y(D_,N,{transform(e,t){const n=e.fields,i=e.index,r=e.values,s=e.default==null?null:e.default,a=e.modified(),o=n.length;let u=a?t.SOURCE:t.ADD,l=t,c=e.as,f,h,d;return r?(h=r.length,o>1&&!c&&P('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==o*h&&P('The "as" parameter has too few output field names.'),c=c||r.map(dt),f=function(p){for(var g=0,m=0,y,x;g<o;++g)if(x=i.get(n[g](p)),x==null)for(y=0;y<h;++y,++m)p[c[m]]=s;else for(y=0;y<h;++y,++m)p[c[m]]=r[y](x)}):(c||P("Missing output field names."),f=function(p){for(var g=0,m;g<o;++g)m=i.get(n[g](p)),p[c[g]]=m??s}),a?l=t.reflow(!0):(d=n.some(p=>t.modified(p.fields)),u|=d?t.MOD:0),t.visit(u,f),l.modifies(c)}});function SD(e){Ke.call(this,null,AH,e)}Y(SD,Ke);function AH(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let i=1/0,r=-1/0,s,a;for(s=0;s<n;++s)a=t[s],a[0]<i&&(i=a[0]),a[1]>r&&(r=a[1]);return[i,r]}function kD(e){Ke.call(this,null,CH,e)}Y(kD,Ke);function CH(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function AD(e){N.call(this,null,e)}Y(AD,N,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function I_(e){Va.call(this,e)}I_.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:cd,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};Y(I_,Va,{_transform:Va.prototype.transform,transform(e,t){return this._transform($H(e,t),t)}});function $H(e,t){const n=e.field,i=e.value,r=(e.op==="count"?"__count__":e.op)||"sum",s=dn(n).concat(dn(i)),a=FH(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:a.map(()=>r),fields:a.map(o=>TH(o,n,i,s)),as:a.map(o=>o+""),modified:e.modified.bind(e)}}function TH(e,t,n,i){return Jn(r=>t(r)===e?n(r):NaN,i,e+"")}function FH(e,t,n){const i={},r=[];return n.visit(n.SOURCE,s=>{const a=e(s);i[a]||(i[a]=1,r.push(a))}),r.sort(wc),t?r.slice(0,t):r}function CD(e){Um.call(this,e)}Y(CD,Um,{transform(e,t){const n=e.subflow,i=e.field,r=s=>this.subflow(oe(s),n,t,s);return(e.modified("field")||i&&t.modified(dn(i)))&&P("PreFacet does not support field modification."),this.initTargets(),i?(t.visit(t.MOD,s=>{const a=r(s);i(s).forEach(o=>a.mod(o))}),t.visit(t.ADD,s=>{const a=r(s);i(s).forEach(o=>a.add(ze(o)))}),t.visit(t.REM,s=>{const a=r(s);i(s).forEach(o=>a.rem(o))})):(t.visit(t.MOD,s=>r(s).mod(s)),t.visit(t.ADD,s=>r(s).add(s)),t.visit(t.REM,s=>r(s).rem(s))),t.clean()&&t.runAfter(()=>this.clean()),t}});function P_(e){N.call(this,null,e)}P_.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};Y(P_,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.fields,r=yD(e.fields,e.as||[]),s=i?(o,u)=>MH(o,u,i,r):Nm;let a;return this.value?a=this.value:(t=t.addAll(),a=this.value={}),t.visit(t.REM,o=>{const u=oe(o);n.rem.push(a[u]),a[u]=null}),t.visit(t.ADD,o=>{const u=s(o,ze({}));a[oe(o)]=u,n.add.push(u)}),t.visit(t.MOD,o=>{n.mod.push(s(o,a[oe(o)]))}),n}});function MH(e,t,n,i){for(let r=0,s=n.length;r<s;++r)t[i[r]]=n[r](e);return t}function $D(e){N.call(this,null,e)}Y($D,N,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function L_(e){N.call(this,null,e)}L_.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const OH=1e-14;Y(L_,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const r=t.materialize(t.SOURCE).source,s=S_(r,e.groupby,e.field),a=(e.groupby||[]).map(dt),o=[],u=e.step||.01,l=e.probs||si(u/2,1-OH,u),c=l.length;return s.forEach(f=>{const h=t_(f,l);for(let d=0;d<c;++d){const p={};for(let g=0;g<a.length;++g)p[a[g]]=f.dims[g];p[i[0]]=l[d],p[i[1]]=h[d],o.push(ze(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}});function TD(e){N.call(this,null,e)}Y(TD,N,{transform(e,t){let n,i;return this.value?i=this.value:(n=t=t.addAll(),i=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,r=>{const s=oe(r);n.rem.push(i[s]),i[s]=null}),t.visit(t.ADD,r=>{const s=Jw(r);i[oe(r)]=s,n.add.push(s)}),t.visit(t.MOD,r=>{const s=i[oe(r)];for(const a in r)s[a]=r[a],n.modifies(a);n.mod.push(s)})),n}});function z_(e){N.call(this,[],e),this.count=0}z_.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};Y(z_,N,{transform(e,t){const n=t.fork(t.NO_SOURCE),i=e.modified("size"),r=e.size,s=this.value.reduce((c,f)=>(c[oe(f)]=1,c),{});let a=this.value,o=this.count,u=0;function l(c){let f,h;a.length<r?a.push(c):(h=~~((o+1)*Ri()),h<a.length&&h>=u&&(f=a[h],s[oe(f)]&&n.rem.push(f),a[h]=c)),++o}if(t.rem.length&&(t.visit(t.REM,c=>{const f=oe(c);s[f]&&(s[f]=-1,n.rem.push(c)),--o}),a=a.filter(c=>s[oe(c)]!==-1)),(t.rem.length||i)&&a.length<r&&t.source&&(u=o=a.length,t.visit(t.SOURCE,c=>{s[oe(c)]||l(c)}),u=-1),i&&a.length>r){const c=a.length-r;for(let f=0;f<c;++f)s[oe(a[f])]=-1,n.rem.push(a[f]);a=a.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{s[oe(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=a.filter(c=>!s[oe(c)])),this.count=o,this.value=n.source=a,n}});function B_(e){N.call(this,null,e)}B_.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};Y(B_,N,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),i=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=si(e.start,e.stop,e.step||1).map(r=>{const s={};return s[i]=r,ze(s)}),n.add=t.add.concat(this.value),n}});function FD(e){N.call(this,null,e),this.modified(!0)}Y(FD,N,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function U_(e){N.call(this,null,e)}const MD=["unit0","unit1"];U_.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:qw,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:MD}]};Y(U_,N,{transform(e,t){const n=e.field,i=e.interval!==!1,r=e.timezone==="utc",s=this._floor(e,t),a=(r?Cc:Ac)(s.unit).offset,o=e.as||MD,u=o[0],l=o[1],c=s.step;let f=s.start||1/0,h=s.stop||-1/0,d=t.ADD;return(e.modified()||t.changed(t.REM)||t.modified(dn(n)))&&(t=t.reflow(!0),d=t.SOURCE,f=1/0,h=-1/0),t.visit(d,p=>{const g=n(p);let m,y;g==null?(p[u]=null,i&&(p[l]=null)):(p[u]=m=y=s(g),i&&(p[l]=y=a(m,c)),m<f&&(f=m),y>h&&(h=y))}),s.start=f,s.stop=h,t.modifies(i?o:u)},_floor(e,t){const n=e.timezone==="utc",{units:i,step:r}=e.units?{units:e.units,step:e.step||1}:wR({extent:e.extent||Yr(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=Vw(i),a=this.value||{},o=(n?hR:fR)(s,r);return o.unit=Fe(s),o.units=s,o.step=r,o.start=a.start,o.stop=a.stop,this.value=o}});function OD(e){N.call(this,_c(),e)}Y(OD,N,{transform(e,t){const n=t.dataflow,i=e.field,r=this.value,s=o=>r.set(i(o),o);let a=!0;return e.modified("field")||t.modified(i.fields)?(r.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,o=>r.delete(i(o))),t.visit(t.ADD,s)):a=!1,this.modified(a),r.empty>n.cleanThreshold&&n.runAfter(r.clean),t.fork()}});function ND(e){N.call(this,null,e)}Y(ND,N,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Mu(e.sort)):t.source).map(e.field))}});function NH(e,t,n,i){const r=kh[e](t,n);return{init:r.init||Ea,update:function(s,a){a[i]=r.next(s)}}}const kh={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,i=t.data;return n&&t.compare(i[n-1],i[n])?++e:e}}},percent_rank:function(){const e=kh.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,i=t.compare;let r=t.index;if(e<r){for(;r+1<n.length&&!i(n[r],n[r+1]);)++r;e=r}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||P("ntile num must be greater than zero.");const n=kh.cume_dist(),i=n.next;return{init:n.init,next:r=>Math.ceil(t*i(r))}},lag:function(e,t){return t=+t||1,{next:n=>{const i=n.index-t;return i>=0?e(n.data[i]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const i=n.index+t,r=n.data;return i<r.length?e(r[i]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||P("nth_value nth must be greater than zero."),{next:n=>{const i=n.i0+(t-1);return i<n.i1?e(n.data[i]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const i=e(n.data[n.index]);return i!=null?t=i:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:i=>{const r=i.data;return i.index<=n?t:(n=RH(e,r,i.index))<0?(n=r.length,t=null):t=e(r[n])}}}};function RH(e,t,n){for(let i=t.length;n<i;++n)if(e(t[n])!=null)return n;return-1}const DH=Object.keys(kh);function RD(e){const t=Q(e.ops),n=Q(e.fields),i=Q(e.params),r=Q(e.aggregate_params),s=Q(e.as),a=this.outputs=[],o=this.windows=[],u={},l={},c=[],f=[];let h=!0;function d(p){Q(dn(p)).forEach(g=>u[g]=1)}d(e.sort),t.forEach((p,g)=>{const m=n[g],y=i[g],x=r[g]||null,v=dt(m),b=lD(p,v,s[g]);if(d(m),a.push(b),Z(kh,p))o.push(NH(p,m,y,b));else{if(m==null&&p!=="count"&&P("Null aggregate field specified."),p==="count"){c.push(b);return}h=!1;let w=l[v];w||(w=l[v]=[],w.field=m,f.push(w)),w.push(cD(p,x,b))}}),(c.length||f.length)&&(this.cell=IH(f,c,h)),this.inputs=Object.keys(u)}const DD=RD.prototype;DD.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()};DD.update=function(e,t){const n=this.cell,i=this.windows,r=e.data,s=i&&i.length;let a;if(n){for(a=e.p0;a<e.i0;++a)n.rem(r[a]);for(a=e.p1;a<e.i1;++a)n.add(r[a]);n.set(t)}for(a=0;a<s;++a)i[a].update(e,t)};function IH(e,t,n){e=e.map(u=>hD(u,u.field));const i={num:0,agg:null,store:!1,count:t};if(!n)for(var r=e.length,s=i.agg=Array(r),a=0;a<r;++a)s[a]=new e[a](i);if(i.store)var o=i.data=new x_;return i.add=function(u){if(i.num+=1,!n){o&&o.add(u);for(let l=0;l<r;++l)s[l].add(s[l].get(u),u)}},i.rem=function(u){if(i.num-=1,!n){o&&o.rem(u);for(let l=0;l<r;++l)s[l].rem(s[l].get(u),u)}},i.set=function(u){let l,c;for(o&&o.values(),l=0,c=t.length;l<c;++l)u[t[l]]=i.num;if(!n)for(l=0,c=s.length;l<c;++l)s[l].set(u)},i.init=function(){i.num=0,o&&o.reset();for(let u=0;u<r;++u)s[u].init()},i}function j_(e){N.call(this,{},e),this._mlen=0,this._mods=[]}j_.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:DH.concat(cd)},{name:"params",type:"number",null:!0,array:!0},{name:"aggregate_params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};Y(j_,N,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),i=Mu(e.sort),r=hb(e.groupby),s=o=>this.group(r(o));let a=this.state;(!a||n)&&(a=this.state=new RD(e)),n||t.modified(a.inputs)?(this.value={},t.visit(t.SOURCE,o=>s(o).add(o))):(t.visit(t.REM,o=>s(o).remove(o)),t.visit(t.ADD,o=>s(o).add(o)));for(let o=0,u=this._mlen;o<u;++o)PH(this._mods[o],a,i,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(a.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=dD(oe),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function PH(e,t,n,i){const r=i.sort,s=r&&!i.ignorePeers,a=i.frame||[null,0],o=e.data(n),u=o.length,l=s?Ec(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:o,compare:r||xn(-1)};t.init();for(let f=0;f<u;++f)LH(c,a,f,u),s&&zH(c,l),t.update(c,o[f])}function LH(e,t,n,i){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?i:Math.min(i,n+Math.abs(t[1])+1),e.index=n}function zH(e,t){const n=e.i0,i=e.i1-1,r=e.compare,s=e.data,a=s.length-1;n>0&&!r(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),i<a&&!r(s[i],s[i+1])&&(e.i1=t.right(s,s[i]))}const BH=Object.freeze(Object.defineProperty({__proto__:null,aggregate:Va,bin:v_,collect:b_,compare:pD,countpattern:w_,cross:__,density:E_,dotbin:k_,expression:vD,extent:A_,facet:Um,field:bD,filter:$_,flatten:T_,fold:F_,formula:M_,generate:wD,impute:O_,joinaggregate:N_,kde:R_,key:_D,load:ED,lookup:D_,multiextent:SD,multivalues:kD,params:AD,pivot:I_,prefacet:CD,project:P_,proxy:$D,quantile:L_,relay:TD,sample:z_,sequence:B_,sieve:FD,subflow:C_,timeunit:U_,tupleindex:OD,values:ND,window:j_},Symbol.toStringTag,{value:"Module"}));function Be(e){return function(){return e}}const A$=Math.abs,sn=Math.atan2,Co=Math.cos,UH=Math.max,ox=Math.min,Cr=Math.sin,Ho=Math.sqrt,on=1e-12,Ul=Math.PI,Ug=Ul/2,ID=2*Ul;function jH(e){return e>1?0:e<-1?Ul:Math.acos(e)}function C$(e){return e>=1?Ug:e<=-1?-Ug:Math.asin(e)}const db=Math.PI,pb=2*db,Lo=1e-6,qH=pb-Lo;function PD(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function VH(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return PD;const n=10**t;return function(i){this._+=i[0];for(let r=1,s=i.length;r<s;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}let q_=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?PD:VH(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,s,a){this._append`C${+t},${+n},${+i},${+r},${this._x1=+s},${this._y1=+a}`}arcTo(t,n,i,r,s){if(t=+t,n=+n,i=+i,r=+r,s=+s,s<0)throw new Error(`negative radius: ${s}`);let a=this._x1,o=this._y1,u=i-t,l=r-n,c=a-t,f=o-n,h=c*c+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>Lo)if(!(Math.abs(f*u-l*c)>Lo)||!s)this._append`L${this._x1=t},${this._y1=n}`;else{let d=i-a,p=r-o,g=u*u+l*l,m=d*d+p*p,y=Math.sqrt(g),x=Math.sqrt(h),v=s*Math.tan((db-Math.acos((g+h-m)/(2*y*x)))/2),b=v/x,w=v/y;Math.abs(b-1)>Lo&&this._append`L${t+b*c},${n+b*f}`,this._append`A${s},${s},0,0,${+(f*d>c*p)},${this._x1=t+w*u},${this._y1=n+w*l}`}}arc(t,n,i,r,s,a){if(t=+t,n=+n,i=+i,a=!!a,i<0)throw new Error(`negative radius: ${i}`);let o=i*Math.cos(r),u=i*Math.sin(r),l=t+o,c=n+u,f=1^a,h=a?r-s:s-r;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>Lo||Math.abs(this._y1-c)>Lo)&&this._append`L${l},${c}`,i&&(h<0&&(h=h%pb+pb),h>qH?this._append`A${i},${i},0,1,${f},${t-o},${n-u}A${i},${i},0,1,${f},${this._x1=l},${this._y1=c}`:h>Lo&&this._append`A${i},${i},0,${+(h>=db)},${f},${this._x1=t+i*Math.cos(s)},${this._y1=n+i*Math.sin(s)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}};function jm(){return new q_}jm.prototype=q_.prototype;function qm(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new q_(t)}function WH(e){return e.innerRadius}function HH(e){return e.outerRadius}function GH(e){return e.startAngle}function YH(e){return e.endAngle}function XH(e){return e&&e.padAngle}function KH(e,t,n,i,r,s,a,o){var u=n-e,l=i-t,c=a-r,f=o-s,h=f*u-c*l;if(!(h*h<on))return h=(c*(t-s)-f*(e-r))/h,[e+h*u,t+h*l]}function pp(e,t,n,i,r,s,a){var o=e-n,u=t-i,l=(a?s:-s)/Ho(o*o+u*u),c=l*u,f=-l*o,h=e+c,d=t+f,p=n+c,g=i+f,m=(h+p)/2,y=(d+g)/2,x=p-h,v=g-d,b=x*x+v*v,w=r-s,E=h*g-p*d,_=(v<0?-1:1)*Ho(UH(0,w*w*b-E*E)),k=(E*v-x*_)/b,A=(-E*x-v*_)/b,T=(E*v+x*_)/b,$=(-E*x+v*_)/b,R=k-m,O=A-y,F=T-m,C=$-y;return R*R+O*O>F*F+C*C&&(k=T,A=$),{cx:k,cy:A,x01:-c,y01:-f,x11:k*(r/w-1),y11:A*(r/w-1)}}function QH(){var e=WH,t=HH,n=Be(0),i=null,r=GH,s=YH,a=XH,o=null,u=qm(l);function l(){var c,f,h=+e.apply(this,arguments),d=+t.apply(this,arguments),p=r.apply(this,arguments)-Ug,g=s.apply(this,arguments)-Ug,m=A$(g-p),y=g>p;if(o||(o=c=u()),d<h&&(f=d,d=h,h=f),!(d>on))o.moveTo(0,0);else if(m>ID-on)o.moveTo(d*Co(p),d*Cr(p)),o.arc(0,0,d,p,g,!y),h>on&&(o.moveTo(h*Co(g),h*Cr(g)),o.arc(0,0,h,g,p,y));else{var x=p,v=g,b=p,w=g,E=m,_=m,k=a.apply(this,arguments)/2,A=k>on&&(i?+i.apply(this,arguments):Ho(h*h+d*d)),T=ox(A$(d-h)/2,+n.apply(this,arguments)),$=T,R=T,O,F;if(A>on){var C=C$(A/h*Cr(k)),M=C$(A/d*Cr(k));(E-=C*2)>on?(C*=y?1:-1,b+=C,w-=C):(E=0,b=w=(p+g)/2),(_-=M*2)>on?(M*=y?1:-1,x+=M,v-=M):(_=0,x=v=(p+g)/2)}var D=d*Co(x),B=d*Cr(x),z=h*Co(w),ee=h*Cr(w);if(T>on){var he=d*Co(v),le=d*Cr(v),me=h*Co(b),Xe=h*Cr(b),ye;if(m<Ul)if(ye=KH(D,B,me,Xe,he,le,z,ee)){var nn=D-ye[0],Ao=B-ye[1],da=he-ye[0],te=le-ye[1],be=1/Cr(jH((nn*da+Ao*te)/(Ho(nn*nn+Ao*Ao)*Ho(da*da+te*te)))/2),Ee=Ho(ye[0]*ye[0]+ye[1]*ye[1]);$=ox(T,(h-Ee)/(be-1)),R=ox(T,(d-Ee)/(be+1))}else $=R=0}_>on?R>on?(O=pp(me,Xe,D,B,d,R,y),F=pp(he,le,z,ee,d,R,y),o.moveTo(O.cx+O.x01,O.cy+O.y01),R<T?o.arc(O.cx,O.cy,R,sn(O.y01,O.x01),sn(F.y01,F.x01),!y):(o.arc(O.cx,O.cy,R,sn(O.y01,O.x01),sn(O.y11,O.x11),!y),o.arc(0,0,d,sn(O.cy+O.y11,O.cx+O.x11),sn(F.cy+F.y11,F.cx+F.x11),!y),o.arc(F.cx,F.cy,R,sn(F.y11,F.x11),sn(F.y01,F.x01),!y))):(o.moveTo(D,B),o.arc(0,0,d,x,v,!y)):o.moveTo(D,B),!(h>on)||!(E>on)?o.lineTo(z,ee):$>on?(O=pp(z,ee,he,le,h,-$,y),F=pp(D,B,me,Xe,h,-$,y),o.lineTo(O.cx+O.x01,O.cy+O.y01),$<T?o.arc(O.cx,O.cy,$,sn(O.y01,O.x01),sn(F.y01,F.x01),!y):(o.arc(O.cx,O.cy,$,sn(O.y01,O.x01),sn(O.y11,O.x11),!y),o.arc(0,0,h,sn(O.cy+O.y11,O.cx+O.x11),sn(F.cy+F.y11,F.cx+F.x11),y),o.arc(F.cx,F.cy,$,sn(F.y11,F.x11),sn(F.y01,F.x01),!y))):o.arc(0,0,h,w,b,y)}if(o.closePath(),c)return o=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+r.apply(this,arguments)+ +s.apply(this,arguments))/2-Ul/2;return[Co(f)*c,Cr(f)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:Be(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:Be(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:Be(+c),l):n},l.padRadius=function(c){return arguments.length?(i=c==null?null:typeof c=="function"?c:Be(+c),l):i},l.startAngle=function(c){return arguments.length?(r=typeof c=="function"?c:Be(+c),l):r},l.endAngle=function(c){return arguments.length?(s=typeof c=="function"?c:Be(+c),l):s},l.padAngle=function(c){return arguments.length?(a=typeof c=="function"?c:Be(+c),l):a},l.context=function(c){return arguments.length?(o=c??null,l):o},l}function LD(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function zD(e){this._context=e}zD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function V_(e){return new zD(e)}function BD(e){return e[0]}function UD(e){return e[1]}function jD(e,t){var n=Be(!0),i=null,r=V_,s=null,a=qm(o);e=typeof e=="function"?e:e===void 0?BD:Be(e),t=typeof t=="function"?t:t===void 0?UD:Be(t);function o(u){var l,c=(u=LD(u)).length,f,h=!1,d;for(i==null&&(s=r(d=a())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+e(f,l,u),+t(f,l,u));if(d)return s=null,d+""||null}return o.x=function(u){return arguments.length?(e=typeof u=="function"?u:Be(+u),o):e},o.y=function(u){return arguments.length?(t=typeof u=="function"?u:Be(+u),o):t},o.defined=function(u){return arguments.length?(n=typeof u=="function"?u:Be(!!u),o):n},o.curve=function(u){return arguments.length?(r=u,i!=null&&(s=r(i)),o):r},o.context=function(u){return arguments.length?(u==null?i=s=null:s=r(i=u),o):i},o}function qD(e,t,n){var i=null,r=Be(!0),s=null,a=V_,o=null,u=qm(l);e=typeof e=="function"?e:e===void 0?BD:Be(+e),t=typeof t=="function"?t:Be(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?UD:Be(+n);function l(f){var h,d,p,g=(f=LD(f)).length,m,y=!1,x,v=new Array(g),b=new Array(g);for(s==null&&(o=a(x=u())),h=0;h<=g;++h){if(!(h<g&&r(m=f[h],h,f))===y)if(y=!y)d=h,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),p=h-1;p>=d;--p)o.point(v[p],b[p]);o.lineEnd(),o.areaEnd()}y&&(v[h]=+e(m,h,f),b[h]=+t(m,h,f),o.point(i?+i(m,h,f):v[h],n?+n(m,h,f):b[h]))}if(x)return o=null,x+""||null}function c(){return jD().defined(r).curve(a).context(s)}return l.x=function(f){return arguments.length?(e=typeof f=="function"?f:Be(+f),i=null,l):e},l.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Be(+f),l):e},l.x1=function(f){return arguments.length?(i=f==null?null:typeof f=="function"?f:Be(+f),l):i},l.y=function(f){return arguments.length?(t=typeof f=="function"?f:Be(+f),n=null,l):t},l.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Be(+f),l):t},l.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Be(+f),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(i).y(t)},l.defined=function(f){return arguments.length?(r=typeof f=="function"?f:Be(!!f),l):r},l.curve=function(f){return arguments.length?(a=f,s!=null&&(o=a(s)),l):a},l.context=function(f){return arguments.length?(f==null?s=o=null:o=a(s=f),l):s},l}const JH={draw(e,t){const n=Ho(t/Ul);e.moveTo(n,0),e.arc(0,0,n,0,ID)}};function ZH(e,t){let n=null,i=qm(r);e=typeof e=="function"?e:Be(e||JH),t=typeof t=="function"?t:Be(t===void 0?64:+t);function r(){let s;if(n||(n=s=i()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),s)return n=null,s+""||null}return r.type=function(s){return arguments.length?(e=typeof s=="function"?s:Be(s),r):e},r.size=function(s){return arguments.length?(t=typeof s=="function"?s:Be(+s),r):t},r.context=function(s){return arguments.length?(n=s??null,r):n},r}function Wa(){}function jg(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Vm(e){this._context=e}Vm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:jg(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:jg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function eG(e){return new Vm(e)}function VD(e){this._context=e}VD.prototype={areaStart:Wa,areaEnd:Wa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:jg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function tG(e){return new VD(e)}function WD(e){this._context=e}WD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:jg(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function nG(e){return new WD(e)}function HD(e,t){this._basis=new Vm(e),this._beta=t}HD.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var i=e[0],r=t[0],s=e[n]-i,a=t[n]-r,o=-1,u;++o<=n;)u=o/n,this._basis.point(this._beta*e[o]+(1-this._beta)*(i+u*s),this._beta*t[o]+(1-this._beta)*(r+u*a));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const iG=function e(t){function n(i){return t===1?new Vm(i):new HD(i,t)}return n.beta=function(i){return e(+i)},n}(.85);function qg(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function W_(e,t){this._context=e,this._k=(1-t)/6}W_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:qg(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:qg(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const rG=function e(t){function n(i){return new W_(i,t)}return n.tension=function(i){return e(+i)},n}(0);function H_(e,t){this._context=e,this._k=(1-t)/6}H_.prototype={areaStart:Wa,areaEnd:Wa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:qg(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const sG=function e(t){function n(i){return new H_(i,t)}return n.tension=function(i){return e(+i)},n}(0);function G_(e,t){this._context=e,this._k=(1-t)/6}G_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:qg(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const aG=function e(t){function n(i){return new G_(i,t)}return n.tension=function(i){return e(+i)},n}(0);function Y_(e,t,n){var i=e._x1,r=e._y1,s=e._x2,a=e._y2;if(e._l01_a>on){var o=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*o-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,r=(r*o-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>on){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,a=(a*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,s,a,e._x2,e._y2)}function GD(e,t){this._context=e,this._alpha=t}GD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Y_(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const oG=function e(t){function n(i){return t?new GD(i,t):new W_(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function YD(e,t){this._context=e,this._alpha=t}YD.prototype={areaStart:Wa,areaEnd:Wa,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Y_(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const uG=function e(t){function n(i){return t?new YD(i,t):new H_(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function XD(e,t){this._context=e,this._alpha=t}XD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Y_(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const lG=function e(t){function n(i){return t?new XD(i,t):new G_(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function KD(e){this._context=e}KD.prototype={areaStart:Wa,areaEnd:Wa,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function cG(e){return new KD(e)}function $$(e){return e<0?-1:1}function T$(e,t,n){var i=e._x1-e._x0,r=t-e._x1,s=(e._y1-e._y0)/(i||r<0&&-0),a=(n-e._y1)/(r||i<0&&-0),o=(s*r+a*i)/(i+r);return($$(s)+$$(a))*Math.min(Math.abs(s),Math.abs(a),.5*Math.abs(o))||0}function F$(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function ux(e,t,n){var i=e._x0,r=e._y0,s=e._x1,a=e._y1,o=(s-i)/3;e._context.bezierCurveTo(i+o,r+o*t,s-o,a-o*n,s,a)}function Vg(e){this._context=e}Vg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ux(this,this._t0,F$(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,ux(this,F$(this,n=T$(this,e,t)),n);break;default:ux(this,this._t0,n=T$(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function QD(e){this._context=new JD(e)}(QD.prototype=Object.create(Vg.prototype)).point=function(e,t){Vg.prototype.point.call(this,t,e)};function JD(e){this._context=e}JD.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,s){this._context.bezierCurveTo(t,e,i,n,s,r)}};function fG(e){return new Vg(e)}function hG(e){return new QD(e)}function ZD(e){this._context=e}ZD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var i=M$(e),r=M$(t),s=0,a=1;a<n;++s,++a)this._context.bezierCurveTo(i[0][s],r[0][s],i[1][s],r[1][s],e[a],t[a]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function M$(e){var t,n=e.length-1,i,r=new Array(n),s=new Array(n),a=new Array(n);for(r[0]=0,s[0]=2,a[0]=e[0]+2*e[1],t=1;t<n-1;++t)r[t]=1,s[t]=4,a[t]=4*e[t]+2*e[t+1];for(r[n-1]=2,s[n-1]=7,a[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)i=r[t]/s[t-1],s[t]-=i,a[t]-=i*a[t-1];for(r[n-1]=a[n-1]/s[n-1],t=n-2;t>=0;--t)r[t]=(a[t]-r[t+1])/s[t];for(s[n-1]=(e[n]+r[n-1])/2,t=0;t<n-1;++t)s[t]=2*e[t+1]-r[t+1];return[r,s]}function dG(e){return new ZD(e)}function Wm(e,t){this._context=e,this._t=t}Wm.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function pG(e){return new Wm(e,.5)}function gG(e){return new Wm(e,0)}function mG(e){return new Wm(e,1)}function La(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const yG=()=>typeof Image<"u"?Image:null;function ss(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function oo(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const gb=Symbol("implicit");function X_(){var e=new YC,t=[],n=[],i=gb;function r(s){let a=e.get(s);if(a===void 0){if(i!==gb)return i;e.set(s,a=t.push(s)-1)}return n[a%n.length]}return r.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new YC;for(const a of s)e.has(a)||e.set(a,t.push(a)-1);return r},r.range=function(s){return arguments.length?(n=Array.from(s),r):n.slice()},r.unknown=function(s){return arguments.length?(i=s,r):i},r.copy=function(){return X_(t,n).unknown(i)},ss.apply(r,arguments),r}function Tc(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function fd(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function uo(){}var ou=.7,jl=1/ou,kl="\\s*([+-]?\\d+)\\s*",Ah="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",jr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xG=/^#([0-9a-f]{3,8})$/,vG=new RegExp(`^rgb\\(${kl},${kl},${kl}\\)$`),bG=new RegExp(`^rgb\\(${jr},${jr},${jr}\\)$`),wG=new RegExp(`^rgba\\(${kl},${kl},${kl},${Ah}\\)$`),_G=new RegExp(`^rgba\\(${jr},${jr},${jr},${Ah}\\)$`),EG=new RegExp(`^hsl\\(${Ah},${jr},${jr}\\)$`),SG=new RegExp(`^hsla\\(${Ah},${jr},${jr},${Ah}\\)$`),O$={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Tc(uo,Ch,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:N$,formatHex:N$,formatHex8:kG,formatHsl:AG,formatRgb:R$,toString:R$});function N$(){return this.rgb().formatHex()}function kG(){return this.rgb().formatHex8()}function AG(){return eI(this).formatHsl()}function R$(){return this.rgb().formatRgb()}function Ch(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=xG.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?D$(t):n===3?new Rt(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?gp(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?gp(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=vG.exec(e))?new Rt(t[1],t[2],t[3],1):(t=bG.exec(e))?new Rt(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=wG.exec(e))?gp(t[1],t[2],t[3],t[4]):(t=_G.exec(e))?gp(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=EG.exec(e))?L$(t[1],t[2]/100,t[3]/100,1):(t=SG.exec(e))?L$(t[1],t[2]/100,t[3]/100,t[4]):O$.hasOwnProperty(e)?D$(O$[e]):e==="transparent"?new Rt(NaN,NaN,NaN,0):null}function D$(e){return new Rt(e>>16&255,e>>8&255,e&255,1)}function gp(e,t,n,i){return i<=0&&(e=t=n=NaN),new Rt(e,t,n,i)}function K_(e){return e instanceof uo||(e=Ch(e)),e?(e=e.rgb(),new Rt(e.r,e.g,e.b,e.opacity)):new Rt}function Ha(e,t,n,i){return arguments.length===1?K_(e):new Rt(e,t,n,i??1)}function Rt(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Tc(Rt,Ha,fd(uo,{brighter(e){return e=e==null?jl:Math.pow(jl,e),new Rt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?ou:Math.pow(ou,e),new Rt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Rt(Qo(this.r),Qo(this.g),Qo(this.b),Wg(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:I$,formatHex:I$,formatHex8:CG,formatRgb:P$,toString:P$}));function I$(){return`#${Go(this.r)}${Go(this.g)}${Go(this.b)}`}function CG(){return`#${Go(this.r)}${Go(this.g)}${Go(this.b)}${Go((isNaN(this.opacity)?1:this.opacity)*255)}`}function P$(){const e=Wg(this.opacity);return`${e===1?"rgb(":"rgba("}${Qo(this.r)}, ${Qo(this.g)}, ${Qo(this.b)}${e===1?")":`, ${e})`}`}function Wg(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Qo(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Go(e){return e=Qo(e),(e<16?"0":"")+e.toString(16)}function L$(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ji(e,t,n,i)}function eI(e){if(e instanceof Ji)return new Ji(e.h,e.s,e.l,e.opacity);if(e instanceof uo||(e=Ch(e)),!e)return new Ji;if(e instanceof Ji)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),a=NaN,o=s-r,u=(s+r)/2;return o?(t===s?a=(n-i)/o+(n<i)*6:n===s?a=(i-t)/o+2:a=(t-n)/o+4,o/=u<.5?s+r:2-s-r,a*=60):o=u>0&&u<1?0:a,new Ji(a,o,u,e.opacity)}function Hg(e,t,n,i){return arguments.length===1?eI(e):new Ji(e,t,n,i??1)}function Ji(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Tc(Ji,Hg,fd(uo,{brighter(e){return e=e==null?jl:Math.pow(jl,e),new Ji(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?ou:Math.pow(ou,e),new Ji(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new Rt(lx(e>=240?e-240:e+120,r,i),lx(e,r,i),lx(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new Ji(z$(this.h),mp(this.s),mp(this.l),Wg(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Wg(this.opacity);return`${e===1?"hsl(":"hsla("}${z$(this.h)}, ${mp(this.s)*100}%, ${mp(this.l)*100}%${e===1?")":`, ${e})`}`}}));function z$(e){return e=(e||0)%360,e<0?e+360:e}function mp(e){return Math.max(0,Math.min(1,e||0))}function lx(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const tI=Math.PI/180,nI=180/Math.PI,Gg=18,iI=.96422,rI=1,sI=.82521,aI=4/29,Al=6/29,oI=3*Al*Al,$G=Al*Al*Al;function uI(e){if(e instanceof qr)return new qr(e.l,e.a,e.b,e.opacity);if(e instanceof Rs)return lI(e);e instanceof Rt||(e=K_(e));var t=dx(e.r),n=dx(e.g),i=dx(e.b),r=cx((.2225045*t+.7168786*n+.0606169*i)/rI),s,a;return t===n&&n===i?s=a=r:(s=cx((.4360747*t+.3850649*n+.1430804*i)/iI),a=cx((.0139322*t+.0971045*n+.7141733*i)/sI)),new qr(116*r-16,500*(s-r),200*(r-a),e.opacity)}function Yg(e,t,n,i){return arguments.length===1?uI(e):new qr(e,t,n,i??1)}function qr(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}Tc(qr,Yg,fd(uo,{brighter(e){return new qr(this.l+Gg*(e??1),this.a,this.b,this.opacity)},darker(e){return new qr(this.l-Gg*(e??1),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=iI*fx(t),e=rI*fx(e),n=sI*fx(n),new Rt(hx(3.1338561*t-1.6168667*e-.4906146*n),hx(-.9787684*t+1.9161415*e+.033454*n),hx(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function cx(e){return e>$G?Math.pow(e,1/3):e/oI+aI}function fx(e){return e>Al?e*e*e:oI*(e-aI)}function hx(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function dx(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function TG(e){if(e instanceof Rs)return new Rs(e.h,e.c,e.l,e.opacity);if(e instanceof qr||(e=uI(e)),e.a===0&&e.b===0)return new Rs(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*nI;return new Rs(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Xg(e,t,n,i){return arguments.length===1?TG(e):new Rs(e,t,n,i??1)}function Rs(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function lI(e){if(isNaN(e.h))return new qr(e.l,0,0,e.opacity);var t=e.h*tI;return new qr(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Tc(Rs,Xg,fd(uo,{brighter(e){return new Rs(this.h,this.c,this.l+Gg*(e??1),this.opacity)},darker(e){return new Rs(this.h,this.c,this.l-Gg*(e??1),this.opacity)},rgb(){return lI(this).rgb()}}));var cI=-.14861,Q_=1.78277,J_=-.29227,Hm=-.90649,$h=1.97294,B$=$h*Hm,U$=$h*Q_,j$=Q_*J_-Hm*cI;function FG(e){if(e instanceof Jo)return new Jo(e.h,e.s,e.l,e.opacity);e instanceof Rt||(e=K_(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(j$*i+B$*t-U$*n)/(j$+B$-U$),s=i-r,a=($h*(n-r)-J_*s)/Hm,o=Math.sqrt(a*a+s*s)/($h*r*(1-r)),u=o?Math.atan2(a,s)*nI-120:NaN;return new Jo(u<0?u+360:u,o,r,e.opacity)}function mb(e,t,n,i){return arguments.length===1?FG(e):new Jo(e,t,n,i??1)}function Jo(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Tc(Jo,mb,fd(uo,{brighter(e){return e=e==null?jl:Math.pow(jl,e),new Jo(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?ou:Math.pow(ou,e),new Jo(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*tI,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new Rt(255*(t+n*(cI*i+Q_*r)),255*(t+n*(J_*i+Hm*r)),255*(t+n*($h*i)),this.opacity)}}));function fI(e,t,n,i,r){var s=e*e,a=s*e;return((1-3*e+3*s-a)*t+(4-6*s+3*a)*n+(1+3*e+3*s-3*a)*i+a*r)/6}function hI(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),r=e[i],s=e[i+1],a=i>0?e[i-1]:2*r-s,o=i<t-1?e[i+2]:2*s-r;return fI((n-i/t)*t,a,r,s,o)}}function dI(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t),r=e[(i+t-1)%t],s=e[i%t],a=e[(i+1)%t],o=e[(i+2)%t];return fI((n-i/t)*t,r,s,a,o)}}const Gm=e=>()=>e;function pI(e,t){return function(n){return e+n*t}}function MG(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Ym(e,t){var n=t-e;return n?pI(e,n>180||n<-180?n-360*Math.round(n/360):n):Gm(isNaN(e)?t:e)}function OG(e){return(e=+e)==1?Dt:function(t,n){return n-t?MG(t,n,e):Gm(isNaN(t)?n:t)}}function Dt(e,t){var n=t-e;return n?pI(e,n):Gm(isNaN(e)?t:e)}const yb=function e(t){var n=OG(t);function i(r,s){var a=n((r=Ha(r)).r,(s=Ha(s)).r),o=n(r.g,s.g),u=n(r.b,s.b),l=Dt(r.opacity,s.opacity);return function(c){return r.r=a(c),r.g=o(c),r.b=u(c),r.opacity=l(c),r+""}}return i.gamma=e,i}(1);function gI(e){return function(t){var n=t.length,i=new Array(n),r=new Array(n),s=new Array(n),a,o;for(a=0;a<n;++a)o=Ha(t[a]),i[a]=o.r||0,r[a]=o.g||0,s[a]=o.b||0;return i=e(i),r=e(r),s=e(s),o.opacity=1,function(u){return o.r=i(u),o.g=r(u),o.b=s(u),o+""}}}var NG=gI(hI),RG=gI(dI);function Z_(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=e[r]*(1-s)+t[r]*s;return i}}function mI(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function DG(e,t){return(mI(t)?Z_:yI)(e,t)}function yI(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),s=new Array(n),a;for(a=0;a<i;++a)r[a]=lo(e[a],t[a]);for(;a<n;++a)s[a]=t[a];return function(o){for(a=0;a<i;++a)s[a]=r[a](o);return s}}function xI(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function Ki(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function vI(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=lo(e[r],t[r]):i[r]=t[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var xb=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,px=new RegExp(xb.source,"g");function IG(e){return function(){return e}}function PG(e){return function(t){return e(t)+""}}function bI(e,t){var n=xb.lastIndex=px.lastIndex=0,i,r,s,a=-1,o=[],u=[];for(e=e+"",t=t+"";(i=xb.exec(e))&&(r=px.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),o[a]?o[a]+=s:o[++a]=s),(i=i[0])===(r=r[0])?o[a]?o[a]+=r:o[++a]=r:(o[++a]=null,u.push({i:a,x:Ki(i,r)})),n=px.lastIndex;return n<t.length&&(s=t.slice(n),o[a]?o[a]+=s:o[++a]=s),o.length<2?u[0]?PG(u[0].x):IG(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)o[(f=u[c]).i]=f.x(l);return o.join("")})}function lo(e,t){var n=typeof t,i;return t==null||n==="boolean"?Gm(t):(n==="number"?Ki:n==="string"?(i=Ch(t))?(t=i,yb):bI:t instanceof Ch?yb:t instanceof Date?xI:mI(t)?Z_:Array.isArray(t)?yI:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?vI:Ki)(e,t)}function LG(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function zG(e,t){var n=Ym(+e,+t);return function(i){var r=n(i);return r-360*Math.floor(r/360)}}function hd(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var q$=180/Math.PI,vb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function wI(e,t,n,i,r,s){var a,o,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*i)&&(n-=e*u,i-=t*u),(o=Math.sqrt(n*n+i*i))&&(n/=o,i/=o,u/=o),e*i<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*q$,skewX:Math.atan(u)*q$,scaleX:a,scaleY:o}}var yp;function BG(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?vb:wI(t.a,t.b,t.c,t.d,t.e,t.f)}function UG(e){return e==null||(yp||(yp=document.createElementNS("http://www.w3.org/2000/svg","g")),yp.setAttribute("transform",e),!(e=yp.transform.baseVal.consolidate()))?vb:(e=e.matrix,wI(e.a,e.b,e.c,e.d,e.e,e.f))}function _I(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push("translate(",null,t,null,n);p.push({i:g-4,x:Ki(l,f)},{i:g-2,x:Ki(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function a(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(r(f)+"rotate(",null,i)-2,x:Ki(l,c)})):c&&f.push(r(f)+"rotate("+c+i)}function o(l,c,f,h){l!==c?h.push({i:f.push(r(f)+"skewX(",null,i)-2,x:Ki(l,c)}):c&&f.push(r(f)+"skewX("+c+i)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push(r(d)+"scale(",null,",",null,")");p.push({i:g-4,x:Ki(l,f)},{i:g-2,x:Ki(c,h)})}else(f!==1||h!==1)&&d.push(r(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),a(l.rotate,c.rotate,f,h),o(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,g=h.length,m;++p<g;)f[(m=h[p]).i]=m.x(d);return f.join("")}}}var jG=_I(BG,"px, ","px)","deg)"),qG=_I(UG,", ",")",")"),VG=1e-12;function V$(e){return((e=Math.exp(e))+1/e)/2}function WG(e){return((e=Math.exp(e))-1/e)/2}function HG(e){return((e=Math.exp(2*e))-1)/(e+1)}const GG=function e(t,n,i){function r(s,a){var o=s[0],u=s[1],l=s[2],c=a[0],f=a[1],h=a[2],d=c-o,p=f-u,g=d*d+p*p,m,y;if(g<VG)y=Math.log(h/l)/t,m=function(_){return[o+_*d,u+_*p,l*Math.exp(t*_*y)]};else{var x=Math.sqrt(g),v=(h*h-l*l+i*g)/(2*l*n*x),b=(h*h-l*l-i*g)/(2*h*n*x),w=Math.log(Math.sqrt(v*v+1)-v),E=Math.log(Math.sqrt(b*b+1)-b);y=(E-w)/t,m=function(_){var k=_*y,A=V$(w),T=l/(n*x)*(A*HG(t*k+w)-WG(w));return[o+T*d,u+T*p,l*A/V$(t*k+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return r.rho=function(s){var a=Math.max(.001,+s),o=a*a,u=o*o;return e(a,o,u)},r}(Math.SQRT2,2,4);function EI(e){return function(t,n){var i=e((t=Hg(t)).h,(n=Hg(n)).h),r=Dt(t.s,n.s),s=Dt(t.l,n.l),a=Dt(t.opacity,n.opacity);return function(o){return t.h=i(o),t.s=r(o),t.l=s(o),t.opacity=a(o),t+""}}}const YG=EI(Ym);var XG=EI(Dt);function KG(e,t){var n=Dt((e=Yg(e)).l,(t=Yg(t)).l),i=Dt(e.a,t.a),r=Dt(e.b,t.b),s=Dt(e.opacity,t.opacity);return function(a){return e.l=n(a),e.a=i(a),e.b=r(a),e.opacity=s(a),e+""}}function SI(e){return function(t,n){var i=e((t=Xg(t)).h,(n=Xg(n)).h),r=Dt(t.c,n.c),s=Dt(t.l,n.l),a=Dt(t.opacity,n.opacity);return function(o){return t.h=i(o),t.c=r(o),t.l=s(o),t.opacity=a(o),t+""}}}const QG=SI(Ym);var JG=SI(Dt);function kI(e){return function t(n){n=+n;function i(r,s){var a=e((r=mb(r)).h,(s=mb(s)).h),o=Dt(r.s,s.s),u=Dt(r.l,s.l),l=Dt(r.opacity,s.opacity);return function(c){return r.h=a(c),r.s=o(c),r.l=u(Math.pow(c,n)),r.opacity=l(c),r+""}}return i.gamma=t,i}(1)}const ZG=kI(Ym);var eY=kI(Dt);function eE(e,t){t===void 0&&(t=e,e=lo);for(var n=0,i=t.length-1,r=t[0],s=new Array(i<0?0:i);n<i;)s[n]=e(r,r=t[++n]);return function(a){var o=Math.max(0,Math.min(i-1,Math.floor(a*=i)));return s[o](a-o)}}function tY(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i/(t-1));return n}const nY=Object.freeze(Object.defineProperty({__proto__:null,interpolate:lo,interpolateArray:DG,interpolateBasis:hI,interpolateBasisClosed:dI,interpolateCubehelix:ZG,interpolateCubehelixLong:eY,interpolateDate:xI,interpolateDiscrete:LG,interpolateHcl:QG,interpolateHclLong:JG,interpolateHsl:YG,interpolateHslLong:XG,interpolateHue:zG,interpolateLab:KG,interpolateNumber:Ki,interpolateNumberArray:Z_,interpolateObject:vI,interpolateRgb:yb,interpolateRgbBasis:NG,interpolateRgbBasisClosed:RG,interpolateRound:hd,interpolateString:bI,interpolateTransformCss:jG,interpolateTransformSvg:qG,interpolateZoom:GG,piecewise:eE,quantize:tY},Symbol.toStringTag,{value:"Module"}));function iY(e){return function(){return e}}function bb(e){return+e}var W$=[0,1];function qn(e){return e}function wb(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:iY(isNaN(t)?NaN:.5)}function rY(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function sY(e,t,n){var i=e[0],r=e[1],s=t[0],a=t[1];return r<i?(i=wb(r,i),s=n(a,s)):(i=wb(i,r),s=n(s,a)),function(o){return s(i(o))}}function aY(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),s=new Array(i),a=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<i;)r[a]=wb(e[a],e[a+1]),s[a]=n(t[a],t[a+1]);return function(o){var u=ja(e,o,1,i)-1;return s[u](r[u](o))}}function dd(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Xm(){var e=W$,t=W$,n=lo,i,r,s,a=qn,o,u,l;function c(){var h=Math.min(e.length,t.length);return a!==qn&&(a=rY(e[0],e[h-1])),o=h>2?aY:sY,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=o(e.map(i),t,n)))(i(a(h)))}return f.invert=function(h){return a(r((l||(l=o(t,e.map(i),Ki)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,bb),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=hd,c()},f.clamp=function(h){return arguments.length?(a=h?!0:qn,c()):a!==qn},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return i=h,r=d,c()}}function AI(){return Xm()(qn,qn)}function CI(e,t,n,i){var r=qa(e,t,n),s;switch(i=au(i??",f"),i.type){case"s":{var a=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(s=ZN(r,a))&&(i.precision=s),Uw(i,a)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=eR(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=JN(r))&&(i.precision=s-(i.type==="%")*2);break}}return Sm(i)}function Nu(e){var t=e.domain;return e.ticks=function(n){var i=t();return Zv(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return CI(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,s=i.length-1,a=i[r],o=i[s],u,l,c=10;for(o<a&&(l=a,a=o,o=l,l=r,r=s,s=l);c-- >0;){if(l=eb(a,o,n),l===u)return i[r]=a,i[s]=o,t(i);if(l>0)a=Math.floor(a/l)*l,o=Math.ceil(o/l)*l;else if(l<0)a=Math.ceil(a*l)/l,o=Math.floor(o*l)/l;else break;u=l}return e},e}function $I(){var e=AI();return e.copy=function(){return dd(e,$I())},ss.apply(e,arguments),Nu(e)}function TI(e){var t;function n(i){return i==null||isNaN(i=+i)?t:i}return n.invert=n,n.domain=n.range=function(i){return arguments.length?(e=Array.from(i,bb),n):e.slice()},n.unknown=function(i){return arguments.length?(t=i,n):t},n.copy=function(){return TI(e).unknown(t)},e=arguments.length?Array.from(e,bb):[0,1],Nu(n)}function FI(e,t){e=e.slice();var n=0,i=e.length-1,r=e[n],s=e[i],a;return s<r&&(a=n,n=i,i=a,a=r,r=s,s=a),e[n]=t.floor(r),e[i]=t.ceil(s),e}function H$(e){return Math.log(e)}function G$(e){return Math.exp(e)}function oY(e){return-Math.log(-e)}function uY(e){return-Math.exp(-e)}function lY(e){return isFinite(e)?+("1e"+e):e<0?0:e}function cY(e){return e===10?lY:e===Math.E?Math.exp:t=>Math.pow(e,t)}function fY(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function Y$(e){return(t,n)=>-e(-t,n)}function tE(e){const t=e(H$,G$),n=t.domain;let i=10,r,s;function a(){return r=fY(i),s=cY(i),n()[0]<0?(r=Y$(r),s=Y$(s),e(oY,uY)):e(H$,G$),t}return t.base=function(o){return arguments.length?(i=+o,a()):i},t.domain=function(o){return arguments.length?(n(o),a()):n()},t.ticks=o=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let h=r(l),d=r(c),p,g;const m=o==null?10:+o;let y=[];if(!(i%1)&&d-h<m){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(p=1;p<i;++p)if(g=h<0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}}else for(;h<=d;++h)for(p=i-1;p>=1;--p)if(g=h>0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}y.length*2<m&&(y=Zv(l,c,m))}else y=Zv(h,d,Math.min(d-h,m)).map(s);return f?y.reverse():y},t.tickFormat=(o,u)=>{if(o==null&&(o=10),u==null&&(u=i===10?"s":","),typeof u!="function"&&(!(i%1)&&(u=au(u)).precision==null&&(u.trim=!0),u=Sm(u)),o===1/0)return u;const l=Math.max(1,i*o/t.ticks().length);return c=>{let f=c/s(Math.round(r(c)));return f*i<i-.5&&(f*=i),f<=l?u(c):""}},t.nice=()=>n(FI(n(),{floor:o=>s(Math.floor(r(o))),ceil:o=>s(Math.ceil(r(o)))})),t}function MI(){const e=tE(Xm()).domain([1,10]);return e.copy=()=>dd(e,MI()).base(e.base()),ss.apply(e,arguments),e}function X$(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function K$(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function nE(e){var t=1,n=e(X$(t),K$(t));return n.constant=function(i){return arguments.length?e(X$(t=+i),K$(t)):t},Nu(n)}function OI(){var e=nE(Xm());return e.copy=function(){return dd(e,OI()).constant(e.constant())},ss.apply(e,arguments)}function Q$(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function hY(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function dY(e){return e<0?-e*e:e*e}function iE(e){var t=e(qn,qn),n=1;function i(){return n===1?e(qn,qn):n===.5?e(hY,dY):e(Q$(n),Q$(1/n))}return t.exponent=function(r){return arguments.length?(n=+r,i()):n},Nu(t)}function rE(){var e=iE(Xm());return e.copy=function(){return dd(e,rE()).exponent(e.exponent())},ss.apply(e,arguments),e}function pY(){return rE.apply(null,arguments).exponent(.5)}function NI(){var e=[],t=[],n=[],i;function r(){var a=0,o=Math.max(1,t.length);for(n=new Array(o-1);++a<o;)n[a-1]=HN(e,a/o);return s}function s(a){return a==null||isNaN(a=+a)?i:t[ja(n,a)]}return s.invertExtent=function(a){var o=t.indexOf(a);return o<0?[NaN,NaN]:[o>0?n[o-1]:e[0],o<n.length?n[o]:e[e.length-1]]},s.domain=function(a){if(!arguments.length)return e.slice();e=[];for(let o of a)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(Ls),r()},s.range=function(a){return arguments.length?(t=Array.from(a),r()):t.slice()},s.unknown=function(a){return arguments.length?(i=a,s):i},s.quantiles=function(){return n.slice()},s.copy=function(){return NI().domain(e).range(t).unknown(i)},ss.apply(s,arguments)}function RI(){var e=0,t=1,n=1,i=[.5],r=[0,1],s;function a(u){return u!=null&&u<=u?r[ja(i,u,0,n)]:s}function o(){var u=-1;for(i=new Array(n);++u<n;)i[u]=((u+1)*t-(u-n)*e)/(n+1);return a}return a.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,o()):[e,t]},a.range=function(u){return arguments.length?(n=(r=Array.from(u)).length-1,o()):r.slice()},a.invertExtent=function(u){var l=r.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,i[0]]:l>=n?[i[n-1],t]:[i[l-1],i[l]]},a.unknown=function(u){return arguments.length&&(s=u),a},a.thresholds=function(){return i.slice()},a.copy=function(){return RI().domain([e,t]).range(r).unknown(s)},ss.apply(Nu(a),arguments)}function DI(){var e=[.5],t=[0,1],n,i=1;function r(s){return s!=null&&s<=s?t[ja(e,s,0,i)]:n}return r.domain=function(s){return arguments.length?(e=Array.from(s),i=Math.min(e.length,t.length-1),r):e.slice()},r.range=function(s){return arguments.length?(t=Array.from(s),i=Math.min(e.length,t.length-1),r):t.slice()},r.invertExtent=function(s){var a=t.indexOf(s);return[e[a-1],e[a]]},r.unknown=function(s){return arguments.length?(n=s,r):n},r.copy=function(){return DI().domain(e).range(t).unknown(n)},ss.apply(r,arguments)}function gY(e){return new Date(e)}function mY(e){return e instanceof Date?+e:+new Date(+e)}function sE(e,t,n,i,r,s,a,o,u,l){var c=AI(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),x=l("%b %d"),v=l("%B"),b=l("%Y");function w(E){return(u(E)<E?d:o(E)<E?p:a(E)<E?g:s(E)<E?m:i(E)<E?r(E)<E?y:x:n(E)<E?v:b)(E)}return c.invert=function(E){return new Date(f(E))},c.domain=function(E){return arguments.length?h(Array.from(E,mY)):h().map(gY)},c.ticks=function(E){var _=h();return e(_[0],_[_.length-1],E??10)},c.tickFormat=function(E,_){return _==null?w:l(_)},c.nice=function(E){var _=h();return(!E||typeof E.range!="function")&&(E=t(_[0],_[_.length-1],E??10)),E?h(FI(_,E)):c},c.copy=function(){return dd(c,sE(e,t,n,i,r,s,a,o,u,l))},c}function yY(){return ss.apply(sE(Eq,Sq,Xr,wh,Sc,zs,Cm,km,Ns,Hw).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function xY(){return ss.apply(sE(wq,_q,Kr,_h,kc,Ia,$m,Am,Ns,Gw).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Km(){var e=0,t=1,n,i,r,s,a=qn,o=!1,u;function l(f){return f==null||isNaN(f=+f)?u:a(r===0?.5:(f=(s(f)-n)*r,o?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),i=s(t=+t),r=n===i?0:1/(i-n),l):[e,t]},l.clamp=function(f){return arguments.length?(o=!!f,l):o},l.interpolator=function(f){return arguments.length?(a=f,l):a};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,a=f(d,p),l):[a(0),a(1)]}}return l.range=c(lo),l.rangeRound=c(hd),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),i=f(t),r=n===i?0:1/(i-n),l}}function co(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function aE(){var e=Nu(Km()(qn));return e.copy=function(){return co(e,aE())},oo.apply(e,arguments)}function II(){var e=tE(Km()).domain([1,10]);return e.copy=function(){return co(e,II()).base(e.base())},oo.apply(e,arguments)}function PI(){var e=nE(Km());return e.copy=function(){return co(e,PI()).constant(e.constant())},oo.apply(e,arguments)}function oE(){var e=iE(Km());return e.copy=function(){return co(e,oE()).exponent(e.exponent())},oo.apply(e,arguments)}function vY(){return oE.apply(null,arguments).exponent(.5)}function Qm(){var e=0,t=.5,n=1,i=1,r,s,a,o,u,l=qn,c,f=!1,h;function d(g){return isNaN(g=+g)?h:(g=.5+((g=+c(g))-s)*(i*g<i*s?o:u),l(f?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,n]=g,r=c(e=+e),s=c(t=+t),a=c(n=+n),o=r===s?0:.5/(s-r),u=s===a?0:.5/(a-s),i=s<r?-1:1,d):[e,t,n]},d.clamp=function(g){return arguments.length?(f=!!g,d):f},d.interpolator=function(g){return arguments.length?(l=g,d):l};function p(g){return function(m){var y,x,v;return arguments.length?([y,x,v]=m,l=eE(g,[y,x,v]),d):[l(0),l(.5),l(1)]}}return d.range=p(lo),d.rangeRound=p(hd),d.unknown=function(g){return arguments.length?(h=g,d):h},function(g){return c=g,r=g(e),s=g(t),a=g(n),o=r===s?0:.5/(s-r),u=s===a?0:.5/(a-s),i=s<r?-1:1,d}}function LI(){var e=Nu(Qm()(qn));return e.copy=function(){return co(e,LI())},oo.apply(e,arguments)}function zI(){var e=tE(Qm()).domain([.1,1,10]);return e.copy=function(){return co(e,zI()).base(e.base())},oo.apply(e,arguments)}function BI(){var e=nE(Qm());return e.copy=function(){return co(e,BI()).constant(e.constant())},oo.apply(e,arguments)}function uE(){var e=iE(Qm());return e.copy=function(){return co(e,uE()).exponent(e.exponent())},oo.apply(e,arguments)}function bY(){return uE.apply(null,arguments).exponent(.5)}function as(e){for(var t=e.length/6|0,n=new Array(t),i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}const wY=as("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),_Y=as("7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666"),EY=as("1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666"),SY=as("4269d0efb118ff725c6cc5b03ca951ff8ab7a463f297bbf59c6b4e9498a0"),kY=as("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),AY=as("fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2"),CY=as("b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc"),$Y=as("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999"),TY=as("66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3"),FY=as("8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f");function lE(e,t,n){const i=e-t+n*2;return e?i>0?i:1:0}const MY="identity",ql="linear",Gs="log",pd="pow",gd="sqrt",Jm="symlog",uu="time",lu="utc",Vr="sequential",Fc="diverging",Vl="quantile",Zm="quantize",e1="threshold",cE="ordinal",_b="point",UI="band",fE="bin-ordinal",Mt="continuous",md="discrete",yd="discretizing",zi="interpolating",hE="temporal";function OY(e){return function(t){let n=t[0],i=t[1],r;return i<n&&(r=n,n=i,i=r),[e.invert(n),e.invert(i)]}}function NY(e){return function(t){const n=e.range();let i=t[0],r=t[1],s=-1,a,o,u,l;for(r<i&&(o=i,i=r,r=o),u=0,l=n.length;u<l;++u)n[u]>=i&&n[u]<=r&&(s<0&&(s=u),a=u);if(!(s<0))return i=e.invertExtent(n[s]),r=e.invertExtent(n[a]),[i[0]===void 0?i[1]:i[0],r[1]===void 0?r[0]:r[1]]}}function dE(){const e=X_().unknown(void 0),t=e.domain,n=e.range;let i=[0,1],r,s,a=!1,o=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=i[1]<i[0],d=i[1-h],p=lE(f,o,u);let g=i[h-0];r=(d-g)/(p||1),a&&(r=Math.floor(r)),g+=(d-g-r*(f-o))*l,s=r*(1-o),a&&(g=Math.round(g),s=Math.round(s));const m=si(f).map(y=>g+r*y);return n(h?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(i=[+f[0],+f[1]],c()):i.slice()},e.rangeRound=function(f){return i=[+f[0],+f[1]],a=!0,c()},e.bandwidth=function(){return s},e.step=function(){return r},e.round=function(f){return arguments.length?(a=!!f,c()):a},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),o=u,c()):o},e.paddingInner=function(f){return arguments.length?(o=Math.max(0,Math.min(1,f)),c()):o},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=i[1]<i[0],d=h?n().reverse():n(),p=d.length-1;let g=+f[0],m=+f[1],y,x,v;if(!(g!==g||m!==m)&&(m<g&&(v=g,g=m,m=v),!(m<d[0]||g>i[1-h])))return y=Math.max(0,ja(d,g)-1),x=g===m?y:ja(d,m)-1,g-d[y]>s+1e-10&&++y,h&&(v=y,y=p-x,x=p-v),y>x?void 0:t().slice(y,x+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return dE().domain(t()).range(i).round(a).paddingInner(o).paddingOuter(u).align(l)},c()}function jI(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return jI(t())},e}function RY(){return jI(dE().paddingInner(1))}var DY=Array.prototype.map;function IY(e){return DY.call(e,fn)}const PY=Array.prototype.slice;function qI(){let e=[],t=[];function n(i){return i==null||i!==i?void 0:t[(ja(e,i)-1)%t.length]}return n.domain=function(i){return arguments.length?(e=IY(i),n):e.slice()},n.range=function(i){return arguments.length?(t=PY.call(i),n):t.slice()},n.tickFormat=function(i,r){return CI(e[0],Fe(e),i??10,r)},n.copy=function(){return qI().domain(n.domain()).range(n.range())},n}const Kg=new Map,VI=Symbol("vega_scale");function WI(e){return e[VI]=!0,e}function LY(e){return e&&e[VI]===!0}function zY(e,t,n){const i=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?OY(s):s.invertExtent?NY(s):void 0),s.type=e,WI(s)};return i.metadata=ur(Q(n)),i}function Le(e,t,n){return arguments.length>1?(Kg.set(e,zY(e,t,n)),this):HI(e)?Kg.get(e):void 0}Le(MY,TI);Le(ql,$I,Mt);Le(Gs,MI,[Mt,Gs]);Le(pd,rE,Mt);Le(gd,pY,Mt);Le(Jm,OI,Mt);Le(uu,yY,[Mt,hE]);Le(lu,xY,[Mt,hE]);Le(Vr,aE,[Mt,zi]);Le(`${Vr}-${ql}`,aE,[Mt,zi]);Le(`${Vr}-${Gs}`,II,[Mt,zi,Gs]);Le(`${Vr}-${pd}`,oE,[Mt,zi]);Le(`${Vr}-${gd}`,vY,[Mt,zi]);Le(`${Vr}-${Jm}`,PI,[Mt,zi]);Le(`${Fc}-${ql}`,LI,[Mt,zi]);Le(`${Fc}-${Gs}`,zI,[Mt,zi,Gs]);Le(`${Fc}-${pd}`,uE,[Mt,zi]);Le(`${Fc}-${gd}`,bY,[Mt,zi]);Le(`${Fc}-${Jm}`,BI,[Mt,zi]);Le(Vl,NI,[yd,Vl]);Le(Zm,RI,yd);Le(e1,DI,yd);Le(fE,qI,[md,yd]);Le(cE,X_,md);Le(UI,dE,md);Le(_b,RY,md);function HI(e){return Kg.has(e)}function Ru(e,t){const n=Kg.get(e);return n&&n.metadata[t]}function pE(e){return Ru(e,Mt)}function Wl(e){return Ru(e,md)}function Eb(e){return Ru(e,yd)}function GI(e){return Ru(e,Gs)}function BY(e){return Ru(e,hE)}function YI(e){return Ru(e,zi)}function XI(e){return Ru(e,Vl)}const UY=["clamp","base","constant","exponent"];function KI(e,t){const n=t[0],i=Fe(t)-n;return function(r){return e(n+r*i)}}function t1(e,t,n){return eE(gE(t||"rgb",n),e)}function QI(e,t){const n=new Array(t),i=t+1;for(let r=0;r<t;)n[r]=e(++r/i);return n}function JI(e,t,n){const i=n-t;let r,s,a;return!i||!Number.isFinite(i)?xn(.5):(r=(s=e.type).indexOf("-"),s=r<0?s:s.slice(r+1),a=Le(s)().domain([t,n]).range([0,1]),UY.forEach(o=>e[o]?a[o](e[o]()):0),a)}function gE(e,t){const n=nY[jY(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function jY(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const qY={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},VY={accent:_Y,category10:wY,category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",dark2:EY,observable10:SY,paired:kY,pastel1:AY,pastel2:CY,set1:$Y,set2:TY,set3:FY,tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5"};function ZI(e){if(L(e))return e;const t=e.length/6|0,n=new Array(t);for(let i=0;i<t;)n[i]="#"+e.slice(i*6,++i*6);return n}function e5(e,t){for(const n in e)mE(n,t(e[n]))}const J$={};e5(VY,ZI);e5(qY,e=>t1(ZI(e)));function mE(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(J$[e]=t,this):J$[e]}const rg="symbol",WY="discrete",HY="gradient",GY=e=>L(e)?e.map(t=>String(t)):String(e),YY=(e,t)=>e[1]-t[1],XY=(e,t)=>t[1]-e[1];function yE(e,t,n){let i;return Ie(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(od(e.domain())/n||1)+1))),K(t)&&(i=t.step,t=t.interval),J(t)&&(t=e.type===uu?Ac(t):e.type==lu?Cc(t):P("Only time and utc scales accept interval strings."),i&&(t=t.every(i))),t}function t5(e,t,n){let i=e.range(),r=i[0],s=Fe(i),a=YY;if(r>s&&(i=s,s=r,r=i,a=XY),r=Math.floor(r),s=Math.ceil(s),t=t.map(o=>[o,e(o)]).filter(o=>r<=o[1]&&o[1]<=s).sort(a).map(o=>o[0]),n>0&&t.length>1){const o=[t[0],Fe(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=o)}return t}function xE(e,t){return e.bins?t5(e,e.bins,t):e.ticks?e.ticks(t):e.domain()}function n5(e,t,n,i,r,s){const a=t.type;let o=GY;if(a===uu||r===uu)o=e.timeFormat(i);else if(a===lu||r===lu)o=e.utcFormat(i);else if(GI(a)){const u=e.formatFloat(i);if(s||t.bins)o=u;else{const l=i5(t,n,!1);o=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();o=e.formatSpan(u[0],u[u.length-1],n,i)}else i&&(o=e.format(i));return o}function i5(e,t,n){const i=xE(e,t),r=e.base(),s=Math.log(r),a=Math.max(1,r*t/i.length),o=u=>{let l=u/Math.pow(r,Math.round(Math.log(u)/s));return l*r<r-.5&&(l*=r),l<=a};return n?i.filter(o):o}const Sb={[Vl]:"quantiles",[Zm]:"thresholds",[e1]:"domain"},r5={[Vl]:"quantiles",[Zm]:"domain"};function s5(e,t){return e.bins?JY(e.bins):e.type===Gs?i5(e,t,!0):Sb[e.type]?QY(e[Sb[e.type]]()):xE(e,t)}function KY(e,t,n){const i=t[r5[t.type]](),r=i.length;let s=r>1?i[1]-i[0]:i[0],a;for(a=1;a<r;++a)s=Math.min(s,i[a]-i[a-1]);return e.formatSpan(0,s,3*10,n)}function QY(e){const t=[-1/0].concat(e);return t.max=1/0,t}function JY(e){const t=e.slice(0,-1);return t.max=Fe(e),t}const ZY=e=>Sb[e.type]||e.bins;function a5(e,t,n,i,r,s,a){const o=r5[t.type]&&s!==uu&&s!==lu?KY(e,t,r):n5(e,t,n,r,s,a);return i===rg&&ZY(t)?eX(o):i===WY?tX(o):nX(o)}const eX=e=>(t,n,i)=>{const r=Z$(i[n+1],Z$(i.max,1/0)),s=e3(t,e),a=e3(r,e);return s&&a?s+" – "+a:a?"< "+a:"≥ "+s},Z$=(e,t)=>e??t,tX=e=>(t,n)=>n?e(t):null,nX=e=>t=>e(t),e3=(e,t)=>Number.isFinite(e)?t(e):null;function iX(e){const t=e.domain(),n=t.length-1;let i=+t[0],r=+Fe(t),s=r-i;if(e.type===e1){const a=n?s/n:.1;i-=a,r+=a,s=r-i}return a=>(a-i)/s}function rX(e,t,n,i){const r=i||t.type;return J(n)&&BY(r)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&r===uu?e.timeFormat("%A, %d %B %Y, %X"):!n&&r===lu?e.utcFormat("%A, %d %B %Y, %X UTC"):a5(e,t,5,null,n,i,!0)}function o5(e,t,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=rX(e,t,n.format,n.formatType);if(Eb(t.type)){const s=s5(t).slice(1).map(r),a=s.length;return`${a} boundar${a===1?"y":"ies"}: ${s.join(", ")}`}else if(Wl(t.type)){const s=t.domain(),a=s.length,o=a>i?s.slice(0,i-2).map(r).join(", ")+", ending with "+s.slice(-1).map(r):s.map(r).join(", ");return`${a} value${a===1?"":"s"}: ${o}`}else{const s=t.domain();return`values from ${r(s[0])} to ${r(Fe(s))}`}}let u5=0;function sX(){u5=0}const Qg="p_";function vE(e){return e&&e.gradient}function l5(e,t,n){const i=e.gradient;let r=e.id,s=i==="radial"?Qg:"";return r||(r=e.id="gradient_"+u5++,i==="radial"?(e.x1=$r(e.x1,.5),e.y1=$r(e.y1,.5),e.r1=$r(e.r1,0),e.x2=$r(e.x2,.5),e.y2=$r(e.y2,.5),e.r2=$r(e.r2,.5),s=Qg):(e.x1=$r(e.x1,0),e.y1=$r(e.y1,0),e.x2=$r(e.x2,1),e.y2=$r(e.y2,0))),t[r]=e,"url("+(n||"")+"#"+s+r+")"}function $r(e,t){return e??t}function c5(e,t){var n=[],i;return i={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(r,s){return n.push({offset:r,color:s}),i}}}const t3={basis:{curve:eG},"basis-closed":{curve:tG},"basis-open":{curve:nG},bundle:{curve:iG,tension:"beta",value:.85},cardinal:{curve:rG,tension:"tension",value:0},"cardinal-open":{curve:aG,tension:"tension",value:0},"cardinal-closed":{curve:sG,tension:"tension",value:0},"catmull-rom":{curve:oG,tension:"alpha",value:.5},"catmull-rom-closed":{curve:uG,tension:"alpha",value:.5},"catmull-rom-open":{curve:lG,tension:"alpha",value:.5},linear:{curve:V_},"linear-closed":{curve:cG},monotone:{horizontal:hG,vertical:fG},natural:{curve:dG},step:{curve:pG},"step-after":{curve:mG},"step-before":{curve:gG}};function bE(e,t,n){var i=Z(t3,e)&&t3[e],r=null;return i&&(r=i.curve||i[t||"vertical"],i.tension&&n!=null&&(r=r[i.tension](n))),r}const aX={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},oX=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,uX=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,lX=/^((\s+,?\s*)|(,\s*))/,cX=/^[01]/;function Hl(e){const t=[];return(e.match(oX)||[]).forEach(i=>{let r=i[0];const s=r.toLowerCase(),a=aX[s],o=fX(s,a,i.slice(1).trim()),u=o.length;if(u<a||u&&u%a!==0)throw Error("Invalid SVG path, incorrect parameter count");if(t.push([r,...o.slice(0,a)]),u!==a){s==="m"&&(r=r==="M"?"L":"l");for(let l=a;l<u;l+=a)t.push([r,...o.slice(l,l+a)])}}),t}function fX(e,t,n){const i=[];for(let r=0;t&&r<n.length;)for(let s=0;s<t;++s){const a=e==="a"&&(s===3||s===4)?cX:uX,o=n.slice(r).match(a);if(o===null)throw Error("Invalid SVG path, incorrect parameter type");r+=o[0].length,i.push(+o[0]);const u=n.slice(r).match(lX);u!==null&&(r+=u[0].length)}return i}const Ga=Math.PI/180,hX=1e-14,jo=Math.PI/2,Pr=Math.PI*2,Ju=Math.sqrt(3)/2;var gx={},mx={},f5=[].join;function dX(e,t,n,i,r,s,a,o,u){const l=f5.call(arguments);if(gx[l])return gx[l];const c=a*Ga,f=Math.sin(c),h=Math.cos(c);n=Math.abs(n),i=Math.abs(i);const d=h*(o-e)*.5+f*(u-t)*.5,p=h*(u-t)*.5-f*(o-e)*.5;let g=d*d/(n*n)+p*p/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);const m=h/n,y=f/n,x=-f/i,v=h/i,b=m*o+y*u,w=x*o+v*u,E=m*e+y*t,_=x*e+v*t;let A=1/((E-b)*(E-b)+(_-w)*(_-w))-.25;A<0&&(A=0);let T=Math.sqrt(A);s==r&&(T=-T);const $=.5*(b+E)-T*(_-w),R=.5*(w+_)+T*(E-b),O=Math.atan2(w-R,b-$);let C=Math.atan2(_-R,E-$)-O;C<0&&s===1?C+=Pr:C>0&&s===0&&(C-=Pr);const M=Math.ceil(Math.abs(C/(jo+.001))),D=[];for(let B=0;B<M;++B){const z=O+B*C/M,ee=O+(B+1)*C/M;D[B]=[$,R,z,ee,n,i,f,h]}return gx[l]=D}function pX(e){const t=f5.call(e);if(mx[t])return mx[t];var n=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],u=e[6],l=e[7];const c=l*a,f=-u*o,h=u*a,d=l*o,p=Math.cos(r),g=Math.sin(r),m=Math.cos(s),y=Math.sin(s),x=.5*(s-r),v=Math.sin(x*.5),b=8/3*v*v/Math.sin(x),w=n+p-b*g,E=i+g+b*p,_=n+m,k=i+y,A=_+b*y,T=k-b*m;return mx[t]=[c*w+f*E,h*w+d*E,c*A+f*T,h*A+d*T,c*_+f*k,h*_+d*k]}const yi=["l",0,0,0,0,0,0,0];function gX(e,t,n){const i=yi[0]=e[0];if(i==="a"||i==="A")yi[1]=t*e[1],yi[2]=n*e[2],yi[3]=e[3],yi[4]=e[4],yi[5]=e[5],yi[6]=t*e[6],yi[7]=n*e[7];else if(i==="h"||i==="H")yi[1]=t*e[1];else if(i==="v"||i==="V")yi[1]=n*e[1];else for(var r=1,s=e.length;r<s;++r)yi[r]=(r%2==1?t:n)*e[r];return yi}function Th(e,t,n,i,r,s){var a,o=null,u=0,l=0,c=0,f=0,h,d,p,g,m=0,y=0;n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),s==null&&(s=r),e.beginPath&&e.beginPath();for(var x=0,v=t.length;x<v;++x){switch(a=t[x],(r!==1||s!==1)&&(a=gX(a,r,s)),a[0]){case"l":u+=a[1],l+=a[2],e.lineTo(u+n,l+i);break;case"L":u=a[1],l=a[2],e.lineTo(u+n,l+i);break;case"h":u+=a[1],e.lineTo(u+n,l+i);break;case"H":u=a[1],e.lineTo(u+n,l+i);break;case"v":l+=a[1],e.lineTo(u+n,l+i);break;case"V":l=a[1],e.lineTo(u+n,l+i);break;case"m":u+=a[1],l+=a[2],m=u,y=l,e.moveTo(u+n,l+i);break;case"M":u=a[1],l=a[2],m=u,y=l,e.moveTo(u+n,l+i);break;case"c":h=u+a[5],d=l+a[6],c=u+a[3],f=l+a[4],e.bezierCurveTo(u+a[1]+n,l+a[2]+i,c+n,f+i,h+n,d+i),u=h,l=d;break;case"C":u=a[5],l=a[6],c=a[3],f=a[4],e.bezierCurveTo(a[1]+n,a[2]+i,c+n,f+i,u+n,l+i);break;case"s":h=u+a[3],d=l+a[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,u+a[1]+n,l+a[2]+i,h+n,d+i),c=u+a[1],f=l+a[2],u=h,l=d;break;case"S":h=a[3],d=a[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+i,a[1]+n,a[2]+i,h+n,d+i),u=h,l=d,c=a[1],f=a[2];break;case"q":h=u+a[3],d=l+a[4],c=u+a[1],f=l+a[2],e.quadraticCurveTo(c+n,f+i,h+n,d+i),u=h,l=d;break;case"Q":h=a[3],d=a[4],e.quadraticCurveTo(a[1]+n,a[2]+i,h+n,d+i),u=h,l=d,c=a[1],f=a[2];break;case"t":h=u+a[1],d=l+a[2],o[0].match(/[QqTt]/)===null?(c=u,f=l):o[0]==="t"?(c=2*u-p,f=2*l-g):o[0]==="q"&&(c=2*u-c,f=2*l-f),p=c,g=f,e.quadraticCurveTo(c+n,f+i,h+n,d+i),u=h,l=d,c=u+a[1],f=l+a[2];break;case"T":h=a[1],d=a[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+i,h+n,d+i),u=h,l=d;break;case"a":n3(e,u+n,l+i,[a[1],a[2],a[3],a[4],a[5],a[6]+u+n,a[7]+l+i]),u+=a[6],l+=a[7];break;case"A":n3(e,u+n,l+i,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+i]),u=a[6],l=a[7];break;case"z":case"Z":u=m,l=y,e.closePath();break}o=a}}function n3(e,t,n,i){const r=dX(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,n);for(let s=0;s<r.length;++s){const a=pX(r[s]);e.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])}}const i3=.5773502691896257,r3={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,Pr)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/2.5;e.moveTo(-n,-i),e.lineTo(-n,i),e.lineTo(-i,i),e.lineTo(-i,n),e.lineTo(i,n),e.lineTo(i,i),e.lineTo(n,i),e.lineTo(n,-i),e.lineTo(i,-i),e.lineTo(i,-n),e.lineTo(-i,-n),e.lineTo(-i,-i),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),i=-n/2;e.rect(i,i,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,i=n/7,r=n/2.5,s=n/8;e.moveTo(-i,n),e.lineTo(i,n),e.lineTo(i,-s),e.lineTo(r,-s),e.lineTo(0,-n),e.lineTo(-r,-s),e.lineTo(-i,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ju*n,r=i-n*i3,s=n/4;e.moveTo(0,-i-r),e.lineTo(-s,i-r),e.lineTo(s,i-r),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ju*n,r=i-n*i3;e.moveTo(0,-i-r),e.lineTo(-n,i-r),e.lineTo(n,i-r),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ju*n;e.moveTo(0,-i),e.lineTo(-n,i),e.lineTo(n,i),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ju*n;e.moveTo(0,i),e.lineTo(-n,-i),e.lineTo(n,-i),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ju*n;e.moveTo(i,0),e.lineTo(-i,-n),e.lineTo(-i,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,i=Ju*n;e.moveTo(-i,0),e.lineTo(i,-n),e.lineTo(i,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function h5(e){return Z(r3,e)?r3[e]:mX(e)}var yx={};function mX(e){if(!Z(yx,e)){const t=Hl(e);yx[e]={draw:function(n,i){Th(n,t,0,0,Math.sqrt(i)/2)}}}return yx[e]}const pa=.448084975506;function yX(e){return e.x}function xX(e){return e.y}function vX(e){return e.width}function bX(e){return e.height}function vs(e){return typeof e=="function"?e:()=>+e}function xp(e,t,n){return Math.max(t,Math.min(e,n))}function d5(){var e=yX,t=xX,n=vX,i=bX,r=vs(0),s=r,a=r,o=r,u=null;function l(c,f,h){var d,p=f??+e.call(this,c),g=h??+t.call(this,c),m=+n.call(this,c),y=+i.call(this,c),x=Math.min(m,y)/2,v=xp(+r.call(this,c),0,x),b=xp(+s.call(this,c),0,x),w=xp(+a.call(this,c),0,x),E=xp(+o.call(this,c),0,x);if(u||(u=d=jm()),v<=0&&b<=0&&w<=0&&E<=0)u.rect(p,g,m,y);else{var _=p+m,k=g+y;u.moveTo(p+v,g),u.lineTo(_-b,g),u.bezierCurveTo(_-pa*b,g,_,g+pa*b,_,g+b),u.lineTo(_,k-E),u.bezierCurveTo(_,k-pa*E,_-pa*E,k,_-E,k),u.lineTo(p+w,k),u.bezierCurveTo(p+pa*w,k,p,k-pa*w,p,k-w),u.lineTo(p,g+v),u.bezierCurveTo(p,g+pa*v,p+pa*v,g,p+v,g),u.closePath()}if(d)return u=null,d+""||null}return l.x=function(c){return arguments.length?(e=vs(c),l):e},l.y=function(c){return arguments.length?(t=vs(c),l):t},l.width=function(c){return arguments.length?(n=vs(c),l):n},l.height=function(c){return arguments.length?(i=vs(c),l):i},l.cornerRadius=function(c,f,h,d){return arguments.length?(r=vs(c),s=f!=null?vs(f):r,o=h!=null?vs(h):r,a=d!=null?vs(d):s,l):r},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function p5(){var e,t,n,i,r=null,s,a,o,u;function l(f,h,d){const p=d/2;if(s){var g=o-h,m=f-a;if(g||m){var y=Math.hypot(g,m),x=(g/=y)*u,v=(m/=y)*u,b=Math.atan2(m,g);r.moveTo(a-x,o-v),r.lineTo(f-g*p,h-m*p),r.arc(f,h,p,b-Math.PI,b),r.lineTo(a+x,o+v),r.arc(a,o,u,b,b+Math.PI)}else r.arc(f,h,p,0,Pr);r.closePath()}else s=1;a=f,o=h,u=p}function c(f){var h,d=f.length,p,g=!1,m;for(r==null&&(r=m=jm()),h=0;h<=d;++h)!(h<d&&i(p=f[h],h,f))===g&&(g=!g)&&(s=0),g&&l(+e(p,h,f),+t(p,h,f),+n(p,h,f));if(m)return r=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(i=f,c):i},c.context=function(f){return arguments.length?(f==null?r=null:r=f,c):r},c}function xd(e,t){return e??t}const vd=e=>e.x||0,bd=e=>e.y||0,wX=e=>e.width||0,_X=e=>e.height||0,EX=e=>(e.x||0)+(e.width||0),SX=e=>(e.y||0)+(e.height||0),kX=e=>e.startAngle||0,AX=e=>e.endAngle||0,CX=e=>e.padAngle||0,$X=e=>e.innerRadius||0,TX=e=>e.outerRadius||0,FX=e=>e.cornerRadius||0,MX=e=>xd(e.cornerRadiusTopLeft,e.cornerRadius)||0,OX=e=>xd(e.cornerRadiusTopRight,e.cornerRadius)||0,NX=e=>xd(e.cornerRadiusBottomRight,e.cornerRadius)||0,RX=e=>xd(e.cornerRadiusBottomLeft,e.cornerRadius)||0,DX=e=>xd(e.size,64),IX=e=>e.size||1,n1=e=>e.defined!==!1,PX=e=>h5(e.shape||"circle"),LX=QH().startAngle(kX).endAngle(AX).padAngle(CX).innerRadius($X).outerRadius(TX).cornerRadius(FX),zX=qD().x(vd).y1(bd).y0(SX).defined(n1),BX=qD().y(bd).x1(vd).x0(EX).defined(n1),UX=jD().x(vd).y(bd).defined(n1),jX=d5().x(vd).y(bd).width(wX).height(_X).cornerRadius(MX,OX,NX,RX),qX=ZH().type(PX).size(DX),VX=p5().x(vd).y(bd).defined(n1).size(IX);function wE(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function WX(e,t){return LX.context(e)(t)}function HX(e,t){const n=t[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?BX:zX).curve(bE(i,n.orient,n.tension)).context(e)(t)}function GX(e,t){const n=t[0],i=n.interpolate||"linear";return UX.curve(bE(i,n.orient,n.tension)).context(e)(t)}function Mc(e,t,n,i){return jX.context(e)(t,n,i)}function YX(e,t){return(t.mark.shape||t.shape).context(e)(t)}function XX(e,t){return qX.context(e)(t)}function KX(e,t){return VX.context(e)(t)}var g5=1;function m5(){g5=1}function _E(e,t,n){var i=t.clip,r=e._defs,s=t.clip_id||(t.clip_id="clip"+g5++),a=r.clipping[s]||(r.clipping[s]={id:s});return we(i)?a.path=i(null):wE(n)?a.path=Mc(null,n,0,0):(a.width=n.width||0,a.height=n.height||0),"url(#"+s+")"}function wt(e){this.clear(),e&&this.union(e)}wt.prototype={clone(){return new wt(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,i){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),i<t?(this.y2=t,this.y1=i):(this.y1=t,this.y2=i),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const i=this.rotatedPoints(e,t,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(e,t,n){var{x1:i,y1:r,x2:s,y2:a}=this,o=Math.cos(e),u=Math.sin(e),l=t-t*o+n*u,c=n-t*u-n*o;return[o*i-u*r+l,u*i+o*r+c,o*i-u*a+l,u*i+o*a+c,o*s-u*r+l,u*s+o*r+c,o*s-u*a+l,u*s+o*a+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function i1(e){this.mark=e,this.bounds=this.bounds||new wt}function r1(e){i1.call(this,e),this.items=this.items||[]}Y(r1,i1);class y5{constructor(t){this._pending=0,this._loader=t||Fm()}pending(){return this._pending}sanitizeURL(t){const n=this;return s3(n),n._loader.sanitize(t,{context:"href"}).then(i=>(pf(n),i)).catch(()=>(pf(n),null))}loadImage(t){const n=this,i=yG();return s3(n),n._loader.sanitize(t,{context:"image"}).then(r=>{const s=r.href;if(!s||!i)throw{url:s};const a=new i,o=Z(r,"crossOrigin")?r.crossOrigin:"anonymous";return o!=null&&(a.crossOrigin=o),a.onload=()=>pf(n),a.onerror=()=>pf(n),a.src=s,a}).catch(r=>(pf(n),{complete:!1,width:0,height:0,src:r&&r.url||""}))}ready(){const t=this;return new Promise(n=>{function i(r){t.pending()?setTimeout(()=>{i(!0)},10):n(r)}i(!1)})}}function s3(e){e._pending+=1}function pf(e){e._pending-=1}function ia(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const i=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(i+(n?QX(t,i):0))}return e}function QX(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const JX=Pr-1e-8;let s1,sg,ag,Yo,kb,og,Ab,Cb;const Sa=(e,t)=>s1.add(e,t),ug=(e,t)=>Sa(sg=e,ag=t),a3=e=>Sa(e,s1.y1),o3=e=>Sa(s1.x1,e),qo=(e,t)=>kb*e+Ab*t,Vo=(e,t)=>og*e+Cb*t,xx=(e,t)=>Sa(qo(e,t),Vo(e,t)),vx=(e,t)=>ug(qo(e,t),Vo(e,t));function wd(e,t){return s1=e,t?(Yo=t*Ga,kb=Cb=Math.cos(Yo),og=Math.sin(Yo),Ab=-og):(kb=Cb=1,Yo=og=Ab=0),ZX}const ZX={beginPath(){},closePath(){},moveTo:vx,lineTo:vx,rect(e,t,n,i){Yo?(xx(e+n,t),xx(e+n,t+i),xx(e,t+i),vx(e,t)):(Sa(e+n,t+i),ug(e,t))},quadraticCurveTo(e,t,n,i){const r=qo(e,t),s=Vo(e,t),a=qo(n,i),o=Vo(n,i);u3(sg,r,a,a3),u3(ag,s,o,o3),ug(a,o)},bezierCurveTo(e,t,n,i,r,s){const a=qo(e,t),o=Vo(e,t),u=qo(n,i),l=Vo(n,i),c=qo(r,s),f=Vo(r,s);l3(sg,a,u,c,a3),l3(ag,o,l,f,o3),ug(c,f)},arc(e,t,n,i,r,s){if(i+=Yo,r+=Yo,sg=n*Math.cos(r)+e,ag=n*Math.sin(r)+t,Math.abs(r-i)>JX)Sa(e-n,t-n),Sa(e+n,t+n);else{const a=l=>Sa(n*Math.cos(l)+e,n*Math.sin(l)+t);let o,u;if(a(i),a(r),r!==i)if(i=i%Pr,i<0&&(i+=Pr),r=r%Pr,r<0&&(r+=Pr),r<i&&(s=!s,o=i,i=r,r=o),s)for(r-=Pr,o=i-i%jo,u=0;u<4&&o>r;++u,o-=jo)a(o);else for(o=i-i%jo+jo,u=0;u<4&&o<r;++u,o=o+jo)a(o)}}};function u3(e,t,n,i){const r=(e-t)/(e+n-2*t);0<r&&r<1&&i(e+(t-e)*r)}function l3(e,t,n,i,r){const s=i-e+3*t-3*n,a=e+n-2*t,o=e-t;let u=0,l=0,c;Math.abs(s)>hX?(c=a*a+o*s,c>=0&&(c=Math.sqrt(c),u=(-a+c)/s,l=(-a-c)/s)):u=.5*o/a,0<u&&u<1&&r(c3(u,e,t,n,i)),0<l&&l<1&&r(c3(l,e,t,n,i))}function c3(e,t,n,i,r){const s=1-e,a=s*s,o=e*e;return a*s*t+3*a*e*n+3*s*o*i+o*e*r}var za=(za=La(1,1))?za.getContext("2d"):null;const $b=new wt;function EE(e){return function(t,n){if(!za)return!0;e(za,t),$b.clear().union(t.bounds).intersect(n).round();const{x1:i,y1:r,x2:s,y2:a}=$b;for(let o=r;o<=a;++o)for(let u=i;u<=s;++u)if(za.isPointInPath(u,o))return!0;return!1}}function SE(e,t){return t.contains(e.x||0,e.y||0)}function x5(e,t){const n=e.x||0,i=e.y||0,r=e.width||0,s=e.height||0;return t.intersects($b.set(n,i,n+r,i+s))}function v5(e,t){const n=e.x||0,i=e.y||0,r=e.x2!=null?e.x2:n,s=e.y2!=null?e.y2:i;return ml(t,n,i,r,s)}function ml(e,t,n,i,r){const{x1:s,y1:a,x2:o,y2:u}=e,l=i-t,c=r-n;let f=0,h=1,d,p,g,m;for(m=0;m<4;++m){if(m===0&&(d=-l,p=-(s-t)),m===1&&(d=l,p=o-t),m===2&&(d=-c,p=-(a-n)),m===3&&(d=c,p=u-n),Math.abs(d)<1e-10&&p<0)return!1;if(g=p/d,d<0){if(g>h)return!1;g>f&&(f=g)}else if(d>0){if(g<f)return!1;g<h&&(h=g)}}return!0}function Gl(e,t){e.globalCompositeOperation=t.blend||"source-over"}function Wi(e,t){return e??t}function f3(e,t){const n=t.length;for(let i=0;i<n;++i)e.addColorStop(t[i].offset,t[i].color);return e}function eK(e,t,n){const i=n.width(),r=n.height();let s;if(t.gradient==="radial")s=e.createRadialGradient(n.x1+Wi(t.x1,.5)*i,n.y1+Wi(t.y1,.5)*r,Math.max(i,r)*Wi(t.r1,0),n.x1+Wi(t.x2,.5)*i,n.y1+Wi(t.y2,.5)*r,Math.max(i,r)*Wi(t.r2,.5));else{const a=Wi(t.x1,0),o=Wi(t.y1,0),u=Wi(t.x2,1),l=Wi(t.y2,0);if(a===u||o===l||i===r)s=e.createLinearGradient(n.x1+a*i,n.y1+o*r,n.x1+u*i,n.y1+l*r);else{const c=La(Math.ceil(i),Math.ceil(r)),f=c.getContext("2d");return f.scale(i,r),f.fillStyle=f3(f.createLinearGradient(a,o,u,l),t.stops),f.fillRect(0,0,i,r),e.createPattern(c,"no-repeat")}}return f3(s,t.stops)}function b5(e,t,n){return vE(n)?eK(e,n,t.bounds):n}function Jg(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=b5(e,t,t.fill),!0):!1}var tK=[];function Yl(e,t,n){var i=(i=t.strokeWidth)!=null?i:1;return i<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=b5(e,t,t.stroke),e.lineWidth=i,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||tK),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function nK(e,t){return e.zindex-t.zindex||e.index-t.index}function kE(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],i,r,s;for(r=0,s=t.length;r<s;++r)i=t[r],i.index=r,i.zindex&&n.push(i);return e.zdirty=!1,e.zitems=n.sort(nK)}function cr(e,t){var n=e.items,i,r;if(!n||!n.length)return;const s=kE(e);if(s&&s.length){for(i=0,r=n.length;i<r;++i)n[i].zindex||t(n[i]);n=s}for(i=0,r=n.length;i<r;++i)t(n[i])}function Zg(e,t){var n=e.items,i,r;if(!n||!n.length)return null;const s=kE(e);for(s&&s.length&&(n=s),r=n.length;--r>=0;)if(i=t(n[r]))return i;if(n===s){for(n=e.items,r=n.length;--r>=0;)if(!n[r].zindex&&(i=t(n[r])))return i}return null}function AE(e){return function(t,n,i){cr(n,r=>{(!i||i.intersects(r.bounds))&&w5(e,t,r,r)})}}function iK(e){return function(t,n,i){n.items.length&&(!i||i.intersects(n.bounds))&&w5(e,t,n.items[0],n.items)}}function w5(e,t,n,i){var r=n.opacity==null?1:n.opacity;r!==0&&(e(t,i)||(Gl(t,n),n.fill&&Jg(t,n,r)&&t.fill(),n.stroke&&Yl(t,n,r)&&t.stroke()))}function a1(e){return e=e||Oi,function(t,n,i,r,s,a){return i*=t.pixelRatio,r*=t.pixelRatio,Zg(n,o=>{const u=o.bounds;if(!(u&&!u.contains(s,a)||!u)&&e(t,o,i,r,s,a))return o})}}function _d(e,t){return function(n,i,r,s){var a=Array.isArray(i)?i[0]:i,o=t??a.fill,u=a.stroke&&n.isPointInStroke,l,c;return u&&(l=a.strokeWidth,c=a.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,i)?!1:o&&n.isPointInPath(r,s)||u&&n.isPointInStroke(r,s)}}function CE(e){return a1(_d(e))}function Zo(e,t){return"translate("+e+","+t+")"}function $E(e){return"rotate("+e+")"}function rK(e,t){return"scale("+e+","+t+")"}function _5(e){return Zo(e.x||0,e.y||0)}function sK(e){return Zo(e.x||0,e.y||0)+(e.angle?" "+$E(e.angle):"")}function aK(e){return Zo(e.x||0,e.y||0)+(e.angle?" "+$E(e.angle):"")+(e.scaleX||e.scaleY?" "+rK(e.scaleX||1,e.scaleY||1):"")}function TE(e,t,n){function i(a,o){a("transform",sK(o)),a("d",t(null,o))}function r(a,o){return t(wd(a,o.angle),o),ia(a,o).translate(o.x||0,o.y||0)}function s(a,o){var u=o.x||0,l=o.y||0,c=o.angle||0;a.translate(u,l),c&&a.rotate(c*=Ga),a.beginPath(),t(a,o),c&&a.rotate(-c),a.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:i,bound:r,draw:AE(s),pick:CE(s),isect:n||EE(s)}}var oK=TE("arc",WX);function uK(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],i=e[0].orient==="horizontal"?"y":"x",r=e.length,s=1/0,a,o;--r>=0;)e[r].defined!==!1&&(o=Math.abs(e[r][i]-n),o<s&&(s=o,a=e[r]));return a}function lK(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),i=e.length,r,s,a;--i>=0;)if(e[i].defined!==!1&&(r=e[i].x-t[0],s=e[i].y-t[1],a=r*r+s*s,a<n))return e[i];return null}function cK(e,t){for(var n=e.length,i,r,s;--n>=0;)if(e[n].defined!==!1&&(i=e[n].x-t[0],r=e[n].y-t[1],s=i*i+r*r,i=e[n].size||1,s<i*i))return e[n];return null}function FE(e,t,n){function i(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function r(u,l){var c=l.items;return c.length===0?u:(t(wd(u),c),ia(u,c[0]))}function s(u,l){u.beginPath(),t(u,l)}const a=_d(s);function o(u,l,c,f,h,d){var p=l.items,g=l.bounds;return!p||!p.length||g&&!g.contains(h,d)?null:(c*=u.pixelRatio,f*=u.pixelRatio,a(u,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:i,bound:r,draw:iK(s),pick:o,isect:SE,tip:n}}var fK=FE("area",HX,uK);function hK(e,t){var n=t.clip;e.save(),we(n)?(e.beginPath(),n(e),e.clip()):E5(e,t.group)}function E5(e,t){e.beginPath(),wE(t)?Mc(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function S5(e){const t=Wi(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function dK(e,t){e("transform",_5(t))}function k5(e,t){const n=S5(t);e("d",Mc(null,t,n,n))}function pK(e,t){e("class","background"),e("aria-hidden",!0),k5(e,t)}function gK(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?k5(e,t):e("d","")}function mK(e,t,n){const i=t.clip?_E(n,t,t):null;e("clip-path",i)}function yK(e,t){if(!t.clip&&t.items){const n=t.items,i=n.length;for(let r=0;r<i;++r)e.union(n[r].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),ia(e,t),e.translate(t.x||0,t.y||0)}function Fh(e,t,n,i){const r=S5(t);e.beginPath(),Mc(e,t,(n||0)+r,(i||0)+r)}const xK=_d(Fh),vK=_d(Fh,!1),bK=_d(Fh,!0);function wK(e,t,n,i){cr(t,r=>{const s=r.x||0,a=r.y||0,o=r.strokeForeground,u=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&u&&(Fh(e,r,s,a),Gl(e,r),r.fill&&Jg(e,r,u)&&e.fill(),r.stroke&&!o&&Yl(e,r,u)&&e.stroke()),e.save(),e.translate(s,a),r.clip&&E5(e,r),n&&n.translate(-s,-a),cr(r,l=>{(l.marktype==="group"||i==null||i.includes(l.marktype))&&this.draw(e,l,n,i)}),n&&n.translate(s,a),e.restore(),o&&r.stroke&&u&&(Fh(e,r,s,a),Gl(e,r),Yl(e,r,u)&&e.stroke())})}function _K(e,t,n,i,r,s){if(t.bounds&&!t.bounds.contains(r,s)||!t.items)return null;const a=n*e.pixelRatio,o=i*e.pixelRatio;return Zg(t,u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(r,s))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(r<c||r>d||s<f||s>p))return;if(e.save(),e.translate(c,f),c=r-c,f=s-f,g&&wE(u)&&!bK(e,u,a,o))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&vK(e,u,a,o)?(e.restore(),u):(l=Zg(u,x=>EK(x,c,f)?this.pick(x,n,i,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&xK(e,u,a,o)&&(l=u),e.restore(),l||null)})}function EK(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var SK={type:"group",tag:"g",nested:!1,attr:dK,bound:yK,draw:wK,pick:_K,isect:x5,content:mK,background:pK,foreground:gK},Mh={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function ME(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(i=>{e.image=i,e.image.url=e.url})),n}function OE(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function NE(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function o1(e,t){return e==="center"?t/2:e==="right"?t:0}function u1(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function kK(e,t,n){const i=ME(t,n),r=OE(t,i),s=NE(t,i),a=(t.x||0)-o1(t.align,r),o=(t.y||0)-u1(t.baseline,s),u=!i.src&&i.toDataURL?i.toDataURL():i.src||"";e("href",u,Mh["xmlns:xlink"],"xlink:href"),e("transform",Zo(a,o)),e("width",r),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function AK(e,t){const n=t.image,i=OE(t,n),r=NE(t,n),s=(t.x||0)-o1(t.align,i),a=(t.y||0)-u1(t.baseline,r);return e.set(s,a,s+i,a+r)}function CK(e,t,n){cr(t,i=>{if(n&&!n.intersects(i.bounds))return;const r=ME(i,this);let s=OE(i,r),a=NE(i,r);if(s===0||a===0)return;let o=(i.x||0)-o1(i.align,s),u=(i.y||0)-u1(i.baseline,a),l,c,f,h;i.aspect!==!1&&(c=r.width/r.height,f=i.width/i.height,c===c&&f===f&&c!==f&&(f<c?(h=s/c,u+=(a-h)/2,a=h):(h=a*c,o+=(s-h)/2,s=h))),(r.complete||r.toDataURL)&&(Gl(e,i),e.globalAlpha=(l=i.opacity)!=null?l:1,e.imageSmoothingEnabled=i.smooth!==!1,e.drawImage(r,o,u,s,a))})}var $K={type:"image",tag:"image",nested:!1,attr:kK,bound:AK,draw:CK,pick:a1(),isect:Oi,get:ME,xOffset:o1,yOffset:u1},TK=FE("line",GX,lK);function FK(e,t){var n=t.scaleX||1,i=t.scaleY||1;(n!==1||i!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",aK(t)),e("d",t.path)}function lg(e,t){var n=t.path;if(n==null)return!0;var i=t.x||0,r=t.y||0,s=t.scaleX||1,a=t.scaleY||1,o=(t.angle||0)*Ga,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=Hl(n)).path=n),o&&e.rotate&&e.translate?(e.translate(i,r),e.rotate(o),Th(e,u,0,0,s,a),e.rotate(-o),e.translate(-i,-r)):Th(e,u,i,r,s,a)}function MK(e,t){return lg(wd(e,t.angle),t)?e.set(0,0,0,0):ia(e,t,!0)}var OK={type:"path",tag:"path",nested:!1,attr:FK,bound:MK,draw:AE(lg),pick:CE(lg),isect:EE(lg)};function NK(e,t){e("d",Mc(null,t))}function RK(e,t){var n,i;return ia(e.set(n=t.x||0,i=t.y||0,n+t.width||0,i+t.height||0),t)}function h3(e,t){e.beginPath(),Mc(e,t)}var DK={type:"rect",tag:"path",nested:!1,attr:NK,bound:RK,draw:AE(h3),pick:CE(h3),isect:x5};function IK(e,t){e("transform",_5(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function PK(e,t){var n,i;return ia(e.set(n=t.x||0,i=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:i),t)}function A5(e,t,n){var i,r,s,a;return t.stroke&&Yl(e,t,n)?(i=t.x||0,r=t.y||0,s=t.x2!=null?t.x2:i,a=t.y2!=null?t.y2:r,e.beginPath(),e.moveTo(i,r),e.lineTo(s,a),!0):!1}function LK(e,t,n){cr(t,i=>{if(!(n&&!n.intersects(i.bounds))){var r=i.opacity==null?1:i.opacity;r&&A5(e,i,r)&&(Gl(e,i),e.stroke())}})}function zK(e,t,n,i){return e.isPointInStroke?A5(e,t,1)&&e.isPointInStroke(n,i):!1}var BK={type:"rule",tag:"line",nested:!1,attr:IK,bound:PK,draw:LK,pick:a1(zK),isect:v5},UK=TE("shape",YX),jK=TE("symbol",XX,SE);const d3=NN();var ui={height:os,measureWidth:RE,estimateWidth:e0,width:e0,canvas:C5};C5(!0);function C5(e){ui.width=e&&za?RE:e0}function e0(e,t){return $5(Xa(e,t),os(e))}function $5(e,t){return~~(.8*e.length*t)}function RE(e,t){return os(e)<=0||!(t=Xa(e,t))?0:T5(t,l1(e))}function T5(e,t){const n=`(${t}) ${e}`;let i=d3.get(n);return i===void 0&&(za.font=t,i=za.measureText(e).width,d3.set(n,i)),i}function os(e){return e.fontSize!=null?+e.fontSize||0:11}function Ya(e){return e.lineHeight!=null?e.lineHeight:os(e)+2}function qK(e){return L(e)?e.length>1?e:e[0]:e}function Ed(e){return qK(e.lineBreak&&e.text&&!L(e.text)?e.text.split(e.lineBreak):e.text)}function DE(e){const t=Ed(e);return(L(t)?t.length-1:0)*Ya(e)}function Xa(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?WK(e,n):n}function VK(e){if(ui.width===RE){const t=l1(e);return n=>T5(n,t)}else if(ui.width===e0){const t=os(e);return n=>$5(n,t)}else return t=>ui.width(e,t)}function WK(e,t){var n=+e.limit,i=VK(e);if(i(t)<n)return t;var r=e.ellipsis||"…",s=e.dir==="rtl",a=0,o=t.length,u;if(n-=i(r),s){for(;a<o;)u=a+o>>>1,i(t.slice(u))>n?a=u+1:o=u;return r+t.slice(a)}else{for(;a<o;)u=1+(a+o>>>1),i(t.slice(0,u))<n?a=u:o=u-1;return t.slice(0,a)+r}}function Sd(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function l1(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+os(e)+"px "+Sd(e,t)}function IE(e){var t=e.baseline,n=os(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Ya(e):t==="line-bottom"?.29*n-.5*Ya(e):0)}const HK={left:"start",center:"middle",right:"end"},ih=new wt;function c1(e){var t=e.x||0,n=e.y||0,i=e.radius||0,r;return i&&(r=(e.theta||0)-jo,t+=i*Math.cos(r),n+=i*Math.sin(r)),ih.x1=t,ih.y1=n,ih}function GK(e,t){var n=t.dx||0,i=(t.dy||0)+IE(t),r=c1(t),s=r.x1,a=r.y1,o=t.angle||0,u;e("text-anchor",HK[t.align]||"start"),o?(u=Zo(s,a)+" "+$E(o),(n||i)&&(u+=" "+Zo(n,i))):u=Zo(s+n,a+i),e("transform",u)}function PE(e,t,n){var i=ui.height(t),r=t.align,s=c1(t),a=s.x1,o=s.y1,u=t.dx||0,l=(t.dy||0)+IE(t)-Math.round(.8*i),c=Ed(t),f;if(L(c)?(i+=Ya(t)*(c.length-1),f=c.reduce((h,d)=>Math.max(h,ui.width(t,d)),0)):f=ui.width(t,c),r==="center"?u-=f/2:r==="right"&&(u-=f),e.set(u+=a,l+=o,u+f,l+i),t.angle&&!n)e.rotate(t.angle*Ga,a,o);else if(n===2)return e.rotatedPoints(t.angle*Ga,a,o);return e}function YK(e,t,n){cr(t,i=>{var r=i.opacity==null?1:i.opacity,s,a,o,u,l,c,f;if(!(n&&!n.intersects(i.bounds)||r===0||i.fontSize<=0||i.text==null||i.text.length===0)){if(e.font=l1(i),e.textAlign=i.align||"left",s=c1(i),a=s.x1,o=s.y1,i.angle&&(e.save(),e.translate(a,o),e.rotate(i.angle*Ga),a=o=0),a+=i.dx||0,o+=(i.dy||0)+IE(i),c=Ed(i),Gl(e,i),L(c))for(l=Ya(i),u=0;u<c.length;++u)f=Xa(i,c[u]),i.fill&&Jg(e,i,r)&&e.fillText(f,a,o),i.stroke&&Yl(e,i,r)&&e.strokeText(f,a,o),o+=l;else f=Xa(i,c),i.fill&&Jg(e,i,r)&&e.fillText(f,a,o),i.stroke&&Yl(e,i,r)&&e.strokeText(f,a,o);i.angle&&e.restore()}})}function XK(e,t,n,i,r,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var a=c1(t),o=a.x1,u=a.y1,l=PE(ih,t,1),c=-t.angle*Ga,f=Math.cos(c),h=Math.sin(c),d=f*r-h*s+(o-f*o+h*u),p=h*r+f*s+(u-h*o-f*u);return l.contains(d,p)}function KK(e,t){const n=PE(ih,e,2);return ml(t,n[0],n[1],n[2],n[3])||ml(t,n[0],n[1],n[4],n[5])||ml(t,n[4],n[5],n[6],n[7])||ml(t,n[2],n[3],n[6],n[7])}var QK={type:"text",tag:"text",nested:!1,attr:GK,bound:PE,draw:YK,pick:a1(XK),isect:KK},JK=FE("trail",KX,cK),di={arc:oK,area:fK,group:SK,image:$K,line:TK,path:OK,rect:DK,rule:BK,shape:UK,symbol:jK,text:QK,trail:JK};function Tb(e,t,n){var i=di[e.mark.marktype],r=t||i.bound;return i.nested&&(e=e.mark),r(e.bounds||(e.bounds=new wt),e,n)}var p3={mark:null};function F5(e,t,n){var i=di[e.marktype],r=i.bound,s=e.items,a=s&&s.length,o,u,l,c;if(i.nested)return a?l=s[0]:(p3.mark=e,l=p3),c=Tb(l,r,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new wt,a)for(o=0,u=s.length;o<u;++o)t.union(Tb(s[o],r,n));return e.bounds=t}const ZK=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function M5(e,t){return JSON.stringify(e,ZK,t)}function O5(e){const t=typeof e=="string"?JSON.parse(e):e;return N5(t)}function N5(e){var t=e.marktype,n=e.items,i,r,s;if(n)for(r=0,s=n.length;r<s;++r)i=t?"mark":"group",n[r][i]=e,n[r].zindex&&(n[r][i].zdirty=!0),(t||i)==="group"&&N5(n[r]);return t&&F5(e),e}class R5{constructor(t){arguments.length?this.root=O5(t):(this.root=g3({marktype:"group",name:"root",role:"frame"}),this.root.items=[new r1(this.root)])}toJSON(t){return M5(this.root,t||0)}mark(t,n,i){n=n||this.root.items[0];const r=g3(t,n);return n.items[i]=r,r.zindex&&(r.group.zdirty=!0),r}}function g3(e,t){const n={bounds:new wt,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function ka(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function LE(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===t)return n[i]}function St(e,t,n,i){var r=e.childNodes[t],s;return(!r||r.tagName.toLowerCase()!==n.toLowerCase())&&(s=r||null,r=ka(e.ownerDocument,n,i),e.insertBefore(r,s)),r}function wi(e,t){for(var n=e.childNodes,i=n.length;i>t;)e.removeChild(n[--i]);return e}function D5(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function f1(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function eQ(e,t,n,i){var r=e&&e.mark,s,a;if(r&&(s=di[r.marktype]).tip){for(a=f1(t,n),a[0]-=i[0],a[1]-=i[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=s.tip(r.items,a)}return e}let zE=class{constructor(t,n){this._active=null,this._handlers={},this._loader=t||Fm(),this._tooltip=n||tQ}initialize(t,n,i){return this._el=t,this._obj=i||null,this.origin(n)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}origin(t){return arguments.length?(this._origin=t||[0,0],this):this._origin.slice()}scene(t){return arguments.length?(this._scene=t,this):this._scene}on(){}off(){}_handlerIndex(t,n,i){for(let r=t?t.length:0;--r>=0;)if(t[r].type===n&&(!i||t[r].handler===i))return r;return-1}handlers(t){const n=this._handlers,i=[];if(t)i.push(...n[this.eventName(t)]);else for(const r in n)i.push(...n[r]);return i}eventName(t){const n=t.indexOf(".");return n<0?t:t.slice(0,n)}handleHref(t,n,i){this._loader.sanitize(i,{context:"href"}).then(r=>{const s=new MouseEvent(t.type,t),a=ka(null,"a");for(const o in r)a.setAttribute(o,r[o]);a.dispatchEvent(s)}).catch(()=>{})}handleTooltip(t,n,i){if(n&&n.tooltip!=null){n=eQ(n,t,this.canvas(),this._origin);const r=i&&n&&n.tooltip||null;this._tooltip.call(this._obj,this,t,n,r)}}getItemBoundingClientRect(t){const n=this.canvas();if(!n)return;const i=n.getBoundingClientRect(),r=this._origin,s=t.bounds,a=s.width(),o=s.height();let u=s.x1+r[0]+i.left,l=s.y1+r[1]+i.top;for(;t.mark&&(t=t.mark.group);)u+=t.x||0,l+=t.y||0;return{x:u,y:l,width:a,height:o,left:u,top:l,right:u+a,bottom:l+o}}};function tQ(e,t,n,i){e.element().setAttribute("title",i||"")}class kd{constructor(t){this._el=null,this._bgcolor=null,this._loader=new y5(t)}initialize(t,n,i,r,s){return this._el=t,this.resize(n,i,r,s)}element(){return this._el}canvas(){return this._el&&this._el.firstChild}background(t){return arguments.length===0?this._bgcolor:(this._bgcolor=t,this)}resize(t,n,i,r){return this._width=t,this._height=n,this._origin=i||[0,0],this._scale=r||1,this}dirty(){}render(t,n){const i=this;return i._call=function(){i._render(t,n)},i._call(),i._call=null,i}_render(){}renderAsync(t,n){const i=this.render(t,n);return this._ready?this._ready.then(()=>i):Promise.resolve(i)}_load(t,n){var i=this,r=i._loader[t](n);if(!i._ready){const s=i._call;i._ready=i._loader.ready().then(a=>{a&&s(),i._ready=null})}return r}sanitizeURL(t){return this._load("sanitizeURL",t)}loadImage(t){return this._load("loadImage",t)}}const nQ="keydown",iQ="keypress",rQ="keyup",I5="dragenter",cg="dragleave",P5="dragover",Fb="pointerdown",sQ="pointerup",t0="pointermove",fg="pointerout",L5="pointerover",Mb="mousedown",aQ="mouseup",z5="mousemove",n0="mouseout",B5="mouseover",i0="click",oQ="dblclick",uQ="wheel",U5="mousewheel",r0="touchstart",s0="touchmove",a0="touchend",lQ=[nQ,iQ,rQ,I5,cg,P5,Fb,sQ,t0,fg,L5,Mb,aQ,z5,n0,B5,i0,oQ,uQ,U5,r0,s0,a0],Ob=t0,rh=n0,Nb=i0;class Ad extends zE{constructor(t,n){super(t,n),this._down=null,this._touch=null,this._first=!0,this._events={},this.events=lQ,this.pointermove=y3([t0,z5],[L5,B5],[fg,n0]),this.dragover=y3([P5],[I5],[cg]),this.pointerout=x3([fg,n0]),this.dragleave=x3([cg])}initialize(t,n,i){return this._canvas=t&&LE(t,"canvas"),[i0,Mb,Fb,t0,fg,cg].forEach(r=>m3(this,r)),super.initialize(t,n,i)}canvas(){return this._canvas}context(){return this._canvas.getContext("2d")}DOMMouseScroll(t){this.fire(U5,t)}pointerdown(t){this._down=this._active,this.fire(Fb,t)}mousedown(t){this._down=this._active,this.fire(Mb,t)}click(t){this._down===this._active&&(this.fire(i0,t),this._down=null)}touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(r0,t,!0)}touchmove(t){this.fire(s0,t,!0)}touchend(t){this.fire(a0,t,!0),this._touch=null}fire(t,n,i){const r=i?this._touch:this._active,s=this._handlers[t];if(n.vegaType=t,t===Nb&&r&&r.href?this.handleHref(n,r,r.href):(t===Ob||t===rh)&&this.handleTooltip(n,r,t!==rh),s)for(let a=0,o=s.length;a<o;++a)s[a].handler.call(this._obj,n,r)}on(t,n){const i=this.eventName(t),r=this._handlers;return this._handlerIndex(r[i],t,n)<0&&(m3(this,t),(r[i]||(r[i]=[])).push({type:t,handler:n})),this}off(t,n){const i=this.eventName(t),r=this._handlers[i],s=this._handlerIndex(r,t,n);return s>=0&&r.splice(s,1),this}pickEvent(t){const n=f1(t,this._canvas),i=this._origin;return this.pick(this._scene,n[0],n[1],n[0]-i[0],n[1]-i[1])}pick(t,n,i,r,s){const a=this.context();return di[t.marktype].pick.call(this,a,t,n,i,r,s)}}const cQ=e=>e===r0||e===s0||e===a0?[r0,s0,a0]:[e];function m3(e,t){cQ(t).forEach(n=>fQ(e,n))}function fQ(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?i=>e[t](i):i=>e.fire(t,i)))}function Uf(e,t,n){t.forEach(i=>e.fire(i,n))}function y3(e,t,n){return function(i){const r=this._active,s=this.pickEvent(i);s===r?Uf(this,e,i):((!r||!r.exit)&&Uf(this,n,i),this._active=s,Uf(this,t,i),Uf(this,e,i))}}function x3(e){return function(t){Uf(this,e,t),this._active=null}}function hQ(){return typeof window<"u"&&window.devicePixelRatio||1}function dQ(e,t,n,i,r,s){const a=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,o=e.getContext("2d"),u=a?hQ():r;e.width=t*u,e.height=n*u;for(const l in s)o[l]=s[l];return a&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),o.pixelRatio=u,o.setTransform(u,0,0,u,u*i[0],u*i[1]),e}class o0 extends kd{constructor(t){super(t),this._options={},this._redraw=!1,this._dirty=new wt,this._tempb=new wt}initialize(t,n,i,r,s,a){return this._options=a||{},this._canvas=this._options.externalContext?null:La(1,1,this._options.type),t&&this._canvas&&(wi(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),super.initialize(t,n,i,r,s)}resize(t,n,i,r){if(super.resize(t,n,i,r),this._canvas)dQ(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const s=this._options.externalContext;s||P("CanvasRenderer is missing a valid canvas or context"),s.scale(this._scale,this._scale),s.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this}canvas(){return this._canvas}context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)}dirty(t){const n=this._tempb.clear().union(t.bounds);let i=t.mark.group;for(;i;)n.translate(i.x||0,i.y||0),i=i.mark.group;this._dirty.union(n)}_render(t,n){const i=this.context(),r=this._origin,s=this._width,a=this._height,o=this._dirty,u=pQ(r,s,a);i.save();const l=this._redraw||o.empty()?(this._redraw=!1,u.expand(1)):gQ(i,u.intersect(o),r);return this.clear(-r[0],-r[1],s,a),this.draw(i,t,l,n),i.restore(),o.clear(),this}draw(t,n,i,r){if(n.marktype!=="group"&&r!=null&&!r.includes(n.marktype))return;const s=di[n.marktype];n.clip&&hK(t,n),s.draw.call(this,t,n,i,r),n.clip&&t.restore()}clear(t,n,i,r){const s=this._options,a=this.context();s.type!=="pdf"&&!s.externalContext&&a.clearRect(t,n,i,r),this._bgcolor!=null&&(a.fillStyle=this._bgcolor,a.fillRect(t,n,i,r))}}const pQ=(e,t,n)=>new wt().set(0,0,t,n).translate(-e[0],-e[1]);function gQ(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}class j5 extends zE{constructor(t,n){super(t,n);const i=this;i._hrefHandler=bx(i,(r,s)=>{s&&s.href&&i.handleHref(r,s,s.href)}),i._tooltipHandler=bx(i,(r,s)=>{i.handleTooltip(r,s,r.type!==rh)})}initialize(t,n,i){let r=this._svg;return r&&(r.removeEventListener(Nb,this._hrefHandler),r.removeEventListener(Ob,this._tooltipHandler),r.removeEventListener(rh,this._tooltipHandler)),this._svg=r=t&&LE(t,"svg"),r&&(r.addEventListener(Nb,this._hrefHandler),r.addEventListener(Ob,this._tooltipHandler),r.addEventListener(rh,this._tooltipHandler)),super.initialize(t,n,i)}canvas(){return this._svg}on(t,n){const i=this.eventName(t),r=this._handlers;if(this._handlerIndex(r[i],t,n)<0){const a={type:t,handler:n,listener:bx(this,n)};(r[i]||(r[i]=[])).push(a),this._svg&&this._svg.addEventListener(i,a.listener)}return this}off(t,n){const i=this.eventName(t),r=this._handlers[i],s=this._handlerIndex(r,t,n);return s>=0&&(this._svg&&this._svg.removeEventListener(i,r[s].listener),r.splice(s,1)),this}}const bx=(e,t)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i,n.vegaType=n.type,t.call(e._obj,n,i)},q5="aria-hidden",BE="aria-label",UE="role",jE="aria-roledescription",V5="graphics-object",qE="graphics-symbol",W5=(e,t,n)=>({[UE]:e,[jE]:t,[BE]:n||void 0}),mQ=ur(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),v3={axis:{desc:"axis",caption:vQ},legend:{desc:"legend",caption:bQ},"title-text":{desc:"title",caption:e=>`Title text '${w3(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${w3(e)}'`}},b3={ariaRole:UE,ariaRoleDescription:jE,description:BE};function H5(e,t){const n=t.aria===!1;if(e(q5,n||void 0),n||t.description==null)for(const i in b3)e(b3[i],void 0);else{const i=t.mark.marktype;e(BE,t.description),e(UE,t.ariaRole||(i==="group"?V5:qE)),e(jE,t.ariaRoleDescription||`${i} mark`)}}function G5(e){return e.aria===!1?{[q5]:!0}:mQ[e.role]?null:v3[e.role]?xQ(e,v3[e.role]):yQ(e)}function yQ(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(i=>i.description!=null&&i.aria!==!1);return W5(n?V5:qE,`${t} mark container`,e.description)}function xQ(e,t){try{const n=e.items[0],i=t.caption||(()=>"");return W5(t.role||qE,t.desc,n.description||i(n))}catch{return null}}function w3(e){return Q(e.text).join(" ")}function vQ(e){const t=e.datum,n=e.orient,i=t.title?Y5(e):null,r=e.context,s=r.scales[t.scale].value,a=r.dataflow.locale(),o=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(i?` titled '${i}'`:"")+` for a ${Wl(o)?"discrete":o} scale with ${o5(a,s,e)}`}function bQ(e){const t=e.datum,n=t.title?Y5(e):null,i=`${t.type||""} legend`.trim(),r=t.scales,s=Object.keys(r),a=e.context,o=a.scales[r[s[0]]].value,u=a.dataflow.locale();return _Q(i)+(n?` titled '${n}'`:"")+` for ${wQ(s)} with ${o5(u,o,e)}`}function Y5(e){try{return Q(Fe(e.items).items[0].text).join(" ")}catch{return null}}function wQ(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Fe(e)}function _Q(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const X5=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),EQ=e=>X5(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function VE(){let e="",t="",n="";const i=[],r=()=>t=n="",s=u=>{t&&(e+=`${t}>${n}`,r()),i.push(u)},a=(u,l)=>(l!=null&&(t+=` ${u}="${EQ(l)}"`),o),o={open(u){s(u),t="<"+u;for(var l=arguments.length,c=new Array(l>1?l-1:0),f=1;f<l;f++)c[f-1]=arguments[f];for(const h of c)for(const d in h)a(d,h[d]);return o},close(){const u=i.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,r(),o},attr:a,text:u=>(n+=X5(u),o),toString:()=>e};return o}const K5=e=>Q5(VE(),e)+"";function Q5(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,i=n.length;for(let r=0;r<i;++r)e.attr(n[r].name,n[r].value)}if(t.hasChildNodes()){const n=t.childNodes;for(const i of n)i.nodeType===3?e.text(i.nodeValue):Q5(e,i)}return e.close()}const u0={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},l0={blend:"mix-blend-mode"},J5={fill:"none","stroke-miterlimit":10},gf=0,_3="http://www.w3.org/2000/xmlns/",Et=Mh.xmlns;class WE extends kd{constructor(t){super(t),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}initialize(t,n,i,r,s){return this._defs={},this._clearDefs(),t&&(this._svg=St(t,0,"svg",Et),this._svg.setAttributeNS(_3,"xmlns",Et),this._svg.setAttributeNS(_3,"xmlns:xlink",Mh["xmlns:xlink"]),this._svg.setAttribute("version",Mh.version),this._svg.setAttribute("class","marks"),wi(t,1),this._root=St(this._svg,gf,"g",Et),Aa(this._root,J5),wi(this._svg,gf+1)),this.background(this._bgcolor),super.initialize(t,n,i,r,s)}background(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),super.background(...arguments)}resize(t,n,i,r){return super.resize(t,n,i,r),this._svg&&(Aa(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this}canvas(){return this._svg}svg(){const t=this._svg,n=this._bgcolor;if(!t)return null;let i;n&&(t.removeAttribute("style"),i=St(t,gf,"rect",Et),Aa(i,{width:this._width,height:this._height,fill:n}));const r=K5(t);return n&&(t.removeChild(i),this._svg.style.setProperty("background-color",n)),r}_render(t,n){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,t,void 0,n),wi(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this}dirty(t){t.dirty!==this._dirtyID&&(t.dirty=this._dirtyID,this._dirty.push(t))}isDirty(t){return this._dirtyAll||!t._svg||!t._svg.ownerSVGElement||t.dirty===this._dirtyID}_dirtyCheck(){this._dirtyAll=!0;const t=this._dirty;if(!t.length||!this._dirtyID)return!0;const n=++this._dirtyID;let i,r,s,a,o,u,l;for(o=0,u=t.length;o<u;++o)if(i=t[o],r=i.mark,r.marktype!==s&&(s=r.marktype,a=di[s]),r.zdirty&&r.dirty!==n&&(this._dirtyAll=!1,E3(i,n),r.items.forEach(c=>{c.dirty=n})),!r.zdirty){if(i.exit){a.nested&&r.items.length?(l=r.items[0],l._svg&&this._update(a,l._svg,l)):i._svg&&(l=i._svg.parentNode,l&&l.removeChild(i._svg)),i._svg=null;continue}i=a.nested?r.items[0]:i,i._update!==n&&(!i._svg||!i._svg.ownerSVGElement?(this._dirtyAll=!1,E3(i,n)):this._update(a,i._svg,i),i._update=n)}return!this._dirtyAll}mark(t,n,i,r){if(!this.isDirty(n))return n._svg;const s=this._svg,a=n.marktype,o=di[a],u=n.interactive===!1?"none":null,l=o.tag==="g",c=S3(n,t,i,"g",s);if(a!=="group"&&r!=null&&!r.includes(a))return wi(c,0),n._svg;c.setAttribute("class",D5(n));const f=G5(n);for(const g in f)wn(c,g,f[g]);l||wn(c,"pointer-events",u),wn(c,"clip-path",n.clip?_E(this,n,n.group):null);let h=null,d=0;const p=g=>{const m=this.isDirty(g),y=S3(g,c,h,o.tag,s);m&&(this._update(o,y,g),l&&AQ(this,y,g,r)),h=y,++d};return o.nested?n.items.length&&p(n.items[0]):cr(n,p),wi(c,d),c}_update(t,n,i){Ds=n,ln=n.__values__,H5(sh,i),t.attr(sh,i,this);const r=$Q[t.type];r&&r.call(this,t,n,i),Ds&&this.style(Ds,i)}style(t,n){if(n!=null){for(const i in u0){let r=i==="font"?Sd(n):n[i];if(r===ln[i])continue;const s=u0[i];r==null?t.removeAttribute(s):(vE(r)&&(r=l5(r,this._defs.gradient,Z5())),t.setAttribute(s,r+"")),ln[i]=r}for(const i in l0)hg(t,l0[i],n[i])}}defs(){const t=this._svg,n=this._defs;let i=n.el,r=0;for(const s in n.gradient)i||(n.el=i=St(t,gf+1,"defs",Et)),r=SQ(i,n.gradient[s],r);for(const s in n.clipping)i||(n.el=i=St(t,gf+1,"defs",Et)),r=kQ(i,n.clipping[s],r);i&&(r===0?(t.removeChild(i),n.el=null):wi(i,r))}_clearDefs(){const t=this._defs;t.gradient={},t.clipping={}}}function E3(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function SQ(e,t,n){let i,r,s;if(t.gradient==="radial"){let a=St(e,n++,"pattern",Et);Aa(a,{id:Qg+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),a=St(a,0,"rect",Et),Aa(a,{width:1,height:1,fill:`url(${Z5()}#${t.id})`}),e=St(e,n++,"radialGradient",Et),Aa(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=St(e,n++,"linearGradient",Et),Aa(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(i=0,r=t.stops.length;i<r;++i)s=St(e,i,"stop",Et),s.setAttribute("offset",t.stops[i].offset),s.setAttribute("stop-color",t.stops[i].color);return wi(e,i),n}function kQ(e,t,n){let i;return e=St(e,n,"clipPath",Et),e.setAttribute("id",t.id),t.path?(i=St(e,0,"path",Et),i.setAttribute("d",t.path)):(i=St(e,0,"rect",Et),Aa(i,{x:0,y:0,width:t.width,height:t.height})),wi(e,1),n+1}function AQ(e,t,n,i){t=t.lastChild.previousSibling;let r,s=0;cr(n,a=>{r=e.mark(t,a,r,i),++s}),wi(t,1+s)}function S3(e,t,n,i,r){let s=e._svg,a;if(!s&&(a=t.ownerDocument,s=ka(a,i,Et),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},i==="g"))){const o=ka(a,"path",Et);s.appendChild(o),o.__data__=e;const u=ka(a,"g",Et);s.appendChild(u),u.__data__=e;const l=ka(a,"path",Et);s.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(s.ownerSVGElement!==r||CQ(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}function CQ(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Ds=null,ln=null;const $Q={group(e,t,n){const i=Ds=t.childNodes[2];ln=i.__values__,e.foreground(sh,n,this),ln=t.__values__,Ds=t.childNodes[1],e.content(sh,n,this);const r=Ds=t.childNodes[0];e.background(sh,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==ln.events&&(wn(i,"pointer-events",s),wn(r,"pointer-events",s),ln.events=s),n.strokeForeground&&n.stroke){const a=n.fill;wn(i,"display",null),this.style(r,n),wn(r,"stroke",null),a&&(n.fill=null),ln=i.__values__,this.style(i,n),a&&(n.fill=a),Ds=null}else wn(i,"display","none")},image(e,t,n){n.smooth===!1?(hg(t,"image-rendering","optimizeSpeed"),hg(t,"image-rendering","pixelated")):hg(t,"image-rendering",null)},text(e,t,n){const i=Ed(n);let r,s,a,o;L(i)?(s=i.map(u=>Xa(n,u)),r=s.join(`
`),r!==ln.text&&(wi(t,0),a=t.ownerDocument,o=Ya(n),s.forEach((u,l)=>{const c=ka(a,"tspan",Et);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",o)),t.appendChild(c)}),ln.text=r)):(s=Xa(n,i),s!==ln.text&&(t.textContent=s,ln.text=s)),wn(t,"font-family",Sd(n)),wn(t,"font-size",os(n)+"px"),wn(t,"font-style",n.fontStyle),wn(t,"font-variant",n.fontVariant),wn(t,"font-weight",n.fontWeight)}};function sh(e,t,n){t!==ln[e]&&(n?TQ(Ds,e,t,n):wn(Ds,e,t),ln[e]=t)}function hg(e,t,n){n!==ln[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),ln[t]=n)}function Aa(e,t){for(const n in t)wn(e,n,t[n])}function wn(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function TQ(e,t,n,i){n!=null?e.setAttributeNS(i,t,n):e.removeAttributeNS(i,t)}function Z5(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}class e6 extends kd{constructor(t){super(t),this._text=null,this._defs={gradient:{},clipping:{}}}svg(){return this._text}_render(t){const n=VE();n.open("svg",ve({},Mh,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const i=this._bgcolor;return i&&i!=="transparent"&&i!=="none"&&n.open("rect",{width:this._width,height:this._height,fill:i}).close(),n.open("g",J5,{transform:"translate("+this._origin+")"}),this.mark(n,t),n.close(),this.defs(n),this._text=n.close()+"",this}mark(t,n){const i=di[n.marktype],r=i.tag,s=[H5,i.attr];t.open("g",{class:D5(n),"clip-path":n.clip?_E(this,n,n.group):null},G5(n),{"pointer-events":r!=="g"&&n.interactive===!1?"none":null});const a=o=>{const u=this.href(o);if(u&&t.open("a",u),t.open(r,this.attr(n,o,s,r!=="g"?r:null)),r==="text"){const l=Ed(o);if(L(l)){const c={x:0,dy:Ya(o)};for(let f=0;f<l.length;++f)t.open("tspan",f?c:null).text(Xa(o,l[f])).close()}else t.text(Xa(o,l))}else if(r==="g"){const l=o.strokeForeground,c=o.fill,f=o.stroke;l&&f&&(o.stroke=null),t.open("path",this.attr(n,o,i.background,"bgrect")).close(),t.open("g",this.attr(n,o,i.content)),cr(o,h=>this.mark(t,h)),t.close(),l&&f?(c&&(o.fill=null),o.stroke=f,t.open("path",this.attr(n,o,i.foreground,"bgrect")).close(),c&&(o.fill=c)):t.open("path",this.attr(n,o,i.foreground,"bgfore")).close()}t.close(),u&&t.close()};return i.nested?n.items&&n.items.length&&a(n.items[0]):cr(n,a),t.close()}href(t){const n=t.href;let i;if(n){if(i=this._hrefs&&this._hrefs[n])return i;this.sanitizeURL(n).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[n]=r})}return null}attr(t,n,i,r){const s={},a=(o,u,l,c)=>{s[c||o]=u};return Array.isArray(i)?i.forEach(o=>o(a,n,this)):i(a,n,this),r&&FQ(s,n,t,r,this._defs),s}defs(t){const n=this._defs.gradient,i=this._defs.clipping;if(Object.keys(n).length+Object.keys(i).length!==0){t.open("defs");for(const s in n){const a=n[s],o=a.stops;a.gradient==="radial"?(t.open("pattern",{id:Qg+s,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),t.open("rect",{width:"1",height:"1",fill:"url(#"+s+")"}).close(),t.close(),t.open("radialGradient",{id:s,fx:a.x1,fy:a.y1,fr:a.r1,cx:a.x2,cy:a.y2,r:a.r2})):t.open("linearGradient",{id:s,x1:a.x1,x2:a.x2,y1:a.y1,y2:a.y2});for(let u=0;u<o.length;++u)t.open("stop",{offset:o[u].offset,"stop-color":o[u].color}).close();t.close()}for(const s in i){const a=i[s];t.open("clipPath",{id:s}),a.path?t.open("path",{d:a.path}).close():t.open("rect",{x:0,y:0,width:a.width,height:a.height}).close(),t.close()}t.close()}}}function FQ(e,t,n,i,r){let s;if(t==null||(i==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),i==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;i==="image"&&t.smooth===!1&&(s=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),i==="text"&&(e["font-family"]=Sd(t),e["font-size"]=os(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const a in u0){let o=t[a];const u=u0[a];o==="transparent"&&(u==="fill"||u==="stroke")||o!=null&&(vE(o)&&(o=l5(o,r.gradient,"")),e[u]=o)}for(const a in l0){const o=t[a];o!=null&&(s=s||[],s.push(`${l0[a]}: ${o};`))}return s&&(e.style=s.join(" ")),e}const Yi={svgMarkTypes:["text"],svgOnTop:!0,debug:!1};function MQ(e){Yi.svgMarkTypes=e.svgMarkTypes??["text"],Yi.svgOnTop=e.svgOnTop??!0,Yi.debug=e.debug??!1}class Rb extends kd{constructor(t){super(t),this._svgRenderer=new WE(t),this._canvasRenderer=new o0(t)}initialize(t,n,i,r,s){this._root_el=St(t,0,"div");const a=St(this._root_el,0,"div"),o=St(this._root_el,1,"div");return this._root_el.style.position="relative",Yi.debug||(a.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.height="100%",o.style.width="100%"),this._svgEl=Yi.svgOnTop?o:a,this._canvasEl=Yi.svgOnTop?a:o,this._svgEl.style.pointerEvents="none",this._canvasRenderer.initialize(this._canvasEl,n,i,r,s),this._svgRenderer.initialize(this._svgEl,n,i,r,s),super.initialize(t,n,i,r,s)}dirty(t){return Yi.svgMarkTypes.includes(t.mark.marktype)?this._svgRenderer.dirty(t):this._canvasRenderer.dirty(t),this}_render(t,n){const r=(n??["arc","area","image","line","path","rect","rule","shape","symbol","text","trail"]).filter(s=>!Yi.svgMarkTypes.includes(s));this._svgRenderer.render(t,Yi.svgMarkTypes),this._canvasRenderer.render(t,r)}resize(t,n,i,r){return super.resize(t,n,i,r),this._svgRenderer.resize(t,n,i,r),this._canvasRenderer.resize(t,n,i,r),this}background(t){return Yi.svgOnTop?this._canvasRenderer.background(t):this._svgRenderer.background(t),this}}class t6 extends Ad{constructor(t,n){super(t,n)}initialize(t,n,i){const r=St(St(t,0,"div"),Yi.svgOnTop?0:1,"div");return super.initialize(r,n,i)}}const n6="canvas",i6="hybrid",r6="png",s6="svg",a6="none",Ca={Canvas:n6,PNG:r6,SVG:s6,Hybrid:i6,None:a6},cu={};cu[n6]=cu[r6]={renderer:o0,headless:o0,handler:Ad};cu[s6]={renderer:WE,headless:e6,handler:j5};cu[i6]={renderer:Rb,headless:Rb,handler:t6};cu[a6]={};function h1(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(cu[e]=t,this):cu[e]}function o6(e,t,n){const i=[],r=new wt().union(t),s=e.marktype;return s?u6(e,r,n,i):s==="group"?l6(e,r,n,i):P("Intersect scene must be mark node or group item.")}function u6(e,t,n,i){if(OQ(e,t,n)){const r=e.items,s=e.marktype,a=r.length;let o=0;if(s==="group")for(;o<a;++o)l6(r[o],t,n,i);else for(const u=di[s].isect;o<a;++o){const l=r[o];c6(l,t,u)&&i.push(l)}}return i}function OQ(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function l6(e,t,n,i){n&&n(e.mark)&&c6(e,t,di.group.isect)&&i.push(e);const r=e.items,s=r&&r.length;if(s){const a=e.x||0,o=e.y||0;t.translate(-a,-o);for(let u=0;u<s;++u)u6(r[u],t,n,i);t.translate(a,o)}return i}function c6(e,t,n){const i=e.bounds;return t.encloses(i)||t.intersects(i)&&n(e,t)}const wx=new wt;function f6(e){const t=e.clip;if(we(t))t(wd(wx.clear()));else if(t)wx.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(wx)}const NQ=1e-9;function HE(e,t,n){return e===t?!0:n==="path"?h6(e,t):e instanceof Date&&t instanceof Date?+e==+t:Ie(e)&&Ie(t)?Math.abs(e-t)<=NQ:!e||!t||!K(e)&&!K(t)?e==t:RQ(e,t)}function h6(e,t){return HE(Hl(e),Hl(t))}function RQ(e,t){var n=Object.keys(e),i=Object.keys(t),r,s;if(n.length!==i.length)return!1;for(n.sort(),i.sort(),s=n.length-1;s>=0;s--)if(n[s]!=i[s])return!1;for(s=n.length-1;s>=0;s--)if(r=n[s],!HE(e[r],t[r],r))return!1;return typeof e==typeof t}function DQ(){m5(),sX()}const Xl="top",Zi="left",er="right",Ka="bottom",IQ="top-left",PQ="top-right",LQ="bottom-left",zQ="bottom-right",GE="start",Db="middle",_n="end",BQ="x",UQ="y",d1="group",YE="axis",XE="title",jQ="frame",qQ="scope",KE="legend",d6="row-header",p6="row-footer",g6="row-title",m6="column-header",y6="column-footer",x6="column-title",VQ="padding",WQ="symbol",v6="fit",b6="fit-x",w6="fit-y",HQ="pad",QE="none",vp="all",Ib="each",JE="flush",$a="column",Ta="row";function _6(e){N.call(this,null,e)}Y(_6,N,{transform(e,t){const n=t.dataflow,i=e.mark,r=i.marktype,s=di[r],a=s.bound;let o=i.bounds,u;if(s.nested)i.items.length&&n.dirty(i.items[0]),o=bp(i,a),i.items.forEach(l=>{l.bounds.clear().union(o)});else if(r===d1||e.modified())switch(t.visit(t.MOD,l=>n.dirty(l)),o.clear(),i.items.forEach(l=>o.union(bp(l,a))),i.role){case YE:case KE:case XE:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,l=>{o.union(bp(l,a))}),t.visit(t.MOD,l=>{u=u||o.alignsWith(l.bounds),n.dirty(l),o.union(bp(l,a))}),u&&(o.clear(),i.items.forEach(l=>o.union(l.bounds)));return f6(i),t.modifies("bounds")}});function bp(e,t,n){return t(e.bounds.clear(),e,n)}const k3=":vega_identifier:";function ZE(e){N.call(this,0,e)}ZE.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};Y(ZE,N,{transform(e,t){const n=GQ(t.dataflow),i=e.as;let r=n.value;return t.visit(t.ADD,s=>s[i]=s[i]||++r),n.set(this.value=r),t}});function GQ(e){return e._signals[k3]||(e._signals[k3]=e.add(0))}function E6(e){N.call(this,null,e)}Y(E6,N,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,YQ(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const i=n.marktype===d1?r1:i1;return t.visit(t.ADD,r=>i.call(r,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function YQ(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function S6(e){N.call(this,null,e)}const A3={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((i,r)=>!r||!k6(n.bounds,i.bounds,t)?(n=i,1):i.opacity=0)}},k6=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),C3=(e,t)=>{for(var n=1,i=e.length,r=e[0].bounds,s;n<i;r=s,++n)if(k6(r,s=e[n].bounds,t))return!0},XQ=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},KQ=(e,t,n)=>{var i=e.range(),r=new wt;return t===Xl||t===Ka?r.set(i[0],-1/0,i[1],1/0):r.set(-1/0,i[0],1/0,i[1]),r.expand(n||1),s=>r.encloses(s.bounds)},$3=e=>(e.forEach(t=>t.opacity=1),e),T3=(e,t)=>e.reflow(t.modified()).modifies("opacity");Y(S6,N,{transform(e,t){const n=A3[e.method]||A3.parity,i=e.separation||0;let r=t.materialize(t.SOURCE).source,s,a;if(!r||!r.length)return;if(!e.method)return e.modified("method")&&($3(r),t=T3(t,e)),t;if(r=r.filter(XQ),!r.length)return;if(e.sort&&(r=r.slice().sort(e.sort)),s=$3(r),t=T3(t,e),s.length>=3&&C3(s,i)){do s=n(s,i);while(s.length>=3&&C3(s,i));s.length<3&&!Fe(r).opacity&&(s.length>1&&(Fe(s).opacity=0),Fe(r).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(a=KQ(e.boundScale,e.boundOrient,+e.boundTolerance),r.forEach(u=>{a(u)||(u.opacity=0)}));const o=s[0].mark.bounds.clear();return r.forEach(u=>{u.opacity&&o.union(u.bounds)}),t}});function A6(e){N.call(this,null,e)}Y(A6,N,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,i=>n.dirty(i)),t.fields&&t.fields.zindex){const i=t.source&&t.source[0];i&&(i.mark.zdirty=!0)}}});const un=new wt;function yl(e,t,n){return e[t]===n?0:(e[t]=n,1)}function QQ(e){var t=e.items[0].orient;return t===Zi||t===er}function JQ(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function ZQ(e,t,n,i){var r=t.items[0],s=r.datum,a=r.translate!=null?r.translate:.5,o=r.orient,u=JQ(s),l=r.range,c=r.offset,f=r.position,h=r.minExtent,d=r.maxExtent,p=s.title&&r.items[u[2]].items[0],g=r.titlePadding,m=r.bounds,y=p&&DE(p),x=0,v=0,b,w;switch(un.clear().union(m),m.clear(),(b=u[0])>-1&&m.union(r.items[b].bounds),(b=u[1])>-1&&m.union(r.items[b].bounds),o){case Xl:x=f||0,v=-c,w=Math.max(h,Math.min(d,-m.y1)),m.add(0,-w).add(l,0),p&&wp(e,p,w,g,y,0,-1,m);break;case Zi:x=-c,v=f||0,w=Math.max(h,Math.min(d,-m.x1)),m.add(-w,0).add(0,l),p&&wp(e,p,w,g,y,1,-1,m);break;case er:x=n+c,v=f||0,w=Math.max(h,Math.min(d,m.x2)),m.add(0,0).add(w,l),p&&wp(e,p,w,g,y,1,1,m);break;case Ka:x=f||0,v=i+c,w=Math.max(h,Math.min(d,m.y2)),m.add(0,0).add(l,w),p&&wp(e,p,w,g,0,0,1,m);break;default:x=r.x,v=r.y}return ia(m.translate(x,v),r),yl(r,"x",x+a)|yl(r,"y",v+a)&&(r.bounds=un,e.dirty(r),r.bounds=m,e.dirty(r)),r.mark.bounds.clear().union(m)}function wp(e,t,n,i,r,s,a,o){const u=t.bounds;if(t.auto){const l=a*(n+r+i);let c=0,f=0;e.dirty(t),s?c=(t.x||0)-(t.x=l):f=(t.y||0)-(t.y=l),t.mark.bounds.clear().union(u.translate(-c,-f)),e.dirty(t)}o.union(u)}const F3=(e,t)=>Math.floor(Math.min(e,t)),M3=(e,t)=>Math.ceil(Math.max(e,t));function eJ(e){var t=e.items,n=t.length,i=0,r,s;const a={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i)if(r=t[i],s=r.items,r.marktype===d1)switch(r.role){case YE:case KE:case XE:break;case d6:a.rowheaders.push(...s);break;case p6:a.rowfooters.push(...s);break;case m6:a.colheaders.push(...s);break;case y6:a.colfooters.push(...s);break;case g6:a.rowtitle=s[0];break;case x6:a.coltitle=s[0];break;default:a.marks.push(...s)}return a}function tJ(e){return new wt().set(0,0,e.width||0,e.height||0)}function nJ(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function tt(e,t,n){const i=K(e)?e[t]:e;return i??(n!==void 0?n:0)}function O3(e){return e<0?Math.ceil(-e):0}function C6(e,t,n){var i=!n.nodirty,r=n.bounds===JE?tJ:nJ,s=un.set(0,0,0,0),a=tt(n.align,$a),o=tt(n.align,Ta),u=tt(n.padding,$a),l=tt(n.padding,Ta),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),h=t.length,d=Array(h),p=Array(c),g=0,m=Array(h),y=Array(f),x=0,v=Array(h),b=Array(h),w=Array(h),E,_,k,A,T,$,R,O,F,C,M;for(_=0;_<c;++_)p[_]=0;for(_=0;_<f;++_)y[_]=0;for(_=0;_<h;++_)$=t[_],T=w[_]=r($),$.x=$.x||0,v[_]=0,$.y=$.y||0,b[_]=0,k=_%c,A=~~(_/c),g=Math.max(g,R=Math.ceil(T.x2)),x=Math.max(x,O=Math.ceil(T.y2)),p[k]=Math.max(p[k],R),y[A]=Math.max(y[A],O),d[_]=u+O3(T.x1),m[_]=l+O3(T.y1),i&&e.dirty(t[_]);for(_=0;_<h;++_)_%c===0&&(d[_]=0),_<c&&(m[_]=0);if(a===Ib)for(k=1;k<c;++k){for(M=0,_=k;_<h;_+=c)M<d[_]&&(M=d[_]);for(_=k;_<h;_+=c)d[_]=M+p[k-1]}else if(a===vp){for(M=0,_=0;_<h;++_)_%c&&M<d[_]&&(M=d[_]);for(_=0;_<h;++_)_%c&&(d[_]=M+g)}else for(a=!1,k=1;k<c;++k)for(_=k;_<h;_+=c)d[_]+=p[k-1];if(o===Ib)for(A=1;A<f;++A){for(M=0,_=A*c,E=_+c;_<E;++_)M<m[_]&&(M=m[_]);for(_=A*c;_<E;++_)m[_]=M+y[A-1]}else if(o===vp){for(M=0,_=c;_<h;++_)M<m[_]&&(M=m[_]);for(_=c;_<h;++_)m[_]=M+x}else for(o=!1,A=1;A<f;++A)for(_=A*c,E=_+c;_<E;++_)m[_]+=y[A-1];for(F=0,_=0;_<h;++_)F=d[_]+(_%c?F:0),v[_]+=F-t[_].x;for(k=0;k<c;++k)for(C=0,_=k;_<h;_+=c)C+=m[_],b[_]+=C-t[_].y;if(a&&tt(n.center,$a)&&f>1)for(_=0;_<h;++_)T=a===vp?g:p[_%c],F=T-w[_].x2-t[_].x-v[_],F>0&&(v[_]+=F/2);if(o&&tt(n.center,Ta)&&c!==1)for(_=0;_<h;++_)T=o===vp?x:y[~~(_/c)],C=T-w[_].y2-t[_].y-b[_],C>0&&(b[_]+=C/2);for(_=0;_<h;++_)s.union(w[_].translate(v[_],b[_]));switch(F=tt(n.anchor,BQ),C=tt(n.anchor,UQ),tt(n.anchor,$a)){case _n:F-=s.width();break;case Db:F-=s.width()/2}switch(tt(n.anchor,Ta)){case _n:C-=s.height();break;case Db:C-=s.height()/2}for(F=Math.round(F),C=Math.round(C),s.clear(),_=0;_<h;++_)t[_].mark.bounds.clear();for(_=0;_<h;++_)$=t[_],$.x+=v[_]+=F,$.y+=b[_]+=C,s.union($.mark.bounds.union($.bounds.translate(v[_],b[_]))),i&&e.dirty($);return s}function iJ(e,t,n){var i=eJ(t),r=i.marks,s=n.bounds===JE?rJ:sJ,a=n.offset,o=n.columns||r.length,u=o<=0?1:Math.ceil(r.length/o),l=u*o,c,f,h,d,p,g,m;const y=C6(e,r,n);y.empty()&&y.set(0,0,0,0),i.rowheaders&&(g=tt(n.headerBand,Ta,null),c=_p(e,i.rowheaders,r,o,u,-tt(a,"rowHeader"),F3,0,s,"x1",0,o,1,g)),i.colheaders&&(g=tt(n.headerBand,$a,null),f=_p(e,i.colheaders,r,o,o,-tt(a,"columnHeader"),F3,1,s,"y1",0,1,o,g)),i.rowfooters&&(g=tt(n.footerBand,Ta,null),h=_p(e,i.rowfooters,r,o,u,tt(a,"rowFooter"),M3,0,s,"x2",o-1,o,1,g)),i.colfooters&&(g=tt(n.footerBand,$a,null),d=_p(e,i.colfooters,r,o,o,tt(a,"columnFooter"),M3,1,s,"y2",l-o,1,o,g)),i.rowtitle&&(p=tt(n.titleAnchor,Ta),m=tt(a,"rowTitle"),m=p===_n?h+m:c-m,g=tt(n.titleBand,Ta,.5),N3(e,i.rowtitle,m,0,y,g)),i.coltitle&&(p=tt(n.titleAnchor,$a),m=tt(a,"columnTitle"),m=p===_n?d+m:f-m,g=tt(n.titleBand,$a,.5),N3(e,i.coltitle,m,1,y,g))}function rJ(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function sJ(e,t){return e.bounds[t]}function _p(e,t,n,i,r,s,a,o,u,l,c,f,h,d){var p=n.length,g=0,m=0,y,x,v,b,w,E,_,k,A;if(!p)return g;for(y=c;y<p;y+=f)n[y]&&(g=a(g,u(n[y],l)));if(!t.length)return g;for(t.length>r&&(e.warn("Grid headers exceed limit: "+r),t=t.slice(0,r)),g+=s,x=0,b=t.length;x<b;++x)e.dirty(t[x]),t[x].mark.bounds.clear();for(y=c,x=0,b=t.length;x<b;++x,y+=f){for(E=t[x],w=E.mark.bounds,v=y;v>=0&&(_=n[v])==null;v-=h);o?(k=d==null?_.x:Math.round(_.bounds.x1+d*_.bounds.width()),A=g):(k=g,A=d==null?_.y:Math.round(_.bounds.y1+d*_.bounds.height())),w.union(E.bounds.translate(k-(E.x||0),A-(E.y||0))),E.x=k,E.y=A,e.dirty(E),m=a(m,w[l])}return m}function N3(e,t,n,i,r,s){if(t){e.dirty(t);var a=n,o=n;i?a=Math.round(r.x1+s*r.width()):o=Math.round(r.y1+s*r.height()),t.bounds.translate(a-(t.x||0),o-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=a,t.y=o,e.dirty(t)}}function aJ(e,t){const n=e[t]||{};return(i,r)=>n[i]!=null?n[i]:e[i]!=null?e[i]:r}function oJ(e,t){let n=-1/0;return e.forEach(i=>{i.offset!=null&&(n=Math.max(n,i.offset))}),n>-1/0?n:t}function uJ(e,t,n,i,r,s,a){const o=aJ(n,t),u=oJ(e,o("offset",0)),l=o("anchor",GE),c=l===_n?1:l===Db?.5:0,f={align:Ib,bounds:o("bounds",JE),columns:o("direction")==="vertical"?1:e.length,padding:o("margin",8),center:o("center"),nodirty:!0};switch(t){case Zi:f.anchor={x:Math.floor(i.x1)-u,column:_n,y:c*(a||i.height()+2*i.y1),row:l};break;case er:f.anchor={x:Math.ceil(i.x2)+u,y:c*(a||i.height()+2*i.y1),row:l};break;case Xl:f.anchor={y:Math.floor(r.y1)-u,row:_n,x:c*(s||r.width()+2*r.x1),column:l};break;case Ka:f.anchor={y:Math.ceil(r.y2)+u,x:c*(s||r.width()+2*r.x1),column:l};break;case IQ:f.anchor={x:u,y:u};break;case PQ:f.anchor={x:s-u,y:u,column:_n};break;case LQ:f.anchor={x:u,y:a-u,row:_n};break;case zQ:f.anchor={x:s-u,y:a-u,column:_n,row:_n};break}return f}function lJ(e,t){var n=t.items[0],i=n.datum,r=n.orient,s=n.bounds,a=n.x,o=n.y,u,l;return n._bounds?n._bounds.clear().union(s):n._bounds=s.clone(),s.clear(),fJ(e,n,n.items[0].items[0]),s=cJ(n,s),u=2*n.padding,l=2*n.padding,s.empty()||(u=Math.ceil(s.width()+u),l=Math.ceil(s.height()+l)),i.type===WQ&&hJ(n.items[0].items[0].items[0].items),r!==QE&&(n.x=a=0,n.y=o=0),n.width=u,n.height=l,ia(s.set(a,o,a+u,o+l),n),n.mark.bounds.clear().union(s),n}function cJ(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function fJ(e,t,n){var i=t.padding,r=i-n.x,s=i-n.y;if(!t.datum.title)(r||s)&&mf(e,n,r,s);else{var a=t.items[1].items[0],o=a.anchor,u=t.titlePadding||0,l=i-a.x,c=i-a.y;switch(a.orient){case Zi:r+=Math.ceil(a.bounds.width())+u;break;case er:case Ka:break;default:s+=a.bounds.height()+u}switch((r||s)&&mf(e,n,r,s),a.orient){case Zi:c+=Zu(t,n,a,o,1,1);break;case er:l+=Zu(t,n,a,_n,0,0)+u,c+=Zu(t,n,a,o,1,1);break;case Ka:l+=Zu(t,n,a,o,0,0),c+=Zu(t,n,a,_n,-1,0,1)+u;break;default:l+=Zu(t,n,a,o,0,0)}(l||c)&&mf(e,a,l,c),(l=Math.round(a.bounds.x1-i))<0&&(mf(e,n,-l,0),mf(e,a,-l,0))}}function Zu(e,t,n,i,r,s,a){const o=e.datum.type!=="symbol",u=n.datum.vgrad,l=o&&(s||!u)&&!a?t.items[0]:t,c=l.bounds[r?"y2":"x2"]-e.padding,f=u&&s?c:0,h=u&&s?0:c,d=r<=0?0:DE(n);return Math.round(i===GE?f:i===_n?h-d:.5*(c-d))}function mf(e,t,n,i){t.x+=n,t.y+=i,t.bounds.translate(n,i),t.mark.bounds.translate(n,i),e.dirty(t)}function hJ(e){const t=e.reduce((n,i)=>(n[i.column]=Math.max(i.bounds.x2-i.x,n[i.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function dJ(e,t,n,i,r){var s=t.items[0],a=s.frame,o=s.orient,u=s.anchor,l=s.offset,c=s.padding,f=s.items[0].items[0],h=s.items[1]&&s.items[1].items[0],d=o===Zi||o===er?i:n,p=0,g=0,m=0,y=0,x=0,v;if(a!==d1?o===Zi?(p=r.y2,d=r.y1):o===er?(p=r.y1,d=r.y2):(p=r.x1,d=r.x2):o===Zi&&(p=i,d=0),v=u===GE?p:u===_n?d:(p+d)/2,h&&h.text){switch(o){case Xl:case Ka:x=f.bounds.height()+c;break;case Zi:y=f.bounds.width()+c;break;case er:y=-f.bounds.width()-c;break}un.clear().union(h.bounds),un.translate(y-(h.x||0),x-(h.y||0)),yl(h,"x",y)|yl(h,"y",x)&&(e.dirty(h),h.bounds.clear().union(un),h.mark.bounds.clear().union(un),e.dirty(h)),un.clear().union(h.bounds)}else un.clear();switch(un.union(f.bounds),o){case Xl:g=v,m=r.y1-un.height()-l;break;case Zi:g=r.x1-un.width()-l,m=v;break;case er:g=r.x2+un.width()+l,m=v;break;case Ka:g=v,m=r.y2+l;break;default:g=s.x,m=s.y}return yl(s,"x",g)|yl(s,"y",m)&&(un.translate(g,m),e.dirty(s),s.bounds.clear().union(un),t.bounds.clear().union(un),e.dirty(s)),s.bounds}function $6(e){N.call(this,null,e)}Y($6,N,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(i=>{e.layout&&iJ(n,i,e.layout),gJ(n,i,e)}),pJ(e.mark.group)?t.reflow():t}});function pJ(e){return e&&e.mark.role!=="legend-entry"}function gJ(e,t,n){var i=t.items,r=Math.max(0,t.width||0),s=Math.max(0,t.height||0),a=new wt().set(0,0,r,s),o=a.clone(),u=a.clone(),l=[],c,f,h,d,p,g;for(p=0,g=i.length;p<g;++p)switch(f=i[p],f.role){case YE:d=QQ(f)?o:u,d.union(ZQ(e,f,r,s));break;case XE:c=f;break;case KE:l.push(lJ(e,f));break;case jQ:case qQ:case d6:case p6:case g6:case m6:case y6:case x6:o.union(f.bounds),u.union(f.bounds);break;default:a.union(f.bounds)}if(l.length){const m={};l.forEach(y=>{h=y.orient||er,h!==QE&&(m[h]||(m[h]=[])).push(y)});for(const y in m){const x=m[y];C6(e,x,uJ(x,y,n.legends,o,u,r,s))}l.forEach(y=>{const x=y.bounds;if(x.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=x,e.dirty(y)),n.autosize&&(n.autosize.type===v6||n.autosize.type===b6||n.autosize.type===w6))switch(y.orient){case Zi:case er:a.add(x.x1,0).add(x.x2,0);break;case Xl:case Ka:a.add(0,x.y1).add(0,x.y2)}else a.union(x)})}a.union(o).union(u),c&&a.union(dJ(e,c,r,s,a)),t.clip&&a.set(0,0,t.width||0,t.height||0),mJ(e,t,a,n)}function mJ(e,t,n,i){const r=i.autosize||{},s=r.type;if(e._autosize<1||!s)return;let a=e._width,o=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),d=Math.max(0,Math.ceil(n.y2-c));if(r.contains===VQ){const p=e.padding();a-=p.left+p.right,o-=p.top+p.bottom}s===QE?(l=0,f=0,u=a,c=o):s===v6?(u=Math.max(0,a-l-h),c=Math.max(0,o-f-d)):s===b6?(u=Math.max(0,a-l-h),o=c+f+d):s===w6?(a=u+l+h,c=Math.max(0,o-f-d)):s===HQ&&(a=u+l+h,o=c+f+d),e._resizeView(a,o,u,c,[l,f],r.resize)}const yJ=Object.freeze(Object.defineProperty({__proto__:null,bound:_6,identifier:ZE,mark:E6,overlap:S6,render:A6,viewlayout:$6},Symbol.toStringTag,{value:"Module"}));function T6(e){N.call(this,null,e)}Y(T6,N,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,s=e.scale,a=e.count==null?e.values?e.values.length:10:e.count,o=yE(s,a,e.minstep),u=e.format||n5(n,s,o,e.formatSpecifier,e.formatType,!!e.values),l=e.values?t5(s,e.values,o):xE(s,o);return r&&(i.rem=r),r=l.map((c,f)=>ze({index:f/(l.length-1||1),value:c,label:u(c)})),e.extra&&r.length&&r.push(ze({index:-1,extra:{value:r[0].value},label:""})),i.source=r,i.add=r,this.value=r,i}});function F6(e){N.call(this,null,e)}function xJ(){return ze({})}function vJ(e){const t=_c().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}Y(F6,N,{transform(e,t){var n=t.dataflow,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.item||xJ,s=e.key||oe,a=this.value;return L(i.encode)&&(i.encode=null),a&&(e.modified("key")||t.modified(s))&&P("DataJoin does not support modified key function or fields."),a||(t=t.addAll(),this.value=a=vJ(s)),t.visit(t.ADD,o=>{const u=s(o);let l=a.get(u);l?l.exit?(a.empty--,i.add.push(l)):i.mod.push(l):(l=r(o),a.set(u,l),i.add.push(l)),l.datum=o,l.exit=!1}),t.visit(t.MOD,o=>{const u=s(o),l=a.get(u);l&&(l.datum=o,i.mod.push(l))}),t.visit(t.REM,o=>{const u=s(o),l=a.get(u);o===l.datum&&!l.exit&&(i.rem.push(l),l.exit=!0,++a.empty)}),t.changed(t.ADD_MOD)&&i.modifies("datum"),(t.clean()||e.clean&&a.empty>n.cleanThreshold)&&n.runAfter(a.clean),i}});function M6(e){N.call(this,null,e)}Y(M6,N,{transform(e,t){var n=t.fork(t.ADD_REM),i=e.mod||!1,r=e.encoders,s=t.encode;if(L(s))if(n.changed()||s.every(f=>r[f]))s=s[0],n.encode=null;else return t.StopPropagation;var a=s==="enter",o=r.update||ga,u=r.enter||ga,l=r.exit||ga,c=(s&&!a?r[s]:o)||ga;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{u(f,e),o(f,e)}),n.modifies(u.output),n.modifies(o.output),c!==ga&&c!==o&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&l!==ga&&(t.visit(t.REM,f=>{l(f,e)}),n.modifies(l.output)),a||c!==ga){const f=t.MOD|(e.modified()?t.REFLOW:0);a?(t.visit(f,h=>{const d=u(h,e)||i;(c(h,e)||d)&&n.mod.push(h)}),n.mod.length&&n.modifies(u.output)):t.visit(f,h=>{(c(h,e)||i)&&n.mod.push(h)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function O6(e){N.call(this,[],e)}Y(O6,N,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),i=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=this.value,s=e.type||rg,a=e.scale,o=+e.limit,u=yE(a,e.count==null?5:e.count,e.minstep),l=!!e.values||s===rg,c=e.format||a5(n,a,u,s,e.formatSpecifier,e.formatType,l),f=e.values||s5(a,u),h,d,p,g,m;return r&&(i.rem=r),s===rg?(o&&f.length>o?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),r=f.slice(0,o-1),m=!0):r=f,we(p=e.size)?(!e.values&&a(r[0])===0&&(r=r.slice(1)),g=r.reduce((y,x)=>Math.max(y,p(x,e)),0)):p=xn(g=p||8),r=r.map((y,x)=>ze({index:x,label:c(y,x,r),value:y,offset:g,size:p(y,e)})),m&&(m=f[r.length],r.push(ze({index:r.length,label:`…${f.length-r.length} entries`,value:m,offset:g,size:p(m,e)})))):s===HY?(h=a.domain(),d=JI(a,h[0],Fe(h)),f.length<3&&!e.values&&h[0]!==Fe(h)&&(f=[h[0],Fe(h)]),r=f.map((y,x)=>ze({index:x,label:c(y,x,f),value:y,perc:d(y)}))):(p=f.length-1,d=iX(a),r=f.map((y,x)=>ze({index:x,label:c(y,x,f),value:y,perc:x?d(y):0,perc2:x===p?1:d(f[x+1])}))),i.source=r,i.add=r,this.value=r,i}});const bJ=e=>e.source.x,wJ=e=>e.source.y,_J=e=>e.target.x,EJ=e=>e.target.y;function eS(e){N.call(this,{},e)}eS.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};Y(eS,N,{transform(e,t){var n=e.sourceX||bJ,i=e.sourceY||wJ,r=e.targetX||_J,s=e.targetY||EJ,a=e.as||"path",o=e.orient||"vertical",u=e.shape||"line",l=R3.get(u+"-"+o)||R3.get(u);return l||P("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[a]=l(n(c),i(c),r(c),s(c))}),t.reflow(e.modified()).modifies(a)}});const N6=(e,t,n,i)=>"M"+e+","+t+"L"+n+","+i,SJ=(e,t,n,i)=>N6(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),R6=(e,t,n,i)=>{var r=n-e,s=i-t,a=Math.hypot(r,s)/2,o=180*Math.atan2(s,r)/Math.PI;return"M"+e+","+t+"A"+a+","+a+" "+o+" 0 1 "+n+","+i},kJ=(e,t,n,i)=>R6(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),D6=(e,t,n,i)=>{const r=n-e,s=i-t,a=.2*(r+s),o=.2*(s-r);return"M"+e+","+t+"C"+(e+a)+","+(t+o)+" "+(n+o)+","+(i-a)+" "+n+","+i},AJ=(e,t,n,i)=>D6(t*Math.cos(e),t*Math.sin(e),i*Math.cos(n),i*Math.sin(n)),CJ=(e,t,n,i)=>"M"+e+","+t+"V"+i+"H"+n,$J=(e,t,n,i)=>"M"+e+","+t+"H"+n+"V"+i,TJ=(e,t,n,i)=>{const r=Math.cos(e),s=Math.sin(e),a=Math.cos(n),o=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*r+","+t*s+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*a+","+t*o+"L"+i*a+","+i*o},FJ=(e,t,n,i)=>{const r=(e+n)/2;return"M"+e+","+t+"C"+r+","+t+" "+r+","+i+" "+n+","+i},MJ=(e,t,n,i)=>{const r=(t+i)/2;return"M"+e+","+t+"C"+e+","+r+" "+n+","+r+" "+n+","+i},OJ=(e,t,n,i)=>{const r=Math.cos(e),s=Math.sin(e),a=Math.cos(n),o=Math.sin(n),u=(t+i)/2;return"M"+t*r+","+t*s+"C"+u*r+","+u*s+" "+u*a+","+u*o+" "+i*a+","+i*o},R3=_c({line:N6,"line-radial":SJ,arc:R6,"arc-radial":kJ,curve:D6,"curve-radial":AJ,"orthogonal-horizontal":CJ,"orthogonal-vertical":$J,"orthogonal-radial":TJ,"diagonal-horizontal":FJ,"diagonal-vertical":MJ,"diagonal-radial":OJ});function tS(e){N.call(this,null,e)}tS.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};Y(tS,N,{transform(e,t){var n=e.as||["startAngle","endAngle"],i=n[0],r=n[1],s=e.field||xc,a=e.startAngle||0,o=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(s),c=l.length,f=a,h=(o-a)/XN(l),d=si(c),p,g,m;for(e.sort&&d.sort((y,x)=>l[y]-l[x]),p=0;p<c;++p)m=l[d[p]],g=u[d[p]],g[i]=f,g[r]=f+=m*h;return this.value=l,t.reflow(e.modified()).modifies(n)}});const NJ=5;function RJ(e){const t=e.type;return!e.bins&&(t===ql||t===pd||t===gd)}function I6(e){return pE(e)&&e!==Vr}const DJ=ur(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function P6(e){N.call(this,null,e),this.modified(!0)}Y(P6,N,{transform(e,t){var n=t.dataflow,i=this.value,r=IJ(e);(!i||r!==i.type)&&(this.value=i=Le(r)());for(r in e)if(!DJ[r]){if(r==="padding"&&I6(i.type))continue;we(i[r])?i[r](e[r]):n.warn("Unsupported scale property: "+r)}return jJ(i,e,UJ(i,e,LJ(i,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function IJ(e){var t=e.type,n="",i;return t===Vr?Vr+"-"+ql:(PJ(e)&&(i=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=i===2?Vr+"-":i===3?Fc+"-":""),(n+t||ql).toLowerCase())}function PJ(e){const t=e.type;return pE(t)&&t!==uu&&t!==lu&&(e.scheme||e.range&&e.range.length&&e.range.every(J))}function LJ(e,t,n){const i=zJ(e,t.domainRaw,n);if(i>-1)return i;var r=t.domain,s=e.type,a=t.zero||t.zero===void 0&&RJ(e),o,u;if(!r)return 0;if((a||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(o=(r=r.slice()).length-1||1,a&&(r[0]>0&&(r[0]=0),r[o]<0&&(r[o]=0)),t.domainMin!=null&&(r[0]=t.domainMin),t.domainMax!=null&&(r[o]=t.domainMax),t.domainMid!=null)){u=t.domainMid;const l=u>r[o]?o+1:u<r[0]?0:o;l!==o&&n.warn("Scale domainMid exceeds domain min or max.",u),r.splice(l,0,u)}return I6(s)&&t.padding&&r[0]!==Fe(r)&&(r=BJ(s,r,t.range,t.padding,t.exponent,t.constant)),e.domain(L6(s,r,n)),s===cE&&e.unknown(t.domainImplicit?gb:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&yE(e,t.nice)||null),r.length}function zJ(e,t,n){return t?(e.domain(L6(e.type,t,n)),t.length):-1}function BJ(e,t,n,i,r,s){var a=Math.abs(Fe(n)-n[0]),o=a/(a-2*i),u=e===Gs?Ow(t,null,o):e===gd?Ng(t,null,o,.5):e===pd?Ng(t,null,o,r||1):e===Jm?Nw(t,null,o,s||1):Mw(t,null,o);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function L6(e,t,n){if(GI(e)){var i=Math.abs(t.reduce((r,s)=>r+(s<0?-1:s>0?1:0),0));i!==t.length&&n.warn("Log scale domain includes zero: "+G(t))}return t}function UJ(e,t,n){let i=t.bins;if(i&&!L(i)){const r=e.domain(),s=r[0],a=Fe(r),o=i.step;let u=i.start==null?s:i.start,l=i.stop==null?a:i.stop;o||P("Scale bins parameter missing step property."),u<s&&(u=o*Math.ceil(s/o)),l>a&&(l=o*Math.floor(a/o)),i=si(u,l+o/2,o)}return i?e.bins=i:e.bins&&delete e.bins,e.type===fE&&(i?!t.domain&&!t.domainRaw&&(e.domain(i),n=i.length):e.bins=e.domain()),n}function jJ(e,t,n){var i=e.type,r=t.round||!1,s=t.range;if(t.rangeStep!=null)s=qJ(i,t,n);else if(t.scheme&&(s=VJ(i,t,n),we(s))){if(e.interpolator)return e.interpolator(s);P(`Scale type ${i} does not support interpolating color schemes.`)}if(s&&YI(i))return e.interpolator(t1(Pb(s,t.reverse),t.interpolate,t.interpolateGamma));s&&t.interpolate&&e.interpolate?e.interpolate(gE(t.interpolate,t.interpolateGamma)):we(e.round)?e.round(r):we(e.rangeRound)&&e.interpolate(r?hd:lo),s&&e.range(Pb(s,t.reverse))}function qJ(e,t,n){e!==UI&&e!==_b&&P("Only band and point scales support rangeStep.");var i=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,r=e===_b?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*lE(n,r,i)]}function VJ(e,t,n){var i=t.schemeExtent,r,s;return L(t.scheme)?s=t1(t.scheme,t.interpolate,t.interpolateGamma):(r=t.scheme.toLowerCase(),s=mE(r),s||P(`Unrecognized scheme name: ${t.scheme}`)),n=e===e1?n+1:e===fE?n-1:e===Vl||e===Zm?+t.schemeCount||NJ:n,YI(e)?D3(s,i,t.reverse):we(s)?QI(D3(s,i),n):e===cE?s:s.slice(0,n)}function D3(e,t,n){return we(e)&&(t||n)?KI(e,Pb(t||[0,1],n)):e}function Pb(e,t){return t?e.slice().reverse():e}function z6(e){N.call(this,null,e)}Y(z6,N,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Mu(e.sort)),this.modified(n),t}});const I3="zero",B6="center",U6="normalize",j6=["y0","y1"];function nS(e){N.call(this,null,e)}nS.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:I3,values:[I3,B6,U6]},{name:"as",type:"string",array:!0,length:2,default:j6}]};Y(nS,N,{transform(e,t){var n=e.as||j6,i=n[0],r=n[1],s=Mu(e.sort),a=e.field||xc,o=e.offset===B6?WJ:e.offset===U6?HJ:GJ,u,l,c,f;for(u=YJ(t.source,e.groupby,s,a),l=0,c=u.length,f=u.max;l<c;++l)o(u[l],f,a,i,r);return t.reflow(e.modified()).modifies(n)}});function WJ(e,t,n,i,r){for(var s=(t-e.sum)/2,a=e.length,o=0,u;o<a;++o)u=e[o],u[i]=s,u[r]=s+=Math.abs(n(u))}function HJ(e,t,n,i,r){for(var s=1/e.sum,a=0,o=e.length,u=0,l=0,c;u<o;++u)c=e[u],c[i]=a,c[r]=a=s*(l+=Math.abs(n(c)))}function GJ(e,t,n,i,r){for(var s=0,a=0,o=e.length,u=0,l,c;u<o;++u)c=e[u],l=+n(c),l<0?(c[i]=a,c[r]=a+=l):(c[i]=s,c[r]=s+=l)}function YJ(e,t,n,i){var r=[],s=g=>g(c),a,o,u,l,c,f,h,d,p;if(t==null)r.push(e.slice());else for(a={},o=0,u=e.length;o<u;++o)c=e[o],f=t.map(s),h=a[f],h||(a[f]=h=[],r.push(h)),h.push(c);for(f=0,p=0,l=r.length;f<l;++f){for(h=r[f],o=0,d=0,u=h.length;o<u;++o)d+=Math.abs(i(h[o]));h.sum=d,d>p&&(p=d),n&&h.sort(n)}return r.max=p,r}const XJ=Object.freeze(Object.defineProperty({__proto__:null,axisticks:T6,datajoin:F6,encode:M6,legendentries:O6,linkpath:eS,pie:tS,scale:P6,sortitems:z6,stack:nS},Symbol.toStringTag,{value:"Module"}));var fe=1e-6,Lb=1e-12,Se=Math.PI,ht=Se/2,c0=Se/4,Mn=Se*2,mt=180/Se,_e=Se/180,Te=Math.abs,Oc=Math.atan,Di=Math.atan2,ce=Math.cos,Ep=Math.ceil,q6=Math.exp,zb=Math.hypot,f0=Math.log,_x=Math.pow,ue=Math.sin,Ai=Math.sign||function(e){return e>0?1:e<0?-1:0},On=Math.sqrt,iS=Math.tan;function V6(e){return e>1?0:e<-1?Se:Math.acos(e)}function Yn(e){return e>1?ht:e<-1?-ht:Math.asin(e)}function Xt(){}function h0(e,t){e&&L3.hasOwnProperty(e.type)&&L3[e.type](e,t)}var P3={Feature:function(e,t){h0(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)h0(n[i].geometry,t)}},L3={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Bb(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Bb(n[i],t,0)},Polygon:function(e,t){z3(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)z3(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)h0(n[i],t)}};function Bb(e,t,n){var i=-1,r=e.length-n,s;for(t.lineStart();++i<r;)s=e[i],t.point(s[0],s[1],s[2]);t.lineEnd()}function z3(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Bb(e[n],t,1);t.polygonEnd()}function Ts(e,t){e&&P3.hasOwnProperty(e.type)?P3[e.type](e,t):h0(e,t)}var d0=new Tn,p0=new Tn,W6,H6,Ub,jb,qb,Jr={point:Xt,lineStart:Xt,lineEnd:Xt,polygonStart:function(){d0=new Tn,Jr.lineStart=KJ,Jr.lineEnd=QJ},polygonEnd:function(){var e=+d0;p0.add(e<0?Mn+e:e),this.lineStart=this.lineEnd=this.point=Xt},sphere:function(){p0.add(Mn)}};function KJ(){Jr.point=JJ}function QJ(){G6(W6,H6)}function JJ(e,t){Jr.point=G6,W6=e,H6=t,e*=_e,t*=_e,Ub=e,jb=ce(t=t/2+c0),qb=ue(t)}function G6(e,t){e*=_e,t*=_e,t=t/2+c0;var n=e-Ub,i=n>=0?1:-1,r=i*n,s=ce(t),a=ue(t),o=qb*a,u=jb*s+o*ce(r),l=o*i*ue(r);d0.add(Di(l,u)),Ub=e,jb=s,qb=a}function ZJ(e){return p0=new Tn,Ts(e,Jr),p0*2}function g0(e){return[Di(e[1],e[0]),Yn(e[2])]}function fu(e){var t=e[0],n=e[1],i=ce(n);return[i*ce(t),i*ue(t),ue(n)]}function Sp(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Kl(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Ex(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function kp(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function m0(e){var t=On(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var st,Un,ut,ni,zo,Y6,X6,Cl,ah,ba,Ys,As={point:Vb,lineStart:B3,lineEnd:U3,polygonStart:function(){As.point=Q6,As.lineStart=eZ,As.lineEnd=tZ,ah=new Tn,Jr.polygonStart()},polygonEnd:function(){Jr.polygonEnd(),As.point=Vb,As.lineStart=B3,As.lineEnd=U3,d0<0?(st=-(ut=180),Un=-(ni=90)):ah>fe?ni=90:ah<-1e-6&&(Un=-90),Ys[0]=st,Ys[1]=ut},sphere:function(){st=-(ut=180),Un=-(ni=90)}};function Vb(e,t){ba.push(Ys=[st=e,ut=e]),t<Un&&(Un=t),t>ni&&(ni=t)}function K6(e,t){var n=fu([e*_e,t*_e]);if(Cl){var i=Kl(Cl,n),r=[i[1],-i[0],0],s=Kl(r,i);m0(s),s=g0(s);var a=e-zo,o=a>0?1:-1,u=s[0]*mt*o,l,c=Te(a)>180;c^(o*zo<u&&u<o*e)?(l=s[1]*mt,l>ni&&(ni=l)):(u=(u+360)%360-180,c^(o*zo<u&&u<o*e)?(l=-s[1]*mt,l<Un&&(Un=l)):(t<Un&&(Un=t),t>ni&&(ni=t))),c?e<zo?ti(st,e)>ti(st,ut)&&(ut=e):ti(e,ut)>ti(st,ut)&&(st=e):ut>=st?(e<st&&(st=e),e>ut&&(ut=e)):e>zo?ti(st,e)>ti(st,ut)&&(ut=e):ti(e,ut)>ti(st,ut)&&(st=e)}else ba.push(Ys=[st=e,ut=e]);t<Un&&(Un=t),t>ni&&(ni=t),Cl=n,zo=e}function B3(){As.point=K6}function U3(){Ys[0]=st,Ys[1]=ut,As.point=Vb,Cl=null}function Q6(e,t){if(Cl){var n=e-zo;ah.add(Te(n)>180?n+(n>0?360:-360):n)}else Y6=e,X6=t;Jr.point(e,t),K6(e,t)}function eZ(){Jr.lineStart()}function tZ(){Q6(Y6,X6),Jr.lineEnd(),Te(ah)>fe&&(st=-(ut=180)),Ys[0]=st,Ys[1]=ut,Cl=null}function ti(e,t){return(t-=e)<0?t+360:t}function nZ(e,t){return e[0]-t[0]}function j3(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function iZ(e){var t,n,i,r,s,a,o;if(ni=ut=-(st=Un=1/0),ba=[],Ts(e,As),n=ba.length){for(ba.sort(nZ),t=1,i=ba[0],s=[i];t<n;++t)r=ba[t],j3(i,r[0])||j3(i,r[1])?(ti(i[0],r[1])>ti(i[0],i[1])&&(i[1]=r[1]),ti(r[0],i[1])>ti(i[0],i[1])&&(i[0]=r[0])):s.push(i=r);for(a=-1/0,n=s.length-1,t=0,i=s[n];t<=n;i=r,++t)r=s[t],(o=ti(i[1],r[0]))>a&&(a=o,st=r[0],ut=i[1])}return ba=Ys=null,st===1/0||Un===1/0?[[NaN,NaN],[NaN,NaN]]:[[st,Un],[ut,ni]]}var jf,y0,x0,v0,b0,w0,_0,E0,Wb,Hb,Gb,J6,Z6,En,Sn,kn,tr={sphere:Xt,point:rS,lineStart:q3,lineEnd:V3,polygonStart:function(){tr.lineStart=aZ,tr.lineEnd=oZ},polygonEnd:function(){tr.lineStart=q3,tr.lineEnd=V3}};function rS(e,t){e*=_e,t*=_e;var n=ce(t);Cd(n*ce(e),n*ue(e),ue(t))}function Cd(e,t,n){++jf,x0+=(e-x0)/jf,v0+=(t-v0)/jf,b0+=(n-b0)/jf}function q3(){tr.point=rZ}function rZ(e,t){e*=_e,t*=_e;var n=ce(t);En=n*ce(e),Sn=n*ue(e),kn=ue(t),tr.point=sZ,Cd(En,Sn,kn)}function sZ(e,t){e*=_e,t*=_e;var n=ce(t),i=n*ce(e),r=n*ue(e),s=ue(t),a=Di(On((a=Sn*s-kn*r)*a+(a=kn*i-En*s)*a+(a=En*r-Sn*i)*a),En*i+Sn*r+kn*s);y0+=a,w0+=a*(En+(En=i)),_0+=a*(Sn+(Sn=r)),E0+=a*(kn+(kn=s)),Cd(En,Sn,kn)}function V3(){tr.point=rS}function aZ(){tr.point=uZ}function oZ(){eP(J6,Z6),tr.point=rS}function uZ(e,t){J6=e,Z6=t,e*=_e,t*=_e,tr.point=eP;var n=ce(t);En=n*ce(e),Sn=n*ue(e),kn=ue(t),Cd(En,Sn,kn)}function eP(e,t){e*=_e,t*=_e;var n=ce(t),i=n*ce(e),r=n*ue(e),s=ue(t),a=Sn*s-kn*r,o=kn*i-En*s,u=En*r-Sn*i,l=zb(a,o,u),c=Yn(l),f=l&&-c/l;Wb.add(f*a),Hb.add(f*o),Gb.add(f*u),y0+=c,w0+=c*(En+(En=i)),_0+=c*(Sn+(Sn=r)),E0+=c*(kn+(kn=s)),Cd(En,Sn,kn)}function lZ(e){jf=y0=x0=v0=b0=w0=_0=E0=0,Wb=new Tn,Hb=new Tn,Gb=new Tn,Ts(e,tr);var t=+Wb,n=+Hb,i=+Gb,r=zb(t,n,i);return r<Lb&&(t=w0,n=_0,i=E0,y0<fe&&(t=x0,n=v0,i=b0),r=zb(t,n,i),r<Lb)?[NaN,NaN]:[Di(n,t)*mt,Yn(i/r)*mt]}function Yb(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function Xb(e,t){return Te(e)>Se&&(e-=Math.round(e/Mn)*Mn),[e,t]}Xb.invert=Xb;function tP(e,t,n){return(e%=Mn)?t||n?Yb(H3(e),G3(t,n)):H3(e):t||n?G3(t,n):Xb}function W3(e){return function(t,n){return t+=e,Te(t)>Se&&(t-=Math.round(t/Mn)*Mn),[t,n]}}function H3(e){var t=W3(e);return t.invert=W3(-e),t}function G3(e,t){var n=ce(e),i=ue(e),r=ce(t),s=ue(t);function a(o,u){var l=ce(u),c=ce(o)*l,f=ue(o)*l,h=ue(u),d=h*n+c*i;return[Di(f*r-d*s,c*n-h*i),Yn(d*r+f*s)]}return a.invert=function(o,u){var l=ce(u),c=ce(o)*l,f=ue(o)*l,h=ue(u),d=h*r-f*s;return[Di(f*r+h*s,c*n+d*i),Yn(d*n-c*i)]},a}function cZ(e){e=tP(e[0]*_e,e[1]*_e,e.length>2?e[2]*_e:0);function t(n){return n=e(n[0]*_e,n[1]*_e),n[0]*=mt,n[1]*=mt,n}return t.invert=function(n){return n=e.invert(n[0]*_e,n[1]*_e),n[0]*=mt,n[1]*=mt,n},t}function fZ(e,t,n,i,r,s){if(n){var a=ce(t),o=ue(t),u=i*n;r==null?(r=t+i*Mn,s=t-u/2):(r=Y3(a,r),s=Y3(a,s),(i>0?r<s:r>s)&&(r+=i*Mn));for(var l,c=r;i>0?c>s:c<s;c-=u)l=g0([a,-o*ce(c),-o*ue(c)]),e.point(l[0],l[1])}}function Y3(e,t){t=fu(t),t[0]-=e,m0(t);var n=V6(-t[1]);return((-t[2]<0?-n:n)+Mn-fe)%Mn}function nP(){var e=[],t;return{point:function(n,i,r){t.push([n,i,r])},lineStart:function(){e.push(t=[])},lineEnd:Xt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function dg(e,t){return Te(e[0]-t[0])<fe&&Te(e[1]-t[1])<fe}function Ap(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function iP(e,t,n,i,r){var s=[],a=[],o,u;if(e.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],y=p[g],x;if(dg(m,y)){if(!m[2]&&!y[2]){for(r.lineStart(),o=0;o<g;++o)r.point((m=p[o])[0],m[1]);r.lineEnd();return}y[0]+=2*fe}s.push(x=new Ap(m,p,null,!0)),a.push(x.o=new Ap(m,null,x,!1)),s.push(x=new Ap(y,p,null,!1)),a.push(x.o=new Ap(y,null,x,!0))}}),!!s.length){for(a.sort(t),X3(s),X3(a),o=0,u=a.length;o<u;++o)a[o].e=n=!n;for(var l=s[0],c,f;;){for(var h=l,d=!0;h.v;)if((h=h.n)===l)return;c=h.z,r.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(o=0,u=c.length;o<u;++o)r.point((f=c[o])[0],f[1]);else i(h.x,h.n.x,1,r);h=h.n}else{if(d)for(c=h.p.z,o=c.length-1;o>=0;--o)r.point((f=c[o])[0],f[1]);else i(h.x,h.p.x,-1,r);h=h.p}h=h.o,c=h.z,d=!d}while(!h.v);r.lineEnd()}}}function X3(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function Sx(e){return Te(e[0])<=Se?e[0]:Ai(e[0])*((Te(e[0])+Se)%Mn-Se)}function hZ(e,t){var n=Sx(t),i=t[1],r=ue(i),s=[ue(n),-ce(n),0],a=0,o=0,u=new Tn;r===1?i=ht+fe:r===-1&&(i=-ht-fe);for(var l=0,c=e.length;l<c;++l)if(h=(f=e[l]).length)for(var f,h,d=f[h-1],p=Sx(d),g=d[1]/2+c0,m=ue(g),y=ce(g),x=0;x<h;++x,p=b,m=E,y=_,d=v){var v=f[x],b=Sx(v),w=v[1]/2+c0,E=ue(w),_=ce(w),k=b-p,A=k>=0?1:-1,T=A*k,$=T>Se,R=m*E;if(u.add(Di(R*A*ue(T),y*_+R*ce(T))),a+=$?k+A*Mn:k,$^p>=n^b>=n){var O=Kl(fu(d),fu(v));m0(O);var F=Kl(s,O);m0(F);var C=($^k>=0?-1:1)*Yn(F[2]);(i>C||i===C&&(O[0]||O[1]))&&(o+=$^k>=0?1:-1)}}return(a<-1e-6||a<fe&&u<-1e-12)^o&1}function rP(e,t,n,i){return function(r){var s=t(r),a=nP(),o=t(a),u=!1,l,c,f,h={point:d,lineStart:g,lineEnd:m,polygonStart:function(){h.point=y,h.lineStart=x,h.lineEnd=v,c=[],l=[]},polygonEnd:function(){h.point=d,h.lineStart=g,h.lineEnd=m,c=YN(c);var b=hZ(l,i);c.length?(u||(r.polygonStart(),u=!0),iP(c,pZ,b,n,r)):b&&(u||(r.polygonStart(),u=!0),r.lineStart(),n(null,null,1,r),r.lineEnd()),u&&(r.polygonEnd(),u=!1),c=l=null},sphere:function(){r.polygonStart(),r.lineStart(),n(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function d(b,w){e(b,w)&&r.point(b,w)}function p(b,w){s.point(b,w)}function g(){h.point=p,s.lineStart()}function m(){h.point=d,s.lineEnd()}function y(b,w){f.push([b,w]),o.point(b,w)}function x(){o.lineStart(),f=[]}function v(){y(f[0][0],f[0][1]),o.lineEnd();var b=o.clean(),w=a.result(),E,_=w.length,k,A,T;if(f.pop(),l.push(f),f=null,!!_){if(b&1){if(A=w[0],(k=A.length-1)>0){for(u||(r.polygonStart(),u=!0),r.lineStart(),E=0;E<k;++E)r.point((T=A[E])[0],T[1]);r.lineEnd()}return}_>1&&b&2&&w.push(w.pop().concat(w.shift())),c.push(w.filter(dZ))}}return h}}function dZ(e){return e.length>1}function pZ(e,t){return((e=e.x)[0]<0?e[1]-ht-fe:ht-e[1])-((t=t.x)[0]<0?t[1]-ht-fe:ht-t[1])}const K3=rP(function(){return!0},gZ,yZ,[-Se,-ht]);function gZ(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(s,a){var o=s>0?Se:-Se,u=Te(s-t);Te(u-Se)<fe?(e.point(t,n=(n+a)/2>0?ht:-ht),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(o,n),e.point(s,n),r=0):i!==o&&u>=Se&&(Te(t-i)<fe&&(t-=i*fe),Te(s-o)<fe&&(s-=o*fe),n=mZ(t,n,s,a),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(o,n),r=0),e.point(t=s,n=a),i=o},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function mZ(e,t,n,i){var r,s,a=ue(e-n);return Te(a)>fe?Oc((ue(t)*(s=ce(i))*ue(n)-ue(i)*(r=ce(t))*ue(e))/(r*s*a)):(t+i)/2}function yZ(e,t,n,i){var r;if(e==null)r=n*ht,i.point(-Se,r),i.point(0,r),i.point(Se,r),i.point(Se,0),i.point(Se,-r),i.point(0,-r),i.point(-Se,-r),i.point(-Se,0),i.point(-Se,r);else if(Te(e[0]-t[0])>fe){var s=e[0]<t[0]?Se:-Se;r=n*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])}function xZ(e){var t=ce(e),n=2*_e,i=t>0,r=Te(t)>fe;function s(c,f,h,d){fZ(d,e,n,h,c,f)}function a(c,f){return ce(c)*ce(f)>t}function o(c){var f,h,d,p,g;return{lineStart:function(){p=d=!1,g=1},point:function(m,y){var x=[m,y],v,b=a(m,y),w=i?b?0:l(m,y):b?l(m+(m<0?Se:-Se),y):0;if(!f&&(p=d=b)&&c.lineStart(),b!==d&&(v=u(f,x),(!v||dg(f,v)||dg(x,v))&&(x[2]=1)),b!==d)g=0,b?(c.lineStart(),v=u(x,f),c.point(v[0],v[1])):(v=u(f,x),c.point(v[0],v[1],2),c.lineEnd()),f=v;else if(r&&f&&i^b){var E;!(w&h)&&(E=u(x,f,!0))&&(g=0,i?(c.lineStart(),c.point(E[0][0],E[0][1]),c.point(E[1][0],E[1][1]),c.lineEnd()):(c.point(E[1][0],E[1][1]),c.lineEnd(),c.lineStart(),c.point(E[0][0],E[0][1],3)))}b&&(!f||!dg(f,x))&&c.point(x[0],x[1]),f=x,d=b,h=w},lineEnd:function(){d&&c.lineEnd(),f=null},clean:function(){return g|(p&&d)<<1}}}function u(c,f,h){var d=fu(c),p=fu(f),g=[1,0,0],m=Kl(d,p),y=Sp(m,m),x=m[0],v=y-x*x;if(!v)return!h&&c;var b=t*y/v,w=-t*x/v,E=Kl(g,m),_=kp(g,b),k=kp(m,w);Ex(_,k);var A=E,T=Sp(_,A),$=Sp(A,A),R=T*T-$*(Sp(_,_)-1);if(!(R<0)){var O=On(R),F=kp(A,(-T-O)/$);if(Ex(F,_),F=g0(F),!h)return F;var C=c[0],M=f[0],D=c[1],B=f[1],z;M<C&&(z=C,C=M,M=z);var ee=M-C,he=Te(ee-Se)<fe,le=he||ee<fe;if(!he&&B<D&&(z=D,D=B,B=z),le?he?D+B>0^F[1]<(Te(F[0]-C)<fe?D:B):D<=F[1]&&F[1]<=B:ee>Se^(C<=F[0]&&F[0]<=M)){var me=kp(A,(-T+O)/$);return Ex(me,_),[F,g0(me)]}}}function l(c,f){var h=i?e:Se-e,d=0;return c<-h?d|=1:c>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return rP(a,o,s,i?[0,-e]:[-Se,e-Se])}function vZ(e,t,n,i,r,s){var a=e[0],o=e[1],u=t[0],l=t[1],c=0,f=1,h=u-a,d=l-o,p;if(p=n-a,!(!h&&p>0)){if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=r-a,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}if(p=i-o,!(!d&&p>0)){if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=s-o,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=a+c*h,e[1]=o+c*d),f<1&&(t[0]=a+f*h,t[1]=o+f*d),!0}}}}}var Cp=1e9,$p=-1e9;function sP(e,t,n,i){function r(l,c){return e<=l&&l<=n&&t<=c&&c<=i}function s(l,c,f,h){var d=0,p=0;if(l==null||(d=a(l,f))!==(p=a(c,f))||u(l,c)<0^f>0)do h.point(d===0||d===3?e:n,d>1?i:t);while((d=(d+f+4)%4)!==p);else h.point(c[0],c[1])}function a(l,c){return Te(l[0]-e)<fe?c>0?0:3:Te(l[0]-n)<fe?c>0?2:1:Te(l[1]-t)<fe?c>0?1:0:c>0?3:2}function o(l,c){return u(l.x,c.x)}function u(l,c){var f=a(l,1),h=a(c,1);return f!==h?f-h:f===0?c[1]-l[1]:f===1?l[0]-c[0]:f===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,f=nP(),h,d,p,g,m,y,x,v,b,w,E,_={point:k,lineStart:R,lineEnd:O,polygonStart:T,polygonEnd:$};function k(C,M){r(C,M)&&c.point(C,M)}function A(){for(var C=0,M=0,D=d.length;M<D;++M)for(var B=d[M],z=1,ee=B.length,he=B[0],le,me,Xe=he[0],ye=he[1];z<ee;++z)le=Xe,me=ye,he=B[z],Xe=he[0],ye=he[1],me<=i?ye>i&&(Xe-le)*(i-me)>(ye-me)*(e-le)&&++C:ye<=i&&(Xe-le)*(i-me)<(ye-me)*(e-le)&&--C;return C}function T(){c=f,h=[],d=[],E=!0}function $(){var C=A(),M=E&&C,D=(h=YN(h)).length;(M||D)&&(l.polygonStart(),M&&(l.lineStart(),s(null,null,1,l),l.lineEnd()),D&&iP(h,o,C,s,l),l.polygonEnd()),c=l,h=d=p=null}function R(){_.point=F,d&&d.push(p=[]),w=!0,b=!1,x=v=NaN}function O(){h&&(F(g,m),y&&b&&f.rejoin(),h.push(f.result())),_.point=k,b&&c.lineEnd()}function F(C,M){var D=r(C,M);if(d&&p.push([C,M]),w)g=C,m=M,y=D,w=!1,D&&(c.lineStart(),c.point(C,M));else if(D&&b)c.point(C,M);else{var B=[x=Math.max($p,Math.min(Cp,x)),v=Math.max($p,Math.min(Cp,v))],z=[C=Math.max($p,Math.min(Cp,C)),M=Math.max($p,Math.min(Cp,M))];vZ(B,z,e,t,n,i)?(b||(c.lineStart(),c.point(B[0],B[1])),c.point(z[0],z[1]),D||c.lineEnd(),E=!1):D&&(c.lineStart(),c.point(C,M),E=!1)}x=C,v=M,b=D}return _}}function Q3(e,t,n){var i=si(e,t-fe,n).concat(t);return function(r){return i.map(function(s){return[r,s]})}}function J3(e,t,n){var i=si(e,t-fe,n).concat(t);return function(r){return i.map(function(s){return[s,r]})}}function bZ(){var e,t,n,i,r,s,a,o,u=10,l=u,c=90,f=360,h,d,p,g,m=2.5;function y(){return{type:"MultiLineString",coordinates:x()}}function x(){return si(Ep(i/c)*c,n,c).map(p).concat(si(Ep(o/f)*f,a,f).map(g)).concat(si(Ep(t/u)*u,e,u).filter(function(v){return Te(v%c)>fe}).map(h)).concat(si(Ep(s/l)*l,r,l).filter(function(v){return Te(v%f)>fe}).map(d))}return y.lines=function(){return x().map(function(v){return{type:"LineString",coordinates:v}})},y.outline=function(){return{type:"Polygon",coordinates:[p(i).concat(g(a).slice(1),p(n).reverse().slice(1),g(o).reverse().slice(1))]}},y.extent=function(v){return arguments.length?y.extentMajor(v).extentMinor(v):y.extentMinor()},y.extentMajor=function(v){return arguments.length?(i=+v[0][0],n=+v[1][0],o=+v[0][1],a=+v[1][1],i>n&&(v=i,i=n,n=v),o>a&&(v=o,o=a,a=v),y.precision(m)):[[i,o],[n,a]]},y.extentMinor=function(v){return arguments.length?(t=+v[0][0],e=+v[1][0],s=+v[0][1],r=+v[1][1],t>e&&(v=t,t=e,e=v),s>r&&(v=s,s=r,r=v),y.precision(m)):[[t,s],[e,r]]},y.step=function(v){return arguments.length?y.stepMajor(v).stepMinor(v):y.stepMinor()},y.stepMajor=function(v){return arguments.length?(c=+v[0],f=+v[1],y):[c,f]},y.stepMinor=function(v){return arguments.length?(u=+v[0],l=+v[1],y):[u,l]},y.precision=function(v){return arguments.length?(m=+v,h=Q3(s,r,90),d=J3(t,e,m),p=Q3(o,a,90),g=J3(i,n,m),y):m},y.extentMajor([[-180,-90+fe],[180,90-fe]]).extentMinor([[-180,-80-fe],[180,80+fe]])}const Oh=e=>e;var kx=new Tn,Kb=new Tn,aP,oP,Qb,Jb,Fs={point:Xt,lineStart:Xt,lineEnd:Xt,polygonStart:function(){Fs.lineStart=wZ,Fs.lineEnd=EZ},polygonEnd:function(){Fs.lineStart=Fs.lineEnd=Fs.point=Xt,kx.add(Te(Kb)),Kb=new Tn},result:function(){var e=kx/2;return kx=new Tn,e}};function wZ(){Fs.point=_Z}function _Z(e,t){Fs.point=uP,aP=Qb=e,oP=Jb=t}function uP(e,t){Kb.add(Jb*e-Qb*t),Qb=e,Jb=t}function EZ(){uP(aP,oP)}var Ql=1/0,S0=Ql,Nh=-Ql,k0=Nh,A0={point:SZ,lineStart:Xt,lineEnd:Xt,polygonStart:Xt,polygonEnd:Xt,result:function(){var e=[[Ql,S0],[Nh,k0]];return Nh=k0=-(S0=Ql=1/0),e}};function SZ(e,t){e<Ql&&(Ql=e),e>Nh&&(Nh=e),t<S0&&(S0=t),t>k0&&(k0=t)}var Zb=0,e2=0,qf=0,C0=0,$0=0,xl=0,t2=0,n2=0,Vf=0,lP,cP,Lr,zr,Ei={point:hu,lineStart:Z3,lineEnd:eT,polygonStart:function(){Ei.lineStart=CZ,Ei.lineEnd=$Z},polygonEnd:function(){Ei.point=hu,Ei.lineStart=Z3,Ei.lineEnd=eT},result:function(){var e=Vf?[t2/Vf,n2/Vf]:xl?[C0/xl,$0/xl]:qf?[Zb/qf,e2/qf]:[NaN,NaN];return Zb=e2=qf=C0=$0=xl=t2=n2=Vf=0,e}};function hu(e,t){Zb+=e,e2+=t,++qf}function Z3(){Ei.point=kZ}function kZ(e,t){Ei.point=AZ,hu(Lr=e,zr=t)}function AZ(e,t){var n=e-Lr,i=t-zr,r=On(n*n+i*i);C0+=r*(Lr+e)/2,$0+=r*(zr+t)/2,xl+=r,hu(Lr=e,zr=t)}function eT(){Ei.point=hu}function CZ(){Ei.point=TZ}function $Z(){fP(lP,cP)}function TZ(e,t){Ei.point=fP,hu(lP=Lr=e,cP=zr=t)}function fP(e,t){var n=e-Lr,i=t-zr,r=On(n*n+i*i);C0+=r*(Lr+e)/2,$0+=r*(zr+t)/2,xl+=r,r=zr*e-Lr*t,t2+=r*(Lr+e),n2+=r*(zr+t),Vf+=r*3,hu(Lr=e,zr=t)}function hP(e){this._context=e}hP.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Mn);break}}},result:Xt};var i2=new Tn,Ax,dP,pP,Wf,Hf,Rh={point:Xt,lineStart:function(){Rh.point=FZ},lineEnd:function(){Ax&&gP(dP,pP),Rh.point=Xt},polygonStart:function(){Ax=!0},polygonEnd:function(){Ax=null},result:function(){var e=+i2;return i2=new Tn,e}};function FZ(e,t){Rh.point=gP,dP=Wf=e,pP=Hf=t}function gP(e,t){Wf-=e,Hf-=t,i2.add(On(Wf*Wf+Hf*Hf)),Wf=e,Hf=t}let tT,T0,nT,iT;class rT{constructor(t){this._append=t==null?mP:MZ(t),this._radius=4.5,this._=""}pointRadius(t){return this._radius=+t,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){this._line===0&&(this._+="Z"),this._point=NaN}point(t,n){switch(this._point){case 0:{this._append`M${t},${n}`,this._point=1;break}case 1:{this._append`L${t},${n}`;break}default:{if(this._append`M${t},${n}`,this._radius!==nT||this._append!==T0){const i=this._radius,r=this._;this._="",this._append`m0,${i}a${i},${i} 0 1,1 0,${-2*i}a${i},${i} 0 1,1 0,${2*i}z`,nT=i,T0=this._append,iT=this._,this._=r}this._+=iT;break}}}result(){const t=this._;return this._="",t.length?t:null}}function mP(e){let t=1;this._+=e[0];for(const n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function MZ(e){const t=Math.floor(e);if(!(t>=0))throw new RangeError(`invalid digits: ${e}`);if(t>15)return mP;if(t!==tT){const n=10**t;tT=t,T0=function(r){let s=1;this._+=r[0];for(const a=r.length;s<a;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}return T0}function yP(e,t){let n=3,i=4.5,r,s;function a(o){return o&&(typeof i=="function"&&s.pointRadius(+i.apply(this,arguments)),Ts(o,r(s))),s.result()}return a.area=function(o){return Ts(o,r(Fs)),Fs.result()},a.measure=function(o){return Ts(o,r(Rh)),Rh.result()},a.bounds=function(o){return Ts(o,r(A0)),A0.result()},a.centroid=function(o){return Ts(o,r(Ei)),Ei.result()},a.projection=function(o){return arguments.length?(r=o==null?(e=null,Oh):(e=o).stream,a):e},a.context=function(o){return arguments.length?(s=o==null?(t=null,new rT(n)):new hP(t=o),typeof i!="function"&&s.pointRadius(i),a):t},a.pointRadius=function(o){return arguments.length?(i=typeof o=="function"?o:(s.pointRadius(+o),+o),a):i},a.digits=function(o){if(!arguments.length)return n;if(o==null)n=null;else{const u=Math.floor(o);if(!(u>=0))throw new RangeError(`invalid digits: ${o}`);n=u}return t===null&&(s=new rT(n)),a},a.projection(e).digits(n).context(t)}function p1(e){return function(t){var n=new r2;for(var i in e)n[i]=e[i];return n.stream=t,n}}function r2(){}r2.prototype={constructor:r2,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function sS(e,t,n){var i=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),i!=null&&e.clipExtent(null),Ts(n,e.stream(A0)),t(A0.result()),i!=null&&e.clipExtent(i),e}function g1(e,t,n){return sS(e,function(i){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],a=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),o=+t[0][0]+(r-a*(i[1][0]+i[0][0]))/2,u=+t[0][1]+(s-a*(i[1][1]+i[0][1]))/2;e.scale(150*a).translate([o,u])},n)}function aS(e,t,n){return g1(e,[[0,0],t],n)}function oS(e,t,n){return sS(e,function(i){var r=+t,s=r/(i[1][0]-i[0][0]),a=(r-s*(i[1][0]+i[0][0]))/2,o=-s*i[0][1];e.scale(150*s).translate([a,o])},n)}function uS(e,t,n){return sS(e,function(i){var r=+t,s=r/(i[1][1]-i[0][1]),a=-s*i[0][0],o=(r-s*(i[1][1]+i[0][1]))/2;e.scale(150*s).translate([a,o])},n)}var sT=16,OZ=ce(30*_e);function aT(e,t){return+t?RZ(e,t):NZ(e)}function NZ(e){return p1({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function RZ(e,t){function n(i,r,s,a,o,u,l,c,f,h,d,p,g,m){var y=l-i,x=c-r,v=y*y+x*x;if(v>4*t&&g--){var b=a+h,w=o+d,E=u+p,_=On(b*b+w*w+E*E),k=Yn(E/=_),A=Te(Te(E)-1)<fe||Te(s-f)<fe?(s+f)/2:Di(w,b),T=e(A,k),$=T[0],R=T[1],O=$-i,F=R-r,C=x*O-y*F;(C*C/v>t||Te((y*O+x*F)/v-.5)>.3||a*h+o*d+u*p<OZ)&&(n(i,r,s,a,o,u,$,R,A,b/=_,w/=_,E,g,m),m.point($,R),n($,R,A,b,w,E,l,c,f,h,d,p,g,m))}}return function(i){var r,s,a,o,u,l,c,f,h,d,p,g,m={point:y,lineStart:x,lineEnd:b,polygonStart:function(){i.polygonStart(),m.lineStart=w},polygonEnd:function(){i.polygonEnd(),m.lineStart=x}};function y(k,A){k=e(k,A),i.point(k[0],k[1])}function x(){f=NaN,m.point=v,i.lineStart()}function v(k,A){var T=fu([k,A]),$=e(k,A);n(f,h,c,d,p,g,f=$[0],h=$[1],c=k,d=T[0],p=T[1],g=T[2],sT,i),i.point(f,h)}function b(){m.point=y,i.lineEnd()}function w(){x(),m.point=E,m.lineEnd=_}function E(k,A){v(r=k,A),s=f,a=h,o=d,u=p,l=g,m.point=v}function _(){n(f,h,c,d,p,g,s,a,r,o,u,l,sT,i),m.lineEnd=b,b()}return m}}var DZ=p1({point:function(e,t){this.stream.point(e*_e,t*_e)}});function IZ(e){return p1({point:function(t,n){var i=e(t,n);return this.stream.point(i[0],i[1])}})}function PZ(e,t,n,i,r){function s(a,o){return a*=i,o*=r,[t+e*a,n-e*o]}return s.invert=function(a,o){return[(a-t)/e*i,(n-o)/e*r]},s}function oT(e,t,n,i,r,s){if(!s)return PZ(e,t,n,i,r);var a=ce(s),o=ue(s),u=a*e,l=o*e,c=a/e,f=o/e,h=(o*n-a*t)/e,d=(o*t+a*n)/e;function p(g,m){return g*=i,m*=r,[u*g-l*m+t,n-l*g-u*m]}return p.invert=function(g,m){return[i*(c*g-f*m+h),r*(d-f*g-c*m)]},p}function us(e){return xP(function(){return e})()}function xP(e){var t,n=150,i=480,r=250,s=0,a=0,o=0,u=0,l=0,c,f=0,h=1,d=1,p=null,g=K3,m=null,y,x,v,b=Oh,w=.5,E,_,k,A,T;function $(C){return k(C[0]*_e,C[1]*_e)}function R(C){return C=k.invert(C[0],C[1]),C&&[C[0]*mt,C[1]*mt]}$.stream=function(C){return A&&T===C?A:A=DZ(IZ(c)(g(E(b(T=C)))))},$.preclip=function(C){return arguments.length?(g=C,p=void 0,F()):g},$.postclip=function(C){return arguments.length?(b=C,m=y=x=v=null,F()):b},$.clipAngle=function(C){return arguments.length?(g=+C?xZ(p=C*_e):(p=null,K3),F()):p*mt},$.clipExtent=function(C){return arguments.length?(b=C==null?(m=y=x=v=null,Oh):sP(m=+C[0][0],y=+C[0][1],x=+C[1][0],v=+C[1][1]),F()):m==null?null:[[m,y],[x,v]]},$.scale=function(C){return arguments.length?(n=+C,O()):n},$.translate=function(C){return arguments.length?(i=+C[0],r=+C[1],O()):[i,r]},$.center=function(C){return arguments.length?(s=C[0]%360*_e,a=C[1]%360*_e,O()):[s*mt,a*mt]},$.rotate=function(C){return arguments.length?(o=C[0]%360*_e,u=C[1]%360*_e,l=C.length>2?C[2]%360*_e:0,O()):[o*mt,u*mt,l*mt]},$.angle=function(C){return arguments.length?(f=C%360*_e,O()):f*mt},$.reflectX=function(C){return arguments.length?(h=C?-1:1,O()):h<0},$.reflectY=function(C){return arguments.length?(d=C?-1:1,O()):d<0},$.precision=function(C){return arguments.length?(E=aT(_,w=C*C),F()):On(w)},$.fitExtent=function(C,M){return g1($,C,M)},$.fitSize=function(C,M){return aS($,C,M)},$.fitWidth=function(C,M){return oS($,C,M)},$.fitHeight=function(C,M){return uS($,C,M)};function O(){var C=oT(n,0,0,h,d,f).apply(null,t(s,a)),M=oT(n,i-C[0],r-C[1],h,d,f);return c=tP(o,u,l),_=Yb(t,M),k=Yb(c,_),E=aT(_,w),F()}function F(){return A=T=null,$}return function(){return t=e.apply(this,arguments),$.invert=t.invert&&R,O()}}function lS(e){var t=0,n=Se/3,i=xP(e),r=i(t,n);return r.parallels=function(s){return arguments.length?i(t=s[0]*_e,n=s[1]*_e):[t*mt,n*mt]},r}function LZ(e){var t=ce(e);function n(i,r){return[i*t,ue(r)/t]}return n.invert=function(i,r){return[i/t,Yn(r*t)]},n}function zZ(e,t){var n=ue(e),i=(n+ue(t))/2;if(Te(i)<fe)return LZ(e);var r=1+n*(2*i-n),s=On(r)/i;function a(o,u){var l=On(r-2*i*ue(u))/i;return[l*ue(o*=i),s-l*ce(o)]}return a.invert=function(o,u){var l=s-u,c=Di(o,Te(l))*Ai(l);return l*i<0&&(c-=Se*Ai(o)*Ai(l)),[c/i,Yn((r-(o*o+l*l)*i*i)/(2*i))]},a}function F0(){return lS(zZ).scale(155.424).center([0,33.6442])}function vP(){return F0().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function BZ(e){var t=e.length;return{point:function(n,i){for(var r=-1;++r<t;)e[r].point(n,i)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function UZ(){var e,t,n=vP(),i,r=F0().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,a=F0().rotate([157,0]).center([-3,19.9]).parallels([8,18]),o,u,l={point:function(h,d){u=[h,d]}};function c(h){var d=h[0],p=h[1];return u=null,i.point(d,p),u||(s.point(d,p),u)||(o.point(d,p),u)}c.invert=function(h){var d=n.scale(),p=n.translate(),g=(h[0]-p[0])/d,m=(h[1]-p[1])/d;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?r:m>=.166&&m<.234&&g>=-.214&&g<-.115?a:n).invert(h)},c.stream=function(h){return e&&t===h?e:e=BZ([n.stream(t=h),r.stream(h),a.stream(h)])},c.precision=function(h){return arguments.length?(n.precision(h),r.precision(h),a.precision(h),f()):n.precision()},c.scale=function(h){return arguments.length?(n.scale(h),r.scale(h*.35),a.scale(h),c.translate(n.translate())):n.scale()},c.translate=function(h){if(!arguments.length)return n.translate();var d=n.scale(),p=+h[0],g=+h[1];return i=n.translate(h).clipExtent([[p-.455*d,g-.238*d],[p+.455*d,g+.238*d]]).stream(l),s=r.translate([p-.307*d,g+.201*d]).clipExtent([[p-.425*d+fe,g+.12*d+fe],[p-.214*d-fe,g+.234*d-fe]]).stream(l),o=a.translate([p-.205*d,g+.212*d]).clipExtent([[p-.214*d+fe,g+.166*d+fe],[p-.115*d-fe,g+.234*d-fe]]).stream(l),f()},c.fitExtent=function(h,d){return g1(c,h,d)},c.fitSize=function(h,d){return aS(c,h,d)},c.fitWidth=function(h,d){return oS(c,h,d)},c.fitHeight=function(h,d){return uS(c,h,d)};function f(){return e=t=null,c}return c.scale(1070)}function bP(e){return function(t,n){var i=ce(t),r=ce(n),s=e(i*r);return s===1/0?[2,0]:[s*r*ue(t),s*ue(n)]}}function $d(e){return function(t,n){var i=On(t*t+n*n),r=e(i),s=ue(r),a=ce(r);return[Di(t*s,i*a),Yn(i&&n*s/i)]}}var wP=bP(function(e){return On(2/(1+e))});wP.invert=$d(function(e){return 2*Yn(e/2)});function jZ(){return us(wP).scale(124.75).clipAngle(180-.001)}var _P=bP(function(e){return(e=V6(e))&&e/ue(e)});_P.invert=$d(function(e){return e});function qZ(){return us(_P).scale(79.4188).clipAngle(180-.001)}function m1(e,t){return[e,f0(iS((ht+t)/2))]}m1.invert=function(e,t){return[e,2*Oc(q6(t))-ht]};function VZ(){return EP(m1).scale(961/Mn)}function EP(e){var t=us(e),n=t.center,i=t.scale,r=t.translate,s=t.clipExtent,a=null,o,u,l;t.scale=function(f){return arguments.length?(i(f),c()):i()},t.translate=function(f){return arguments.length?(r(f),c()):r()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?a=o=u=l=null:(a=+f[0][0],o=+f[0][1],u=+f[1][0],l=+f[1][1]),c()):a==null?null:[[a,o],[u,l]]};function c(){var f=Se*i(),h=t(cZ(t.rotate()).invert([0,0]));return s(a==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===m1?[[Math.max(h[0]-f,a),o],[Math.min(h[0]+f,u),l]]:[[a,Math.max(h[1]-f,o)],[u,Math.min(h[1]+f,l)]])}return c()}function Tp(e){return iS((ht+e)/2)}function WZ(e,t){var n=ce(e),i=e===t?ue(e):f0(n/ce(t))/f0(Tp(t)/Tp(e)),r=n*_x(Tp(e),i)/i;if(!i)return m1;function s(a,o){r>0?o<-ht+fe&&(o=-ht+fe):o>ht-fe&&(o=ht-fe);var u=r/_x(Tp(o),i);return[u*ue(i*a),r-u*ce(i*a)]}return s.invert=function(a,o){var u=r-o,l=Ai(i)*On(a*a+u*u),c=Di(a,Te(u))*Ai(u);return u*i<0&&(c-=Se*Ai(a)*Ai(u)),[c/i,2*Oc(_x(r/l,1/i))-ht]},s}function HZ(){return lS(WZ).scale(109.5).parallels([30,30])}function M0(e,t){return[e,t]}M0.invert=M0;function GZ(){return us(M0).scale(152.63)}function YZ(e,t){var n=ce(e),i=e===t?ue(e):(n-ce(t))/(t-e),r=n/i+e;if(Te(i)<fe)return M0;function s(a,o){var u=r-o,l=i*a;return[u*ue(l),r-u*ce(l)]}return s.invert=function(a,o){var u=r-o,l=Di(a,Te(u))*Ai(u);return u*i<0&&(l-=Se*Ai(a)*Ai(u)),[l/i,r-Ai(i)*On(a*a+u*u)]},s}function XZ(){return lS(YZ).scale(131.154).center([0,13.9389])}var oh=1.340264,uh=-.081106,lh=893e-6,ch=.003796,O0=On(3)/2,KZ=12;function SP(e,t){var n=Yn(O0*ue(t)),i=n*n,r=i*i*i;return[e*ce(n)/(O0*(oh+3*uh*i+r*(7*lh+9*ch*i))),n*(oh+uh*i+r*(lh+ch*i))]}SP.invert=function(e,t){for(var n=t,i=n*n,r=i*i*i,s=0,a,o,u;s<KZ&&(o=n*(oh+uh*i+r*(lh+ch*i))-t,u=oh+3*uh*i+r*(7*lh+9*ch*i),n-=a=o/u,i=n*n,r=i*i*i,!(Te(a)<Lb));++s);return[O0*e*(oh+3*uh*i+r*(7*lh+9*ch*i))/ce(n),Yn(ue(n)/O0)]};function QZ(){return us(SP).scale(177.158)}function kP(e,t){var n=ce(t),i=ce(e)*n;return[n*ue(e)/i,ue(t)/i]}kP.invert=$d(Oc);function JZ(){return us(kP).scale(144.049).clipAngle(60)}function ZZ(){var e=1,t=0,n=0,i=1,r=1,s=0,a,o,u=null,l,c,f,h=1,d=1,p=p1({point:function(b,w){var E=v([b,w]);this.stream.point(E[0],E[1])}}),g=Oh,m,y;function x(){return h=e*i,d=e*r,m=y=null,v}function v(b){var w=b[0]*h,E=b[1]*d;if(s){var _=E*a-w*o;w=w*a+E*o,E=_}return[w+t,E+n]}return v.invert=function(b){var w=b[0]-t,E=b[1]-n;if(s){var _=E*a+w*o;w=w*a-E*o,E=_}return[w/h,E/d]},v.stream=function(b){return m&&y===b?m:m=p(g(y=b))},v.postclip=function(b){return arguments.length?(g=b,u=l=c=f=null,x()):g},v.clipExtent=function(b){return arguments.length?(g=b==null?(u=l=c=f=null,Oh):sP(u=+b[0][0],l=+b[0][1],c=+b[1][0],f=+b[1][1]),x()):u==null?null:[[u,l],[c,f]]},v.scale=function(b){return arguments.length?(e=+b,x()):e},v.translate=function(b){return arguments.length?(t=+b[0],n=+b[1],x()):[t,n]},v.angle=function(b){return arguments.length?(s=b%360*_e,o=ue(s),a=ce(s),x()):s*mt},v.reflectX=function(b){return arguments.length?(i=b?-1:1,x()):i<0},v.reflectY=function(b){return arguments.length?(r=b?-1:1,x()):r<0},v.fitExtent=function(b,w){return g1(v,b,w)},v.fitSize=function(b,w){return aS(v,b,w)},v.fitWidth=function(b,w){return oS(v,b,w)},v.fitHeight=function(b,w){return uS(v,b,w)},v}function AP(e,t){var n=t*t,i=n*n;return[e*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),t*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}AP.invert=function(e,t){var n=t,i=25,r;do{var s=n*n,a=s*s;n-=r=(n*(1.007226+s*(.015085+a*(-.044475+.028874*s-.005916*a)))-t)/(1.007226+s*(.015085*3+a*(-.044475*7+.028874*9*s-.005916*11*a)))}while(Te(r)>fe&&--i>0);return[e/(.8707+(s=n*n)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),n]};function eee(){return us(AP).scale(175.295)}function CP(e,t){return[ce(t)*ue(e),ue(t)]}CP.invert=$d(Yn);function tee(){return us(CP).scale(249.5).clipAngle(90+fe)}function $P(e,t){var n=ce(t),i=1+ce(e)*n;return[n*ue(e)/i,ue(t)/i]}$P.invert=$d(function(e){return 2*Oc(e)});function nee(){return us($P).scale(250).clipAngle(142)}function TP(e,t){return[f0(iS((ht+t)/2)),-e]}TP.invert=function(e,t){return[-t,2*Oc(q6(e))-ht]};function iee(){var e=EP(TP),t=e.center,n=e.rotate;return e.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},e.rotate=function(i){return arguments.length?n([i[0],i[1],i.length>2?i[2]+90:90]):(i=n(),[i[0],i[1],i[2]-90])},n([0,0,90]).scale(159.155)}var ree=Math.abs,s2=Math.cos,N0=Math.sin,see=1e-6,FP=Math.PI,a2=FP/2,uT=aee(2);function lT(e){return e>1?a2:e<-1?-a2:Math.asin(e)}function aee(e){return e>0?Math.sqrt(e):0}function oee(e,t){var n=e*N0(t),i=30,r;do t-=r=(t+N0(t)-n)/(1+s2(t));while(ree(r)>see&&--i>0);return t/2}function uee(e,t,n){function i(r,s){return[e*r*s2(s=oee(n,s)),t*N0(s)]}return i.invert=function(r,s){return s=lT(s/t),[r/(e*s2(s)),lT((2*s+N0(2*s))/n)]},i}var lee=uee(uT/a2,uT,FP);function cee(){return us(lee).scale(169.529)}const fee=yP(),o2=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function hee(e,t){return function n(){const i=t();return i.type=e,i.path=yP().projection(i),i.copy=i.copy||function(){const r=n();return o2.forEach(s=>{i[s]&&r[s](i[s]())}),r.path.pointRadius(i.path.pointRadius()),r},WI(i)}}function cS(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(R0[e]=hee(e,t),this):R0[e]||null}function MP(e){return e&&e.path||fee}const R0={albers:vP,albersusa:UZ,azimuthalequalarea:jZ,azimuthalequidistant:qZ,conicconformal:HZ,conicequalarea:F0,conicequidistant:XZ,equalEarth:QZ,equirectangular:GZ,gnomonic:JZ,identity:ZZ,mercator:VZ,mollweide:cee,naturalEarth1:eee,orthographic:tee,stereographic:nee,transversemercator:iee};for(const e in R0)cS(e,R0[e]);function dee(){}const bs=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function OP(){var e=1,t=1,n=o;function i(u,l){return l.map(c=>r(u,c))}function r(u,l){var c=[],f=[];return s(u,l,h=>{n(h,u,l),pee(h)>0?c.push([h]):f.push(h)}),f.forEach(h=>{for(var d=0,p=c.length,g;d<p;++d)if(gee((g=c[d])[0],h)!==-1){g.push(h);return}}),{type:"MultiPolygon",value:l,coordinates:c}}function s(u,l,c){var f=[],h=[],d,p,g,m,y,x;for(d=p=-1,m=u[0]>=l,bs[m<<1].forEach(v);++d<e-1;)g=m,m=u[d+1]>=l,bs[g|m<<1].forEach(v);for(bs[m<<0].forEach(v);++p<t-1;){for(d=-1,m=u[p*e+e]>=l,y=u[p*e]>=l,bs[m<<1|y<<2].forEach(v);++d<e-1;)g=m,m=u[p*e+e+d+1]>=l,x=y,y=u[p*e+d+1]>=l,bs[g|m<<1|y<<2|x<<3].forEach(v);bs[m|y<<3].forEach(v)}for(d=-1,y=u[p*e]>=l,bs[y<<2].forEach(v);++d<e-1;)x=y,y=u[p*e+d+1]>=l,bs[y<<2|x<<3].forEach(v);bs[y<<3].forEach(v);function v(b){var w=[b[0][0]+d,b[0][1]+p],E=[b[1][0]+d,b[1][1]+p],_=a(w),k=a(E),A,T;(A=h[_])?(T=f[k])?(delete h[A.end],delete f[T.start],A===T?(A.ring.push(E),c(A.ring)):f[A.start]=h[T.end]={start:A.start,end:T.end,ring:A.ring.concat(T.ring)}):(delete h[A.end],A.ring.push(E),h[A.end=k]=A):(A=f[k])?(T=h[_])?(delete f[A.start],delete h[T.end],A===T?(A.ring.push(E),c(A.ring)):f[T.start]=h[A.end]={start:T.start,end:A.end,ring:T.ring.concat(A.ring)}):(delete f[A.start],A.ring.unshift(w),f[A.start=_]=A):f[_]=h[k]={start:_,end:k,ring:[w,E]}}}function a(u){return u[0]*2+u[1]*(e+1)*4}function o(u,l,c){u.forEach(f=>{var h=f[0],d=f[1],p=h|0,g=d|0,m,y=l[g*e+p];h>0&&h<e&&p===h&&(m=l[g*e+p-1],f[0]=h+(c-m)/(y-m)-.5),d>0&&d<t&&g===d&&(m=l[(g-1)*e+p],f[1]=d+(c-m)/(y-m)-.5)})}return i.contour=r,i.size=function(u){if(!arguments.length)return[e,t];var l=Math.floor(u[0]),c=Math.floor(u[1]);return l>=0&&c>=0||P("invalid size"),e=l,t=c,i},i.smooth=function(u){return arguments.length?(n=u?o:dee,i):n===o},i}function pee(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}function gee(e,t){for(var n=-1,i=t.length,r;++n<i;)if(r=mee(e,t[n]))return r;return 0}function mee(e,t){for(var n=t[0],i=t[1],r=-1,s=0,a=e.length,o=a-1;s<a;o=s++){var u=e[s],l=u[0],c=u[1],f=e[o],h=f[0],d=f[1];if(yee(u,f,t))return 0;c>i!=d>i&&n<(h-l)*(i-c)/(d-c)+l&&(r=-r)}return r}function yee(e,t,n){var i;return xee(e,t,n)&&vee(e[i=+(e[0]===t[0])],n[i],t[i])}function xee(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function vee(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function NP(e,t,n){return function(i){var r=Yr(i),s=n?Math.min(r[0],0):r[0],a=r[1],o=a-s,u=t?qa(s,a,e):o/(e+1);return si(s+u,a,u)}}function fS(e){N.call(this,null,e)}fS.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};Y(fS,N,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=e.field||yn,s=OP().smooth(e.smooth!==!1),a=e.thresholds||bee(i,r,e),o=e.as===null?null:e.as||"contour",u=[];return i.forEach(l=>{const c=r(l),f=s.size([c.width,c.height])(c.values,L(a)?a:a(c.values));wee(f,c,l,e),f.forEach(h=>{u.push(Nm(l,ze(o!=null?{[o]:h}:h)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function bee(e,t,n){const i=NP(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?i:i(e.map(r=>Ko(t(r).values)))}function wee(e,t,n,i){let r=i.scale||t.scale,s=i.translate||t.translate;if(we(r)&&(r=r(n,i)),we(s)&&(s=s(n,i)),(r===1||r==null)&&!s)return;const a=(Ie(r)?r:r[0])||1,o=(Ie(r)?r:r[1])||1,u=s&&s[0]||0,l=s&&s[1]||0;e.forEach(RP(t,a,o,u,l))}function RP(e,t,n,i,r){const s=e.x1||0,a=e.y1||0,o=t*n<0;function u(f){f.forEach(l)}function l(f){o&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-s)*t+i,f[1]=(f[1]-a)*n+r}return function(f){return f.coordinates.forEach(u),f}}function cT(e,t,n){const i=e>=0?e:i_(t,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function Cx(e){return we(e)?e:xn(+e)}function DP(){var e=u=>u[0],t=u=>u[1],n=xc,i=[-1,-1],r=960,s=500,a=2;function o(u,l){const c=cT(i[0],u,e)>>a,f=cT(i[1],u,t)>>a,h=c?c+2:0,d=f?f+2:0,p=2*h+(r>>a),g=2*d+(s>>a),m=new Float32Array(p*g),y=new Float32Array(p*g);let x=m;u.forEach(b=>{const w=h+(+e(b)>>a),E=d+(+t(b)>>a);w>=0&&w<p&&E>=0&&E<g&&(m[w+E*p]+=+n(b))}),c>0&&f>0?(el(p,g,m,y,c),tl(p,g,y,m,f),el(p,g,m,y,c),tl(p,g,y,m,f),el(p,g,m,y,c),tl(p,g,y,m,f)):c>0?(el(p,g,m,y,c),el(p,g,y,m,c),el(p,g,m,y,c),x=y):f>0&&(tl(p,g,m,y,f),tl(p,g,y,m,f),tl(p,g,m,y,f),x=y);const v=l?Math.pow(2,-2*a):1/XN(x);for(let b=0,w=p*g;b<w;++b)x[b]*=v;return{values:x,scale:1<<a,width:p,height:g,x1:h,y1:d,x2:h+(r>>a),y2:d+(s>>a)}}return o.x=function(u){return arguments.length?(e=Cx(u),o):e},o.y=function(u){return arguments.length?(t=Cx(u),o):t},o.weight=function(u){return arguments.length?(n=Cx(u),o):n},o.size=function(u){if(!arguments.length)return[r,s];var l=+u[0],c=+u[1];return l>=0&&c>=0||P("invalid size"),r=l,s=c,o},o.cellSize=function(u){return arguments.length?((u=+u)>=1||P("invalid cell size"),a=Math.floor(Math.log(u)/Math.LN2),o):1<<a},o.bandwidth=function(u){return arguments.length?(u=Q(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&P("invalid bandwidth"),i=u,o):i},o}function el(e,t,n,i,r){const s=(r<<1)+1;for(let a=0;a<t;++a)for(let o=0,u=0;o<e+r;++o)o<e&&(u+=n[o+a*e]),o>=r&&(o>=s&&(u-=n[o-s+a*e]),i[o-r+a*e]=u/Math.min(o+1,e-1+s-o,s))}function tl(e,t,n,i,r){const s=(r<<1)+1;for(let a=0;a<e;++a)for(let o=0,u=0;o<t+r;++o)o<t&&(u+=n[a+o*e]),o>=r&&(o>=s&&(u-=n[a+(o-s)*e]),i[a+(o-r)*e]=u/Math.min(o+1,t-1+s-o,s))}function hS(e){N.call(this,null,e)}hS.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const _ee=["x","y","weight","size","cellSize","bandwidth"];function IP(e,t){return _ee.forEach(n=>t[n]!=null?e[n](t[n]):0),e}Y(hS,N,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=t.materialize(t.SOURCE).source,r=Eee(i,e.groupby),s=(e.groupby||[]).map(dt),a=IP(DP(),e),o=e.as||"grid",u=[];function l(c,f){for(let h=0;h<s.length;++h)c[s[h]]=f[h];return c}return u=r.map(c=>ze(l({[o]:a(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function Eee(e,t){var n=[],i=c=>c(o),r,s,a,o,u,l;if(t==null)n.push(e);else for(r={},s=0,a=e.length;s<a;++s)o=e[s],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(o);return n}function dS(e){N.call(this,null,e)}dS.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};Y(dS,N,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=OP().smooth(e.smooth!==!1),r=e.values,s=e.thresholds||NP(e.count||10,e.nice,!!r),a=e.size,o,u;return r||(r=t.materialize(t.SOURCE).source,o=IP(DP(),e)(r,!0),u=RP(o,o.scale||1,o.scale||1,0,0),a=[o.width,o.height],r=o.values),s=L(s)?s:s(r),r=i.size(a)(r,s),u&&r.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(r||[]).map(ze),n}});const u2="Feature",pS="FeatureCollection",See="MultiPoint";function gS(e){N.call(this,null,e)}gS.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};Y(gS,N,{transform(e,t){var n=this._features,i=this._points,r=e.fields,s=r&&r[0],a=r&&r[1],o=e.geojson||!r&&yn,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(dn(o))||s&&t.modified(dn(s))||a&&t.modified(dn(a)),(!this.value||l)&&(u=t.SOURCE,this._features=n=[],this._points=i=[]),o&&t.visit(u,c=>n.push(o(c))),s&&a&&(t.visit(u,c=>{var f=s(c),h=a(c);f!=null&&h!=null&&(f=+f)===f&&(h=+h)===h&&i.push([f,h])}),n=n.concat({type:u2,geometry:{type:See,coordinates:i}})),this.value={type:pS,features:n}}});function mS(e){N.call(this,null,e)}mS.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};Y(mS,N,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.field||yn,s=e.as||"path",a=n.SOURCE;!i||e.modified()?(this.value=i=MP(e.projection),n.materialize().reflow()):a=r===yn||t.modified(r.fields)?n.ADD_MOD:n.ADD;const o=kee(i,e.pointRadius);return n.visit(a,u=>u[s]=i(r(u))),i.pointRadius(o),n.modifies(s)}});function kee(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function yS(e){N.call(this,null,e)}yS.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};Y(yS,N,{transform(e,t){var n=e.projection,i=e.fields[0],r=e.fields[1],s=e.as||["x","y"],a=s[0],o=s[1],u;function l(c){const f=n([i(c),r(c)]);f?(c[a]=f[0],c[o]=f[1]):(c[a]=void 0,c[o]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(u=t.modified(i.fields)||t.modified(r.fields),t.visit(u?t.ADD_MOD:t.ADD,l)),t.modifies(s)}});function xS(e){N.call(this,null,e)}xS.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};Y(xS,N,{transform(e,t){var n=t.fork(t.ALL),i=this.value,r=e.as||"shape",s=n.ADD;return(!i||e.modified())&&(this.value=i=Aee(MP(e.projection),e.field||Mi("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,a=>a[r]=i),n.modifies(r)}});function Aee(e,t,n){const i=n==null?r=>e(t(r)):r=>{var s=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(s),a};return i.context=r=>(e.context(r),i),i}function vS(e){N.call(this,[],e),this.generator=bZ()}vS.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};Y(vS,N,{transform(e,t){var n=this.value,i=this.generator,r;if(!n.length||e.modified())for(const s in e)we(i[s])&&i[s](e[s]);return r=i(),n.length?t.mod.push(VR(n[0],r)):t.add.push(ze(r)),n[0]=r,t}});function bS(e){N.call(this,null,e)}bS.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};Y(bS,N,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,i=e.resolve==="shared",r=e.field||yn,s=$ee(e.opacity,e),a=Cee(e.color,e),o=e.as||"image",u={$x:0,$y:0,$value:0,$max:i?Ko(n.map(l=>Ko(r(l).values))):0};return n.forEach(l=>{const c=r(l),f=ve({},l,u);i||(f.$max=Ko(c.values||[])),l[o]=Tee(c,f,a.dep?a:xn(a(f)),s.dep?s:xn(s(f)))}),t.reflow(!0).modifies(o)}});function Cee(e,t){let n;return we(e)?(n=i=>Ha(e(i,t)),n.dep=PP(e)):n=xn(Ha(e||"#888")),n}function $ee(e,t){let n;return we(e)?(n=i=>e(i,t),n.dep=PP(e)):e?n=xn(e):(n=i=>i.$value/i.$max||0,n.dep=!0),n}function PP(e){if(!we(e))return!1;const t=ur(dn(e));return t.$x||t.$y||t.$value||t.$max}function Tee(e,t,n,i){const r=e.width,s=e.height,a=e.x1||0,o=e.y1||0,u=e.x2||r,l=e.y2||s,c=e.values,f=c?m=>c[m]:Ea,h=La(u-a,l-o),d=h.getContext("2d"),p=d.getImageData(0,0,u-a,l-o),g=p.data;for(let m=o,y=0;m<l;++m){t.$y=m-o;for(let x=a,v=m*r;x<u;++x,y+=4){t.$x=x-a,t.$value=f(x+v);const b=n(t);g[y+0]=b.r,g[y+1]=b.g,g[y+2]=b.b,g[y+3]=~~(255*i(t))}}return d.putImageData(p,0,0),h}function LP(e){N.call(this,null,e),this.modified(!0)}Y(LP,N,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=Mee(e.type),o2.forEach(i=>{e[i]!=null&&fT(n,i,e[i])})):o2.forEach(i=>{e.modified(i)&&fT(n,i,e[i])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&Fee(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Fee(e,t){const n=Oee(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function Mee(e){const t=cS((e||"mercator").toLowerCase());return t||P("Unrecognized projection type: "+e),t()}function fT(e,t,n){we(e[t])&&e[t](n)}function Oee(e){return e=Q(e),e.length===1?e[0]:{type:pS,features:e.reduce((t,n)=>t.concat(Nee(n)),[])}}function Nee(e){return e.type===pS?e.features:Q(e).filter(t=>t!=null).map(t=>t.type===u2?t:{type:u2,geometry:t})}const Ree=Object.freeze(Object.defineProperty({__proto__:null,contour:dS,geojson:gS,geopath:mS,geopoint:yS,geoshape:xS,graticule:vS,heatmap:bS,isocontour:fS,kde2d:hS,projection:LP},Symbol.toStringTag,{value:"Module"}));function Dee(e,t){var n,i=1;e==null&&(e=0),t==null&&(t=0);function r(){var s,a=n.length,o,u=0,l=0;for(s=0;s<a;++s)o=n[s],u+=o.x,l+=o.y;for(u=(u/a-e)*i,l=(l/a-t)*i,s=0;s<a;++s)o=n[s],o.x-=u,o.y-=l}return r.initialize=function(s){n=s},r.x=function(s){return arguments.length?(e=+s,r):e},r.y=function(s){return arguments.length?(t=+s,r):t},r.strength=function(s){return arguments.length?(i=+s,r):i},r}function Iee(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return zP(this.cover(t,n),t,n,e)}function zP(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,s=e._root,a={data:i},o=e._x0,u=e._y0,l=e._x1,c=e._y1,f,h,d,p,g,m,y,x;if(!s)return e._root=a,e;for(;s.length;)if((g=t>=(f=(o+l)/2))?o=f:l=f,(m=n>=(h=(u+c)/2))?u=h:c=h,r=s,!(s=s[y=m<<1|g]))return r[y]=a,e;if(d=+e._x.call(null,s.data),p=+e._y.call(null,s.data),t===d&&n===p)return a.next=s,r?r[y]=a:e._root=a,e;do r=r?r[y]=new Array(4):e._root=new Array(4),(g=t>=(f=(o+l)/2))?o=f:l=f,(m=n>=(h=(u+c)/2))?u=h:c=h;while((y=m<<1|g)===(x=(p>=h)<<1|d>=f));return r[x]=s,r[y]=a,e}function Pee(e){var t,n,i=e.length,r,s,a=new Array(i),o=new Array(i),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(s=+this._y.call(null,t))||(a[n]=r,o[n]=s,r<u&&(u=r),r>c&&(c=r),s<l&&(l=s),s>f&&(f=s));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<i;++n)zP(this,a[n],o[n],e[n]);return this}function Lee(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,s=(i=Math.floor(t))+1;else{for(var a=r-n||1,o=this._root,u,l;n>e||e>=r||i>t||t>=s;)switch(l=(t<i)<<1|e<n,u=new Array(4),u[l]=o,o=u,a*=2,l){case 0:r=n+a,s=i+a;break;case 1:n=r-a,s=i+a;break;case 2:r=n+a,i=s-a;break;case 3:n=r-a,i=s-a;break}this._root&&this._root.length&&(this._root=o)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function zee(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function Bee(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function An(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function Uee(e,t,n){var i,r=this._x0,s=this._y0,a,o,u,l,c=this._x1,f=this._y1,h=[],d=this._root,p,g;for(d&&h.push(new An(d,r,s,c,f)),n==null?n=1/0:(r=e-n,s=t-n,c=e+n,f=t+n,n*=n);p=h.pop();)if(!(!(d=p.node)||(a=p.x0)>c||(o=p.y0)>f||(u=p.x1)<r||(l=p.y1)<s))if(d.length){var m=(a+u)/2,y=(o+l)/2;h.push(new An(d[3],m,y,u,l),new An(d[2],a,y,m,l),new An(d[1],m,o,u,y),new An(d[0],a,o,m,y)),(g=(t>=y)<<1|e>=m)&&(p=h[h.length-1],h[h.length-1]=h[h.length-1-g],h[h.length-1-g]=p)}else{var x=e-+this._x.call(null,d.data),v=t-+this._y.call(null,d.data),b=x*x+v*v;if(b<n){var w=Math.sqrt(n=b);r=e-w,s=t-w,c=e+w,f=t+w,i=d.data}}return i}function jee(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,s,a=this._x0,o=this._y0,u=this._x1,l=this._y1,c,f,h,d,p,g,m,y;if(!n)return this;if(n.length)for(;;){if((p=c>=(h=(a+u)/2))?a=h:u=h,(g=f>=(d=(o+l)/2))?o=d:l=d,t=n,!(n=n[m=g<<1|p]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(i=t,y=m)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):t?(s?t[m]=s:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[y]=n:this._root=n),this):(this._root=s,this)}function qee(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function Vee(){return this._root}function Wee(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function Hee(e){var t=[],n,i=this._root,r,s,a,o,u;for(i&&t.push(new An(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,s=n.x0,a=n.y0,o=n.x1,u=n.y1)&&i.length){var l=(s+o)/2,c=(a+u)/2;(r=i[3])&&t.push(new An(r,l,c,o,u)),(r=i[2])&&t.push(new An(r,s,c,l,u)),(r=i[1])&&t.push(new An(r,l,a,o,c)),(r=i[0])&&t.push(new An(r,s,a,l,c))}return this}function Gee(e){var t=[],n=[],i;for(this._root&&t.push(new An(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var s,a=i.x0,o=i.y0,u=i.x1,l=i.y1,c=(a+u)/2,f=(o+l)/2;(s=r[0])&&t.push(new An(s,a,o,c,f)),(s=r[1])&&t.push(new An(s,c,o,u,f)),(s=r[2])&&t.push(new An(s,a,f,c,l)),(s=r[3])&&t.push(new An(s,c,f,u,l))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function Yee(e){return e[0]}function Xee(e){return arguments.length?(this._x=e,this):this._x}function Kee(e){return e[1]}function Qee(e){return arguments.length?(this._y=e,this):this._y}function wS(e,t,n){var i=new _S(t??Yee,n??Kee,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function _S(e,t,n,i,r,s){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function hT(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var Rn=wS.prototype=_S.prototype;Rn.copy=function(){var e=new _S(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=hT(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=hT(i));return e};Rn.add=Iee;Rn.addAll=Pee;Rn.cover=Lee;Rn.data=zee;Rn.extent=Bee;Rn.find=Uee;Rn.remove=jee;Rn.removeAll=qee;Rn.root=Vee;Rn.size=Wee;Rn.visit=Hee;Rn.visitAfter=Gee;Rn.x=Xee;Rn.y=Qee;function Cn(e){return function(){return e}}function Fa(e){return(e()-.5)*1e-6}function Jee(e){return e.x+e.vx}function Zee(e){return e.y+e.vy}function ete(e){var t,n,i,r=1,s=1;typeof e!="function"&&(e=Cn(e==null?1:+e));function a(){for(var l,c=t.length,f,h,d,p,g,m,y=0;y<s;++y)for(f=wS(t,Jee,Zee).visitAfter(o),l=0;l<c;++l)h=t[l],g=n[h.index],m=g*g,d=h.x+h.vx,p=h.y+h.vy,f.visit(x);function x(v,b,w,E,_){var k=v.data,A=v.r,T=g+A;if(k){if(k.index>h.index){var $=d-k.x-k.vx,R=p-k.y-k.vy,O=$*$+R*R;O<T*T&&($===0&&($=Fa(i),O+=$*$),R===0&&(R=Fa(i),O+=R*R),O=(T-(O=Math.sqrt(O)))/O*r,h.vx+=($*=O)*(T=(A*=A)/(m+A)),h.vy+=(R*=O)*T,k.vx-=$*(T=1-T),k.vy-=R*T)}return}return b>d+T||E<d-T||w>p+T||_<p-T}}function o(l){if(l.data)return l.r=n[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function u(){if(t){var l,c=t.length,f;for(n=new Array(c),l=0;l<c;++l)f=t[l],n[f.index]=+e(f,l,t)}}return a.initialize=function(l,c){t=l,i=c,u()},a.iterations=function(l){return arguments.length?(s=+l,a):s},a.strength=function(l){return arguments.length?(r=+l,a):r},a.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Cn(+l),u(),a):e},a}function tte(e){return e.index}function dT(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function nte(e){var t=tte,n=f,i,r=Cn(30),s,a,o,u,l,c=1;e==null&&(e=[]);function f(m){return 1/Math.min(o[m.source.index],o[m.target.index])}function h(m){for(var y=0,x=e.length;y<c;++y)for(var v=0,b,w,E,_,k,A,T;v<x;++v)b=e[v],w=b.source,E=b.target,_=E.x+E.vx-w.x-w.vx||Fa(l),k=E.y+E.vy-w.y-w.vy||Fa(l),A=Math.sqrt(_*_+k*k),A=(A-s[v])/A*m*i[v],_*=A,k*=A,E.vx-=_*(T=u[v]),E.vy-=k*T,w.vx+=_*(T=1-T),w.vy+=k*T}function d(){if(a){var m,y=a.length,x=e.length,v=new Map(a.map((w,E)=>[t(w,E,a),w])),b;for(m=0,o=new Array(y);m<x;++m)b=e[m],b.index=m,typeof b.source!="object"&&(b.source=dT(v,b.source)),typeof b.target!="object"&&(b.target=dT(v,b.target)),o[b.source.index]=(o[b.source.index]||0)+1,o[b.target.index]=(o[b.target.index]||0)+1;for(m=0,u=new Array(x);m<x;++m)b=e[m],u[m]=o[b.source.index]/(o[b.source.index]+o[b.target.index]);i=new Array(x),p(),s=new Array(x),g()}}function p(){if(a)for(var m=0,y=e.length;m<y;++m)i[m]=+n(e[m],m,e)}function g(){if(a)for(var m=0,y=e.length;m<y;++m)s[m]=+r(e[m],m,e)}return h.initialize=function(m,y){a=m,l=y,d()},h.links=function(m){return arguments.length?(e=m,d(),h):e},h.id=function(m){return arguments.length?(t=m,h):t},h.iterations=function(m){return arguments.length?(c=+m,h):c},h.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Cn(+m),p(),h):n},h.distance=function(m){return arguments.length?(r=typeof m=="function"?m:Cn(+m),g(),h):r},h}var ite={value:()=>{}};function BP(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new pg(n)}function pg(e){this._=e}function rte(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}pg.prototype=BP.prototype={constructor:pg,on:function(e,t){var n=this._,i=rte(e+"",n),r,s=-1,a=i.length;if(arguments.length<2){for(;++s<a;)if((r=(e=i[s]).type)&&(r=ste(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<a;)if(r=(e=i[s]).type)n[r]=pT(n[r],e.name,t);else if(t==null)for(r in n)n[r]=pT(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new pg(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],i=0,r=s.length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};function ste(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function pT(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=ite,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var Jl=0,Gf=0,yf=0,UP=1e3,D0,Yf,I0=0,du=0,y1=0,Dh=typeof performance=="object"&&performance.now?performance:Date,jP=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function ES(){return du||(jP(ate),du=Dh.now()+y1)}function ate(){du=0}function P0(){this._call=this._time=this._next=null}P0.prototype=qP.prototype={constructor:P0,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?ES():+n)+(t==null?0:+t),!this._next&&Yf!==this&&(Yf?Yf._next=this:D0=this,Yf=this),this._call=e,this._time=n,l2()},stop:function(){this._call&&(this._call=null,this._time=1/0,l2())}};function qP(e,t,n){var i=new P0;return i.restart(e,t,n),i}function ote(){ES(),++Jl;for(var e=D0,t;e;)(t=du-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Jl}function gT(){du=(I0=Dh.now())+y1,Jl=Gf=0;try{ote()}finally{Jl=0,lte(),du=0}}function ute(){var e=Dh.now(),t=e-I0;t>UP&&(y1-=t,I0=e)}function lte(){for(var e,t=D0,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:D0=n);Yf=e,l2(i)}function l2(e){if(!Jl){Gf&&(Gf=clearTimeout(Gf));var t=e-du;t>24?(e<1/0&&(Gf=setTimeout(gT,e-Dh.now()-y1)),yf&&(yf=clearInterval(yf))):(yf||(I0=Dh.now(),yf=setInterval(ute,UP)),Jl=1,jP(gT))}}function cte(e,t,n){var i=new P0,r=t;return t==null?(i.restart(e,t,n),i):(i._restart=i.restart,i.restart=function(s,a,o){a=+a,o=o==null?ES():+o,i._restart(function u(l){l+=r,i._restart(u,r+=a,o),s(l)},a,o)},i.restart(e,t,n),i)}const fte=1664525,hte=1013904223,mT=4294967296;function dte(){let e=1;return()=>(e=(fte*e+hte)%mT)/mT}function pte(e){return e.x}function gte(e){return e.y}var mte=10,yte=Math.PI*(3-Math.sqrt(5));function xte(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,a=.6,o=new Map,u=qP(f),l=BP("tick","end"),c=dte();e==null&&(e=[]);function f(){h(),l.call("tick",t),n<i&&(u.stop(),l.call("end",t))}function h(g){var m,y=e.length,x;g===void 0&&(g=1);for(var v=0;v<g;++v)for(n+=(s-n)*r,o.forEach(function(b){b(n)}),m=0;m<y;++m)x=e[m],x.fx==null?x.x+=x.vx*=a:(x.x=x.fx,x.vx=0),x.fy==null?x.y+=x.vy*=a:(x.y=x.fy,x.vy=0);return t}function d(){for(var g=0,m=e.length,y;g<m;++g){if(y=e[g],y.index=g,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var x=mte*Math.sqrt(.5+g),v=g*yte;y.x=x*Math.cos(v),y.y=x*Math.sin(v)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(g){return g.initialize&&g.initialize(e,c),g}return d(),t={tick:h,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(g){return arguments.length?(e=g,d(),o.forEach(p),t):e},alpha:function(g){return arguments.length?(n=+g,t):n},alphaMin:function(g){return arguments.length?(i=+g,t):i},alphaDecay:function(g){return arguments.length?(r=+g,t):+r},alphaTarget:function(g){return arguments.length?(s=+g,t):s},velocityDecay:function(g){return arguments.length?(a=1-g,t):1-a},randomSource:function(g){return arguments.length?(c=g,o.forEach(p),t):c},force:function(g,m){return arguments.length>1?(m==null?o.delete(g):o.set(g,p(m)),t):o.get(g)},find:function(g,m,y){var x=0,v=e.length,b,w,E,_,k;for(y==null?y=1/0:y*=y,x=0;x<v;++x)_=e[x],b=g-_.x,w=m-_.y,E=b*b+w*w,E<y&&(k=_,y=E);return k},on:function(g,m){return arguments.length>1?(l.on(g,m),t):l.on(g)}}}function vte(){var e,t,n,i,r=Cn(-30),s,a=1,o=1/0,u=.81;function l(d){var p,g=e.length,m=wS(e,pte,gte).visitAfter(f);for(i=d,p=0;p<g;++p)t=e[p],m.visit(h)}function c(){if(e){var d,p=e.length,g;for(s=new Array(p),d=0;d<p;++d)g=e[d],s[g.index]=+r(g,d,e)}}function f(d){var p=0,g,m,y=0,x,v,b;if(d.length){for(x=v=b=0;b<4;++b)(g=d[b])&&(m=Math.abs(g.value))&&(p+=g.value,y+=m,x+=m*g.x,v+=m*g.y);d.x=x/y,d.y=v/y}else{g=d,g.x=g.data.x,g.y=g.data.y;do p+=s[g.data.index];while(g=g.next)}d.value=p}function h(d,p,g,m){if(!d.value)return!0;var y=d.x-t.x,x=d.y-t.y,v=m-p,b=y*y+x*x;if(v*v/u<b)return b<o&&(y===0&&(y=Fa(n),b+=y*y),x===0&&(x=Fa(n),b+=x*x),b<a&&(b=Math.sqrt(a*b)),t.vx+=y*d.value*i/b,t.vy+=x*d.value*i/b),!0;if(d.length||b>=o)return;(d.data!==t||d.next)&&(y===0&&(y=Fa(n),b+=y*y),x===0&&(x=Fa(n),b+=x*x),b<a&&(b=Math.sqrt(a*b)));do d.data!==t&&(v=s[d.data.index]*i/b,t.vx+=y*v,t.vy+=x*v);while(d=d.next)}return l.initialize=function(d,p){e=d,n=p,c()},l.strength=function(d){return arguments.length?(r=typeof d=="function"?d:Cn(+d),c(),l):r},l.distanceMin=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.distanceMax=function(d){return arguments.length?(o=d*d,l):Math.sqrt(o)},l.theta=function(d){return arguments.length?(u=d*d,l):Math.sqrt(u)},l}function bte(e){var t=Cn(.1),n,i,r;typeof e!="function"&&(e=Cn(e==null?0:+e));function s(o){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vx+=(r[u]-c.x)*i[u]*o}function a(){if(n){var o,u=n.length;for(i=new Array(u),r=new Array(u),o=0;o<u;++o)i[o]=isNaN(r[o]=+e(n[o],o,n))?0:+t(n[o],o,n)}}return s.initialize=function(o){n=o,a()},s.strength=function(o){return arguments.length?(t=typeof o=="function"?o:Cn(+o),a(),s):t},s.x=function(o){return arguments.length?(e=typeof o=="function"?o:Cn(+o),a(),s):e},s}function wte(e){var t=Cn(.1),n,i,r;typeof e!="function"&&(e=Cn(e==null?0:+e));function s(o){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vy+=(r[u]-c.y)*i[u]*o}function a(){if(n){var o,u=n.length;for(i=new Array(u),r=new Array(u),o=0;o<u;++o)i[o]=isNaN(r[o]=+e(n[o],o,n))?0:+t(n[o],o,n)}}return s.initialize=function(o){n=o,a()},s.strength=function(o){return arguments.length?(t=typeof o=="function"?o:Cn(+o),a(),s):t},s.y=function(o){return arguments.length?(e=typeof o=="function"?o:Cn(+o),a(),s):e},s}const yT={center:Dee,collide:ete,nbody:vte,link:nte,x:bte,y:wte},Xf="forces",c2=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],_te=["static","iterations"],VP=["x","y","vx","vy"];function SS(e){N.call(this,null,e)}SS.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30,expr:!0},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:VP}]};Y(SS,N,{transform(e,t){var n=this.value,i=t.changed(t.ADD_REM),r=e.modified(c2),s=e.iterations||300;if(n?(i&&(t.modifies("index"),n.nodes(t.source)),(r||t.changed(t.MOD))&&WP(n,e,0,t)):(this.value=n=Ste(t.source,e),n.on("tick",Ete(t.dataflow,this)),e.static||(i=!0,n.tick()),t.modifies("index")),r||i||e.modified(_te)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),e.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!i)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let o=this._argops,u=0,l=o.length,c;u<l;++u)if(c=o[u],!(c.name!==Xf||c.op._argval.force!=="link")){for(var i=c.op._argops,r=0,s=i.length,a;r<s;++r)if(i[r].name==="links"&&(a=i[r].op.source)){n.pulse(a,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(VP)}});function Ete(e,t){return()=>e.touch(t).run()}function Ste(e,t){const n=xte(e),i=n.stop,r=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,r()),n.stop=()=>(s=!0,i()),WP(n,t,!0).on("end",()=>s=!0)}function WP(e,t,n,i){var r=Q(t.forces),s,a,o,u;for(s=0,a=c2.length;s<a;++s)o=c2[s],o!==Xf&&t.modified(o)&&e[o](t[o]);for(s=0,a=r.length;s<a;++s)u=Xf+s,o=n||t.modified(Xf,s)?Ate(r[s]):i&&kte(r[s],i)?e.force(u):null,o&&e.force(u,o);for(a=e.numForces||0;s<a;++s)e.force(Xf+s,null);return e.numForces=r.length,e}function kte(e,t){var n,i;for(n in e)if(we(i=e[n])&&t.modified(dn(i)))return 1;return 0}function Ate(e){var t,n;Z(yT,e.force)||P("Unrecognized force: "+e.force),t=yT[e.force]();for(n in e)we(t[n])&&Cte(t[n],e[n],e);return t}function Cte(e,t,n){e(we(t)?i=>t(i,n):t)}const $te=Object.freeze(Object.defineProperty({__proto__:null,force:SS},Symbol.toStringTag,{value:"Module"}));function Tte(e,t){return e.parent===t.parent?1:2}function Fte(e){return e.reduce(Mte,0)/e.length}function Mte(e,t){return e+t.x}function Ote(e){return 1+e.reduce(Nte,0)}function Nte(e,t){return Math.max(e,t.y)}function Rte(e){for(var t;t=e.children;)e=t[0];return e}function Dte(e){for(var t;t=e.children;)e=t[t.length-1];return e}function Ite(){var e=Tte,t=1,n=1,i=!1;function r(s){var a,o=0;s.eachAfter(function(h){var d=h.children;d?(h.x=Fte(d),h.y=Ote(d)):(h.x=a?o+=e(h,a):0,h.y=0,a=h)});var u=Rte(s),l=Dte(s),c=u.x-e(u,l)/2,f=l.x+e(l,u)/2;return s.eachAfter(i?function(h){h.x=(h.x-s.x)*t,h.y=(s.y-h.y)*n}:function(h){h.x=(h.x-c)/(f-c)*t,h.y=(1-(s.y?h.y/s.y:1))*n})}return r.separation=function(s){return arguments.length?(e=s,r):e},r.size=function(s){return arguments.length?(i=!1,t=+s[0],n=+s[1],r):i?null:[t,n]},r.nodeSize=function(s){return arguments.length?(i=!0,t=+s[0],n=+s[1],r):i?[t,n]:null},r}function Pte(e){var t=0,n=e.children,i=n&&n.length;if(!i)t=1;else for(;--i>=0;)t+=n[i].value;e.value=t}function Lte(){return this.eachAfter(Pte)}function zte(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this}function Bte(e,t){for(var n=this,i=[n],r,s,a=-1;n=i.pop();)if(e.call(t,n,++a,this),r=n.children)for(s=r.length-1;s>=0;--s)i.push(r[s]);return this}function Ute(e,t){for(var n=this,i=[n],r=[],s,a,o,u=-1;n=i.pop();)if(r.push(n),s=n.children)for(a=0,o=s.length;a<o;++a)i.push(s[a]);for(;n=r.pop();)e.call(t,n,++u,this);return this}function jte(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i}function qte(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})}function Vte(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function Wte(e){for(var t=this,n=Hte(t,e),i=[t];t!==n;)t=t.parent,i.push(t);for(var r=i.length;e!==n;)i.splice(r,0,e),e=e.parent;return i}function Hte(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function Gte(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function Yte(){return Array.from(this)}function Xte(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function Kte(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*Qte(){var e=this,t,n=[e],i,r,s;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,i=e.children)for(r=0,s=i.length;r<s;++r)n.push(i[r]);while(n.length)}function kS(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=ene)):t===void 0&&(t=Zte);for(var n=new Zl(e),i,r=[n],s,a,o,u;i=r.pop();)if((a=t(i.data))&&(u=(a=Array.from(a)).length))for(i.children=a,o=u-1;o>=0;--o)r.push(s=a[o]=new Zl(a[o])),s.parent=i,s.depth=i.depth+1;return n.eachBefore(HP)}function Jte(){return kS(this).eachBefore(tne)}function Zte(e){return e.children}function ene(e){return Array.isArray(e)?e[1]:null}function tne(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function HP(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function Zl(e){this.data=e,this.depth=this.height=0,this.parent=null}Zl.prototype=kS.prototype={constructor:Zl,count:Lte,each:zte,eachAfter:Ute,eachBefore:Bte,find:jte,sum:qte,sort:Vte,path:Wte,ancestors:Gte,descendants:Yte,leaves:Xte,links:Kte,copy:Jte,[Symbol.iterator]:Qte};function gg(e){return e==null?null:GP(e)}function GP(e){if(typeof e!="function")throw new Error;return e}function Wo(){return 0}function fl(e){return function(){return e}}const nne=1664525,ine=1013904223,xT=4294967296;function rne(){let e=1;return()=>(e=(nne*e+ine)%xT)/xT}function sne(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ane(e,t){let n=e.length,i,r;for(;n;)r=t()*n--|0,i=e[n],e[n]=e[r],e[r]=i;return e}function one(e,t){for(var n=0,i=(e=ane(Array.from(e),t)).length,r=[],s,a;n<i;)s=e[n],a&&YP(a,s)?++n:(a=lne(r=une(r,s)),n=0);return a}function une(e,t){var n,i;if($x(t,e))return[t];for(n=0;n<e.length;++n)if(Fp(t,e[n])&&$x(Kf(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(i=n+1;i<e.length;++i)if(Fp(Kf(e[n],e[i]),t)&&Fp(Kf(e[n],t),e[i])&&Fp(Kf(e[i],t),e[n])&&$x(XP(e[n],e[i],t),e))return[e[n],e[i],t];throw new Error}function Fp(e,t){var n=e.r-t.r,i=t.x-e.x,r=t.y-e.y;return n<0||n*n<i*i+r*r}function YP(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function $x(e,t){for(var n=0;n<t.length;++n)if(!YP(e,t[n]))return!1;return!0}function lne(e){switch(e.length){case 1:return cne(e[0]);case 2:return Kf(e[0],e[1]);case 3:return XP(e[0],e[1],e[2])}}function cne(e){return{x:e.x,y:e.y,r:e.r}}function Kf(e,t){var n=e.x,i=e.y,r=e.r,s=t.x,a=t.y,o=t.r,u=s-n,l=a-i,c=o-r,f=Math.sqrt(u*u+l*l);return{x:(n+s+u/f*c)/2,y:(i+a+l/f*c)/2,r:(f+r+o)/2}}function XP(e,t,n){var i=e.x,r=e.y,s=e.r,a=t.x,o=t.y,u=t.r,l=n.x,c=n.y,f=n.r,h=i-a,d=i-l,p=r-o,g=r-c,m=u-s,y=f-s,x=i*i+r*r-s*s,v=x-a*a-o*o+u*u,b=x-l*l-c*c+f*f,w=d*p-h*g,E=(p*b-g*v)/(w*2)-i,_=(g*m-p*y)/w,k=(d*v-h*b)/(w*2)-r,A=(h*y-d*m)/w,T=_*_+A*A-1,$=2*(s+E*_+k*A),R=E*E+k*k-s*s,O=-(Math.abs(T)>1e-6?($+Math.sqrt($*$-4*T*R))/(2*T):R/$);return{x:i+E+_*O,y:r+k+A*O,r:O}}function vT(e,t,n){var i=e.x-t.x,r,s,a=e.y-t.y,o,u,l=i*i+a*a;l?(s=t.r+n.r,s*=s,u=e.r+n.r,u*=u,s>u?(r=(l+u-s)/(2*l),o=Math.sqrt(Math.max(0,u/l-r*r)),n.x=e.x-r*i-o*a,n.y=e.y-r*a+o*i):(r=(l+s-u)/(2*l),o=Math.sqrt(Math.max(0,s/l-r*r)),n.x=t.x+r*i-o*a,n.y=t.y+r*a+o*i)):(n.x=t.x+n.r,n.y=t.y)}function bT(e,t){var n=e.r+t.r-1e-6,i=t.x-e.x,r=t.y-e.y;return n>0&&n*n>i*i+r*r}function wT(e){var t=e._,n=e.next._,i=t.r+n.r,r=(t.x*n.r+n.x*t.r)/i,s=(t.y*n.r+n.y*t.r)/i;return r*r+s*s}function Mp(e){this._=e,this.next=null,this.previous=null}function fne(e,t){if(!(s=(e=sne(e)).length))return 0;var n,i,r,s,a,o,u,l,c,f,h;if(n=e[0],n.x=0,n.y=0,!(s>1))return n.r;if(i=e[1],n.x=-i.r,i.x=n.r,i.y=0,!(s>2))return n.r+i.r;vT(i,n,r=e[2]),n=new Mp(n),i=new Mp(i),r=new Mp(r),n.next=r.previous=i,i.next=n.previous=r,r.next=i.previous=n;e:for(u=3;u<s;++u){vT(n._,i._,r=e[u]),r=new Mp(r),l=i.next,c=n.previous,f=i._.r,h=n._.r;do if(f<=h){if(bT(l._,r._)){i=l,n.next=i,i.previous=n,--u;continue e}f+=l._.r,l=l.next}else{if(bT(c._,r._)){n=c,n.next=i,i.previous=n,--u;continue e}h+=c._.r,c=c.previous}while(l!==c.next);for(r.previous=n,r.next=i,n.next=i.previous=i=r,a=wT(n);(r=r.next)!==i;)(o=wT(r))<a&&(n=r,a=o);i=n.next}for(n=[i._],r=i;(r=r.next)!==i;)n.push(r._);for(r=one(n,t),u=0;u<s;++u)n=e[u],n.x-=r.x,n.y-=r.y;return r.r}function hne(e){return Math.sqrt(e.value)}function dne(){var e=null,t=1,n=1,i=Wo;function r(s){const a=rne();return s.x=t/2,s.y=n/2,e?s.eachBefore(_T(e)).eachAfter(Tx(i,.5,a)).eachBefore(ET(1)):s.eachBefore(_T(hne)).eachAfter(Tx(Wo,1,a)).eachAfter(Tx(i,s.r/Math.min(t,n),a)).eachBefore(ET(Math.min(t,n)/(2*s.r))),s}return r.radius=function(s){return arguments.length?(e=gg(s),r):e},r.size=function(s){return arguments.length?(t=+s[0],n=+s[1],r):[t,n]},r.padding=function(s){return arguments.length?(i=typeof s=="function"?s:fl(+s),r):i},r}function _T(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function Tx(e,t,n){return function(i){if(r=i.children){var r,s,a=r.length,o=e(i)*t||0,u;if(o)for(s=0;s<a;++s)r[s].r+=o;if(u=fne(r,n),o)for(s=0;s<a;++s)r[s].r-=o;i.r=u+o}}}function ET(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function KP(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Td(e,t,n,i,r){for(var s=e.children,a,o=-1,u=s.length,l=e.value&&(i-t)/e.value;++o<u;)a=s[o],a.y0=n,a.y1=r,a.x0=t,a.x1=t+=a.value*l}function pne(){var e=1,t=1,n=0,i=!1;function r(a){var o=a.height+1;return a.x0=a.y0=n,a.x1=e,a.y1=t/o,a.eachBefore(s(t,o)),i&&a.eachBefore(KP),a}function s(a,o){return function(u){u.children&&Td(u,u.x0,a*(u.depth+1)/o,u.x1,a*(u.depth+2)/o);var l=u.x0,c=u.y0,f=u.x1-n,h=u.y1-n;f<l&&(l=f=(l+f)/2),h<c&&(c=h=(c+h)/2),u.x0=l,u.y0=c,u.x1=f,u.y1=h}}return r.round=function(a){return arguments.length?(i=!!a,r):i},r.size=function(a){return arguments.length?(e=+a[0],t=+a[1],r):[e,t]},r.padding=function(a){return arguments.length?(n=+a,r):n},r}var gne={depth:-1},ST={},Fx={};function mne(e){return e.id}function yne(e){return e.parentId}function kT(){var e=mne,t=yne,n;function i(r){var s=Array.from(r),a=e,o=t,u,l,c,f,h,d,p,g,m=new Map;if(n!=null){const y=s.map((b,w)=>xne(n(b,w,r))),x=y.map(AT),v=new Set(y).add("");for(const b of x)v.has(b)||(v.add(b),y.push(b),x.push(AT(b)),s.push(Fx));a=(b,w)=>y[w],o=(b,w)=>x[w]}for(c=0,u=s.length;c<u;++c)l=s[c],d=s[c]=new Zl(l),(p=a(l,c,r))!=null&&(p+="")&&(g=d.id=p,m.set(g,m.has(g)?ST:d)),(p=o(l,c,r))!=null&&(p+="")&&(d.parent=p);for(c=0;c<u;++c)if(d=s[c],p=d.parent){if(h=m.get(p),!h)throw new Error("missing: "+p);if(h===ST)throw new Error("ambiguous: "+p);h.children?h.children.push(d):h.children=[d],d.parent=h}else{if(f)throw new Error("multiple roots");f=d}if(!f)throw new Error("no root");if(n!=null){for(;f.data===Fx&&f.children.length===1;)f=f.children[0],--u;for(let y=s.length-1;y>=0&&(d=s[y],d.data===Fx);--y)d.data=null}if(f.parent=gne,f.eachBefore(function(y){y.depth=y.parent.depth+1,--u}).eachBefore(HP),f.parent=null,u>0)throw new Error("cycle");return f}return i.id=function(r){return arguments.length?(e=gg(r),i):e},i.parentId=function(r){return arguments.length?(t=gg(r),i):t},i.path=function(r){return arguments.length?(n=gg(r),i):n},i}function xne(e){e=`${e}`;let t=e.length;return f2(e,t-1)&&!f2(e,t-2)&&(e=e.slice(0,-1)),e[0]==="/"?e:`/${e}`}function AT(e){let t=e.length;if(t<2)return"";for(;--t>1&&!f2(e,t););return e.slice(0,t)}function f2(e,t){if(e[t]==="/"){let n=0;for(;t>0&&e[--t]==="\\";)++n;if(!(n&1))return!0}return!1}function vne(e,t){return e.parent===t.parent?1:2}function Mx(e){var t=e.children;return t?t[0]:e.t}function Ox(e){var t=e.children;return t?t[t.length-1]:e.t}function bne(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function wne(e){for(var t=0,n=0,i=e.children,r=i.length,s;--r>=0;)s=i[r],s.z+=t,s.m+=t,t+=s.s+(n+=s.c)}function _ne(e,t,n){return e.a.parent===t.parent?e.a:n}function mg(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}mg.prototype=Object.create(Zl.prototype);function Ene(e){for(var t=new mg(e,0),n,i=[t],r,s,a,o;n=i.pop();)if(s=n._.children)for(n.children=new Array(o=s.length),a=o-1;a>=0;--a)i.push(r=n.children[a]=new mg(s[a],a)),r.parent=n;return(t.parent=new mg(null,0)).children=[t],t}function Sne(){var e=vne,t=1,n=1,i=null;function r(l){var c=Ene(l);if(c.eachAfter(s),c.parent.m=-c.z,c.eachBefore(a),i)l.eachBefore(u);else{var f=l,h=l,d=l;l.eachBefore(function(x){x.x<f.x&&(f=x),x.x>h.x&&(h=x),x.depth>d.depth&&(d=x)});var p=f===h?1:e(f,h)/2,g=p-f.x,m=t/(h.x+p+g),y=n/(d.depth||1);l.eachBefore(function(x){x.x=(x.x+g)*m,x.y=x.depth*y})}return l}function s(l){var c=l.children,f=l.parent.children,h=l.i?f[l.i-1]:null;if(c){wne(l);var d=(c[0].z+c[c.length-1].z)/2;h?(l.z=h.z+e(l._,h._),l.m=l.z-d):l.z=d}else h&&(l.z=h.z+e(l._,h._));l.parent.A=o(l,h,l.parent.A||f[0])}function a(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function o(l,c,f){if(c){for(var h=l,d=l,p=c,g=h.parent.children[0],m=h.m,y=d.m,x=p.m,v=g.m,b;p=Ox(p),h=Mx(h),p&&h;)g=Mx(g),d=Ox(d),d.a=l,b=p.z+x-h.z-m+e(p._,h._),b>0&&(bne(_ne(p,l,f),l,b),m+=b,y+=b),x+=p.m,m+=h.m,v+=g.m,y+=d.m;p&&!Ox(d)&&(d.t=p,d.m+=x-y),h&&!Mx(g)&&(g.t=h,g.m+=m-v,f=l)}return f}function u(l){l.x*=t,l.y=l.depth*n}return r.separation=function(l){return arguments.length?(e=l,r):e},r.size=function(l){return arguments.length?(i=!1,t=+l[0],n=+l[1],r):i?null:[t,n]},r.nodeSize=function(l){return arguments.length?(i=!0,t=+l[0],n=+l[1],r):i?[t,n]:null},r}function x1(e,t,n,i,r){for(var s=e.children,a,o=-1,u=s.length,l=e.value&&(r-n)/e.value;++o<u;)a=s[o],a.x0=t,a.x1=i,a.y0=n,a.y1=n+=a.value*l}var QP=(1+Math.sqrt(5))/2;function JP(e,t,n,i,r,s){for(var a=[],o=t.children,u,l,c=0,f=0,h=o.length,d,p,g=t.value,m,y,x,v,b,w,E;c<h;){d=r-n,p=s-i;do m=o[f++].value;while(!m&&f<h);for(y=x=m,w=Math.max(p/d,d/p)/(g*e),E=m*m*w,b=Math.max(x/E,E/y);f<h;++f){if(m+=l=o[f].value,l<y&&(y=l),l>x&&(x=l),E=m*m*w,v=Math.max(x/E,E/y),v>b){m-=l;break}b=v}a.push(u={value:m,dice:d<p,children:o.slice(c,f)}),u.dice?Td(u,n,i,r,g?i+=p*m/g:s):x1(u,n,i,g?n+=d*m/g:r,s),g-=m,c=f}return a}const ZP=function e(t){function n(i,r,s,a,o){JP(t,i,r,s,a,o)}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(QP);function kne(){var e=ZP,t=!1,n=1,i=1,r=[0],s=Wo,a=Wo,o=Wo,u=Wo,l=Wo;function c(h){return h.x0=h.y0=0,h.x1=n,h.y1=i,h.eachBefore(f),r=[0],t&&h.eachBefore(KP),h}function f(h){var d=r[h.depth],p=h.x0+d,g=h.y0+d,m=h.x1-d,y=h.y1-d;m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),h.x0=p,h.y0=g,h.x1=m,h.y1=y,h.children&&(d=r[h.depth+1]=s(h)/2,p+=l(h)-d,g+=a(h)-d,m-=o(h)-d,y-=u(h)-d,m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),e(h,p,g,m,y))}return c.round=function(h){return arguments.length?(t=!!h,c):t},c.size=function(h){return arguments.length?(n=+h[0],i=+h[1],c):[n,i]},c.tile=function(h){return arguments.length?(e=GP(h),c):e},c.padding=function(h){return arguments.length?c.paddingInner(h).paddingOuter(h):c.paddingInner()},c.paddingInner=function(h){return arguments.length?(s=typeof h=="function"?h:fl(+h),c):s},c.paddingOuter=function(h){return arguments.length?c.paddingTop(h).paddingRight(h).paddingBottom(h).paddingLeft(h):c.paddingTop()},c.paddingTop=function(h){return arguments.length?(a=typeof h=="function"?h:fl(+h),c):a},c.paddingRight=function(h){return arguments.length?(o=typeof h=="function"?h:fl(+h),c):o},c.paddingBottom=function(h){return arguments.length?(u=typeof h=="function"?h:fl(+h),c):u},c.paddingLeft=function(h){return arguments.length?(l=typeof h=="function"?h:fl(+h),c):l},c}function Ane(e,t,n,i,r){var s=e.children,a,o=s.length,u,l=new Array(o+1);for(l[0]=u=a=0;a<o;++a)l[a+1]=u+=s[a].value;c(0,o,e.value,t,n,i,r);function c(f,h,d,p,g,m,y){if(f>=h-1){var x=s[f];x.x0=p,x.y0=g,x.x1=m,x.y1=y;return}for(var v=l[f],b=d/2+v,w=f+1,E=h-1;w<E;){var _=w+E>>>1;l[_]<b?w=_+1:E=_}b-l[w-1]<l[w]-b&&f+1<w&&--w;var k=l[w]-v,A=d-k;if(m-p>y-g){var T=d?(p*A+m*k)/d:m;c(f,w,k,p,g,T,y),c(w,h,A,T,g,m,y)}else{var $=d?(g*A+y*k)/d:y;c(f,w,k,p,g,m,$),c(w,h,A,p,$,m,y)}}}function Cne(e,t,n,i,r){(e.depth&1?x1:Td)(e,t,n,i,r)}const $ne=function e(t){function n(i,r,s,a,o){if((u=i._squarify)&&u.ratio===t)for(var u,l,c,f,h=-1,d,p=u.length,g=i.value;++h<p;){for(l=u[h],c=l.children,f=l.value=0,d=c.length;f<d;++f)l.value+=c[f].value;l.dice?Td(l,r,s,a,g?s+=(o-s)*l.value/g:o):x1(l,r,s,g?r+=(a-r)*l.value/g:a,o),g-=l.value}else i._squarify=u=JP(t,i,r,s,a,o),u.ratio=t}return n.ratio=function(i){return e((i=+i)>1?i:1)},n}(QP);function h2(e,t,n){const i={};return e.each(r=>{const s=r.data;n(s)&&(i[t(s)]=r)}),e.lookup=i,e}function AS(e){N.call(this,null,e)}AS.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const Tne=e=>e.values;Y(AS,N,{transform(e,t){t.source||P("Nest transform requires an upstream data source.");var n=e.generate,i=e.modified(),r=t.clone(),s=this.value;return(!s||i||t.changed())&&(s&&s.each(a=>{a.children&&Om(a.data)&&r.rem.push(a.data)}),this.value=s=kS({values:Q(e.keys).reduce((a,o)=>(a.key(o),a),Fne()).entries(r.source)},Tne),n&&s.each(a=>{a.children&&(a=ze(a.data),r.add.push(a),r.source.push(a))}),h2(s,oe,oe)),r.source.root=s,r}});function Fne(){const e=[],t={entries:r=>i(n(r,0),0),key:r=>(e.push(r),t)};function n(r,s){if(s>=e.length)return r;const a=r.length,o=e[s++],u={},l={};let c=-1,f,h,d;for(;++c<a;)f=o(h=r[c])+"",(d=u[f])?d.push(h):u[f]=[h];for(f in u)l[f]=n(u[f],s);return l}function i(r,s){if(++s>e.length)return r;const a=[];for(const o in r)a.push({key:o,values:i(r[o],s)});return a}return t}function ra(e){N.call(this,null,e)}const Mne=(e,t)=>e.parent===t.parent?1:2;Y(ra,N,{transform(e,t){(!t.source||!t.source.root)&&P(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),i=this.fields,r=t.source.root,s=e.as||i;e.field?r.sum(e.field):r.count(),e.sort&&r.sort(Mu(e.sort,a=>a.data)),One(n,this.params,e),n.separation&&n.separation(e.separation!==!1?Mne:xc);try{this.value=n(r)}catch(a){P(a)}return r.each(a=>Nne(a,i,s)),t.reflow(e.modified()).modifies(s).modifies("leaf")}});function One(e,t,n){for(let i,r=0,s=t.length;r<s;++r)i=t[r],i in n&&e[i](n[i])}function Nne(e,t,n){const i=e.data,r=t.length-1;for(let s=0;s<r;++s)i[n[s]]=e[t[s]];i[n[r]]=e.children?e.children.length:0}const d2=["x","y","r","depth","children"];function CS(e){ra.call(this,e)}CS.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:d2.length,default:d2}]};Y(CS,ra,{layout:dne,params:["radius","size","padding"],fields:d2});const p2=["x0","y0","x1","y1","depth","children"];function $S(e){ra.call(this,e)}$S.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:p2.length,default:p2}]};Y($S,ra,{layout:pne,params:["size","round","padding"],fields:p2});function TS(e){N.call(this,null,e)}TS.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};Y(TS,N,{transform(e,t){t.source||P("Stratify transform requires an upstream data source.");let n=this.value;const i=e.modified(),r=t.fork(t.ALL).materialize(t.SOURCE),s=!n||i||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return r.source=r.source.slice(),s&&(n=r.source.length?h2(kT().id(e.key).parentId(e.parentKey)(r.source),e.key,Oi):h2(kT()([{}]),e.key,e.key)),r.source.root=this.value=n,r}});const CT={tidy:Sne,cluster:Ite},g2=["x","y","depth","children"];function FS(e){ra.call(this,e)}FS.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:g2.length,default:g2}]};Y(FS,ra,{layout(e){const t=e||"tidy";if(Z(CT,t))return CT[t]();P("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:g2});function MS(e){N.call(this,[],e)}MS.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};Y(MS,N,{transform(e,t){const n=this.value,i=t.source&&t.source.root,r=t.fork(t.NO_SOURCE),s={};return i||P("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(r.rem=n,t.visit(t.SOURCE,a=>s[oe(a)]=1),i.each(a=>{const o=a.data,u=a.parent&&a.parent.data;u&&s[oe(o)]&&s[oe(u)]&&r.add.push(ze({source:u,target:o}))}),this.value=r.add):t.changed(t.MOD)&&(t.visit(t.MOD,a=>s[oe(a)]=1),n.forEach(a=>{(s[oe(a.source)]||s[oe(a.target)])&&r.mod.push(a)})),r}});const $T={binary:Ane,dice:Td,slice:x1,slicedice:Cne,squarify:ZP,resquarify:$ne},m2=["x0","y0","x1","y1","depth","children"];function OS(e){ra.call(this,e)}OS.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:m2.length,default:m2}]};Y(OS,ra,{layout(){const e=kne();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{Z($T,t)?e.tile($T[t]):P("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:m2});const Rne=Object.freeze(Object.defineProperty({__proto__:null,nest:AS,pack:CS,partition:$S,stratify:TS,tree:FS,treelinks:MS,treemap:OS},Symbol.toStringTag,{value:"Module"})),Nx=4278190080;function Dne(e,t){const n=e.bitmap();return(t||[]).forEach(i=>n.set(e(i.boundary[0]),e(i.boundary[3]))),[n,void 0]}function Ine(e,t,n,i,r){const s=e.width,a=e.height,o=i||r,u=La(s,a).getContext("2d"),l=La(s,a).getContext("2d"),c=o&&La(s,a).getContext("2d");n.forEach(k=>yg(u,k,!1)),yg(l,t,!1),o&&yg(c,t,!0);const f=Rx(u,s,a),h=Rx(l,s,a),d=o&&Rx(c,s,a),p=e.bitmap(),g=o&&e.bitmap();let m,y,x,v,b,w,E,_;for(y=0;y<a;++y)for(m=0;m<s;++m)b=y*s+m,w=f[b]&Nx,_=h[b]&Nx,E=o&&d[b]&Nx,(w||E||_)&&(x=e(m),v=e(y),!r&&(w||_)&&p.set(x,v),o&&(w||E)&&g.set(x,v));return[p,g]}function Rx(e,t,n){return new Uint32Array(e.getImageData(0,0,t,n).data.buffer)}function yg(e,t,n){if(!t.length)return;const i=t[0].mark.marktype;i==="group"?t.forEach(r=>{r.items.forEach(s=>yg(e,s.items,n))}):di[i].draw(e,{items:n?t.map(Pne):t})}function Pne(e){const t=Nm(e,{});return t.stroke&&t.strokeOpacity!==0||t.fill&&t.fillOpacity!==0?{...t,strokeOpacity:1,stroke:"#000",fillOpacity:0}:t}const ws=5,vn=31,Ih=32,wa=new Uint32Array(Ih+1),Qi=new Uint32Array(Ih+1);Qi[0]=0;wa[0]=~Qi[0];for(let e=1;e<=Ih;++e)Qi[e]=Qi[e-1]<<1|1,wa[e]=~Qi[e];function Lne(e,t){const n=new Uint32Array(~~((e*t+Ih)/Ih));function i(s,a){n[s]|=a}function r(s,a){n[s]&=a}return{array:n,get:(s,a)=>{const o=a*e+s;return n[o>>>ws]&1<<(o&vn)},set:(s,a)=>{const o=a*e+s;i(o>>>ws,1<<(o&vn))},clear:(s,a)=>{const o=a*e+s;r(o>>>ws,~(1<<(o&vn)))},getRange:(s,a,o,u)=>{let l=u,c,f,h,d;for(;l>=a;--l)if(c=l*e+s,f=l*e+o,h=c>>>ws,d=f>>>ws,h===d){if(n[h]&wa[c&vn]&Qi[(f&vn)+1])return!0}else{if(n[h]&wa[c&vn]||n[d]&Qi[(f&vn)+1])return!0;for(let p=h+1;p<d;++p)if(n[p])return!0}return!1},setRange:(s,a,o,u)=>{let l,c,f,h,d;for(;a<=u;++a)if(l=a*e+s,c=a*e+o,f=l>>>ws,h=c>>>ws,f===h)i(f,wa[l&vn]&Qi[(c&vn)+1]);else for(i(f,wa[l&vn]),i(h,Qi[(c&vn)+1]),d=f+1;d<h;++d)i(d,4294967295)},clearRange:(s,a,o,u)=>{let l,c,f,h,d;for(;a<=u;++a)if(l=a*e+s,c=a*e+o,f=l>>>ws,h=c>>>ws,f===h)r(f,Qi[l&vn]|wa[(c&vn)+1]);else for(r(f,Qi[l&vn]),r(h,wa[(c&vn)+1]),d=f+1;d<h;++d)r(d,0)},outOfBounds:(s,a,o,u)=>s<0||a<0||u>=t||o>=e}}function zne(e,t,n){const i=Math.max(1,Math.sqrt(e*t/1e6)),r=~~((e+2*n+i)/i),s=~~((t+2*n+i)/i),a=o=>~~((o+n)/i);return a.invert=o=>o*i-n,a.bitmap=()=>Lne(r,s),a.ratio=i,a.padding=n,a.width=e,a.height=t,a}function Bne(e,t,n,i){const r=e.width,s=e.height;return function(a){const o=a.datum.datum.items[i].items,u=o.length,l=a.datum.fontSize,c=ui.width(a.datum,a.datum.text);let f=0,h,d,p,g,m,y,x;for(let v=0;v<u;++v)h=o[v].x,p=o[v].y,d=o[v].x2===void 0?h:o[v].x2,g=o[v].y2===void 0?p:o[v].y2,m=(h+d)/2,y=(p+g)/2,x=Math.abs(d-h+g-p),x>=f&&(f=x,a.x=m,a.y=y);return m=c/2,y=l/2,h=a.x-m,d=a.x+m,p=a.y-y,g=a.y+y,a.align="center",h<0&&d<=r?a.align="left":0<=h&&r<d&&(a.align="right"),a.baseline="middle",p<0&&g<=s?a.baseline="top":0<=p&&s<g&&(a.baseline="bottom"),!0}}function L0(e,t,n,i,r,s){let a=n/2;return e-a<0||e+a>r||t-(a=i/2)<0||t+a>s}function Ma(e,t,n,i,r,s,a,o){const u=r*s/(i*2),l=e(t-u),c=e(t+u),f=e(n-(s=s/2)),h=e(n+s);return a.outOfBounds(l,f,c,h)||a.getRange(l,f,c,h)||o&&o.getRange(l,f,c,h)}function Une(e,t,n,i){const r=e.width,s=e.height,a=t[0],o=t[1];function u(l,c,f,h,d){const p=e.invert(l),g=e.invert(c);let m=f,y=s,x;if(!L0(p,g,h,d,r,s)&&!Ma(e,p,g,d,h,m,a,o)&&!Ma(e,p,g,d,h,d,a,null)){for(;y-m>=1;)x=(m+y)/2,Ma(e,p,g,d,h,x,a,o)?y=x:m=x;if(m>f)return[p,g,m,!0]}}return function(l){const c=l.datum.datum.items[i].items,f=c.length,h=l.datum.fontSize,d=ui.width(l.datum,l.datum.text);let p=n?h:0,g=!1,m=!1,y=0,x,v,b,w,E,_,k,A,T,$,R,O,F,C,M,D,B;for(let z=0;z<f;++z){for(x=c[z].x,b=c[z].y,v=c[z].x2===void 0?x:c[z].x2,w=c[z].y2===void 0?b:c[z].y2,x>v&&(B=x,x=v,v=B),b>w&&(B=b,b=w,w=B),T=e(x),R=e(v),$=~~((T+R)/2),O=e(b),C=e(w),F=~~((O+C)/2),k=$;k>=T;--k)for(A=F;A>=O;--A)D=u(k,A,p,d,h),D&&([l.x,l.y,p,g]=D);for(k=$;k<=R;++k)for(A=F;A<=C;++A)D=u(k,A,p,d,h),D&&([l.x,l.y,p,g]=D);!g&&!n&&(M=Math.abs(v-x+w-b),E=(x+v)/2,_=(b+w)/2,M>=y&&!L0(E,_,d,h,r,s)&&!Ma(e,E,_,h,d,h,a,null)&&(y=M,l.x=E,l.y=_,m=!0))}return g||m?(E=d/2,_=h/2,a.setRange(e(l.x-E),e(l.y-_),e(l.x+E),e(l.y+_)),l.align="center",l.baseline="middle",!0):!1}}const jne=[-1,-1,1,1],qne=[-1,1,-1,1];function Vne(e,t,n,i){const r=e.width,s=e.height,a=t[0],o=t[1],u=e.bitmap();return function(l){const c=l.datum.datum.items[i].items,f=c.length,h=l.datum.fontSize,d=ui.width(l.datum,l.datum.text),p=[];let g=n?h:0,m=!1,y=!1,x=0,v,b,w,E,_,k,A,T,$,R,O,F;for(let C=0;C<f;++C){for(v=c[C].x,w=c[C].y,b=c[C].x2===void 0?v:c[C].x2,E=c[C].y2===void 0?w:c[C].y2,p.push([e((v+b)/2),e((w+E)/2)]);p.length;)if([A,T]=p.pop(),!(a.get(A,T)||o.get(A,T)||u.get(A,T))){u.set(A,T);for(let M=0;M<4;++M)_=A+jne[M],k=T+qne[M],u.outOfBounds(_,k,_,k)||p.push([_,k]);if(_=e.invert(A),k=e.invert(T),$=g,R=s,!L0(_,k,d,h,r,s)&&!Ma(e,_,k,h,d,$,a,o)&&!Ma(e,_,k,h,d,h,a,null)){for(;R-$>=1;)O=($+R)/2,Ma(e,_,k,h,d,O,a,o)?R=O:$=O;$>g&&(l.x=_,l.y=k,g=$,m=!0)}}!m&&!n&&(F=Math.abs(b-v+E-w),_=(v+b)/2,k=(w+E)/2,F>=x&&!L0(_,k,d,h,r,s)&&!Ma(e,_,k,h,d,h,a,null)&&(x=F,l.x=_,l.y=k,y=!0))}return m||y?(_=d/2,k=h/2,a.setRange(e(l.x-_),e(l.y-k),e(l.x+_),e(l.y+k)),l.align="center",l.baseline="middle",!0):!1}}const Wne=["right","center","left"],Hne=["bottom","middle","top"];function Gne(e,t,n,i){const r=e.width,s=e.height,a=t[0],o=t[1],u=i.length;return function(l){const c=l.boundary,f=l.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>r||c[3]>s)return!1;let h=l.textWidth??0,d,p,g,m,y,x,v,b,w,E,_,k,A,T,$;for(let R=0;R<u;++R){if(d=(n[R]&3)-1,p=(n[R]>>>2&3)-1,g=d===0&&p===0||i[R]<0,m=d&&p?Math.SQRT1_2:1,y=i[R]<0?-1:1,x=c[1+d]+i[R]*d*m,_=c[4+p]+y*f*p/2+i[R]*p*m,b=_-f/2,w=_+f/2,k=e(x),T=e(b),$=e(w),!h)if(TT(k,k,T,$,a,o,x,x,b,w,c,g))h=ui.width(l.datum,l.datum.text);else continue;if(E=x+y*h*d/2,x=E-h/2,v=E+h/2,k=e(x),A=e(v),TT(k,A,T,$,a,o,x,v,b,w,c,g))return l.x=d?d*y<0?v:x:E,l.y=p?p*y<0?w:b:_,l.align=Wne[d*y+1],l.baseline=Hne[p*y+1],a.setRange(k,T,A,$),!0}return!1}}function TT(e,t,n,i,r,s,a,o,u,l,c,f){return!(r.outOfBounds(e,n,t,i)||(f&&s||r).getRange(e,n,t,i))}const Dx=0,Ix=4,Px=8,Lx=0,zx=1,Bx=2,Yne={"top-left":Dx+Lx,top:Dx+zx,"top-right":Dx+Bx,left:Ix+Lx,middle:Ix+zx,right:Ix+Bx,"bottom-left":Px+Lx,bottom:Px+zx,"bottom-right":Px+Bx},Xne={naive:Bne,"reduced-search":Une,floodfill:Vne};function Kne(e,t,n,i,r,s,a,o,u,l,c){if(!e.length)return e;const f=Math.max(i.length,r.length),h=Qne(i,f),d=Jne(r,f),p=Zne(e[0].datum),g=p==="group"&&e[0].datum.items[u].marktype,m=g==="area",y=eie(p,g,o,u),x=l===null||l===1/0,v=m&&c==="naive";let b=-1,w=-1;const E=e.map(T=>{const $=x?ui.width(T,T.text):void 0;return b=Math.max(b,$),w=Math.max(w,T.fontSize),{datum:T,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(T),textWidth:$}});l=l===null||l===1/0?Math.max(b,w)+Math.max(...i):l;const _=zne(t[0],t[1],l);let k;if(!v){n&&E.sort((R,O)=>n(R.datum,O.datum));let T=!1;for(let R=0;R<d.length&&!T;++R)T=d[R]===5||h[R]<0;const $=(p&&a||m)&&e.map(R=>R.datum);k=s.length||$?Ine(_,$||[],s,T,m):Dne(_,a&&E)}const A=m?Xne[c](_,k,a,u):Gne(_,k,d,h);return E.forEach(T=>T.opacity=+A(T)),E}function Qne(e,t){const n=new Float64Array(t),i=e.length;for(let r=0;r<i;++r)n[r]=e[r]||0;for(let r=i;r<t;++r)n[r]=n[i-1];return n}function Jne(e,t){const n=new Int8Array(t),i=e.length;for(let r=0;r<i;++r)n[r]|=Yne[e[r]];for(let r=i;r<t;++r)n[r]=n[i-1];return n}function Zne(e){return e&&e.mark&&e.mark.marktype}function eie(e,t,n,i){const r=s=>[s.x,s.x,s.x,s.y,s.y,s.y];return e?e==="line"||e==="area"?s=>r(s.datum):t==="line"?s=>{const a=s.datum.items[i].items;return r(a.length?a[n==="start"?0:a.length-1]:{x:NaN,y:NaN})}:s=>{const a=s.datum.bounds;return[a.x1,(a.x1+a.x2)/2,a.x2,a.y1,(a.y1+a.y2)/2,a.y2]}:r}const y2=["x","y","opacity","align","baseline"],e4=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function NS(e){N.call(this,null,e)}NS.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:e4},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0,null:!0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:y2.length,default:y2}]};Y(NS,N,{transform(e,t){function n(s){const a=e[s];return we(a)&&t.modified(a.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&P("Size parameter should be specified as a [width, height] array.");const r=e.as||y2;return Kne(t.materialize(t.SOURCE).source||[],e.size,e.sort,Q(e.offset==null?1:e.offset),Q(e.anchor||e4),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding===void 0?0:e.padding,e.method||"naive").forEach(s=>{const a=s.datum;a[r[0]]=s.x,a[r[1]]=s.y,a[r[2]]=s.opacity,a[r[3]]=s.align,a[r[4]]=s.baseline}),t.reflow(i).modifies(r)}});const tie=Object.freeze(Object.defineProperty({__proto__:null,label:NS},Symbol.toStringTag,{value:"Module"}));function t4(e,t){var n=[],i=function(c){return c(o)},r,s,a,o,u,l;if(t==null)n.push(e);else for(r={},s=0,a=e.length;s<a;++s)o=e[s],u=t.map(i),l=r[u],l||(r[u]=l=[],l.dims=u,n.push(l)),l.push(o);return n}function RS(e){N.call(this,null,e)}RS.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};Y(RS,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=t4(i,e.groupby),s=(e.groupby||[]).map(dt),a=s.length,o=e.as||[dt(e.x),dt(e.y)],u=[];r.forEach(l=>{uD(l,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let h=0;h<a;++h)f[s[h]]=l.dims[h];f[o[0]]=c[0],f[o[1]]=c[1],u.push(ze(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const x2={constant:g_,linear:m_,log:rD,exp:sD,pow:aD,quad:y_,poly:oD},nie=(e,t)=>e==="poly"?t:e==="quad"?2:1;function DS(e){N.call(this,null,e)}DS.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(x2)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};Y(DS,N,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const i=t.materialize(t.SOURCE).source,r=t4(i,e.groupby),s=(e.groupby||[]).map(dt),a=e.method||"linear",o=e.order==null?3:e.order,u=nie(a,o),l=e.as||[dt(e.x),dt(e.y)],c=x2[a],f=[];let h=e.extent;Z(x2,a)||P("Invalid regression method: "+a),h!=null&&a==="log"&&h[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),r.forEach(d=>{if(d.length<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=c(d,e.x,e.y,o);if(e.params){f.push(ze({keys:d.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=h||Yr(d,e.x),y=x=>{const v={};for(let b=0;b<s.length;++b)v[s[b]]=d.dims[b];v[l[0]]=x[0],v[l[1]]=x[1],f.push(ze(v))};a==="linear"||a==="constant"?m.forEach(x=>y([x,g.predict(x)])):Bm(g.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const iie=Object.freeze(Object.defineProperty({__proto__:null,loess:RS,regression:DS},Symbol.toStringTag,{value:"Module"})),Bs=11102230246251565e-32,an=134217729,rie=(3+8*Bs)*Bs;function Ux(e,t,n,i,r){let s,a,o,u,l=t[0],c=i[0],f=0,h=0;c>l==c>-l?(s=l,l=t[++f]):(s=c,c=i[++h]);let d=0;if(f<e&&h<n)for(c>l==c>-l?(a=l+s,o=s-(a-l),l=t[++f]):(a=c+s,o=s-(a-c),c=i[++h]),s=a,o!==0&&(r[d++]=o);f<e&&h<n;)c>l==c>-l?(a=s+l,u=a-s,o=s-(a-u)+(l-u),l=t[++f]):(a=s+c,u=a-s,o=s-(a-u)+(c-u),c=i[++h]),s=a,o!==0&&(r[d++]=o);for(;f<e;)a=s+l,u=a-s,o=s-(a-u)+(l-u),l=t[++f],s=a,o!==0&&(r[d++]=o);for(;h<n;)a=s+c,u=a-s,o=s-(a-u)+(c-u),c=i[++h],s=a,o!==0&&(r[d++]=o);return(s!==0||d===0)&&(r[d++]=s),d}function sie(e,t){let n=t[0];for(let i=1;i<e;i++)n+=t[i];return n}function Fd(e){return new Float64Array(e)}const aie=(3+16*Bs)*Bs,oie=(2+12*Bs)*Bs,uie=(9+64*Bs)*Bs*Bs,nl=Fd(4),FT=Fd(8),MT=Fd(12),OT=Fd(16),bn=Fd(4);function lie(e,t,n,i,r,s,a){let o,u,l,c,f,h,d,p,g,m,y,x,v,b,w,E,_,k;const A=e-r,T=n-r,$=t-s,R=i-s;b=A*R,h=an*A,d=h-(h-A),p=A-d,h=an*R,g=h-(h-R),m=R-g,w=p*m-(b-d*g-p*g-d*m),E=$*T,h=an*$,d=h-(h-$),p=$-d,h=an*T,g=h-(h-T),m=T-g,_=p*m-(E-d*g-p*g-d*m),y=w-_,f=w-y,nl[0]=w-(y+f)+(f-_),x=b+y,f=x-b,v=b-(x-f)+(y-f),y=v-E,f=v-y,nl[1]=v-(y+f)+(f-E),k=x+y,f=k-x,nl[2]=x-(k-f)+(y-f),nl[3]=k;let O=sie(4,nl),F=oie*a;if(O>=F||-O>=F||(f=e-A,o=e-(A+f)+(f-r),f=n-T,l=n-(T+f)+(f-r),f=t-$,u=t-($+f)+(f-s),f=i-R,c=i-(R+f)+(f-s),o===0&&u===0&&l===0&&c===0)||(F=uie*a+rie*Math.abs(O),O+=A*c+R*o-($*l+T*u),O>=F||-O>=F))return O;b=o*R,h=an*o,d=h-(h-o),p=o-d,h=an*R,g=h-(h-R),m=R-g,w=p*m-(b-d*g-p*g-d*m),E=u*T,h=an*u,d=h-(h-u),p=u-d,h=an*T,g=h-(h-T),m=T-g,_=p*m-(E-d*g-p*g-d*m),y=w-_,f=w-y,bn[0]=w-(y+f)+(f-_),x=b+y,f=x-b,v=b-(x-f)+(y-f),y=v-E,f=v-y,bn[1]=v-(y+f)+(f-E),k=x+y,f=k-x,bn[2]=x-(k-f)+(y-f),bn[3]=k;const C=Ux(4,nl,4,bn,FT);b=A*c,h=an*A,d=h-(h-A),p=A-d,h=an*c,g=h-(h-c),m=c-g,w=p*m-(b-d*g-p*g-d*m),E=$*l,h=an*$,d=h-(h-$),p=$-d,h=an*l,g=h-(h-l),m=l-g,_=p*m-(E-d*g-p*g-d*m),y=w-_,f=w-y,bn[0]=w-(y+f)+(f-_),x=b+y,f=x-b,v=b-(x-f)+(y-f),y=v-E,f=v-y,bn[1]=v-(y+f)+(f-E),k=x+y,f=k-x,bn[2]=x-(k-f)+(y-f),bn[3]=k;const M=Ux(C,FT,4,bn,MT);b=o*c,h=an*o,d=h-(h-o),p=o-d,h=an*c,g=h-(h-c),m=c-g,w=p*m-(b-d*g-p*g-d*m),E=u*l,h=an*u,d=h-(h-u),p=u-d,h=an*l,g=h-(h-l),m=l-g,_=p*m-(E-d*g-p*g-d*m),y=w-_,f=w-y,bn[0]=w-(y+f)+(f-_),x=b+y,f=x-b,v=b-(x-f)+(y-f),y=v-E,f=v-y,bn[1]=v-(y+f)+(f-E),k=x+y,f=k-x,bn[2]=x-(k-f)+(y-f),bn[3]=k;const D=Ux(M,MT,4,bn,OT);return OT[D-1]}function Op(e,t,n,i,r,s){const a=(t-s)*(n-r),o=(e-r)*(i-s),u=a-o,l=Math.abs(a+o);return Math.abs(u)>=aie*l?u:-lie(e,t,n,i,r,s,l)}const NT=Math.pow(2,-52),Np=new Uint32Array(512);class z0{static from(t,n=pie,i=gie){const r=t.length,s=new Float64Array(r*2);for(let a=0;a<r;a++){const o=t[a];s[2*a]=n(o),s[2*a+1]=i(o)}return new z0(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*n-5,0);this._triangles=new Uint32Array(i*3),this._halfedges=new Int32Array(i*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:i,_hullTri:r,_hullHash:s}=this,a=t.length>>1;let o=1/0,u=1/0,l=-1/0,c=-1/0;for(let A=0;A<a;A++){const T=t[2*A],$=t[2*A+1];T<o&&(o=T),$<u&&(u=$),T>l&&(l=T),$>c&&(c=$),this._ids[A]=A}const f=(o+l)/2,h=(u+c)/2;let d,p,g;for(let A=0,T=1/0;A<a;A++){const $=jx(f,h,t[2*A],t[2*A+1]);$<T&&(d=A,T=$)}const m=t[2*d],y=t[2*d+1];for(let A=0,T=1/0;A<a;A++){if(A===d)continue;const $=jx(m,y,t[2*A],t[2*A+1]);$<T&&$>0&&(p=A,T=$)}let x=t[2*p],v=t[2*p+1],b=1/0;for(let A=0;A<a;A++){if(A===d||A===p)continue;const T=hie(m,y,x,v,t[2*A],t[2*A+1]);T<b&&(g=A,b=T)}let w=t[2*g],E=t[2*g+1];if(b===1/0){for(let $=0;$<a;$++)this._dists[$]=t[2*$]-t[0]||t[2*$+1]-t[1];vl(this._ids,this._dists,0,a-1);const A=new Uint32Array(a);let T=0;for(let $=0,R=-1/0;$<a;$++){const O=this._ids[$],F=this._dists[O];F>R&&(A[T++]=O,R=F)}this.hull=A.subarray(0,T),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Op(m,y,x,v,w,E)<0){const A=p,T=x,$=v;p=g,x=w,v=E,g=A,w=T,E=$}const _=die(m,y,x,v,w,E);this._cx=_.x,this._cy=_.y;for(let A=0;A<a;A++)this._dists[A]=jx(t[2*A],t[2*A+1],_.x,_.y);vl(this._ids,this._dists,0,a-1),this._hullStart=d;let k=3;i[d]=n[g]=p,i[p]=n[d]=g,i[g]=n[p]=d,r[d]=0,r[p]=1,r[g]=2,s.fill(-1),s[this._hashKey(m,y)]=d,s[this._hashKey(x,v)]=p,s[this._hashKey(w,E)]=g,this.trianglesLen=0,this._addTriangle(d,p,g,-1,-1,-1);for(let A=0,T,$;A<this._ids.length;A++){const R=this._ids[A],O=t[2*R],F=t[2*R+1];if(A>0&&Math.abs(O-T)<=NT&&Math.abs(F-$)<=NT||(T=O,$=F,R===d||R===p||R===g))continue;let C=0;for(let ee=0,he=this._hashKey(O,F);ee<this._hashSize&&(C=s[(he+ee)%this._hashSize],!(C!==-1&&C!==i[C]));ee++);C=n[C];let M=C,D;for(;D=i[M],Op(O,F,t[2*M],t[2*M+1],t[2*D],t[2*D+1])>=0;)if(M=D,M===C){M=-1;break}if(M===-1)continue;let B=this._addTriangle(M,R,i[M],-1,-1,r[M]);r[R]=this._legalize(B+2),r[M]=B,k++;let z=i[M];for(;D=i[z],Op(O,F,t[2*z],t[2*z+1],t[2*D],t[2*D+1])<0;)B=this._addTriangle(z,R,D,r[R],-1,r[z]),r[R]=this._legalize(B+2),i[z]=z,k--,z=D;if(M===C)for(;D=n[M],Op(O,F,t[2*D],t[2*D+1],t[2*M],t[2*M+1])<0;)B=this._addTriangle(D,R,M,-1,r[M],r[D]),this._legalize(B+2),r[D]=B,i[M]=M,k--,M=D;this._hullStart=n[R]=M,i[M]=n[z]=R,i[R]=z,s[this._hashKey(O,F)]=R,s[this._hashKey(t[2*M],t[2*M+1])]=M}this.hull=new Uint32Array(k);for(let A=0,T=this._hullStart;A<k;A++)this.hull[A]=T,T=i[T];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(cie(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:i,coords:r}=this;let s=0,a=0;for(;;){const o=i[t],u=t-t%3;if(a=u+(t+2)%3,o===-1){if(s===0)break;t=Np[--s];continue}const l=o-o%3,c=u+(t+1)%3,f=l+(o+2)%3,h=n[a],d=n[t],p=n[c],g=n[f];if(fie(r[2*h],r[2*h+1],r[2*d],r[2*d+1],r[2*p],r[2*p+1],r[2*g],r[2*g+1])){n[t]=g,n[o]=h;const y=i[f];if(y===-1){let v=this._hullStart;do{if(this._hullTri[v]===f){this._hullTri[v]=t;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(t,y),this._link(o,i[a]),this._link(a,f);const x=l+(o+1)%3;s<Np.length&&(Np[s++]=x)}else{if(s===0)break;t=Np[--s]}}return a}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,i,r,s,a){const o=this.trianglesLen;return this._triangles[o]=t,this._triangles[o+1]=n,this._triangles[o+2]=i,this._link(o,r),this._link(o+1,s),this._link(o+2,a),this.trianglesLen+=3,o}}function cie(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function jx(e,t,n,i){const r=e-n,s=t-i;return r*r+s*s}function fie(e,t,n,i,r,s,a,o){const u=e-a,l=t-o,c=n-a,f=i-o,h=r-a,d=s-o,p=u*u+l*l,g=c*c+f*f,m=h*h+d*d;return u*(f*m-g*d)-l*(c*m-g*h)+p*(c*d-f*h)<0}function hie(e,t,n,i,r,s){const a=n-e,o=i-t,u=r-e,l=s-t,c=a*a+o*o,f=u*u+l*l,h=.5/(a*l-o*u),d=(l*c-o*f)*h,p=(a*f-u*c)*h;return d*d+p*p}function die(e,t,n,i,r,s){const a=n-e,o=i-t,u=r-e,l=s-t,c=a*a+o*o,f=u*u+l*l,h=.5/(a*l-o*u),d=e+(l*c-o*f)*h,p=t+(a*f-u*c)*h;return{x:d,y:p}}function vl(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){const s=e[r],a=t[s];let o=r-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=s}else{const r=n+i>>1;let s=n+1,a=i;xf(e,r,s),t[e[n]]>t[e[i]]&&xf(e,n,i),t[e[s]]>t[e[i]]&&xf(e,s,i),t[e[n]]>t[e[s]]&&xf(e,n,s);const o=e[s],u=t[o];for(;;){do s++;while(t[e[s]]<u);do a--;while(t[e[a]]>u);if(a<s)break;xf(e,s,a)}e[n+1]=e[a],e[a]=o,i-s+1>=a-n?(vl(e,t,s,i),vl(e,t,n,a-1)):(vl(e,t,n,a-1),vl(e,t,s,i))}}function xf(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function pie(e){return e[0]}function gie(e){return e[1]}const RT=1e-6;class Xo{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,i){t=+t,n=+n,i=+i;const r=t+i,s=n;if(i<0)throw new Error("negative radius");this._x1===null?this._+=`M${r},${s}`:(Math.abs(this._x1-r)>RT||Math.abs(this._y1-s)>RT)&&(this._+="L"+r+","+s),i&&(this._+=`A${i},${i},0,1,1,${t-i},${n}A${i},${i},0,1,1,${this._x1=r},${this._y1=s}`)}rect(t,n,i,r){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+i}v${+r}h${-i}Z`}value(){return this._||null}}class v2{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}let mie=class{constructor(t,[n,i,r,s]=[0,0,960,500]){if(!((r=+r)>=(n=+n))||!((s=+s)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=r,this.xmin=n,this.ymax=s,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:i},vectors:r}=this;let s,a;const o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let g=0,m=0,y=i.length,x,v;g<y;g+=3,m+=2){const b=i[g]*2,w=i[g+1]*2,E=i[g+2]*2,_=t[b],k=t[b+1],A=t[w],T=t[w+1],$=t[E],R=t[E+1],O=A-_,F=T-k,C=$-_,M=R-k,D=(O*M-F*C)*2;if(Math.abs(D)<1e-9){if(s===void 0){s=a=0;for(const z of n)s+=t[z*2],a+=t[z*2+1];s/=n.length,a/=n.length}const B=1e9*Math.sign((s-_)*M-(a-k)*C);x=(_+$)/2-B*M,v=(k+R)/2+B*C}else{const B=1/D,z=O*O+F*F,ee=C*C+M*M;x=_+(M*z-F*ee)*B,v=k+(O*ee-C*z)*B}o[m]=x,o[m+1]=v}let u=n[n.length-1],l,c=u*4,f,h=t[2*u],d,p=t[2*u+1];r.fill(0);for(let g=0;g<n.length;++g)u=n[g],l=c,f=h,d=p,c=u*4,h=t[2*u],p=t[2*u+1],r[l+2]=r[c]=d-p,r[l+3]=r[c+1]=h-f}render(t){const n=t==null?t=new Xo:void 0,{delaunay:{halfedges:i,inedges:r,hull:s},circumcenters:a,vectors:o}=this;if(s.length<=1)return null;for(let c=0,f=i.length;c<f;++c){const h=i[c];if(h<c)continue;const d=Math.floor(c/3)*2,p=Math.floor(h/3)*2,g=a[d],m=a[d+1],y=a[p],x=a[p+1];this._renderSegment(g,m,y,x,t)}let u,l=s[s.length-1];for(let c=0;c<s.length;++c){u=l,l=s[c];const f=Math.floor(r[l]/3)*2,h=a[f],d=a[f+1],p=u*4,g=this._project(h,d,o[p+2],o[p+3]);g&&this._renderSegment(h,d,g[0],g[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Xo:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const i=n==null?n=new Xo:void 0,r=this._clip(t);if(r===null||!r.length)return;n.moveTo(r[0],r[1]);let s=r.length;for(;r[0]===r[s-2]&&r[1]===r[s-1]&&s>1;)s-=2;for(let a=2;a<s;a+=2)(r[a]!==r[a-2]||r[a+1]!==r[a-1])&&n.lineTo(r[a],r[a+1]);return n.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,i=t.length/2;n<i;++n){const r=this.cellPolygon(n);r&&(r.index=n,yield r)}}cellPolygon(t){const n=new v2;return this.renderCell(t,n),n.value()}_renderSegment(t,n,i,r,s){let a;const o=this._regioncode(t,n),u=this._regioncode(i,r);o===0&&u===0?(s.moveTo(t,n),s.lineTo(i,r)):(a=this._clipSegment(t,n,i,r,o,u))&&(s.moveTo(a[0],a[1]),s.lineTo(a[2],a[3]))}contains(t,n,i){return n=+n,n!==n||(i=+i,i!==i)?!1:this.delaunay._step(t,n,i)===t}*neighbors(t){const n=this._clip(t);if(n)for(const i of this.delaunay.neighbors(t)){const r=this._clip(i);if(r){e:for(let s=0,a=n.length;s<a;s+=2)for(let o=0,u=r.length;o<u;o+=2)if(n[s]===r[o]&&n[s+1]===r[o+1]&&n[(s+2)%a]===r[(o+u-2)%u]&&n[(s+3)%a]===r[(o+u-1)%u]){yield i;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:i,halfedges:r,triangles:s}}=this,a=i[t];if(a===-1)return null;const o=[];let u=a;do{const l=Math.floor(u/3);if(o.push(n[l*2],n[l*2+1]),u=u%3===2?u-2:u+1,s[u]!==t)break;u=r[u]}while(u!==a&&u!==-1);return o}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:i}=this,r=t*4;return this._simplify(i[r]||i[r+1]?this._clipInfinite(t,n,i[r],i[r+1],i[r+2],i[r+3]):this._clipFinite(t,n))}_clipFinite(t,n){const i=n.length;let r=null,s,a,o=n[i-2],u=n[i-1],l,c=this._regioncode(o,u),f,h=0;for(let d=0;d<i;d+=2)if(s=o,a=u,o=n[d],u=n[d+1],l=c,c=this._regioncode(o,u),l===0&&c===0)f=h,h=0,r?r.push(o,u):r=[o,u];else{let p,g,m,y,x;if(l===0){if((p=this._clipSegment(s,a,o,u,l,c))===null)continue;[g,m,y,x]=p}else{if((p=this._clipSegment(o,u,s,a,c,l))===null)continue;[y,x,g,m]=p,f=h,h=this._edgecode(g,m),f&&h&&this._edge(t,f,h,r,r.length),r?r.push(g,m):r=[g,m]}f=h,h=this._edgecode(y,x),f&&h&&this._edge(t,f,h,r,r.length),r?r.push(y,x):r=[y,x]}if(r)f=h,h=this._edgecode(r[0],r[1]),f&&h&&this._edge(t,f,h,r,r.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(t,n,i,r,s,a){const o=s<a;for(o&&([t,n,i,r,s,a]=[i,r,t,n,a,s]);;){if(s===0&&a===0)return o?[i,r,t,n]:[t,n,i,r];if(s&a)return null;let u,l,c=s||a;c&8?(u=t+(i-t)*(this.ymax-n)/(r-n),l=this.ymax):c&4?(u=t+(i-t)*(this.ymin-n)/(r-n),l=this.ymin):c&2?(l=n+(r-n)*(this.xmax-t)/(i-t),u=this.xmax):(l=n+(r-n)*(this.xmin-t)/(i-t),u=this.xmin),s?(t=u,n=l,s=this._regioncode(t,n)):(i=u,r=l,a=this._regioncode(i,r))}}_clipInfinite(t,n,i,r,s,a){let o=Array.from(n),u;if((u=this._project(o[0],o[1],i,r))&&o.unshift(u[0],u[1]),(u=this._project(o[o.length-2],o[o.length-1],s,a))&&o.push(u[0],u[1]),o=this._clipFinite(t,o))for(let l=0,c=o.length,f,h=this._edgecode(o[c-2],o[c-1]);l<c;l+=2)f=h,h=this._edgecode(o[l],o[l+1]),f&&h&&(l=this._edge(t,f,h,o,l),c=o.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return o}_edge(t,n,i,r,s){for(;n!==i;){let a,o;switch(n){case 5:n=4;continue;case 4:n=6,a=this.xmax,o=this.ymin;break;case 6:n=2;continue;case 2:n=10,a=this.xmax,o=this.ymax;break;case 10:n=8;continue;case 8:n=9,a=this.xmin,o=this.ymax;break;case 9:n=1;continue;case 1:n=5,a=this.xmin,o=this.ymin;break}(r[s]!==a||r[s+1]!==o)&&this.contains(t,a,o)&&(r.splice(s,0,a,o),s+=2)}return s}_project(t,n,i,r){let s=1/0,a,o,u;if(r<0){if(n<=this.ymin)return null;(a=(this.ymin-n)/r)<s&&(u=this.ymin,o=t+(s=a)*i)}else if(r>0){if(n>=this.ymax)return null;(a=(this.ymax-n)/r)<s&&(u=this.ymax,o=t+(s=a)*i)}if(i>0){if(t>=this.xmax)return null;(a=(this.xmax-t)/i)<s&&(o=this.xmax,u=n+(s=a)*r)}else if(i<0){if(t<=this.xmin)return null;(a=(this.xmin-t)/i)<s&&(o=this.xmin,u=n+(s=a)*r)}return[o,u]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}_simplify(t){if(t&&t.length>4){for(let n=0;n<t.length;n+=2){const i=(n+2)%t.length,r=(n+4)%t.length;(t[n]===t[i]&&t[i]===t[r]||t[n+1]===t[i+1]&&t[i+1]===t[r+1])&&(t.splice(i,2),n-=2)}t.length||(t=null)}return t}};const yie=2*Math.PI,il=Math.pow;function xie(e){return e[0]}function vie(e){return e[1]}function bie(e){const{triangles:t,coords:n}=e;for(let i=0;i<t.length;i+=3){const r=2*t[i],s=2*t[i+1],a=2*t[i+2];if((n[a]-n[r])*(n[s+1]-n[r+1])-(n[s]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}function wie(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class IS{static from(t,n=xie,i=vie,r){return new IS("length"in t?_ie(t,n,i,r):Float64Array.from(Eie(t,n,i,r)))}constructor(t){this._delaunator=new z0(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&bie(t)){this.collinear=Int32Array.from({length:n.length/2},(h,d)=>d).sort((h,d)=>n[2*h]-n[2*d]||n[2*h+1]-n[2*d+1]);const u=this.collinear[0],l=this.collinear[this.collinear.length-1],c=[n[2*u],n[2*u+1],n[2*l],n[2*l+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let h=0,d=n.length/2;h<d;++h){const p=wie(n[2*h],n[2*h+1],f);n[2*h]=p[0],n[2*h+1]=p[1]}this._delaunator=new z0(n)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let u=0,l=i.length;u<l;++u){const c=s[u%3===2?u-2:u+1];(i[u]===-1||a[c]===-1)&&(a[c]=u)}for(let u=0,l=r.length;u<l;++u)o[r[u]]=u;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],a[r[0]]=1,r.length===2&&(a[r[1]]=0,this.triangles[1]=r[1],this.triangles[2]=r[1]))}voronoi(t){return new mie(this,t)}*neighbors(t){const{inedges:n,hull:i,_hullIndex:r,halfedges:s,triangles:a,collinear:o}=this;if(o){const f=o.indexOf(t);f>0&&(yield o[f-1]),f<o.length-1&&(yield o[f+1]);return}const u=n[t];if(u===-1)return;let l=u,c=-1;do{if(yield c=a[l],l=l%3===2?l-2:l+1,a[l]!==t)return;if(l=s[l],l===-1){const f=i[(r[t]+1)%i.length];f!==c&&(yield f);return}}while(l!==u)}find(t,n,i=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const r=i;let s;for(;(s=this._step(i,t,n))>=0&&s!==i&&s!==r;)i=s;return s}_step(t,n,i){const{inedges:r,hull:s,_hullIndex:a,halfedges:o,triangles:u,points:l}=this;if(r[t]===-1||!l.length)return(t+1)%(l.length>>1);let c=t,f=il(n-l[t*2],2)+il(i-l[t*2+1],2);const h=r[t];let d=h;do{let p=u[d];const g=il(n-l[p*2],2)+il(i-l[p*2+1],2);if(g<f&&(f=g,c=p),d=d%3===2?d-2:d+1,u[d]!==t)break;if(d=o[d],d===-1){if(d=s[(a[t]+1)%s.length],d!==p&&il(n-l[d*2],2)+il(i-l[d*2+1],2)<f)return d;break}}while(d!==h);return c}render(t){const n=t==null?t=new Xo:void 0,{points:i,halfedges:r,triangles:s}=this;for(let a=0,o=r.length;a<o;++a){const u=r[a];if(u<a)continue;const l=s[a]*2,c=s[u]*2;t.moveTo(i[l],i[l+1]),t.lineTo(i[c],i[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n){n===void 0&&(!t||typeof t.moveTo!="function")&&(n=t,t=null),n=n==null?2:+n;const i=t==null?t=new Xo:void 0,{points:r}=this;for(let s=0,a=r.length;s<a;s+=2){const o=r[s],u=r[s+1];t.moveTo(o+n,u),t.arc(o,u,n,0,yie)}return i&&i.value()}renderHull(t){const n=t==null?t=new Xo:void 0,{hull:i,points:r}=this,s=i[0]*2,a=i.length;t.moveTo(r[s],r[s+1]);for(let o=1;o<a;++o){const u=2*i[o];t.lineTo(r[u],r[u+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new v2;return this.renderHull(t),t.value()}renderTriangle(t,n){const i=n==null?n=new Xo:void 0,{points:r,triangles:s}=this,a=s[t*=3]*2,o=s[t+1]*2,u=s[t+2]*2;return n.moveTo(r[a],r[a+1]),n.lineTo(r[o],r[o+1]),n.lineTo(r[u],r[u+1]),n.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,i=t.length/3;n<i;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new v2;return this.renderTriangle(t,n),n.value()}}function _ie(e,t,n,i){const r=e.length,s=new Float64Array(r*2);for(let a=0;a<r;++a){const o=e[a];s[a*2]=t.call(i,o,a,e),s[a*2+1]=n.call(i,o,a,e)}return s}function*Eie(e,t,n,i){let r=0;for(const s of e)yield t.call(i,s,r,e),yield n.call(i,s,r,e),++r}function PS(e){N.call(this,null,e)}PS.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const Sie=[-1e5,-1e5,1e5,1e5];Y(PS,N,{transform(e,t){const n=e.as||"path",i=t.source;if(!i||!i.length)return t;let r=e.size;r=r?[0,0,r[0],r[1]]:(r=e.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:Sie;const s=this.value=IS.from(i,e.x,e.y).voronoi(r);for(let a=0,o=i.length;a<o;++a){const u=s.cellPolygon(a);i[a][n]=u&&!Aie(u)?kie(u):null}return t.reflow(e.modified()).modifies(n)}});function kie(e){const t=e[0][0],n=e[0][1];let i=e.length-1;for(;e[i][0]===t&&e[i][1]===n;--i);return"M"+e.slice(0,i+1).join("L")+"Z"}function Aie(e){return e.length===2&&e[0][0]===e[1][0]&&e[0][1]===e[1][1]}const Cie=Object.freeze(Object.defineProperty({__proto__:null,voronoi:PS},Symbol.toStringTag,{value:"Module"}));var qx=Math.PI/180,Qf=64,xg=2048;function $ie(){var e=[256,256],t,n,i,r,s,a,o,u=n4,l=[],c=Math.random,f={};f.layout=function(){for(var p=h(La()),g=Rie((e[0]>>5)*e[1]),m=null,y=l.length,x=-1,v=[],b=l.map(E=>({text:t(E),font:n(E),style:r(E),weight:s(E),rotate:a(E),size:~~(i(E)+1e-14),padding:o(E),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:E})).sort((E,_)=>_.size-E.size);++x<y;){var w=b[x];w.x=e[0]*(c()+.5)>>1,w.y=e[1]*(c()+.5)>>1,Tie(p,w,b,x),w.hasText&&d(g,w,m)&&(v.push(w),m?Mie(m,w):m=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=e[0]>>1,w.y-=e[1]>>1)}return v};function h(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(Qf<<5)/g,p.height=xg/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function d(p,g,m){for(var y=g.x,x=g.y,v=Math.hypot(e[0],e[1]),b=u(e),w=c()<.5?1:-1,E=-w,_,k,A;(_=b(E+=w))&&(k=~~_[0],A=~~_[1],!(Math.min(Math.abs(k),Math.abs(A))>=v));)if(g.x=y+k,g.y=x+A,!(g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>e[0]||g.y+g.y1>e[1])&&(!m||!Fie(g,p,e[0]))&&(!m||Oie(g,m))){for(var T=g.sprite,$=g.width>>5,R=e[0]>>5,O=g.x-($<<4),F=O&127,C=32-F,M=g.y1-g.y0,D=(g.y+g.y0)*R+(O>>5),B,z=0;z<M;z++){B=0;for(var ee=0;ee<=$;ee++)p[D+ee]|=B<<C|(ee<$?(B=T[z*$+ee])>>>F:0);D+=R}return g.sprite=null,!0}return!1}return f.words=function(p){return arguments.length?(l=p,f):l},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=$o(p),f):n},f.fontStyle=function(p){return arguments.length?(r=$o(p),f):r},f.fontWeight=function(p){return arguments.length?(s=$o(p),f):s},f.rotate=function(p){return arguments.length?(a=$o(p),f):a},f.text=function(p){return arguments.length?(t=$o(p),f):t},f.spiral=function(p){return arguments.length?(u=Die[p]||p,f):u},f.fontSize=function(p){return arguments.length?(i=$o(p),f):i},f.padding=function(p){return arguments.length?(o=$o(p),f):o},f.random=function(p){return arguments.length?(c=p,f):c},f}function Tie(e,t,n,i){if(!t.sprite){var r=e.context,s=e.ratio;r.clearRect(0,0,(Qf<<5)/s,xg/s);var a=0,o=0,u=0,l=n.length,c,f,h,d,p;for(--i;++i<l;){if(t=n[i],r.save(),r.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,c=r.measureText(t.text+"m").width*s,h=t.size<<1,t.rotate){var g=Math.sin(t.rotate*qx),m=Math.cos(t.rotate*qx),y=c*m,x=c*g,v=h*m,b=h*g;c=Math.max(Math.abs(y+b),Math.abs(y-b))+31>>5<<5,h=~~Math.max(Math.abs(x+v),Math.abs(x-v))}else c=c+31>>5<<5;if(h>u&&(u=h),a+c>=Qf<<5&&(a=0,o+=u,u=0),o+h>=xg)break;r.translate((a+(c>>1))/s,(o+(h>>1))/s),t.rotate&&r.rotate(t.rotate*qx),r.fillText(t.text,0,0),t.padding&&(r.lineWidth=2*t.padding,r.strokeText(t.text,0,0)),r.restore(),t.width=c,t.height=h,t.xoff=a,t.yoff=o,t.x1=c>>1,t.y1=h>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,a+=c}for(var w=r.getImageData(0,0,(Qf<<5)/s,xg/s).data,E=[];--i>=0;)if(t=n[i],!!t.hasText){for(c=t.width,f=c>>5,h=t.y1-t.y0,d=0;d<h*f;d++)E[d]=0;if(a=t.xoff,a==null)return;o=t.yoff;var _=0,k=-1;for(p=0;p<h;p++){for(d=0;d<c;d++){var A=f*p+(d>>5),T=w[(o+p)*(Qf<<5)+(a+d)<<2]?1<<31-d%32:0;E[A]|=T,_|=T}_?k=p:(t.y0++,h--,p--,o++)}t.y1=t.y0+k,t.sprite=E.slice(0,(t.y1-t.y0)*f)}}}function Fie(e,t,n){n>>=5;for(var i=e.sprite,r=e.width>>5,s=e.x-(r<<4),a=s&127,o=32-a,u=e.y1-e.y0,l=(e.y+e.y0)*n+(s>>5),c,f=0;f<u;f++){c=0;for(var h=0;h<=r;h++)if((c<<o|(h<r?(c=i[f*r+h])>>>a:0))&t[l+h])return!0;l+=n}return!1}function Mie(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function Oie(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function n4(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function Nie(e){var t=4,n=t*e[0]/e[1],i=0,r=0;return function(s){var a=s<0?-1:1;switch(Math.sqrt(1+4*a*s)-a&3){case 0:i+=n;break;case 1:r+=t;break;case 2:i-=n;break;default:r-=t;break}return[i,r]}}function Rie(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function $o(e){return typeof e=="function"?e:function(){return e}}var Die={archimedean:n4,rectangular:Nie};const i4=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Iie=["text","font","rotate","fontSize","fontStyle","fontWeight"];function LS(e){N.call(this,$ie(),e)}LS.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:i4}]};Y(LS,N,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&P("Wordcloud size dimensions must be non-zero.");function n(p){const g=e[p];return we(g)&&t.modified(g.fields)}const i=e.modified();if(!(i||t.changed(t.ADD_REM)||Iie.some(n)))return;const r=t.materialize(t.SOURCE).source,s=this.value,a=e.as||i4;let o=e.fontSize||14,u;if(we(o)?u=e.fontSizeRange:o=xn(o),u){const p=o,g=Le("sqrt")().domain(Yr(r,p)).range(u);o=m=>g(p(m))}r.forEach(p=>{p[a[0]]=NaN,p[a[1]]=NaN,p[a[3]]=0});const l=s.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(o).random(Ri).layout(),c=s.size(),f=c[0]>>1,h=c[1]>>1,d=l.length;for(let p=0,g,m;p<d;++p)g=l[p],m=g.datum,m[a[0]]=g.x+f,m[a[1]]=g.y+h,m[a[2]]=g.font,m[a[3]]=g.size,m[a[4]]=g.style,m[a[5]]=g.weight,m[a[6]]=g.rotate;return t.reflow(i).modifies(a)}});const Pie=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:LS},Symbol.toStringTag,{value:"Module"})),Lie=e=>new Uint8Array(e),zie=e=>new Uint16Array(e),fh=e=>new Uint32Array(e);function Bie(){let e=8,t=[],n=fh(0),i=Rp(0,e),r=Rp(0,e);return{data:()=>t,seen:()=>n=Uie(n,t.length),add(s){for(let a=0,o=t.length,u=s.length,l;a<u;++a)l=s[a],l._index=o++,t.push(l)},remove(s,a){const o=t.length,u=Array(o-s),l=t;let c,f,h;for(f=0;!a[f]&&f<o;++f)u[f]=t[f],l[f]=f;for(h=f;f<o;++f)c=t[f],a[f]?l[f]=-1:(l[f]=h,i[h]=i[f],r[h]=r[f],u[h]=c,c._index=h++),i[f]=0;return t=u,l},size:()=>t.length,curr:()=>i,prev:()=>r,reset:s=>r[s]=i[s],all:()=>e<257?255:e<65537?65535:4294967295,set(s,a){i[s]|=a},clear(s,a){i[s]&=~a},resize(s,a){const o=i.length;(s>o||a>e)&&(e=Math.max(a,e),i=Rp(s,e,i),r=Rp(s,e))}}}function Uie(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function Rp(e,t,n){const i=(t<257?Lie:t<65537?zie:fh)(e);return n&&i.set(n),i}function DT(e,t,n){const i=1<<t;return{one:i,zero:~i,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(r,s){const a=this,o=a.bisect(a.range,r.value),u=r.index,l=o[0],c=o[1],f=u.length;let h;for(h=0;h<l;++h)s[u[h]]|=i;for(h=c;h<f;++h)s[u[h]]|=i;return a}}}function IT(){let e=fh(0),t=[],n=0;function i(o,u,l){if(!u.length)return[];const c=n,f=u.length,h=fh(f);let d=Array(f),p,g,m;for(m=0;m<f;++m)d[m]=o(u[m]),h[m]=m;if(d=jie(d,h),c)p=t,g=e,t=Array(c+f),e=fh(c+f),qie(l,p,g,c,d,h,f,t,e);else{if(l>0)for(m=0;m<f;++m)h[m]+=l;t=d,e=h}return n=c+f,{index:h,value:d}}function r(o,u){const l=n;let c,f,h;for(f=0;!u[e[f]]&&f<l;++f);for(h=f;f<l;++f)u[c=e[f]]||(e[h]=c,t[h]=t[f],++h);n=l-o}function s(o){for(let u=0,l=n;u<l;++u)e[u]=o[e[u]]}function a(o,u){let l;return u?l=u.length:(u=t,l=n),[Gj(u,o[0],0,l),ja(u,o[1],0,l)]}return{insert:i,remove:r,bisect:a,reindex:s,index:()=>e,size:()=>n}}function jie(e,t){return e.sort.call(t,(n,i)=>{const r=e[n],s=e[i];return r<s?-1:r>s?1:0}),Kj(e,t)}function qie(e,t,n,i,r,s,a,o,u){let l=0,c=0,f;for(f=0;l<i&&c<a;++f)t[l]<r[c]?(o[f]=t[l],u[f]=n[l++]):(o[f]=r[c],u[f]=s[c++]+e);for(;l<i;++l,++f)o[f]=t[l],u[f]=n[l];for(;c<a;++c,++f)o[f]=r[c],u[f]=s[c]+e}function zS(e){N.call(this,Bie(),e),this._indices=null,this._dims=null}zS.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};Y(zS,N,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(i=>t.modified(i.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,i=e.query,r=this._indices={},s=this._dims=[],a=i.length;let o=0,u,l;for(;o<a;++o)u=n[o].fname,l=r[u]||(r[u]=IT()),s.push(DT(l,o,i[o]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),i=e.fields,r=e.query,s=this._indices,a=this._dims,o=this.value,u=o.curr(),l=o.prev(),c=o.all(),f=n.rem=n.add,h=n.mod,d=r.length,p={};let g,m,y,x,v,b,w,E,_;if(l.set(u),t.rem.length&&(v=this.remove(e,t,n)),t.add.length&&o.add(t.add),t.mod.length)for(b={},x=t.mod,w=0,E=x.length;w<E;++w)b[x[w]._index]=1;for(w=0;w<d;++w)_=i[w],(!a[w]||e.modified("fields",w)||t.modified(_.fields))&&(y=_.fname,(g=p[y])||(s[y]=m=IT(),p[y]=g=m.insert(_,t.source,0)),a[w]=DT(m,w,r[w]).onAdd(g,u));for(w=0,E=o.data().length;w<E;++w)v[w]||(l[w]!==u[w]?f.push(w):b[w]&&u[w]!==c&&h.push(w));return o.mask=(1<<d)-1,n},eval(e,t){const n=t.materialize().fork(),i=this._dims.length;let r=0;return t.rem.length&&(this.remove(e,t,n),r|=(1<<i)-1),e.modified("query")&&!e.modified("fields")&&(r|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),r|=(1<<i)-1),t.mod.length&&(this.modify(t,n),r|=(1<<i)-1),this.value.mask=r,n},insert(e,t,n){const i=t.add,r=this.value,s=this._dims,a=this._indices,o=e.fields,u={},l=n.add,c=r.size()+i.length,f=s.length;let h=r.size(),d,p,g;r.resize(c,f),r.add(i);const m=r.curr(),y=r.prev(),x=r.all();for(d=0;d<f;++d)p=o[d].fname,g=u[p]||(u[p]=a[p].insert(o[d],i,h)),s[d].onAdd(g,m);for(;h<c;++h)y[h]=x,m[h]!==x&&l.push(h)},modify(e,t){const n=t.mod,i=this.value,r=i.curr(),s=i.all(),a=e.mod;let o,u,l;for(o=0,u=a.length;o<u;++o)l=a[o]._index,r[l]!==s&&n.push(l)},remove(e,t,n){const i=this._indices,r=this.value,s=r.curr(),a=r.prev(),o=r.all(),u={},l=n.rem,c=t.rem;let f,h,d,p;for(f=0,h=c.length;f<h;++f)d=c[f]._index,u[d]=1,a[d]=p=s[d],s[d]=o,p!==o&&l.push(d);for(d in i)i[d].remove(h,u);return this.reindex(t,h,u),u},reindex(e,t,n){const i=this._indices,r=this.value;e.runAfter(()=>{const s=r.remove(t,n);for(const a in i)i[a].reindex(s)})},update(e,t,n){const i=this._dims,r=e.query,s=t.stamp,a=i.length;let o=0,u,l;for(n.filters=0,l=0;l<a;++l)e.modified("query",l)&&(u=l,++o);if(o===1)o=i[u].one,this.incrementOne(i[u],r[u],n.add,n.rem);else for(l=0,o=0;l<a;++l)e.modified("query",l)&&(o|=i[l].one,this.incrementAll(i[l],r[l],s,n.add),n.rem=n.add);return o},incrementAll(e,t,n,i){const r=this.value,s=r.seen(),a=r.curr(),o=r.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],h=c[1],d=l[0],p=l[1],g=e.one;let m,y,x;if(f<d)for(m=f,y=Math.min(d,h);m<y;++m)x=u[m],s[x]!==n&&(o[x]=a[x],s[x]=n,i.push(x)),a[x]^=g;else if(f>d)for(m=d,y=Math.min(f,p);m<y;++m)x=u[m],s[x]!==n&&(o[x]=a[x],s[x]=n,i.push(x)),a[x]^=g;if(h>p)for(m=Math.max(f,p),y=h;m<y;++m)x=u[m],s[x]!==n&&(o[x]=a[x],s[x]=n,i.push(x)),a[x]^=g;else if(h<p)for(m=Math.max(d,h),y=p;m<y;++m)x=u[m],s[x]!==n&&(o[x]=a[x],s[x]=n,i.push(x)),a[x]^=g;e.range=t.slice()},incrementOne(e,t,n,i){const r=this.value,s=r.curr(),a=e.index(),o=e.bisect(e.range),u=e.bisect(t),l=u[0],c=u[1],f=o[0],h=o[1],d=e.one;let p,g,m;if(l<f)for(p=l,g=Math.min(f,c);p<g;++p)m=a[p],s[m]^=d,n.push(m);else if(l>f)for(p=f,g=Math.min(l,h);p<g;++p)m=a[p],s[m]^=d,i.push(m);if(c>h)for(p=Math.max(l,h),g=c;p<g;++p)m=a[p],s[m]^=d,n.push(m);else if(c<h)for(p=Math.max(f,c),g=h;p<g;++p)m=a[p],s[m]^=d,i.push(m);e.range=t.slice()}});function BS(e){N.call(this,null,e)}BS.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};Y(BS,N,{transform(e,t){const n=~(e.ignore||0),i=e.filter,r=i.mask;if(!(r&n))return t.StopPropagation;const s=t.fork(t.ALL),a=i.data(),o=i.curr(),u=i.prev(),l=c=>o[c]&n?null:a[c];return s.filter(s.MOD,l),r&r-1?(s.filter(s.ADD,c=>{const f=o[c]&n;return!f&&f^u[c]&n?a[c]:null}),s.filter(s.REM,c=>{const f=o[c]&n;return f&&!(f^(f^u[c]&n))?a[c]:null})):(s.filter(s.ADD,l),s.filter(s.REM,c=>(o[c]&n)===r?a[c]:null)),s.filter(s.SOURCE,c=>l(c._index))}});const Vie=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:zS,resolvefilter:BS},Symbol.toStringTag,{value:"Module"})),Wie="RawCode",pu="Literal",Hie="Property",Gie="Identifier",Yie="ArrayExpression",Xie="BinaryExpression",r4="CallExpression",Kie="ConditionalExpression",Qie="LogicalExpression",Jie="MemberExpression",Zie="ObjectExpression",ere="UnaryExpression";function mr(e){this.type=e}mr.prototype.visit=function(e){let t,n,i;if(e(this))return 1;for(t=tre(this),n=0,i=t.length;n<i;++n)if(t[n].visit(e))return 1};function tre(e){switch(e.type){case Yie:return e.elements;case Xie:case Qie:return[e.left,e.right];case r4:return[e.callee].concat(e.arguments);case Kie:return[e.test,e.consequent,e.alternate];case Jie:return[e.object,e.property];case Zie:return e.properties;case Hie:return[e.key,e.value];case ere:return[e.argument];case Gie:case pu:case Wie:default:return[]}}var ls,ie,I,gn,qe,v1=1,Md=2,gu=3,fo=4,b1=5,Du=6,Bn=7,Od=8,nre=9;ls={};ls[v1]="Boolean";ls[Md]="<end>";ls[gu]="Identifier";ls[fo]="Keyword";ls[b1]="Null";ls[Du]="Numeric";ls[Bn]="Punctuator";ls[Od]="String";ls[nre]="RegularExpression";var ire="ArrayExpression",rre="BinaryExpression",sre="CallExpression",are="ConditionalExpression",s4="Identifier",ore="Literal",ure="LogicalExpression",lre="MemberExpression",cre="ObjectExpression",fre="Property",hre="UnaryExpression",It="Unexpected token %0",dre="Unexpected number",pre="Unexpected string",gre="Unexpected identifier",mre="Unexpected reserved word",yre="Unexpected end of input",b2="Invalid regular expression",Vx="Invalid regular expression: missing /",a4="Octal literals are not allowed in strict mode.",xre="Duplicate data property in object literal not allowed in strict mode",Kt="ILLEGAL",Ph="Disabled.",vre=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),bre=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function w1(e,t){if(!e)throw new Error("ASSERT: "+t)}function Cs(e){return e>=48&&e<=57}function US(e){return"0123456789abcdefABCDEF".includes(e)}function hh(e){return"01234567".includes(e)}function wre(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(e)}function Lh(e){return e===10||e===13||e===8232||e===8233}function Nd(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&vre.test(String.fromCharCode(e))}function B0(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&bre.test(String.fromCharCode(e))}const _re={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function o4(){for(;I<gn;){const e=ie.charCodeAt(I);if(wre(e)||Lh(e))++I;else break}}function w2(e){var t,n,i,r=0;for(n=e==="u"?4:2,t=0;t<n;++t)I<gn&&US(ie[I])?(i=ie[I++],r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())):De({},It,Kt);return String.fromCharCode(r)}function Ere(){var e,t,n,i;for(e=ie[I],t=0,e==="}"&&De({},It,Kt);I<gn&&(e=ie[I++],!!US(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&De({},It,Kt),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(n,i))}function u4(){var e,t;for(e=ie.charCodeAt(I++),t=String.fromCharCode(e),e===92&&(ie.charCodeAt(I)!==117&&De({},It,Kt),++I,e=w2("u"),(!e||e==="\\"||!Nd(e.charCodeAt(0)))&&De({},It,Kt),t=e);I<gn&&(e=ie.charCodeAt(I),!!B0(e));)++I,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),ie.charCodeAt(I)!==117&&De({},It,Kt),++I,e=w2("u"),(!e||e==="\\"||!B0(e.charCodeAt(0)))&&De({},It,Kt),t+=e);return t}function Sre(){var e,t;for(e=I++;I<gn;){if(t=ie.charCodeAt(I),t===92)return I=e,u4();if(B0(t))++I;else break}return ie.slice(e,I)}function kre(){var e,t,n;return e=I,t=ie.charCodeAt(I)===92?u4():Sre(),t.length===1?n=gu:_re.hasOwnProperty(t)?n=fo:t==="null"?n=b1:t==="true"||t==="false"?n=v1:n=gu,{type:n,value:t,start:e,end:I}}function Wx(){var e=I,t=ie.charCodeAt(I),n,i=ie[I],r,s,a;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++I,{type:Bn,value:String.fromCharCode(t),start:e,end:I};default:if(n=ie.charCodeAt(I+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return I+=2,{type:Bn,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:I};case 33:case 61:return I+=2,ie.charCodeAt(I)===61&&++I,{type:Bn,value:ie.slice(e,I),start:e,end:I}}}if(a=ie.substr(I,4),a===">>>=")return I+=4,{type:Bn,value:a,start:e,end:I};if(s=a.substr(0,3),s===">>>"||s==="<<="||s===">>=")return I+=3,{type:Bn,value:s,start:e,end:I};if(r=s.substr(0,2),i===r[1]&&"+-<>&|".includes(i)||r==="=>")return I+=2,{type:Bn,value:r,start:e,end:I};if(r==="//"&&De({},It,Kt),"<>=!+-*%&|^/".includes(i))return++I,{type:Bn,value:i,start:e,end:I};De({},It,Kt)}function Are(e){let t="";for(;I<gn&&US(ie[I]);)t+=ie[I++];return t.length===0&&De({},It,Kt),Nd(ie.charCodeAt(I))&&De({},It,Kt),{type:Du,value:parseInt("0x"+t,16),start:e,end:I}}function Cre(e){let t="0"+ie[I++];for(;I<gn&&hh(ie[I]);)t+=ie[I++];return(Nd(ie.charCodeAt(I))||Cs(ie.charCodeAt(I)))&&De({},It,Kt),{type:Du,value:parseInt(t,8),octal:!0,start:e,end:I}}function PT(){var e,t,n;if(n=ie[I],w1(Cs(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=I,e="",n!=="."){if(e=ie[I++],n=ie[I],e==="0"){if(n==="x"||n==="X")return++I,Are(t);if(hh(n))return Cre(t);n&&Cs(n.charCodeAt(0))&&De({},It,Kt)}for(;Cs(ie.charCodeAt(I));)e+=ie[I++];n=ie[I]}if(n==="."){for(e+=ie[I++];Cs(ie.charCodeAt(I));)e+=ie[I++];n=ie[I]}if(n==="e"||n==="E")if(e+=ie[I++],n=ie[I],(n==="+"||n==="-")&&(e+=ie[I++]),Cs(ie.charCodeAt(I)))for(;Cs(ie.charCodeAt(I));)e+=ie[I++];else De({},It,Kt);return Nd(ie.charCodeAt(I))&&De({},It,Kt),{type:Du,value:parseFloat(e),start:t,end:I}}function $re(){var e="",t,n,i,r,s=!1;for(t=ie[I],w1(t==="'"||t==='"',"String literal must starts with a quote"),n=I,++I;I<gn;)if(i=ie[I++],i===t){t="";break}else if(i==="\\")if(i=ie[I++],!i||!Lh(i.charCodeAt(0)))switch(i){case"u":case"x":ie[I]==="{"?(++I,e+=Ere()):e+=w2(i);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:hh(i)?(r="01234567".indexOf(i),r!==0&&(s=!0),I<gn&&hh(ie[I])&&(s=!0,r=r*8+"01234567".indexOf(ie[I++]),"0123".includes(i)&&I<gn&&hh(ie[I])&&(r=r*8+"01234567".indexOf(ie[I++]))),e+=String.fromCharCode(r)):e+=i;break}else i==="\r"&&ie[I]===`
`&&++I;else{if(Lh(i.charCodeAt(0)))break;e+=i}return t!==""&&De({},It,Kt),{type:Od,value:e,octal:s,start:n,end:I}}function Tre(e,t){let n=e;t.includes("u")&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(i,r)=>{if(parseInt(r,16)<=1114111)return"x";De({},b2)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{De({},b2)}try{return new RegExp(e,t)}catch{return null}}function Fre(){var e,t,n,i,r;for(e=ie[I],w1(e==="/","Regular expression literal must start with a slash"),t=ie[I++],n=!1,i=!1;I<gn;)if(e=ie[I++],t+=e,e==="\\")e=ie[I++],Lh(e.charCodeAt(0))&&De({},Vx),t+=e;else if(Lh(e.charCodeAt(0)))De({},Vx);else if(n)e==="]"&&(n=!1);else if(e==="/"){i=!0;break}else e==="["&&(n=!0);return i||De({},Vx),r=t.substr(1,t.length-2),{value:r,literal:t}}function Mre(){var e,t,n;for(t="",n="";I<gn&&(e=ie[I],!!B0(e.charCodeAt(0)));)++I,e==="\\"&&I<gn?De({},It,Kt):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&De({},b2,n),{value:n,literal:t}}function Ore(){var e,t,n,i;return qe=null,o4(),e=I,t=Fre(),n=Mre(),i=Tre(t.value,n.value),{literal:t.literal+n.literal,value:i,regex:{pattern:t.value,flags:n.value},start:e,end:I}}function Nre(e){return e.type===gu||e.type===fo||e.type===v1||e.type===b1}function l4(){if(o4(),I>=gn)return{type:Md,start:I,end:I};const e=ie.charCodeAt(I);return Nd(e)?kre():e===40||e===41||e===59?Wx():e===39||e===34?$re():e===46?Cs(ie.charCodeAt(I+1))?PT():Wx():Cs(e)?PT():Wx()}function jn(){const e=qe;return I=e.end,qe=l4(),I=e.end,e}function c4(){const e=I;qe=l4(),I=e}function Rre(e){const t=new mr(ire);return t.elements=e,t}function LT(e,t,n){const i=new mr(e==="||"||e==="&&"?ure:rre);return i.operator=e,i.left=t,i.right=n,i}function Dre(e,t){const n=new mr(sre);return n.callee=e,n.arguments=t,n}function Ire(e,t,n){const i=new mr(are);return i.test=e,i.consequent=t,i.alternate=n,i}function jS(e){const t=new mr(s4);return t.name=e,t}function Jf(e){const t=new mr(ore);return t.value=e.value,t.raw=ie.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function zT(e,t,n){const i=new mr(lre);return i.computed=e==="[",i.object=t,i.property=n,i.computed||(n.member=!0),i}function Pre(e){const t=new mr(cre);return t.properties=e,t}function BT(e,t,n){const i=new mr(fre);return i.key=t,i.value=n,i.kind=e,i}function Lre(e,t){const n=new mr(hre);return n.operator=e,n.argument=t,n.prefix=!0,n}function De(e,t){var n,i=Array.prototype.slice.call(arguments,2),r=t.replace(/%(\d)/g,(s,a)=>(w1(a<i.length,"Message reference must be in range"),i[a]));throw n=new Error(r),n.index=I,n.description=r,n}function _1(e){e.type===Md&&De(e,yre),e.type===Du&&De(e,dre),e.type===Od&&De(e,pre),e.type===gu&&De(e,gre),e.type===fo&&De(e,mre),De(e,It,e.value)}function mn(e){const t=jn();(t.type!==Bn||t.value!==e)&&_1(t)}function Ze(e){return qe.type===Bn&&qe.value===e}function Hx(e){return qe.type===fo&&qe.value===e}function zre(){const e=[];for(I=qe.start,mn("[");!Ze("]");)Ze(",")?(jn(),e.push(null)):(e.push(mu()),Ze("]")||mn(","));return jn(),Rre(e)}function UT(){I=qe.start;const e=jn();return e.type===Od||e.type===Du?(e.octal&&De(e,a4),Jf(e)):jS(e.value)}function Bre(){var e,t,n,i;if(I=qe.start,e=qe,e.type===gu)return n=UT(),mn(":"),i=mu(),BT("init",n,i);if(e.type===Md||e.type===Bn)_1(e);else return t=UT(),mn(":"),i=mu(),BT("init",t,i)}function Ure(){var e=[],t,n,i,r={},s=String;for(I=qe.start,mn("{");!Ze("}");)t=Bre(),t.key.type===s4?n=t.key.name:n=s(t.key.value),i="$"+n,Object.prototype.hasOwnProperty.call(r,i)?De({},xre):r[i]=!0,e.push(t),Ze("}")||mn(",");return mn("}"),Pre(e)}function jre(){mn("(");const e=qS();return mn(")"),e}const qre={if:1};function Vre(){var e,t,n;if(Ze("("))return jre();if(Ze("["))return zre();if(Ze("{"))return Ure();if(e=qe.type,I=qe.start,e===gu||qre[qe.value])n=jS(jn().value);else if(e===Od||e===Du)qe.octal&&De(qe,a4),n=Jf(jn());else{if(e===fo)throw new Error(Ph);e===v1?(t=jn(),t.value=t.value==="true",n=Jf(t)):e===b1?(t=jn(),t.value=null,n=Jf(t)):Ze("/")||Ze("/=")?(n=Jf(Ore()),c4()):_1(jn())}return n}function Wre(){const e=[];if(mn("("),!Ze(")"))for(;I<gn&&(e.push(mu()),!Ze(")"));)mn(",");return mn(")"),e}function Hre(){I=qe.start;const e=jn();return Nre(e)||_1(e),jS(e.value)}function Gre(){return mn("."),Hre()}function Yre(){mn("[");const e=qS();return mn("]"),e}function Xre(){var e,t,n;for(e=Vre();;)if(Ze("."))n=Gre(),e=zT(".",e,n);else if(Ze("("))t=Wre(),e=Dre(e,t);else if(Ze("["))n=Yre(),e=zT("[",e,n);else break;return e}function jT(){const e=Xre();if(qe.type===Bn&&(Ze("++")||Ze("--")))throw new Error(Ph);return e}function vg(){var e,t;if(qe.type!==Bn&&qe.type!==fo)t=jT();else{if(Ze("++")||Ze("--"))throw new Error(Ph);if(Ze("+")||Ze("-")||Ze("~")||Ze("!"))e=jn(),t=vg(),t=Lre(e.value,t);else{if(Hx("delete")||Hx("void")||Hx("typeof"))throw new Error(Ph);t=jT()}}return t}function qT(e){let t=0;if(e.type!==Bn&&e.type!==fo)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function Kre(){var e,t,n,i,r,s,a,o,u,l;if(e=qe,u=vg(),i=qe,r=qT(i),r===0)return u;for(i.prec=r,jn(),t=[e,qe],a=vg(),s=[u,i,a];(r=qT(qe))>0;){for(;s.length>2&&r<=s[s.length-2].prec;)a=s.pop(),o=s.pop().value,u=s.pop(),t.pop(),n=LT(o,u,a),s.push(n);i=jn(),i.prec=r,s.push(i),t.push(qe),n=vg(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=LT(s[l-1].value,s[l-2],n),l-=2;return n}function mu(){var e,t,n;return e=Kre(),Ze("?")&&(jn(),t=mu(),mn(":"),n=mu(),e=Ire(e,t,n)),e}function qS(){const e=mu();if(Ze(","))throw new Error(Ph);return e}function VS(e){ie=e,I=0,gn=ie.length,qe=null,c4();const t=qS();if(qe.type!==Md)throw new Error("Unexpect token after expression.");return t}var f4={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function h4(e){function t(a,o,u,l){let c=e(o[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+a+(l<0?"":l===0?"()":"("+o.slice(1).map(e).join(",")+")")}function n(a,o,u){return l=>t(a,l,o,u)}const i="new Date",r="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(a){a.length<3&&P("Missing arguments to clamp function."),a.length>3&&P("Too many arguments to clamp function.");const o=a.map(e);return"Math.max("+o[1]+", Math.min("+o[2]+","+o[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:s,test:n("test",s),if:function(a){a.length<3&&P("Missing arguments to if function."),a.length>3&&P("Too many arguments to if function.");const o=a.map(e);return"("+o[0]+"?"+o[1]+":"+o[2]+")"}}}function Qre(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function d4(e){e=e||{};const t=e.allowed?ur(e.allowed):{},n=e.forbidden?ur(e.forbidden):{},i=e.constants||f4,r=(e.functions||h4)(f),s=e.globalvar,a=e.fieldvar,o=we(s)?s:p=>`${s}["${p}"]`;let u={},l={},c=0;function f(p){if(J(p))return p;const g=h[p.type];return g==null&&P("Unsupported type: "+p.type),g(p)}const h={Literal:p=>p.raw,Identifier:p=>{const g=p.name;return c>0?g:Z(n,g)?P("Illegal identifier: "+g):Z(i,g)?i[g]:Z(t,g)?g:(u[g]=1,o(g))},MemberExpression:p=>{const g=!p.computed,m=f(p.object);g&&(c+=1);const y=f(p.property);return m===a&&(l[Qre(y)]=1),g&&(c-=1),m+(g?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&P("Illegal callee type: "+p.callee.type);const g=p.callee.name,m=p.arguments,y=Z(r,g)&&r[g];return y||P("Unrecognized function: "+g),we(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{c+=1;const g=f(p.key);return c-=1,g+":"+f(p.value)}};function d(p){const g={code:f(p),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},g}return d.functions=r,d.constants=i,d}const VT=Symbol("vega_selection_getter");function p4(e){return(!e.getter||!e.getter[VT])&&(e.getter=Mi(e.field),e.getter[VT]=!0),e.getter}const WS="intersect",WT="union",Jre="vlMulti",Zre="vlPoint",HT="or",ese="and",Ir="_vgsid_",zh=Mi(Ir),tse="E",nse="R",ise="R-E",rse="R-LE",sse="R-RE",ase="E-LT",ose="E-LTE",use="E-GT",lse="E-GTE",cse="E-VALID",fse="E-ONE",U0="index:unit";function GT(e,t){for(var n=t.fields,i=t.values,r=n.length,s=0,a,o;s<r;++s)if(o=n[s],a=p4(o)(e),Da(a)&&(a=fn(a)),Da(i[s])&&(i[s]=fn(i[s])),L(i[s])&&Da(i[s][0])&&(i[s]=i[s].map(fn)),o.type===tse){if(L(i[s])?!i[s].includes(a):a!==i[s])return!1}else if(o.type===nse){if(!gl(a,i[s]))return!1}else if(o.type===sse){if(!gl(a,i[s],!0,!1))return!1}else if(o.type===ise){if(!gl(a,i[s],!1,!1))return!1}else if(o.type===rse){if(!gl(a,i[s],!1,!0))return!1}else if(o.type===ase){if(a>=i[s])return!1}else if(o.type===ose){if(a>i[s])return!1}else if(o.type===use){if(a<=i[s])return!1}else if(o.type===lse){if(a<i[s])return!1}else if(o.type===cse){if(a===null||isNaN(a))return!1}else if(o.type===fse&&i[s].indexOf(a)===-1)return!1;return!0}function hse(e,t,n){for(var i=this.context.data[e],r=i?i.values.value:[],s=i?i[U0]&&i[U0].value:void 0,a=n===WS,o=r.length,u=0,l,c,f,h,d;u<o;++u)if(l=r[u],s&&a){if(c=c||{},f=c[h=l.unit]||0,f===-1)continue;if(d=GT(t,l),c[h]=d?-1:++f,d&&s.size===1)return!0;if(!d&&f===s.get(h).count)return!1}else if(d=GT(t,l),a^d)return d;return o&&a}const g4=Ec(zh),dse=g4.left,pse=g4.right;function gse(e,t,n){const i=this.context.data[e],r=i?i.values.value:[],s=i?i[U0]&&i[U0].value:void 0,a=n===WS,o=zh(t),u=dse(r,o);if(u===r.length||zh(r[u])!==o)return!1;if(s&&a){if(s.size===1)return!0;if(pse(r,o)-u<s.size)return!1}return!0}function mse(e,t){return e.map(n=>ve(t.fields?{values:t.fields.map(i=>p4(i)(n.datum))}:{[Ir]:zh(n.datum)},t))}function yse(e,t,n,i){for(var r=this.context.data[e],s=r?r.values.value:[],a={},o={},u={},l,c,f,h,d,p,g,m,y,x,v=s.length,b=0,w,E;b<v;++b)if(l=s[b],h=l.unit,c=l.fields,f=l.values,c&&f){for(w=0,E=c.length;w<E;++w)d=c[w],g=a[d.field]||(a[d.field]={}),m=g[h]||(g[h]=[]),u[d.field]=y=d.type.charAt(0),x=Gx[`${y}_union`],g[h]=x(m,Q(f[w]));n&&(m=o[h]||(o[h]=[]),m.push(Q(f).reduce((_,k,A)=>(_[c[A].field]=k,_),{})))}else d=Ir,p=zh(l),g=a[d]||(a[d]={}),m=g[h]||(g[h]=[]),m.push(p),n&&(m=o[h]||(o[h]=[]),m.push({[Ir]:p}));if(t=t||WT,a[Ir]?a[Ir]=Gx[`${Ir}_${t}`](...Object.values(a[Ir])):Object.keys(a).forEach(_=>{a[_]=Object.keys(a[_]).map(k=>a[_][k]).reduce((k,A)=>k===void 0?A:Gx[`${u[_]}_${t}`](k,A))}),s=Object.keys(o),n&&s.length){const _=i?Zre:Jre;a[_]=t===WT?{[HT]:s.reduce((k,A)=>(k.push(...o[A]),k),[])}:{[ese]:s.map(k=>({[HT]:o[k]}))}}return a}var Gx={[`${Ir}_union`]:sq,[`${Ir}_intersect`]:iq,E_union:function(e,t){if(!e.length)return t;for(var n=0,i=t.length;n<i;++n)e.includes(t[n])||e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.includes(n)):t},R_union:function(e,t){var n=fn(t[0]),i=fn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<i&&(e[1]=i),e):[n,i]},R_intersect:function(e,t){var n=fn(t[0]),i=fn(t[1]);return n>i&&(n=t[1],i=t[0]),e.length?i<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>i&&(e[1]=i),e):[n,i]}};const xse=":",vse="@";function HS(e,t,n,i){t[0].type!==pu&&P("First argument to selection functions must be a string literal.");const r=t[0].value,s=t.length>=2&&Fe(t).value,a="unit",o=vse+a,u=xse+r;s===WS&&!Z(i,o)&&(i[o]=n.getData(r).indataRef(n,a)),Z(i,u)||(i[u]=n.getData(r).tuplesRef())}function m4(e){const t=this.context.data[e];return t?t.values.value:[]}function bse(e,t,n){const i=this.context.data[e]["index:"+t],r=i?i.value.get(n):void 0;return r&&r.count}function wse(e,t){const n=this.context.dataflow,i=this.context.data[e],r=i.input;return n.pulse(r,n.changeset().remove(Oi).insert(t)),1}function _se(e,t,n){if(e){const i=this.context.dataflow,r=e.mark.source;i.pulse(r,i.changeset().encode(e,t))}return n!==void 0?n:e}const Rd=e=>function(t,n){const i=this.context.dataflow.locale();return t===null?"null":i[e](n)(t)},Ese=Rd("format"),y4=Rd("timeFormat"),Sse=Rd("utcFormat"),kse=Rd("timeParse"),Ase=Rd("utcParse"),Dp=new Date(2e3,0,1);function E1(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(Dp.setYear(2e3),Dp.setMonth(e),Dp.setDate(t),y4.call(this,Dp,n))}function Cse(e){return E1.call(this,e,1,"%B")}function $se(e){return E1.call(this,e,1,"%b")}function Tse(e){return E1.call(this,0,2+e,"%A")}function Fse(e){return E1.call(this,0,2+e,"%a")}const Mse=":",Ose="@",_2="%",x4="$";function GS(e,t,n,i){t[0].type!==pu&&P("First argument to data functions must be a string literal.");const r=t[0].value,s=Mse+r;if(!Z(s,i))try{i[s]=n.getData(r).tuplesRef()}catch{}}function Nse(e,t,n,i){t[0].type!==pu&&P("First argument to indata must be a string literal."),t[1].type!==pu&&P("Second argument to indata must be a string literal.");const r=t[0].value,s=t[1].value,a=Ose+s;Z(a,i)||(i[a]=n.getData(r).indataRef(n,s))}function Fn(e,t,n,i){if(t[0].type===pu)YT(n,i,t[0].value);else for(e in n.scales)YT(n,i,e)}function YT(e,t,n){const i=_2+n;if(!Z(t,i))try{t[i]=e.scaleRef(n)}catch{}}function cs(e,t){if(J(e)){const n=t.scales[e];return n&&LY(n.value)?n.value:void 0}}function Rse(e,t,n){t.__bandwidth=r=>r&&r.bandwidth?r.bandwidth():0,n._bandwidth=Fn,n._range=Fn,n._scale=Fn;const i=r=>"_["+(r.type===pu?G(_2+r.value):G(_2)+"+"+e(r))+"]";return{_bandwidth:r=>`this.__bandwidth(${i(r[0])})`,_range:r=>`${i(r[0])}.range()`,_scale:r=>`${i(r[0])}(${e(r[1])})`}}function YS(e,t){return function(n,i,r){if(n){const s=cs(n,(r||this).context);return s&&s.path[e](i)}else return t(i)}}const Dse=YS("area",ZJ),Ise=YS("bounds",iZ),Pse=YS("centroid",lZ);function Lse(e,t){const n=cs(e,(t||this).context);return n&&n.scale()}function zse(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function XS(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(i){e.warn(i)}return n[n.length-1]}function Bse(){return XS(this.context.dataflow,"warn",arguments)}function Use(){return XS(this.context.dataflow,"info",arguments)}function jse(){return XS(this.context.dataflow,"debug",arguments)}function Yx(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function E2(e){const t=Ha(e),n=Yx(t.r),i=Yx(t.g),r=Yx(t.b);return .2126*n+.7152*i+.0722*r}function qse(e,t){const n=E2(e),i=E2(t),r=Math.max(n,i),s=Math.min(n,i);return(r+.05)/(s+.05)}function Vse(){const e=[].slice.call(arguments);return e.unshift({}),ve(...e)}function v4(e,t){return e===t||e!==e&&t!==t?!0:L(e)?L(t)&&e.length===t.length?Wse(e,t):!1:K(e)&&K(t)?b4(e,t):!1}function Wse(e,t){for(let n=0,i=e.length;n<i;++n)if(!v4(e[n],t[n]))return!1;return!0}function b4(e,t){for(const n in e)if(!v4(e[n],t[n]))return!1;return!0}function XT(e){return t=>b4(e,t)}function Hse(e,t,n,i,r,s){const a=this.context.dataflow,o=this.context.data[e],u=o.input,l=a.stamp();let c=o.changes,f,h;if(a._trigger===!1||!(u.value.length||t||i))return 0;if((!c||c.stamp<l)&&(o.changes=c=a.changeset(),c.stamp=l,a.runAfter(()=>{o.modified=!0,a.pulse(u,c).run()},!0,1)),n&&(f=n===!0?Oi:L(n)||Om(n)?n:XT(n),c.remove(f)),t&&c.insert(t),i&&(f=XT(i),u.value.some(f)?c.remove(f):c.insert(i)),r)for(h in s)c.modify(r,h,s[h]);return 1}function Gse(e){const t=e.touches,n=t[0].clientX-t[1].clientX,i=t[0].clientY-t[1].clientY;return Math.hypot(n,i)}function Yse(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const KT={};function Xse(e,t){const n=KT[t]||(KT[t]=Mi(t));return L(e)?e.map(n):n(e)}function S1(e){return L(e)||ArrayBuffer.isView(e)?e:null}function KS(e){return S1(e)||(J(e)?e:null)}function Kse(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return S1(e).join(...n)}function Qse(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return KS(e).indexOf(...n)}function Jse(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return KS(e).lastIndexOf(...n)}function Zse(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return KS(e).slice(...n)}function eae(e,t,n){return we(n)&&P("Function argument passed to replace."),String(e).replace(t,n)}function tae(e){return S1(e).slice().reverse()}function nae(e){return S1(e).slice().sort(wc)}function iae(e,t,n){return lE(e||0,t||0,n||0)}function rae(e,t){const n=cs(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function sae(e,t){const n=cs(e,(t||this).context);return n?n.copy():void 0}function aae(e,t){const n=cs(e,(t||this).context);return n?n.domain():[]}function oae(e,t,n){const i=cs(e,(n||this).context);return i?L(t)?(i.invertRange||i.invert)(t):(i.invert||i.invertExtent)(t):void 0}function uae(e,t){const n=cs(e,(t||this).context);return n&&n.range?n.range():[]}function lae(e,t,n){const i=cs(e,(n||this).context);return i?i(t):void 0}function cae(e,t,n,i,r){let s=typeof e=="string"?cs(e,(r||this).context):e;const a=c5(t,n);let o=s.domain(),u=o[0],l=Fe(o),c=yn;return l-u?c=JI(s,u,l):s=(s.interpolator?Le("sequential")().interpolator(s.interpolator()):Le("linear")().interpolate(s.interpolate()).range(s.range())).domain([u=0,l=1]),s.ticks&&(o=s.ticks(+i||15),u!==o[0]&&o.unshift(u),l!==Fe(o)&&o.push(l)),o.forEach(f=>a.stop(c(f),s(f))),a}function fae(e,t,n){const i=cs(e,(n||this).context);return function(r){return i?i.path.context(r)(t):""}}function hae(e){let t=null;return function(n){return n?Th(n,t=t||Hl(e)):e}}const w4=e=>e.data;function _4(e,t){const n=m4.call(t,e);return n.root&&n.root.lookup||{}}function dae(e,t,n){const i=_4(e,this),r=i[t],s=i[n];return r&&s?r.path(s).map(w4):void 0}function pae(e,t){const n=_4(e,this)[t];return n?n.ancestors().map(w4):void 0}const E4=()=>typeof window<"u"&&window||null;function gae(){const e=E4();return e?e.screen:{}}function mae(){const e=E4();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function yae(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function S4(e,t,n){if(!e)return[];const[i,r]=e,s=new wt().set(i[0],i[1],r[0],r[1]),a=n||this.context.dataflow.scenegraph().root;return o6(a,s,xae(t))}function xae(e){let t=null;if(e){const n=Q(e.marktype),i=Q(e.markname);t=r=>(!n.length||n.some(s=>r.marktype===s))&&(!i.length||i.some(s=>r.name===s))}return t}function vae(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:5;e=Q(e);const r=e[e.length-1];return r===void 0||Math.hypot(r[0]-t,r[1]-n)>i?[...e,[t,n]]:e}function bae(e){return Q(e).reduce((t,n,i)=>{let[r,s]=n;return t+=i==0?`M ${r},${s} `:i===e.length-1?" Z":`L ${r},${s} `},"")}function wae(e,t,n){const{x:i,y:r,mark:s}=n,a=new wt().set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[u,l]of t)u<a.x1&&(a.x1=u),u>a.x2&&(a.x2=u),l<a.y1&&(a.y1=l),l>a.y2&&(a.y2=l);return a.translate(i,r),S4([[a.x1,a.y1],[a.x2,a.y2]],e,s).filter(u=>_ae(u.x,u.y,t))}function _ae(e,t,n){let i=0;for(let r=0,s=n.length-1;r<n.length;s=r++){const[a,o]=n[s],[u,l]=n[r];l>t!=o>t&&e<(a-u)*(t-l)/(o-l)+u&&i++}return i&1}const Bh={random(){return Ri()},cumulativeNormal:Pm,cumulativeLogNormal:l_,cumulativeUniform:d_,densityNormal:r_,densityLogNormal:u_,densityUniform:h_,quantileNormal:Lm,quantileLogNormal:c_,quantileUniform:p_,sampleNormal:Im,sampleLogNormal:o_,sampleUniform:f_,isArray:L,isBoolean:ao,isDate:Da,isDefined(e){return e!==void 0},isNumber:Ie,isObject:K,isRegExp:MN,isString:J,isTuple:Om,isValid(e){return e!=null&&e===e},toBoolean:Pw,toDate(e){return Lw(e)},toNumber:fn,toString:zw,indexof:Qse,join:Kse,lastindexof:Jse,replace:eae,reverse:tae,sort:nae,slice:Zse,flush:TN,lerp:ON,merge:Vse,pad:DN,peek:Fe,pluck:Xse,span:od,inrange:gl,truncate:IN,rgb:Ha,lab:Yg,hcl:Xg,hsl:Hg,luminance:E2,contrast:qse,sequence:si,format:Ese,utcFormat:Sse,utcParse:Ase,utcOffset:gR,utcSequence:xR,timeFormat:y4,timeParse:kse,timeOffset:pR,timeSequence:yR,timeUnitSpecifier:iR,monthFormat:Cse,monthAbbrevFormat:$se,dayFormat:Tse,dayAbbrevFormat:Fse,quarter:kN,utcquarter:AN,week:sR,utcweek:uR,dayofyear:rR,utcdayofyear:oR,warn:Bse,info:Use,debug:jse,extent(e){return Yr(e)},inScope:zse,intersect:S4,clampRange:CN,pinchDistance:Gse,pinchAngle:Yse,screen:gae,containerSize:yae,windowSize:mae,bandspace:iae,setdata:wse,pathShape:hae,panLinear:wN,panLog:_N,panPow:EN,panSymlog:SN,zoomLinear:Mw,zoomLog:Ow,zoomPow:Ng,zoomSymlog:Nw,encode:_se,modify:Hse,lassoAppend:vae,lassoPath:bae,intersectLasso:wae},Eae=["view","item","group","xy","x","y"],Sae="event.vega.",k4="this.",QS={},A4={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${G(x4+e)}]`,functions:kae,constants:f4,visitors:QS},S2=d4(A4);function kae(e){const t=h4(e);Eae.forEach(n=>t[n]=Sae+n);for(const n in Bh)t[n]=k4+n;return ve(t,Rse(e,Bh,QS)),t}function vt(e,t,n){return arguments.length===1?Bh[e]:(Bh[e]=t,n&&(QS[e]=n),S2&&(S2.functions[e]=k4+e),this)}vt("bandwidth",rae,Fn);vt("copy",sae,Fn);vt("domain",aae,Fn);vt("range",uae,Fn);vt("invert",oae,Fn);vt("scale",lae,Fn);vt("gradient",cae,Fn);vt("geoArea",Dse,Fn);vt("geoBounds",Ise,Fn);vt("geoCentroid",Pse,Fn);vt("geoShape",fae,Fn);vt("geoScale",Lse,Fn);vt("indata",bse,Nse);vt("data",m4,GS);vt("treePath",dae,GS);vt("treeAncestors",pae,GS);vt("vlSelectionTest",hse,HS);vt("vlSelectionIdTest",gse,HS);vt("vlSelectionResolve",yse,HS);vt("vlSelectionTuples",mse);function Zr(e,t){const n={};let i;try{e=J(e)?e:G(e)+"",i=VS(e)}catch{P("Expression parse error: "+e)}i.visit(s=>{if(s.type!==r4)return;const a=s.callee.name,o=A4.visitors[a];o&&o(a,s.arguments,t,n)});const r=S2(i);return r.globals.forEach(s=>{const a=x4+s;!Z(n,a)&&t.getSignal(s)&&(n[a]=t.signalRef(s))}),{$expr:ve({code:r.code},t.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function Aae(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(i=>t.parseOperator(i)),n.forEach(i=>t.parseOperatorParameters(i)),(e.streams||[]).forEach(i=>t.parseStream(i)),(e.updates||[]).forEach(i=>t.parseUpdate(i)),t.resolve()}const Cae=ur(["rule"]),QT=ur(["group","image","rect"]);function $ae(e,t){let n="";return Cae[t]||(e.x2&&(e.x?(QT[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(QT[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function JS(e){return(e+"").toLowerCase()}function Tae(e){return JS(e)==="operator"}function Fae(e){return JS(e)==="collect"}function vf(e,t,n){n.endsWith(";")||(n="return("+n+");");const i=Function(...t.concat(n));return e&&e.functions?i.bind(e.functions):i}function Mae(e,t,n,i){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${i}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${i} : `}var Oae={operator:(e,t)=>vf(e,["_"],t.code),parameter:(e,t)=>vf(e,["datum","_"],t.code),event:(e,t)=>vf(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return vf(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:i}=t;let r="var o=item,datum=o.datum,m=0,$;";for(const s in i){const a="o["+G(s)+"]";r+=`$=${i[s].code};if(${a}!==$)${a}=$,m=1;`}return r+=$ae(i,n),r+="return m;",vf(e,["item","_"],r)},codegen:{get(e){const t=`[${e.map(G).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const i=(s,a)=>{const o=t[a];let u,l;return s.path?(u=`a${s.path}`,l=`b${s.path}`):((n=n||{})["f"+a]=s,u=`this.f${a}(a)`,l=`this.f${a}(b)`),Mae(u,l,-o,o)},r=Function("a","b","var u, v; return "+e.map(i).join("")+"0;");return n?r.bind(n):r}}};function Nae(e){const t=this;Tae(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function Rae(e){const t=this;if(e.params){const n=t.get(e.id);n||P("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function Dae(e,t){t=t||{};const n=this;for(const i in e){const r=e[i];t[i]=L(r)?r.map(s=>JT(s,n,t)):JT(r,n,t)}return t}function JT(e,t,n){if(!e||!K(e))return e;for(let i=0,r=ZT.length,s;i<r;++i)if(s=ZT[i],Z(e,s.key))return s.parse(e,t,n);return e}var ZT=[{key:"$ref",parse:Iae},{key:"$key",parse:Lae},{key:"$expr",parse:Pae},{key:"$field",parse:zae},{key:"$encode",parse:Uae},{key:"$compare",parse:Bae},{key:"$context",parse:jae},{key:"$subflow",parse:qae},{key:"$tupleid",parse:Vae}];function Iae(e,t){return t.get(e.$ref)||P("Operator not defined: "+e.$ref)}function Pae(e,t,n){e.$params&&t.parseParameters(e.$params,n);const i="e:"+e.$expr.code;return t.fn[i]||(t.fn[i]=Jn(t.parameterExpression(e.$expr),e.$fields))}function Lae(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Iw(e.$key,e.$flat,t.expr.codegen))}function zae(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Mi(e.$field,e.$name,t.expr.codegen))}function Bae(e,t){const n="c:"+e.$compare+"_"+e.$order,i=Q(e.$compare).map(r=>r&&r.$tupleid?oe:r);return t.fn[n]||(t.fn[n]=Rw(i,e.$order,t.expr.codegen))}function Uae(e,t){const n=e.$encode,i={};for(const r in n){const s=n[r];i[r]=Jn(t.encodeExpression(s.$expr),s.$fields),i[r].output=s.$output}return i}function jae(e,t){return t}function qae(e,t){const n=e.$subflow;return function(i,r,s){const a=t.fork().parse(n),o=a.get(n.operators[0].id),u=a.signals.parent;return u&&u.set(s),o.detachSubflow=()=>t.detach(a),o}}function Vae(){return oe}function Wae(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,i=e.stream!=null?t.get(e.stream):void 0,r;e.source?i=t.events(e.source,e.type,n):e.merge&&(r=e.merge.map(s=>t.get(s)),i=r[0].merge.apply(r[0],r.slice(1))),e.between&&(r=e.between.map(s=>t.get(s)),i=i.between(r[0],r[1])),e.filter&&(i=i.filter(n)),e.throttle!=null&&(i=i.throttle(+e.throttle)),e.debounce!=null&&(i=i.debounce(+e.debounce)),i==null&&P("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),t.stream(e,i)}function Hae(e){var t=this,n=K(n=e.source)?n.$ref:n,i=t.get(n),r=null,s=e.update,a=void 0;i||P("Source not defined: "+e.source),r=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),s&&s.$expr&&(s.$params&&(a=t.parseParameters(s.$params)),s=t.handlerExpression(s.$expr)),t.update(e,i,r,s,a)}const Gae={skip:!0};function Yae(e){var t=this,n={};if(e.signals){var i=n.signals={};Object.keys(t.signals).forEach(s=>{const a=t.signals[s];e.signals(s,a)&&(i[s]=a.value)})}if(e.data){var r=n.data={};Object.keys(t.data).forEach(s=>{const a=t.data[s];e.data(s,a)&&(r[s]=a.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(s=>s.getState(e))),n}function Xae(e){var t=this,n=t.dataflow,i=e.data,r=e.signals;Object.keys(r||{}).forEach(s=>{n.update(t.signals[s],r[s],Gae)}),Object.keys(i||{}).forEach(s=>{n.pulse(t.data[s].input,n.changeset().remove(Oi).insert(i[s]))}),(e.subcontext||[]).forEach((s,a)=>{const o=t.subcontext[a];o&&o.setState(s)})}function C4(e,t,n,i){return new $4(e,t,n,i)}function $4(e,t,n,i){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=i||Oae,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function eF(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}$4.prototype=eF.prototype={fork(){const e=new eF(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,i=n.dataflow,r=e.value;if(n.set(e.id,t),Fae(e.type)&&r&&(r.$ingest?i.ingest(t,r.$ingest,r.$format):r.$request?i.preload(t,r.$request,r.$format):i.pulse(t,i.changeset().insert(r))),e.root&&(n.root=t),e.parent){let s=n.get(e.parent.$ref);s?(i.connect(s,[t]),t.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(e.parent.$ref),i.connect(s,[t]),t.targets().add(s)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const s in e.data){const a=n.data[s]||(n.data[s]={});e.data[s].forEach(o=>a[o]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[JS(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,i,r){this.dataflow.on(t,n,i,r,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:Aae,parseOperator:Nae,parseOperatorParameters:Rae,parseParameters:Dae,parseStream:Wae,parseUpdate:Hae,getState:Yae,setState:Xae};function Kae(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),T4(t,e.description()))}function T4(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function Qae(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const Xx="default";function Jae(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:Xx,item:null}));e.on(e.events("view","pointermove"),t,(n,i)=>{const r=t.value,s=r?J(r)?r:r.user:Xx,a=i.item&&i.item.cursor||null;return r&&s===r.user&&a==r.item?r:{user:s,item:a}}),e.add(null,function(n){let i=n.cursor,r=this.value;return J(i)||(r=i.item,i=i.user),k2(e,i&&i!==Xx?i:r||i),r},{cursor:t})}function k2(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function j0(e,t){var n=e._runtime.data;return Z(n,t)||P("Unrecognized data set: "+t),n[t]}function Zae(e,t){return arguments.length<2?j0(this,e).values.value:k1.call(this,e,Ou().remove(Oi).insert(t))}function k1(e,t){WR(t)||P("Second argument to changes must be a changeset.");const n=j0(this,e);return n.modified=!0,this.pulse(n.input,t)}function eoe(e,t){return k1.call(this,e,Ou().insert(t))}function toe(e,t){return k1.call(this,e,Ou().remove(t))}function F4(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function M4(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function A1(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function noe(e){var t=A1(e),n=F4(e),i=M4(e);e._renderer.background(e.background()),e._renderer.resize(n,i,t),e._handler.origin(t),e._resizeListeners.forEach(r=>{try{r(n,i)}catch(s){e.error(s)}})}function ioe(e,t,n){var i=e._renderer,r=i&&i.canvas(),s,a,o;return r&&(o=A1(e),a=t.changedTouches?t.changedTouches[0]:t,s=f1(a,r),s[0]-=o[0],s[1]-=o[1]),t.dataflow=e,t.item=n,t.vega=roe(e,n,s),t}function roe(e,t,n){const i=t?t.mark.marktype==="group"?t:t.mark.group:null;function r(a){var o=i,u;if(a){for(u=t;u;u=u.mark.group)if(u.mark.name===a){o=u;break}}return o&&o.mark&&o.mark.interactive?o:{}}function s(a){if(!a)return n;J(a)&&(a=r(a));const o=n.slice();for(;a;)o[0]-=a.x||0,o[1]-=a.y||0,a=a.mark&&a.mark.group;return o}return{view:xn(e),item:xn(t||{}),group:r,xy:s,x:a=>s(a)[0],y:a=>s(a)[1]}}const tF="view",soe="timer",aoe="window",ooe={trap:!1};function uoe(e){const t=ve({defaults:{}},e),n=(i,r)=>{r.forEach(s=>{L(i[s])&&(i[s]=ur(i[s]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function O4(e,t,n,i){e._eventListeners.push({type:n,sources:Q(t),handler:i})}function loe(e,t){var n=e._eventConfig.defaults,i=n.prevent,r=n.allow;return i===!1||r===!0?!1:i===!0||r===!1?!0:i?i[t]:r?!r[t]:e.preventDefault()}function Ip(e,t,n){const i=e._eventConfig&&e._eventConfig[t];return i===!1||K(i)&&!i[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function coe(e,t,n){var i=this,r=new Dm(n),s=function(l,c){i.runAsync(null,()=>{e===tF&&loe(i,t)&&l.preventDefault(),r.receive(ioe(i,l,c))})},a;if(e===soe)Ip(i,"timer",t)&&i.timer(s,t);else if(e===tF)Ip(i,"view",t)&&i.addEventListener(t,s,ooe);else if(e===aoe?Ip(i,"window",t)&&typeof window<"u"&&(a=[window]):typeof document<"u"&&Ip(i,"selector",t)&&(a=Array.from(document.querySelectorAll(e))),!a)i.warn("Can not resolve event source: "+e);else{for(var o=0,u=a.length;o<u;++o)a[o].addEventListener(t,s);O4(i,a,t,s)}return r}function nF(e){return e.item}function iF(e){return e.item.mark.source}function rF(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function foe(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","pointerover",nF),iF,rF(e)),this.on(this.events("view","pointerout",nF),iF,rF(t)),this}function hoe(){var e=this._tooltip,t=this._timers,n=this._handler.handlers(),i=this._eventListeners,r,s,a,o,u;for(r=t.length;--r>=0;)t[r].stop();for(r=i.length;--r>=0;)for(a=i[r],s=a.sources.length;--s>=0;)a.sources[s].removeEventListener(a.type,a.handler);for(e&&e.call(this,this._handler,null,null,null),r=n.length;--r>=0;)u=n[r].type,o=n[r].handler,this._handler.off(u,o);return this}function li(e,t,n){const i=document.createElement(e);for(const r in t)i.setAttribute(r,t[r]);return n!=null&&(i.textContent=n),i}const doe="vega-bind",poe="vega-bind-name",goe="vega-bind-radio";function moe(e,t,n){if(!t)return;const i=n.param;let r=n.state;return r||(r=n.state={elements:null,active:!1,set:null,update:a=>{a!=e.signal(i.signal)&&e.runAsync(null,()=>{r.source=!0,e.signal(i.signal,a)})}},i.debounce&&(r.update=Dw(i.debounce,r.update))),(i.input==null&&i.element?yoe:voe)(r,t,i,e),r.active||(e.on(e._signals[i.signal],null,()=>{r.source?r.source=!1:r.set(e.signal(i.signal))}),r.active=!0),r}function yoe(e,t,n,i){const r=n.event||"input",s=()=>e.update(t.value);i.signal(n.signal,t.value),t.addEventListener(r,s),O4(i,t,r,s),e.set=a=>{t.value=a,t.dispatchEvent(xoe(r))}}function xoe(e){return typeof Event<"u"?new Event(e):{type:e}}function voe(e,t,n,i){const r=i.signal(n.signal),s=li("div",{class:doe}),a=n.input==="radio"?s:s.appendChild(li("label"));a.appendChild(li("span",{class:poe},n.name||n.signal)),t.appendChild(s);let o=boe;switch(n.input){case"checkbox":o=woe;break;case"select":o=_oe;break;case"radio":o=Eoe;break;case"range":o=Soe;break}o(e,a,n,r)}function boe(e,t,n,i){const r=li("input");for(const s in n)s!=="signal"&&s!=="element"&&r.setAttribute(s==="input"?"type":s,n[s]);r.setAttribute("name",n.signal),r.value=i,t.appendChild(r),r.addEventListener("input",()=>e.update(r.value)),e.elements=[r],e.set=s=>r.value=s}function woe(e,t,n,i){const r={type:"checkbox",name:n.signal};i&&(r.checked=!0);const s=li("input",r);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=a=>s.checked=!!a||null}function _oe(e,t,n,i){const r=li("select",{name:n.signal}),s=n.labels||[];n.options.forEach((a,o)=>{const u={value:a};q0(a,i)&&(u.selected=!0),r.appendChild(li("option",u,(s[o]||a)+""))}),t.appendChild(r),r.addEventListener("change",()=>{e.update(n.options[r.selectedIndex])}),e.elements=[r],e.set=a=>{for(let o=0,u=n.options.length;o<u;++o)if(q0(n.options[o],a)){r.selectedIndex=o;return}}}function Eoe(e,t,n,i){const r=li("span",{class:goe}),s=n.labels||[];t.appendChild(r),e.elements=n.options.map((a,o)=>{const u={type:"radio",name:n.signal,value:a};q0(a,i)&&(u.checked=!0);const l=li("input",u);l.addEventListener("change",()=>e.update(a));const c=li("label",{},(s[o]||a)+"");return c.prepend(l),r.appendChild(c),l}),e.set=a=>{const o=e.elements,u=o.length;for(let l=0;l<u;++l)q0(o[l].value,a)&&(o[l].checked=!0)}}function Soe(e,t,n,i){i=i!==void 0?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,s=n.min||Math.min(0,r,+i)||0,a=n.step||qa(s,r,100),o=li("input",{type:"range",name:n.signal,min:s,max:r,step:a});o.value=i;const u=li("span",{},+i);t.appendChild(o),t.appendChild(u);const l=()=>{u.textContent=o.value,e.update(+o.value)};o.addEventListener("input",l),o.addEventListener("change",l),e.elements=[o],e.set=c=>{o.value=c,u.textContent=c}}function q0(e,t){return e===t||e+""==t+""}function N4(e,t,n,i,r,s){return t=t||new i(e.loader()),t.initialize(n,F4(e),M4(e),A1(e),r,s).background(e.background())}function ZS(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function koe(e,t,n,i){const r=new i(e.loader(),ZS(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,A1(e),e);return t&&t.handlers().forEach(s=>{r.on(s.type,s.handler)}),r}function Aoe(e,t){const n=this,i=n._renderType,r=n._eventConfig.bind,s=h1(i);e=n._el=e?Kx(n,e,!0):null,Kae(n),s||n.error("Unrecognized renderer type: "+i);const a=s.handler||Ad,o=e?s.renderer:s.headless;return n._renderer=o?N4(n,n._renderer,e,o):null,n._handler=koe(n,n._handler,e,a),n._redraw=!0,e&&r!=="none"&&(t=t?n._elBind=Kx(n,t,!0):e.appendChild(li("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&r!=="container"&&(u.element=Kx(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{moe(n,u.element||t,u)})),n}function Kx(e,t,n){if(typeof t=="string")if(typeof document<"u"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.textContent=""}catch(i){t=null,e.error(i)}return t}const bf=e=>+e||0,Coe=e=>({top:e,bottom:e,left:e,right:e});function sF(e){return K(e)?{top:bf(e.top),bottom:bf(e.bottom),left:bf(e.left),right:bf(e.right)}:Coe(bf(e))}async function ek(e,t,n,i){const r=h1(t),s=r&&r.headless;return s||P("Unrecognized renderer type: "+t),await e.runAsync(),N4(e,null,null,s,n,i).renderAsync(e._scenegraph.root)}async function $oe(e,t){e!==Ca.Canvas&&e!==Ca.SVG&&e!==Ca.PNG&&P("Unrecognized image type: "+e);const n=await ek(this,e,t);return e===Ca.SVG?Toe(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function Toe(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function Foe(e,t){return(await ek(this,Ca.Canvas,e,t)).canvas()}async function Moe(e){return(await ek(this,Ca.SVG,e)).svg()}function Ooe(e,t,n){return C4(e,Bl,Bh,n).parse(t)}function Noe(e){var t=this._runtime.scales;return Z(t,e)||P("Unrecognized scale or projection: "+e),t[e].value}var R4="width",D4="height",tk="padding",aF={skip:!0};function I4(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===tk?i.left+i.right:0)}function P4(e,t){var n=e.autosize(),i=e.padding();return t-(n&&n.contains===tk?i.top+i.bottom:0)}function Roe(e){var t=e._signals,n=t[R4],i=t[D4],r=t[tk];function s(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,o=>{e._width=o.size,e._viewWidth=I4(e,o.size),s()},{size:n}),e._resizeHeight=e.add(null,o=>{e._height=o.size,e._viewHeight=P4(e,o.size),s()},{size:i});const a=e.add(null,s,{pad:r});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=i.rank+1,a.rank=r.rank+1}function Doe(e,t,n,i,r,s){this.runAfter(a=>{let o=0;a._autosize=0,a.width()!==n&&(o=1,a.signal(R4,n,aF),a._resizeWidth.skip(!0)),a.height()!==i&&(o=1,a.signal(D4,i,aF),a._resizeHeight.skip(!0)),a._viewWidth!==e&&(a._resize=1,a._viewWidth=e),a._viewHeight!==t&&(a._resize=1,a._viewHeight=t),(a._origin[0]!==r[0]||a._origin[1]!==r[1])&&(a._resize=1,a._origin=r),o&&a.run("enter"),s&&a.runAfter(u=>u.resize())},!1,1)}function Ioe(e){return this._runtime.getState(e||{data:Poe,signals:Loe,recurse:!0})}function Poe(e,t){return t.modified&&L(t.input.value)&&!e.startsWith("_:vega:_")}function Loe(e,t){return!(e==="parent"||t instanceof Bl.proxy)}function zoe(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function Boe(e,t){function n(i){e({timestamp:Date.now(),elapsed:i})}this._timers.push(cte(n,t))}function Uoe(e,t,n,i){const r=e.element();r&&r.setAttribute("title",joe(i))}function joe(e){return e==null?"":L(e)?L4(e):K(e)&&!Da(e)?qoe(e):e+""}function qoe(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(L(n)?L4(n):z4(n))}).join(`
`)}function L4(e){return"["+e.map(z4).join(", ")+"]"}function z4(e){return L(e)?"[…]":K(e)&&!Da(e)?"{…}":e}function Voe(){if(this.renderer()==="canvas"&&this._renderer._canvas){let e=null;const t=()=>{e?.();const n=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);n.addEventListener("change",t),e=()=>{n.removeEventListener("change",t)},this._renderer._canvas.getContext("2d").pixelRatio=window.devicePixelRatio||1,this._redraw=!0,this._resize=1,this.resize().runAsync()};t()}}function B4(e,t){const n=this;if(t=t||{},Sl.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=ve({},e.locale,t.locale);n.locale(DR(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||Ca.Canvas,n._scenegraph=new R5;const i=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||Uoe,n._redraw=!0,n._handler=new Ad().scene(i),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=uoe(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const r=Ooe(n,e,t.expr);n._runtime=r,n._signals=r.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:ve({},s)})),r.root&&r.root.set(i),i.source=r.data.root.input,n.pulse(r.data.root.input,n.changeset().insert(i.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=I4(n,n._width),n._viewHeight=P4(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,Roe(n),Qae(n),Jae(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind),t.watchPixelRatio&&n._watchPixelRatio()}function Pp(e,t){return Z(e._signals,t)?e._signals[t]:P("Unrecognized signal name: "+G(t))}function U4(e,t){const n=(e._targets||[]).filter(i=>i._update&&i._update.handler===t);return n.length?n[0]:null}function oF(e,t,n,i){let r=U4(n,i);return r||(r=ZS(e,()=>i(t,n.value)),r.handler=i,e.on(n,null,r)),e}function uF(e,t,n){const i=U4(t,n);return i&&t._targets.remove(i),e}Y(B4,Sl,{async evaluate(e,t,n){if(await Sl.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,noe(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(i){this.error(i)}return n&&ng(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&T4(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const i=Pp(this,e);return arguments.length===1?i.value:this.update(i,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",sF(e)):sF(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(h1(e)||P("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Sl.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(Pp(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:Doe,addEventListener(e,t,n){let i=t;return n&&n.trap===!1||(i=ZS(this,t),i.raw=t),this._handler.on(e,i),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),i=n.length,r,s;--i>=0;)if(s=n[i].type,r=n[i].handler,e===s&&(t===r||t===r.raw)){this._handler.off(s,r);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.includes(e)||t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return oF(this,e,Pp(this,e),t)},removeSignalListener(e,t){return uF(this,Pp(this,e),t)},addDataListener(e,t){return oF(this,e,j0(this,e).values,t)},removeDataListener(e,t){return uF(this,j0(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=k2(this,null);this._globalCursor=!!e,t&&k2(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:Boe,events:coe,finalize:hoe,hover:foe,data:Zae,change:k1,insert:eoe,remove:toe,scale:Noe,initialize:Aoe,toImageURL:$oe,toCanvas:Foe,toSVG:Moe,getState:Ioe,setState:zoe,_watchPixelRatio:Voe});const Woe="view",V0="[",W0="]",j4="{",q4="}",Hoe=":",V4=",",Goe="@",Yoe=">",Xoe=/[[\]{}]/,Koe={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let W4,H4;function ho(e,t,n){return W4=t||Woe,H4=n||Koe,G4(e.trim()).map(A2)}function Qoe(e){return H4[e]}function dh(e,t,n,i,r){const s=e.length;let a=0,o;for(;t<s;++t){if(o=e[t],!a&&o===n)return t;r&&r.indexOf(o)>=0?--a:i&&i.indexOf(o)>=0&&++a}return t}function G4(e){const t=[],n=e.length;let i=0,r=0;for(;r<n;)r=dh(e,r,V4,V0+j4,W0+q4),t.push(e.substring(i,r).trim()),i=++r;if(t.length===0)throw"Empty event selector: "+e;return t}function A2(e){return e[0]==="["?Joe(e):Zoe(e)}function Joe(e){const t=e.length;let n=1,i;if(n=dh(e,n,W0,V0,W0),n===t)throw"Empty between selector: "+e;if(i=G4(e.substring(1,n)),i.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==Yoe)throw"Expected '>' after between selector: "+e;i=i.map(A2);const r=A2(e.slice(1).trim());return r.between?{between:i,stream:r}:(r.between=i,r)}function Zoe(e){const t={source:W4},n=[];let i=[0,0],r=0,s=0,a=e.length,o=0,u,l;if(e[a-1]===q4){if(o=e.lastIndexOf(j4),o>=0){try{i=eue(e.substring(o+1,a-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,o).trim(),a=e.length}else throw"Unmatched right brace: "+e;o=0}if(!a)throw e;if(e[0]===Goe&&(r=++o),u=dh(e,o,Hoe),u<a&&(n.push(e.substring(s,u).trim()),s=o=++u),o=dh(e,o,V0),o===a)n.push(e.substring(s,a).trim());else if(n.push(e.substring(s,o).trim()),l=[],s=++o,s===a)throw"Unmatched left bracket: "+e;for(;o<a;){if(o=dh(e,o,W0),o===a)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,o).trim()),o<a-1&&e[++o]!==V0)throw"Expected left bracket: "+e;s=++o}if(!(a=n.length)||Xoe.test(n[a-1]))throw"Invalid event selector: "+e;return a>1?(t.type=n[1],r?t.markname=n[0].slice(1):Qoe(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),i[0]&&(t.throttle=i[0]),i[1]&&(t.debounce=i[1]),t}function eue(e){const t=e.split(V4);if(!e.length||t.length>2)throw e;return t.map(n=>{const i=+n;if(i!==i)throw e;return i})}function tue(e){return K(e)?e:{type:e||"pad"}}const wf=e=>+e||0,nue=e=>({top:e,bottom:e,left:e,right:e});function iue(e){return K(e)?e.signal?e:{top:wf(e.top),bottom:wf(e.bottom),left:wf(e.left),right:wf(e.right)}:nue(wf(e))}const Pt=e=>K(e)&&!L(e)?ve({},e):{value:e};function lF(e,t,n,i){return n!=null?(K(n)&&!L(n)||L(n)&&n.length&&K(n[0])?e.update[t]=n:e[i||"enter"][t]={value:n},1):0}function Zt(e,t,n){for(const i in t)lF(e,i,t[i]);for(const i in n)lF(e,i,n[i],"update")}function Nc(e,t,n){for(const i in t)n&&Z(n,i)||(e[i]=ve(e[i]||{},t[i]));return e}function hl(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const nk="mark",ik="frame",rk="scope",rue="axis",sue="axis-domain",aue="axis-grid",oue="axis-label",uue="axis-tick",lue="axis-title",cue="legend",fue="legend-band",hue="legend-entry",due="legend-gradient",Y4="legend-label",pue="legend-symbol",gue="legend-title",mue="title",yue="title-text",xue="title-subtitle";function vue(e,t,n,i,r){const s={},a={};let o,u,l,c;u="lineBreak",t==="text"&&r[u]!=null&&!hl(u,e)&&Qx(s,u,r[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===ik?r.group:n===nk?ve({},r.mark,r[t]):null;for(u in c)l=hl(u,e)||(u==="fill"||u==="stroke")&&(hl("fill",e)||hl("stroke",e)),l||Qx(s,u,c[u]);Q(i).forEach(f=>{const h=r.style&&r.style[f];for(const d in h)hl(d,e)||Qx(s,d,h[d])}),e=ve({},e);for(u in s)c=s[u],c.signal?(o=o||{})[u]=c:a[u]=c;return e.enter=ve(a,e.enter),o&&(e.update=ve(o,e.update)),e}function Qx(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const X4=e=>J(e)?G(e):e.signal?`(${e.signal})`:K4(e);function C1(e){if(e.gradient!=null)return wue(e);let t=e.signal?`(${e.signal})`:e.color?bue(e.color):e.field!=null?K4(e.field):e.value!==void 0?G(e.value):void 0;return e.scale!=null&&(t=_ue(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${bg(e.exponent)})`),e.mult!=null&&(t+=`*${bg(e.mult)}`),e.offset!=null&&(t+=`+${bg(e.offset)}`),e.round&&(t=`round(${t})`),t}const Lp=(e,t,n,i)=>`(${e}(${[t,n,i].map(C1).join(",")})+'')`;function bue(e){return e.c?Lp("hcl",e.h,e.c,e.l):e.h||e.s?Lp("hsl",e.h,e.s,e.l):e.l||e.a?Lp("lab",e.l,e.a,e.b):e.r||e.g||e.b?Lp("rgb",e.r,e.g,e.b):null}function wue(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:G(n));for(;t.length&&Fe(t)==null;)t.pop();return t.unshift(X4(e.gradient)),`gradient(${t.join(",")})`}function bg(e){return K(e)?"("+C1(e)+")":e}function K4(e){return Q4(K(e)?e:{datum:e})}function Q4(e){let t,n,i;if(e.signal)t="datum",i=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(i=e.parent,t+=".datum"):i=e.group}else e.datum?(t="datum",i=e.datum):P("Invalid field reference: "+G(e));return e.signal||(i=J(i)?rs(i).map(G).join("]["):Q4(i)),t+"["+i+"]"}function _ue(e,t){const n=X4(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band==1?"":"*"+bg(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function Eue(e){let t="";return e.forEach(n=>{const i=C1(n);t+=n.test?`(${n.test})?${i}:`:i}),Fe(t)===":"&&(t+="null"),t}function J4(e,t,n,i,r,s){const a={};s=s||{},s.encoders={$encode:a},e=vue(e,t,n,i,r.config);for(const o in e)a[o]=Sue(e[o],t,s,r);return s}function Sue(e,t,n,i){const r={},s={};for(const a in e)e[a]!=null&&(r[a]=Aue(kue(e[a]),i,n,s));return{$expr:{marktype:t,channels:r},$fields:Object.keys(s),$output:Object.keys(e)}}function kue(e){return L(e)?Eue(e):C1(e)}function Aue(e,t,n,i){const r=Zr(e,t);return r.$fields.forEach(s=>i[s]=1),ve(n,r.$params),r.$expr}const Cue="outer",$ue=["value","update","init","react","bind"];function cF(e,t){P(e+' for "outer" push: '+G(t))}function Z4(e,t){const n=e.name;if(e.push===Cue)t.signals[n]||cF("No prior signal definition",n),$ue.forEach(i=>{e[i]!==void 0&&cF("Invalid property ",i)});else{const i=t.addSignal(n,e.value);e.react===!1&&(i.react=!1),e.bind&&t.addBinding(n,e.bind)}}function C2(e,t,n,i){this.id=-1,this.type=e,this.value=t,this.params=n,i&&(this.parent=i)}function $1(e,t,n,i){return new C2(e,t,n,i)}function H0(e,t){return $1("operator",e,t)}function ae(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Uh(e,t){return t?{$field:e,$name:t}:{$field:e}}const $2=Uh("key");function fF(e,t){return{$compare:e,$order:t}}function Tue(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const Fue="ascending",Mue="descending";function Oue(e){return K(e)?(e.order===Mue?"-":"+")+T1(e.op,e.field):""}function T1(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const sk="scope",T2="view";function $t(e){return e&&e.signal}function Nue(e){return e&&e.expr}function wg(e){if($t(e))return!0;if(K(e)){for(const t in e)if(wg(e[t]))return!0}return!1}function Xi(e,t){return e??t}function eu(e){return e&&e.signal||e}const hF="timer";function jh(e,t){return(e.merge?Due:e.stream?Iue:e.type?Pue:P("Invalid stream specification: "+G(e)))(e,t)}function Rue(e){return e===sk?T2:e||T2}function Due(e,t){const n=e.merge.map(r=>jh(r,t)),i=ak({merge:n},e,t);return t.addStream(i).id}function Iue(e,t){const n=jh(e.stream,t),i=ak({stream:n},e,t);return t.addStream(i).id}function Pue(e,t){let n;e.type===hF?(n=t.event(hF,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(Rue(e.source),e.type);const i=ak({stream:n},e,t);return Object.keys(i).length===1?n:t.addStream(i).id}function ak(e,t,n){let i=t.between;return i&&(i.length!==2&&P('Stream "between" parameter must have 2 entries: '+G(t)),e.between=[jh(i[0],n),jh(i[1],n)]),i=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&i.push(Lue(t.marktype,t.markname,t.markrole)),t.source===sk&&i.push("inScope(event.item)"),i.length&&(e.filter=Zr("("+i.join(")&&(")+")",n).$expr),(i=t.throttle)!=null&&(e.throttle=+i),(i=t.debounce)!=null&&(e.debounce=+i),t.consume&&(e.consume=!0),e}function Lue(e,t,n){const i="event.item";return i+(e&&e!=="*"?"&&"+i+".mark.marktype==='"+e+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(t?"&&"+i+".mark.name==='"+t+"'":"")}const zue={code:"_.$value",ast:{type:"Identifier",value:"value"}};function Bue(e,t,n){const i=e.encode,r={target:n};let s=e.events,a=e.update,o=[];s||P("Signal update missing events specification."),J(s)&&(s=ho(s,t.isSubscope()?sk:T2)),s=Q(s).filter(u=>u.signal||u.scale?(o.push(u),0):1),o.length>1&&(o=[jue(o)]),s.length&&o.push(s.length>1?{merge:s}:s[0]),i!=null&&(a&&P("Signal encode and update are mutually exclusive."),a="encode(item(),"+G(i)+")"),r.update=J(a)?Zr(a,t):a.expr!=null?Zr(a.expr,t):a.value!=null?a.value:a.signal!=null?{$expr:zue,$params:{$value:t.signalRef(a.signal)}}:P("Invalid signal update specification."),e.force&&(r.options={force:!0}),o.forEach(u=>t.addUpdate(ve(Uue(u,t),r)))}function Uue(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):jh(e,t)}}function jue(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function que(e,t){const n=t.getSignal(e.name);let i=e.update;e.init&&(i?P("Signals can not include both init and update expressions."):(i=e.init,n.initonly=!0)),i&&(i=Zr(i,t),n.update=i.$expr,n.params=i.$params),e.on&&e.on.forEach(r=>Bue(r,t,n.id))}const Ye=e=>(t,n,i)=>$1(e,n,t||void 0,i),eL=Ye("aggregate"),Vue=Ye("axisticks"),tL=Ye("bound"),yr=Ye("collect"),dF=Ye("compare"),Wue=Ye("datajoin"),nL=Ye("encode"),Hue=Ye("expression"),Gue=Ye("facet"),Yue=Ye("field"),Xue=Ye("key"),Kue=Ye("legendentries"),Que=Ye("load"),Jue=Ye("mark"),Zue=Ye("multiextent"),ele=Ye("multivalues"),tle=Ye("overlap"),nle=Ye("params"),iL=Ye("prefacet"),ile=Ye("projection"),rle=Ye("proxy"),sle=Ye("relay"),rL=Ye("render"),ale=Ye("scale"),Iu=Ye("sieve"),ole=Ye("sortitems"),sL=Ye("viewlayout"),ule=Ye("values");let lle=0;const aL={min:"min",max:"max",count:"sum"};function cle(e,t){const n=e.type||"linear";HI(n)||P("Unrecognized scale type: "+G(n)),t.addScale(e.name,{type:n,domain:void 0})}function fle(e,t){const n=t.getScale(e.name).params;let i;n.domain=oL(e.domain,e,t),e.range!=null&&(n.range=lL(e,t,n)),e.interpolate!=null&&wle(e.interpolate,n),e.nice!=null&&(n.nice=ble(e.nice,t)),e.bins!=null&&(n.bins=vle(e.bins,t));for(i in e)Z(n,i)||i==="name"||(n[i]=Ci(e[i],t))}function Ci(e,t){return K(e)?e.signal?t.signalRef(e.signal):P("Unsupported object: "+G(e)):e}function _g(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Ci(n,t))}function F1(e){P("Can not find data set: "+G(e))}function oL(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&P("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(L(e)?hle:e.fields?ple:dle)(e,t,n)}function hle(e,t,n){return e.map(i=>Ci(i,n))}function dle(e,t,n){const i=n.getData(e.data);return i||F1(e.data),Wl(t.type)?i.valuesRef(n,e.field,uL(e.sort,!1)):XI(t.type)?i.domainRef(n,e.field):i.extentRef(n,e.field)}function ple(e,t,n){const i=e.data,r=e.fields.reduce((s,a)=>(a=J(a)?{data:i,field:a}:L(a)||a.signal?gle(a,n):a,s.push(a),s),[]);return(Wl(t.type)?mle:XI(t.type)?yle:xle)(e,n,r)}function gle(e,t){const n="_:vega:_"+lle++,i=yr({});if(L(e))i.value={$ingest:e};else if(e.signal){const r="setdata("+G(n)+","+e.signal+")";i.params.input=t.signalRef(r)}return t.addDataPipeline(n,[i,Iu({})]),{data:n,field:"data"}}function mle(e,t,n){const i=uL(e.sort,!0);let r,s;const a=n.map(l=>{const c=t.getData(l.data);return c||F1(l.data),c.countsRef(t,l.field,i)}),o={groupby:$2,pulse:a};i&&(r=i.op||"count",s=i.field?T1(r,i.field):"count",o.ops=[aL[r]],o.fields=[t.fieldRef(s)],o.as=[s]),r=t.add(eL(o));const u=t.add(yr({pulse:ae(r)}));return s=t.add(ule({field:$2,sort:t.sortRef(i),pulse:ae(u)})),ae(s)}function uL(e,t){return e&&(!e.field&&!e.op?K(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?P("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!aL[e.op]&&P("Multiple domain scales can not be sorted using "+e.op)),e}function yle(e,t,n){const i=n.map(r=>{const s=t.getData(r.data);return s||F1(r.data),s.domainRef(t,r.field)});return ae(t.add(ele({values:i})))}function xle(e,t,n){const i=n.map(r=>{const s=t.getData(r.data);return s||F1(r.data),s.extentRef(t,r.field)});return ae(t.add(Zue({extents:i})))}function vle(e,t){return e.signal||L(e)?_g(e,t):t.objectProperty(e)}function ble(e,t){return e.signal?t.signalRef(e.signal):K(e)?{interval:Ci(e.interval),step:Ci(e.step)}:Ci(e)}function wle(e,t){t.interpolate=Ci(e.type||e),e.gamma!=null&&(t.interpolateGamma=Ci(e.gamma))}function lL(e,t,n){const i=t.config.range;let r=e.range;if(r.signal)return t.signalRef(r.signal);if(J(r)){if(i&&Z(i,r))return e=ve({},e,{range:i[r]}),lL(e,t,n);r==="width"?r=[0,{signal:"width"}]:r==="height"?r=Wl(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:P("Unrecognized scale range value: "+G(r))}else if(r.scheme){n.scheme=L(r.scheme)?_g(r.scheme,t):Ci(r.scheme,t),r.extent&&(n.schemeExtent=_g(r.extent,t)),r.count&&(n.schemeCount=Ci(r.count,t));return}else if(r.step){n.rangeStep=Ci(r.step,t);return}else{if(Wl(e.type)&&!L(r))return oL(r,e,t);L(r)||P("Unsupported range type: "+G(r))}return r.map(s=>(L(s)?_g:Ci)(s,t))}function _le(e,t){const n=t.config.projection||{},i={};for(const r in e)r!=="name"&&(i[r]=F2(e[r],r,t));for(const r in n)i[r]==null&&(i[r]=F2(n[r],r,t));t.addProjection(e.name,i)}function F2(e,t,n){return L(e)?e.map(i=>F2(i,t,n)):K(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:P("Unsupported parameter object: "+G(e)):e}const xr="top",Rc="left",Dc="right",Qa="bottom",cL="center",Ele="vertical",Sle="start",kle="middle",Ale="end",M2="index",ok="label",Cle="offset",ec="perc",$le="perc2",Ti="value",Dd="guide-label",uk="guide-title",Tle="group-title",Fle="group-subtitle",pF="symbol",Eg="gradient",O2="discrete",N2="size",Mle="shape",Ole="fill",Nle="stroke",Rle="strokeWidth",Dle="strokeDash",Ile="opacity",lk=[N2,Mle,Ole,Nle,Rle,Dle,Ile],Id={name:1,style:1,interactive:1},Oe={value:0},Fi={value:1},M1="group",fL="rect",ck="rule",Ple="symbol",Pu="text";function qh(e){return e.type=M1,e.interactive=e.interactive||!1,e}function Zn(e,t){const n=(i,r)=>Xi(e[i],Xi(t[i],r));return n.isVertical=i=>Ele===Xi(e.direction,t.direction||(i?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>Xi(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>Xi(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>Xi(e.columns,Xi(t.columns,+n.isVertical(!0))),n}function hL(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function Lle(e,t,n){const i=t.config.style[n];return i&&i[e]}function O1(e,t,n){return`item.anchor === '${Sle}' ? ${e} : item.anchor === '${Ale}' ? ${t} : ${n}`}const fk=O1(G(Rc),G(Dc),G(cL));function zle(e){const t=e("tickBand");let n=e("tickOffset"),i,r;return t?t.signal?(i={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},r={signal:`(${t.signal}) === 'extent'`},K(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(i=1,r=!0,n=0):(i=.5,r=!1):(i=e("bandPosition"),r=e("tickExtra")),{extra:r,band:i,offset:n}}function dL(e,t){return t?e?K(e)?Object.assign({},e,{offset:dL(e.offset,t)}):{value:e,offset:t}:t:e}function pi(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Nc(e.encode,t,Id)):e.interactive=!1,e}function Ble(e,t,n,i){const r=Zn(e,n),s=r.isVertical(),a=r.gradientThickness(),o=r.gradientLength();let u,l,c,f,h;s?(l=[0,1],c=[0,0],f=a,h=o):(l=[0,0],c=[1,0],f=o,h=a);const d={enter:u={opacity:Oe,x:Oe,y:Oe,width:Pt(f),height:Pt(h)},update:ve({},u,{opacity:Fi,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:Oe}};return Zt(d,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")}),pi({type:fL,role:due,encode:d},i)}function Ule(e,t,n,i,r){const s=Zn(e,n),a=s.isVertical(),o=s.gradientThickness(),u=s.gradientLength();let l,c,f,h,d="";a?(l="y",f="y2",c="x",h="width",d="1-"):(l="x",f="x2",c="y",h="height");const p={opacity:Oe,fill:{scale:t,field:Ti}};p[l]={signal:d+"datum."+ec,mult:u},p[c]=Oe,p[f]={signal:d+"datum."+$le,mult:u},p[h]=Pt(o);const g={enter:p,update:ve({},p,{opacity:Fi}),exit:{opacity:Oe}};return Zt(g,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),pi({type:fL,role:fue,key:Ti,from:r,encode:g},i)}const jle=`datum.${ec}<=0?"${Rc}":datum.${ec}>=1?"${Dc}":"${cL}"`,qle=`datum.${ec}<=0?"${Qa}":datum.${ec}>=1?"${xr}":"${kle}"`;function gF(e,t,n,i){const r=Zn(e,t),s=r.isVertical(),a=Pt(r.gradientThickness()),o=r.gradientLength();let u=r("labelOverlap"),l,c,f,h,d="";const p={enter:l={opacity:Oe},update:c={opacity:Fi,text:{field:ok}},exit:{opacity:Oe}};return Zt(p,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:Xi(e.labelLimit,t.gradientLabelLimit)}),s?(l.align={value:"left"},l.baseline=c.baseline={signal:qle},f="y",h="x",d="1-"):(l.align=c.align={signal:jle},l.baseline={value:"top"},f="x",h="y"),l[f]=c[f]={signal:d+"datum."+ec,mult:o},l[h]=c[h]=a,a.offset=Xi(e.labelOffset,t.gradientLabelOffset)||0,u=u?{separation:r("labelSeparation"),method:u,order:"datum."+M2}:void 0,pi({type:Pu,role:Y4,style:Dd,key:Ti,from:i,encode:p,overlap:u},n)}function Vle(e,t,n,i,r){const s=Zn(e,t),a=n.entries,o=!!(a&&a.interactive),u=a?a.name:void 0,l=s("clipHeight"),c=s("symbolOffset"),f={data:"value"},h=`(${r}) ? datum.${Cle} : datum.${N2}`,d=l?Pt(l):{field:N2},p=`datum.${M2}`,g=`max(1, ${r})`;let m,y,x,v,b;d.mult=.5,m={enter:y={opacity:Oe,x:{signal:h,mult:.5,offset:c},y:d},update:x={opacity:Fi,x:y.x,y:y.y},exit:{opacity:Oe}};let w=null,E=null;e.fill||(w=t.symbolBaseFillColor,E=t.symbolBaseStrokeColor),Zt(m,{fill:s("symbolFillColor",w),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",E),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),lk.forEach(T=>{e[T]&&(x[T]=y[T]={scale:e[T],field:Ti})});const _=pi({type:Ple,role:pue,key:Ti,from:f,clip:l?!0:void 0,encode:m},n.symbols),k=Pt(c);k.offset=s("labelOffset"),m={enter:y={opacity:Oe,x:{signal:h,offset:k},y:d},update:x={opacity:Fi,text:{field:ok},x:y.x,y:y.y},exit:{opacity:Oe}},Zt(m,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const A=pi({type:Pu,role:Y4,style:Dd,key:Ti,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:Oe,height:l?Pt(l):Oe,opacity:Oe},exit:{opacity:Oe},update:x={opacity:Fi,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(v=`ceil(item.mark.items.length / ${g})`,x.row.signal=`${p}%${v}`,x.column.signal=`floor(${p} / ${v})`,b={field:["row",p]}):(x.row.signal=`floor(${p} / ${g})`,x.column.signal=`${p} % ${g}`,b={field:p}),x.column.signal=`(${r})?${x.column.signal}:${p}`,i={facet:{data:i,name:"value",groupby:M2}},qh({role:rk,from:i,encode:Nc(m,a,Id),marks:[_,A],name:u,interactive:o,sort:b})}function Wle(e,t){const n=Zn(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const hk='item.orient === "left"',dk='item.orient === "right"',N1=`(${hk} || ${dk})`,Hle=`datum.vgrad && ${N1}`,Gle=O1('"top"','"bottom"','"middle"'),Yle=O1('"right"','"left"','"center"'),Xle=`datum.vgrad && ${dk} ? (${Yle}) : (${N1} && !(datum.vgrad && ${hk})) ? "left" : ${fk}`,Kle=`item._anchor || (${N1} ? "middle" : "start")`,Qle=`${Hle} ? (${hk} ? -90 : 90) : 0`,Jle=`${N1} ? (datum.vgrad ? (${dk} ? "bottom" : "top") : ${Gle}) : "top"`;function Zle(e,t,n,i){const r=Zn(e,t),s={enter:{opacity:Oe},update:{opacity:Fi,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:Oe}};return Zt(s,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:Kle},angle:{signal:Qle},align:{signal:Xle},baseline:{signal:Jle},text:e.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")}),pi({type:Pu,role:gue,style:uk,from:i,encode:s},n)}function ece(e,t){let n;return K(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+mF(e.path)+")":e.sphere&&(n="geoShape("+mF(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function mF(e){return K(e)&&e.signal?e.signal:G(e)}function pL(e){const t=e.role||"";return t.startsWith("axis")||t.startsWith("legend")||t.startsWith("title")?t:e.type===M1?rk:t||nk}function tce(e){return{marktype:e.type,name:e.name||void 0,role:e.role||pL(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function nce(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function pk(e,t){const n=YR(e.type);n||P("Unrecognized transform type: "+G(e.type));const i=$1(n.type.toLowerCase(),null,gL(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(i)),i.metadata=n.metadata||{},i}function gL(e,t,n){const i={},r=e.params.length;for(let s=0;s<r;++s){const a=e.params[s];i[a.name]=ice(a,t,n)}return i}function ice(e,t,n){const i=e.type,r=t[e.name];if(i==="index")return rce(e,t,n);if(r===void 0){e.required&&P("Missing required "+G(t.type)+" parameter: "+G(e.name));return}else{if(i==="param")return sce(e,t,n);if(i==="projection")return n.projectionRef(t[e.name])}return e.array&&!$t(r)?r.map(s=>yF(e,s,n)):yF(e,r,n)}function yF(e,t,n){const i=e.type;if($t(t))return vF(i)?P("Expression references can not be signals."):Jx(i)?n.fieldRef(t):bF(i)?n.compareRef(t):n.signalRef(t.signal);{const r=e.expr||Jx(i);return r&&ace(t)?n.exprRef(t.expr,t.as):r&&oce(t)?Uh(t.field,t.as):vF(i)?Zr(t,n):uce(i)?ae(n.getData(t).values):Jx(i)?Uh(t):bF(i)?n.compareRef(t):t}}function rce(e,t,n){return J(t.from)||P('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function sce(e,t,n){const i=t[e.name];return e.array?(L(i)||P("Expected an array of sub-parameters. Instead: "+G(i)),i.map(r=>xF(e,r,n))):xF(e,i,n)}function xF(e,t,n){const i=e.params.length;let r;for(let a=0;a<i;++a){r=e.params[a];for(const o in r.key)if(r.key[o]!==t[o]){r=null;break}if(r)break}r||P("Unsupported parameter: "+G(t));const s=ve(gL(r,t,n),r.key);return ae(n.add(nle(s)))}const ace=e=>e&&e.expr,oce=e=>e&&e.field,uce=e=>e==="data",vF=e=>e==="expr",Jx=e=>e==="field",bF=e=>e==="compare";function lce(e,t,n){let i,r,s,a,o;return e?(i=e.facet)&&(t||P("Only group marks can be faceted."),i.field!=null?a=o=Sg(i,n):(e.data?o=ae(n.getData(e.data).aggregate):(s=pk(ve({type:"aggregate",groupby:Q(i.groupby)},i.aggregate),n),s.params.key=n.keyRef(i.groupby),s.params.pulse=Sg(i,n),a=o=ae(n.add(s))),r=n.keyRef(i.groupby,!0))):a=ae(n.add(yr(null,[{}]))),a||(a=Sg(e,n)),{key:r,pulse:a,parent:o}}function Sg(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:ae(t.getData(e.data).output)}function yu(e,t,n,i,r){this.scope=e,this.input=t,this.output=n,this.values=i,this.aggregate=r,this.index={}}yu.fromEntries=function(e,t){const n=t.length,i=t[n-1],r=t[n-2];let s=t[0],a=null,o=1;for(s&&s.type==="load"&&(s=t[1]),e.add(t[0]);o<n;++o)t[o].params.pulse=ae(t[o-1]),e.add(t[o]),t[o].type==="aggregate"&&(a=t[o]);return new yu(e,s,r,i,a)};function mL(e){return J(e)?e:null}function wF(e,t,n){const i=T1(n.op,n.field);let r;if(t.ops){for(let s=0,a=t.as.length;s<a;++s)if(t.as[s]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function _f(e,t,n,i,r,s,a){const o=t[n]||(t[n]={}),u=Oue(s);let l=mL(r),c,f;if(l!=null&&(e=t.scope,l=l+(u?"|"+u:""),c=o[l]),!c){const h=s?{field:$2,pulse:t.countsRef(e,r,s)}:{field:e.fieldRef(r),pulse:ae(t.output)};u&&(h.sort=e.sortRef(s)),f=e.add($1(i,void 0,h)),a&&(t.index[r]=f),c=ae(f),l!=null&&(o[l]=c)}return c}yu.prototype={countsRef(e,t,n){const i=this,r=i.counts||(i.counts={}),s=mL(t);let a,o,u;return s!=null&&(e=i.scope,a=r[s]),a?n&&n.field&&wF(e,a.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:ae(i.output)},n&&n.field&&wF(e,u,n),o=e.add(eL(u)),a=e.add(yr({pulse:ae(o)})),a={agg:o,ref:ae(a)},s!=null&&(r[s]=a)),a.ref},tuplesRef(){return ae(this.values)},extentRef(e,t){return _f(e,this,"extent","extent",t,!1)},domainRef(e,t){return _f(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return _f(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return _f(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return _f(e,this,"indata","tupleindex",t,!0,!0)}};function cce(e,t,n){const i=e.from.facet,r=i.name,s=Sg(i,t);let a;i.name||P("Facet must have a name: "+G(i)),i.data||P("Facet must reference a data set: "+G(i)),i.field?a=t.add(iL({field:t.fieldRef(i.field),pulse:s})):i.groupby?a=t.add(Gue({key:t.keyRef(i.groupby),group:ae(t.proxy(n.parent)),pulse:s})):P("Facet must specify groupby or field: "+G(i));const o=t.fork(),u=o.add(yr()),l=o.add(Iu({pulse:ae(u)}));o.addData(r,new yu(o,u,u,l)),o.addSignal("parent",null),a.params.subflow={$subflow:o.parse(e).toRuntime()}}function fce(e,t,n){const i=t.add(iL({pulse:n.pulse})),r=t.fork();r.add(Iu()),r.addSignal("parent",null),i.params.subflow={$subflow:r.parse(e).toRuntime()}}function yL(e,t,n){const i=e.remove,r=e.insert,s=e.toggle,a=e.modify,o=e.values,u=t.add(H0()),l="if("+e.trigger+',modify("'+n+'",'+[r,i,s,a,o].map(f=>f??"null").join(",")+"),0)",c=Zr(l,t);u.update=c.$expr,u.params=c.$params}function R1(e,t){const n=pL(e),i=e.type===M1,r=e.from&&e.from.facet,s=e.overlap;let a=e.layout||n===rk||n===ik,o,u,l,c,f,h,d;const p=n===nk||a||r,g=lce(e.from,i,t);u=t.add(Wue({key:g.key||(e.key?Uh(e.key):void 0),pulse:g.pulse,clean:!i}));const m=ae(u);u=l=t.add(yr({pulse:m})),u=t.add(Jue({markdef:tce(e),interactive:nce(e.interactive,t),clip:ece(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:ae(u)}));const y=ae(u);u=c=t.add(nL(J4(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(E=>{const _=pk(E,t),k=_.metadata;(k.generates||k.changes)&&P("Mark transforms should not generate new data."),k.nomod||(c.params.mod=!0),_.params.pulse=ae(u),t.add(u=_)}),e.sort&&(u=t.add(ole({sort:t.compareRef(e.sort),pulse:ae(u)})));const x=ae(u);(r||a)&&(a=t.add(sL({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:x})),h=ae(a));const v=t.add(tL({mark:y,pulse:h||x}));d=ae(v),i&&(p&&(o=t.operators,o.pop(),a&&o.pop()),t.pushState(x,h||d,m),r?cce(e,t,g):p?fce(e,t,g):t.parse(e),t.popState(),p&&(a&&o.push(a),o.push(v))),s&&(d=hce(s,d,t));const b=t.add(rL({pulse:d})),w=t.add(Iu({pulse:ae(b)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new yu(t,l,b,w)),e.on&&e.on.forEach(E=>{(E.insert||E.remove||E.toggle)&&P("Marks only support modify triggers."),yL(E,t,f)}))}function hce(e,t,n){const i=e.method,r=e.bound,s=e.separation,a={separation:$t(s)?n.signalRef(s.signal):s,method:$t(i)?n.signalRef(i.signal):i,pulse:t};if(e.order&&(a.sort=n.compareRef({field:e.order})),r){const o=r.tolerance;a.boundTolerance=$t(o)?n.signalRef(o.signal):+o,a.boundScale=n.scaleRef(r.scale),a.boundOrient=r.orient}return ae(n.add(tle(a)))}function dce(e,t){const n=t.config.legend,i=e.encode||{},r=Zn(e,n),s=i.legend||{},a=s.name||void 0,o=s.interactive,u=s.style,l={};let c=0,f,h,d;lk.forEach(v=>e[v]?(l[v]=e[v],c=c||e[v]):0),c||P("Missing valid scale for legend.");const p=pce(e,t.scaleType(c)),g={title:e.title!=null,scales:l,type:p,vgrad:p!=="symbol"&&r.isVertical()},m=ae(t.add(yr(null,[g]))),y={enter:{x:{value:0},y:{value:0}}},x=ae(t.add(Kue(h={type:p,scale:t.scaleRef(c),count:t.objectProperty(r("tickCount")),limit:t.property(r("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===Eg?(d=[Ble(e,c,n,i.gradient),gF(e,n,i.labels,x)],h.count=h.count||t.signalRef(`max(2,2*floor((${eu(r.gradientLength())})/100))`)):p===O2?d=[Ule(e,c,n,i.gradient,x),gF(e,n,i.labels,x)]:(f=Wle(e,n),d=[Vle(e,n,i,x,eu(f.columns))],h.size=yce(e,t,d[0].marks)),d=[qh({role:hue,from:m,encode:y,marks:d,layout:f,interactive:o})],g.title&&d.push(Zle(e,n,i.title,m)),R1(qh({role:cue,from:m,encode:Nc(mce(r,e,n),s,Id),marks:d,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:a,interactive:o,style:u}),t)}function pce(e,t){let n=e.type||pF;return!e.type&&gce(e)===1&&(e.fill||e.stroke)&&(n=pE(t)?Eg:Eb(t)?O2:pF),n!==Eg?n:Eb(t)?O2:Eg}function gce(e){return lk.reduce((t,n)=>t+(e[n]?1:0),0)}function mce(e,t,n){const i={enter:{},update:{}};return Zt(i,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),i}function yce(e,t,n){const i=eu(_F("size",e,n)),r=eu(_F("strokeWidth",e,n)),s=eu(xce(n[1].encode,t,Dd));return Zr(`max(ceil(sqrt(${i})+${r}),${s})`,t)}function _F(e,t,n){return t[e]?`scale("${t[e]}",datum)`:hL(e,n[0].encode)}function xce(e,t,n){return hL("fontSize",e)||Lle("fontSize",t,n)}const vce=`item.orient==="${Rc}"?-90:item.orient==="${Dc}"?90:0`;function bce(e,t){e=J(e)?{text:e}:e;const n=Zn(e,t.config.title),i=e.encode||{},r=i.group||{},s=r.name||void 0,a=r.interactive,o=r.style,u=[],l={},c=ae(t.add(yr(null,[l])));return u.push(Ece(e,n,wce(e),c)),e.subtitle&&u.push(Sce(e,n,i.subtitle,c)),R1(qh({role:mue,from:c,encode:_ce(n,r),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:a,style:o}),t)}function wce(e){const t=e.encode;return t&&t.title||ve({name:e.name,interactive:e.interactive,style:e.style},t)}function _ce(e,t){const n={enter:{},update:{}};return Zt(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:fk},angle:{signal:vce},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Nc(n,t,Id)}function Ece(e,t,n,i){const r={value:0},s=e.text,a={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Zt(a,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),pi({type:Pu,role:yue,style:Tle,from:i,encode:a},n)}function Sce(e,t,n,i){const r={value:0},s=e.subtitle,a={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};return Zt(a,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),pi({type:Pu,role:xue,style:Fle,from:i,encode:a},n)}function kce(e,t){const n=[];e.transform&&e.transform.forEach(i=>{n.push(pk(i,t))}),e.on&&e.on.forEach(i=>{yL(i,t,e.name)}),t.addDataPipeline(e.name,Ace(e,t,n))}function Ace(e,t,n){const i=[];let r=null,s=!1,a=!1,o,u,l,c,f;for(e.values?$t(e.values)||wg(e.format)?(i.push(EF(t,e)),i.push(r=To())):i.push(r=To({$ingest:e.values,$format:e.format})):e.url?wg(e.url)||wg(e.format)?(i.push(EF(t,e)),i.push(r=To())):i.push(r=To({$request:e.url,$format:e.format})):e.source&&(r=o=Q(e.source).map(h=>ae(t.getData(h).output)),i.push(null)),u=0,l=n.length;u<l;++u)c=n[u],f=c.metadata,!r&&!f.source&&i.push(r=To()),i.push(c),f.generates&&(a=!0),f.modifies&&!a&&(s=!0),f.source?r=c:f.changes&&(r=null);return o&&(l=o.length-1,i[0]=sle({derive:s,pulse:l?o:o[0]}),(s||l)&&i.splice(1,0,To())),r||i.push(To()),i.push(Iu({})),i}function To(e){const t=yr({},e);return t.metadata={source:!0},t}function EF(e,t){return Que({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const xL=e=>e===Qa||e===xr,D1=(e,t,n)=>$t(e)?Fce(e.signal,t,n):e===Rc||e===xr?t:n,Lt=(e,t,n)=>$t(e)?$ce(e.signal,t,n):xL(e)?t:n,sr=(e,t,n)=>$t(e)?Tce(e.signal,t,n):xL(e)?n:t,vL=(e,t,n)=>$t(e)?Mce(e.signal,t,n):e===xr?{value:t}:{value:n},Cce=(e,t,n)=>$t(e)?Oce(e.signal,t,n):e===Dc?{value:t}:{value:n},$ce=(e,t,n)=>bL(`${e} === '${xr}' || ${e} === '${Qa}'`,t,n),Tce=(e,t,n)=>bL(`${e} !== '${xr}' && ${e} !== '${Qa}'`,t,n),Fce=(e,t,n)=>gk(`${e} === '${Rc}' || ${e} === '${xr}'`,t,n),Mce=(e,t,n)=>gk(`${e} === '${xr}'`,t,n),Oce=(e,t,n)=>gk(`${e} === '${Dc}'`,t,n),bL=(e,t,n)=>(t=t!=null?Pt(t):t,n=n!=null?Pt(n):n,SF(t)&&SF(n)?(t=t?t.signal||G(t.value):null,n=n?n.signal||G(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[ve({test:e},t)].concat(n||[])),SF=e=>e==null||Object.keys(e).length===1,gk=(e,t,n)=>({signal:`${e} ? (${bl(t)}) : (${bl(n)})`}),Nce=(e,t,n,i,r)=>({signal:(i!=null?`${e} === '${Rc}' ? (${bl(i)}) : `:"")+(n!=null?`${e} === '${Qa}' ? (${bl(n)}) : `:"")+(r!=null?`${e} === '${Dc}' ? (${bl(r)}) : `:"")+(t!=null?`${e} === '${xr}' ? (${bl(t)}) : `:"")+"(null)"}),bl=e=>$t(e)?e.signal:e==null?null:G(e),Rce=(e,t)=>t===0?0:$t(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},$l=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function rl(e,t,n,i){let r;if(t&&Z(t,e))return t[e];if(Z(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=e[5].toLowerCase()+e.slice(6)}return i[uk][r]}else if(e.startsWith("label")){switch(e){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=e[5].toLowerCase()+e.slice(6)}return i[Dd][r]}return null}function kF(e){const t={};for(const n of e)if(n)for(const i in n)t[i]=1;return Object.keys(t)}function Dce(e,t){var n=t.config,i=n.style,r=n.axis,s=t.scaleType(e.scale)==="band"&&n.axisBand,a=e.orient,o,u,l;if($t(a)){const f=kF([n.axisX,n.axisY]),h=kF([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);o={};for(l of f)o[l]=Lt(a,rl(l,n.axisX,r,i),rl(l,n.axisY,r,i));u={};for(l of h)u[l]=Nce(a.signal,rl(l,n.axisTop,r,i),rl(l,n.axisBottom,r,i),rl(l,n.axisLeft,r,i),rl(l,n.axisRight,r,i))}else o=a===xr||a===Qa?n.axisX:n.axisY,u=n["axis"+a[0].toUpperCase()+a.slice(1)];return o||u||s?ve({},r,o,u,s):r}function Ice(e,t,n,i){const r=Zn(e,t),s=e.orient;let a,o;const u={enter:a={opacity:Oe},update:o={opacity:Fi},exit:{opacity:Oe}};Zt(u,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const l=AF(e,0),c=AF(e,1);return a.x=o.x=Lt(s,l,Oe),a.x2=o.x2=Lt(s,c),a.y=o.y=sr(s,l,Oe),a.y2=o.y2=sr(s,c),pi({type:ck,role:sue,from:i,encode:u},n)}function AF(e,t){return{scale:e.scale,range:t}}function Pce(e,t,n,i,r){const s=Zn(e,t),a=e.orient,o=e.gridScale,u=D1(a,1,-1),l=Lce(e.offset,u);let c,f,h;const d={enter:c={opacity:Oe},update:h={opacity:Fi},exit:f={opacity:Oe}};Zt(d,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const p={scale:e.scale,field:Ti,band:r.band,extra:r.extra,offset:r.offset,round:s("tickRound")},g=Lt(a,{signal:"height"},{signal:"width"}),m=o?{scale:o,range:0,mult:u,offset:l}:{value:0,offset:l},y=o?{scale:o,range:1,mult:u,offset:l}:ve(g,{mult:u,offset:l});return c.x=h.x=Lt(a,p,m),c.y=h.y=sr(a,p,m),c.x2=h.x2=sr(a,y),c.y2=h.y2=Lt(a,y),f.x=Lt(a,p),f.y=sr(a,p),pi({type:ck,role:aue,key:Ti,from:i,encode:d},n)}function Lce(e,t){if(t!==1)if(!K(e))e=$t(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=ve({},e);for(;n.mult!=null;)if(K(n.mult))n=n.mult=ve({},n.mult);else return n.mult=$t(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function zce(e,t,n,i,r,s){const a=Zn(e,t),o=e.orient,u=D1(o,-1,1);let l,c,f;const h={enter:l={opacity:Oe},update:f={opacity:Fi},exit:c={opacity:Oe}};Zt(h,{stroke:a("tickColor"),strokeCap:a("tickCap"),strokeDash:a("tickDash"),strokeDashOffset:a("tickDashOffset"),strokeOpacity:a("tickOpacity"),strokeWidth:a("tickWidth")});const d=Pt(r);d.mult=u;const p={scale:e.scale,field:Ti,band:s.band,extra:s.extra,offset:s.offset,round:a("tickRound")};return f.y=l.y=Lt(o,Oe,p),f.y2=l.y2=Lt(o,d),c.x=Lt(o,p),f.x=l.x=sr(o,Oe,p),f.x2=l.x2=sr(o,d),c.y=sr(o,p),pi({type:ck,role:uue,key:Ti,from:i,encode:h},n)}function Zx(e,t,n,i,r){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+i+","+r+")"}}function Bce(e,t,n,i,r,s){const a=Zn(e,t),o=e.orient,u=e.scale,l=D1(o,-1,1),c=eu(a("labelFlush")),f=eu(a("labelFlushOffset")),h=a("labelAlign"),d=a("labelBaseline");let p=c===0||!!c,g;const m=Pt(r);m.mult=l,m.offset=Pt(a("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:Ti,band:.5,offset:dL(s.offset,a("labelOffset"))},x=Lt(o,p?Zx(u,c,'"left"','"right"','"center"'):{value:"center"},Cce(o,"left","right")),v=Lt(o,vL(o,"bottom","top"),p?Zx(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),b=Zx(u,c,`-(${f})`,f,0);p=p&&f;const w={opacity:Oe,x:Lt(o,y,m),y:sr(o,y,m)},E={enter:w,update:g={opacity:Fi,text:{field:ok},x:w.x,y:w.y,align:x,baseline:v},exit:{opacity:Oe,x:w.x,y:w.y}};Zt(E,{dx:!h&&p?Lt(o,b):null,dy:!d&&p?sr(o,b):null}),Zt(E,{angle:a("labelAngle"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontWeight:a("labelFontWeight"),fontStyle:a("labelFontStyle"),limit:a("labelLimit"),lineHeight:a("labelLineHeight")},{align:h,baseline:d});const _=a("labelBound");let k=a("labelOverlap");return k=k||_?{separation:a("labelSeparation"),method:k,order:"datum.index",bound:_?{scale:u,orient:o,tolerance:_}:null}:void 0,g.align!==x&&(g.align=$l(g.align,x)),g.baseline!==v&&(g.baseline=$l(g.baseline,v)),pi({type:Pu,role:oue,style:Dd,key:Ti,from:i,encode:E,overlap:k},n)}function Uce(e,t,n,i){const r=Zn(e,t),s=e.orient,a=D1(s,-1,1);let o,u;const l={enter:o={opacity:Oe,anchor:Pt(r("titleAnchor",null)),align:{signal:fk}},update:u=ve({},o,{opacity:Fi,text:Pt(e.title)}),exit:{opacity:Oe}},c={signal:`lerp(range("${e.scale}"), ${O1(0,1,.5)})`};return u.x=Lt(s,c),u.y=sr(s,c),o.angle=Lt(s,Oe,Rce(a,90)),o.baseline=Lt(s,vL(s,Qa,xr),{value:Qa}),u.angle=o.angle,u.baseline=o.baseline,Zt(l,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")}),jce(r,s,l,n),l.update.align=$l(l.update.align,o.align),l.update.angle=$l(l.update.angle,o.angle),l.update.baseline=$l(l.update.baseline,o.baseline),pi({type:Pu,role:lue,style:uk,from:i,encode:l},n)}function jce(e,t,n,i){const r=(o,u)=>o!=null?(n.update[u]=$l(Pt(o),n.update[u]),!1):!hl(u,i),s=r(e("titleX"),"x"),a=r(e("titleY"),"y");n.enter.auto=a===s?Pt(a):Lt(t,Pt(a),Pt(s))}function qce(e,t){const n=Dce(e,t),i=e.encode||{},r=i.axis||{},s=r.name||void 0,a=r.interactive,o=r.style,u=Zn(e,n),l=zle(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null},f=ae(t.add(yr({},[c]))),h=ae(t.add(Vue({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),d=[];let p;return c.grid&&d.push(Pce(e,n,i.grid,h,l)),c.ticks&&(p=u("tickSize"),d.push(zce(e,n,i.ticks,h,p,l))),c.labels&&(p=c.ticks?p:0,d.push(Bce(e,n,i.labels,h,p,l))),c.domain&&d.push(Ice(e,n,i.domain,f)),c.title&&d.push(Uce(e,n,i.title,f)),R1(qh({role:rue,from:f,encode:Nc(Vce(u,e),r,Id),marks:d,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:a,style:o}),t)}function Vce(e,t){const n={enter:{},update:{}};return Zt(n,{orient:e("orient"),offset:e("offset")||0,position:Xi(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function wL(e,t,n){const i=Q(e.signals),r=Q(e.scales);return n||i.forEach(s=>Z4(s,t)),Q(e.projections).forEach(s=>_le(s,t)),r.forEach(s=>cle(s,t)),Q(e.data).forEach(s=>kce(s,t)),r.forEach(s=>fle(s,t)),(n||i).forEach(s=>que(s,t)),Q(e.axes).forEach(s=>qce(s,t)),Q(e.marks).forEach(s=>R1(s,t)),Q(e.legends).forEach(s=>dce(s,t)),e.title&&bce(e.title,t),t.parseLambdas(),t}const Wce=e=>Nc({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function Hce(e,t){const n=t.config,i=ae(t.root=t.add(H0())),r=Gce(e,n);r.forEach(l=>Z4(l,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(yr()),a=t.add(nL(J4(Wce(e.encode),M1,ik,e.style,t,{pulse:ae(s)}))),o=t.add(sL({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:i,pulse:ae(a)}));t.operators.pop(),t.pushState(ae(a),ae(o),null),wL(e,t,r),t.operators.push(o);let u=t.add(tL({mark:i,pulse:ae(o)}));return u=t.add(rL({pulse:ae(u)})),u=t.add(Iu({pulse:ae(u)})),t.addData("root",new yu(t,s,s,u)),t}function Ef(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function Gce(e,t){const n=a=>Xi(e[a],t[a]),i=[Ef("background",n("background")),Ef("autosize",tue(n("autosize"))),Ef("padding",iue(n("padding"))),Ef("width",n("width")||0),Ef("height",n("height")||0)],r=i.reduce((a,o)=>(a[o.name]=o,a),{}),s={};return Q(e.signals).forEach(a=>{Z(r,a.name)?a=ve(r[a.name],a):i.push(a),s[a.name]=a}),Q(t.signals).forEach(a=>{!Z(s,a.name)&&!Z(r,a.name)&&i.push(a)}),i}function _L(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function CF(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}_L.prototype=CF.prototype={parse(e){return wL(e,this)},fork(){return new CF(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof C2?ae(e):e;return this.add(rle({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(i,r,s){let a,o;i&&(a=i.data||(i.data={}),o=a[r]||(a[r]=[]),o.push(s))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const i in t.index)n(t.index[i],e,"index:"+i)}return this},pushState(e,t,n){this._encode.push(ae(this.add(Iu({pulse:e})))),this._parent.push(t),this._lookup.push(n?ae(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Fe(this._parent)},encode(){return Fe(this._encode)},lookup(){return Fe(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(J(e))return Uh(e,t);e.signal||P("Unsupported field reference: "+G(e));const n=e.signal;let i=this.field[n];if(!i){const r={name:this.signalRef(n)};t&&(r.as=t),this.field[n]=i=ae(this.add(Yue(r)))}return i},compareRef(e){let t=!1;const n=s=>$t(s)?(t=!0,this.signalRef(s.signal)):Nue(s)?(t=!0,this.exprRef(s.expr)):s,i=Q(e.field).map(n),r=Q(e.order).map(n);return t?ae(this.add(dF({fields:i,orders:r}))):fF(i,r)},keyRef(e,t){let n=!1;const i=s=>$t(s)?(n=!0,ae(r[s.signal])):s,r=this.signals;return e=Q(e).map(i),n?ae(this.add(Xue({fields:e,flat:t}))):Tue(e,t)},sortRef(e){if(!e)return e;const t=T1(e.op,e.field),n=e.order||Fue;return n.signal?ae(this.add(dF({fields:t,orders:this.signalRef(n.signal)}))):fF(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:e,type:t}),this.events[n]=i}return this.events[n]},hasOwnSignal(e){return Z(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&P("Duplicate signal name: "+G(e));const n=t instanceof C2?t:this.add(H0(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||P("Unrecognized signal name: "+G(e)),this.signals[e]},signalRef(e){return this.signals[e]?ae(this.signals[e]):(Z(this.lambdas,e)||(this.lambdas[e]=this.add(H0(null))),ae(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const i=e[t],r=Zr(i,this),s=this.lambdas[i];s.params=r.$params,s.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!K(e)?e:this.signalRef(e.signal||mk(e))},exprRef(e,t){const n={expr:Zr(e,this)};return t&&(n.expr.$name=t),ae(this.add(Hue(n)))},addBinding(e,t){this.bindings||P("Nested signals do not support binding: "+G(e)),this.bindings.push(ve({signal:e},t))},addScaleProj(e,t){Z(this.scales,e)&&P("Duplicate scale or projection name: "+G(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,ale(t))},addProjection(e,t){this.addScaleProj(e,ile(t))},getScale(e){return this.scales[e]||P("Unrecognized scale name: "+G(e)),this.scales[e]},scaleRef(e){return ae(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return Z(this.data,e)&&P("Duplicate data set name: "+G(e)),this.data[e]=t},getData(e){return this.data[e]||P("Undefined data set name: "+G(e)),this.data[e]},addDataPipeline(e,t){return Z(this.data,e)&&P("Duplicate data set name: "+G(e)),this.addData(e,yu.fromEntries(this,t))}};function mk(e){return(L(e)?Yce:Xce)(e)}function Yce(e){const t=e.length;let n="[";for(let i=0;i<t;++i){const r=e[i];n+=(i>0?",":"")+(K(r)?r.signal||mk(r):G(r))}return n+"]"}function Xce(e){let t="{",n=0,i,r;for(i in e)r=e[i],t+=(++n>1?",":"")+G(i)+":"+(K(r)?r.signal||mk(r):G(r));return t+"}"}function Kce(){const e="sans-serif",i="#4c78a8",r="#000",s="#888",a="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:2},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:e,fontSize:11},trail:{fill:i,size:2},style:{"guide-label":{fill:r,font:e,fontSize:10},"guide-title":{fill:r,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:a},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:s,grid:!1,gridWidth:1,gridColor:a,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:s,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:a,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:s,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function Qce(e,t,n){return K(e)||P("Input Vega specification must be an object."),t=vc(Kce(),t,e.config),Hce(e,new _L(t,n)).toRuntime()}var Jce="5.31.0";ve(Bl,BH,yJ,XJ,Ree,$te,tie,Rne,iie,Cie,Pie,Vie);const Zce=Object.freeze(Object.defineProperty({__proto__:null,Bounds:wt,CanvasHandler:Ad,CanvasRenderer:o0,DATE:Gn,DAY:cn,DAYOFYEAR:Qr,Dataflow:Sl,Debug:mN,Error:$w,EventStream:Dm,Gradient:c5,GroupItem:r1,HOURS:fi,Handler:zE,HybridHandler:t6,HybridRenderer:Rb,Info:gN,Item:i1,MILLISECONDS:lr,MINUTES:hi,MONTH:pn,Marks:di,MultiPulse:Zw,None:pN,Operator:Ke,Parameters:Rm,Pulse:Pa,QUARTER:Hn,RenderType:Ca,Renderer:kd,ResourceLoader:y5,SECONDS:Ni,SVGHandler:j5,SVGRenderer:WE,SVGStringRenderer:e6,Scenegraph:R5,TIME_UNITS:qw,Transform:N,View:B4,WEEK:At,Warn:Tw,YEAR:Qt,accessor:Jn,accessorFields:dn,accessorName:dt,array:Q,ascending:wc,bandwidthNRD:i_,bin:QR,bootstrapCI:JR,boundClip:f6,boundContext:wd,boundItem:Tb,boundMark:F5,boundStroke:ia,changeset:Ou,clampRange:CN,codegenExpression:d4,compare:Rw,constant:xn,cumulativeLogNormal:l_,cumulativeNormal:Pm,cumulativeUniform:d_,dayofyear:rR,debounce:Dw,defaultLocale:Yw,definition:YR,densityLogNormal:u_,densityNormal:r_,densityUniform:h_,domChild:St,domClear:wi,domCreate:ka,domFind:LE,dotbin:ZR,error:P,expressionFunction:vt,extend:ve,extent:Yr,extentIndex:$N,falsy:ga,fastmap:_c,field:Mi,flush:TN,font:l1,fontFamily:Sd,fontSize:os,format:tg,formatLocale:zg,formats:Qw,hasOwnProperty:Z,id:ad,identity:yn,inferType:PR,inferTypes:LR,ingest:ze,inherits:Y,inrange:gl,interpolate:gE,interpolateColors:t1,interpolateRange:KI,intersect:o6,intersectBoxLine:ml,intersectPath:EE,intersectPoint:SE,intersectRule:v5,isArray:L,isBoolean:ao,isDate:Da,isFunction:we,isIterable:FN,isNumber:Ie,isObject:K,isRegExp:MN,isString:J,isTuple:Om,key:Iw,lerp:ON,lineHeight:Ya,loader:Fm,locale:DR,logger:Fw,lruCache:NN,markup:VE,merge:RN,mergeConfig:vc,multiLineOffset:DE,one:xc,pad:DN,panLinear:wN,panLog:_N,panPow:EN,panSymlog:SN,parse:Qce,parseExpression:VS,parseSelector:ho,path:jm,pathCurves:bE,pathEqual:h6,pathParse:Hl,pathRectangle:d5,pathRender:Th,pathSymbols:h5,pathTrail:p5,peek:Fe,point:f1,projection:cS,quantileLogNormal:c_,quantileNormal:Lm,quantileUniform:p_,quantiles:t_,quantizeInterpolator:QI,quarter:kN,quartiles:n_,get random(){return Ri},randomInteger:VW,randomKDE:a_,randomLCG:qW,randomLogNormal:tD,randomMixture:nD,randomNormal:s_,randomUniform:iD,read:UR,regressionConstant:g_,regressionExp:sD,regressionLinear:m_,regressionLoess:uD,regressionLog:rD,regressionPoly:oD,regressionPow:aD,regressionQuad:y_,renderModule:h1,repeat:Nf,resetDefaultLocale:BV,resetSVGClipId:m5,resetSVGDefIds:DQ,responseType:BR,runtimeContext:C4,sampleCurve:Bm,sampleLogNormal:o_,sampleNormal:Im,sampleUniform:f_,scale:Le,sceneEqual:HE,sceneFromJSON:O5,scenePickVisit:Zg,sceneToJSON:M5,sceneVisit:cr,sceneZOrder:kE,scheme:mE,serializeXML:K5,setHybridRendererOptions:MQ,setRandom:UW,span:od,splitAccessPath:rs,stringValue:G,textMetrics:ui,timeBin:wR,timeFloor:fR,timeFormatLocale:Eh,timeInterval:Ac,timeOffset:pR,timeSequence:yR,timeUnitSpecifier:iR,timeUnits:Vw,toBoolean:Pw,toDate:Lw,toNumber:fn,toSet:ur,toString:zw,transform:XR,transforms:Bl,truncate:IN,truthy:Oi,tupleid:oe,typeParsers:fb,utcFloor:hR,utcInterval:Cc,utcOffset:gR,utcSequence:xR,utcdayofyear:oR,utcquarter:AN,utcweek:uR,version:Jce,visitArray:xa,week:sR,writeConfig:bc,zero:Ea,zoomLinear:Mw,zoomLog:Ow,zoomPow:Ng,zoomSymlog:Nw},Symbol.toStringTag,{value:"Module"}));function efe(e,t,n){let i;t.x2&&(t.x?(n&&e.x>e.x2&&(i=e.x,e.x=e.x2,e.x2=i),e.width=e.x2-e.x):e.x=e.x2-(e.width||0)),t.xc&&(e.x=e.xc-(e.width||0)/2),t.y2&&(t.y?(n&&e.y>e.y2&&(i=e.y,e.y=e.y2,e.y2=i),e.height=e.y2-e.y):e.y=e.y2-(e.height||0)),t.yc&&(e.y=e.yc-(e.height||0)/2)}var tfe={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},nfe={"*":(e,t)=>e*t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,">":(e,t)=>e>t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"&":(e,t)=>e&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t},ife={"+":e=>+e,"-":e=>-e,"~":e=>~e,"!":e=>!e};const rfe=Array.prototype.slice,Fo=(e,t,n)=>{const i=n?n(t[0]):t[0];return i[e].apply(i,rfe.call(t,1))},sfe=(e,t,n,i,r,s,a)=>new Date(e,t||0,n??1,i||0,r||0,s||0,a||0);var afe={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(e,t,n)=>Math.max(t,Math.min(n,e)),now:Date.now,utc:Date.UTC,datetime:sfe,date:e=>new Date(e).getDate(),day:e=>new Date(e).getDay(),year:e=>new Date(e).getFullYear(),month:e=>new Date(e).getMonth(),hours:e=>new Date(e).getHours(),minutes:e=>new Date(e).getMinutes(),seconds:e=>new Date(e).getSeconds(),milliseconds:e=>new Date(e).getMilliseconds(),time:e=>new Date(e).getTime(),timezoneoffset:e=>new Date(e).getTimezoneOffset(),utcdate:e=>new Date(e).getUTCDate(),utcday:e=>new Date(e).getUTCDay(),utcyear:e=>new Date(e).getUTCFullYear(),utcmonth:e=>new Date(e).getUTCMonth(),utchours:e=>new Date(e).getUTCHours(),utcminutes:e=>new Date(e).getUTCMinutes(),utcseconds:e=>new Date(e).getUTCSeconds(),utcmilliseconds:e=>new Date(e).getUTCMilliseconds(),length:e=>e.length,join:function(){return Fo("join",arguments)},indexof:function(){return Fo("indexOf",arguments)},lastindexof:function(){return Fo("lastIndexOf",arguments)},slice:function(){return Fo("slice",arguments)},reverse:e=>e.slice().reverse(),sort:e=>e.slice().sort(wc),parseFloat,parseInt,upper:e=>String(e).toUpperCase(),lower:e=>String(e).toLowerCase(),substring:function(){return Fo("substring",arguments,String)},split:function(){return Fo("split",arguments,String)},replace:function(){return Fo("replace",arguments,String)},trim:e=>String(e).trim(),regexp:RegExp,test:(e,t)=>RegExp(e).test(t)};const ofe=["view","item","group","xy","x","y"],R2=new Set([Function,eval,setTimeout,setInterval]);typeof setImmediate=="function"&&R2.add(setImmediate);const ufe={Literal:(e,t)=>t.value,Identifier:(e,t)=>{const n=t.name;return e.memberDepth>0?n:n==="datum"?e.datum:n==="event"?e.event:n==="item"?e.item:tfe[n]||e.params["$"+n]},MemberExpression:(e,t)=>{const n=!t.computed,i=e(t.object);n&&(e.memberDepth+=1);const r=e(t.property);if(n&&(e.memberDepth-=1),R2.has(i[r])){console.error(`Prevented interpretation of member "${r}" which could lead to insecure code execution`);return}return i[r]},CallExpression:(e,t)=>{const n=t.arguments;let i=t.callee.name;return i.startsWith("_")&&(i=i.slice(1)),i==="if"?e(n[0])?e(n[1]):e(n[2]):(e.fn[i]||afe[i]).apply(e.fn,n.map(e))},ArrayExpression:(e,t)=>t.elements.map(e),BinaryExpression:(e,t)=>nfe[t.operator](e(t.left),e(t.right)),UnaryExpression:(e,t)=>ife[t.operator](e(t.argument)),ConditionalExpression:(e,t)=>e(t.test)?e(t.consequent):e(t.alternate),LogicalExpression:(e,t)=>t.operator==="&&"?e(t.left)&&e(t.right):e(t.left)||e(t.right),ObjectExpression:(e,t)=>t.properties.reduce((n,i)=>{e.memberDepth+=1;const r=e(i.key);return e.memberDepth-=1,R2.has(e(i.value))?console.error(`Prevented interpretation of property "${r}" which could lead to insecure code execution`):n[r]=e(i.value),n},{})};function Sf(e,t,n,i,r,s){const a=o=>ufe[o.type](a,o);return a.memberDepth=0,a.fn=Object.create(t),a.params=n,a.datum=i,a.event=r,a.item=s,ofe.forEach(o=>a.fn[o]=function(){return r.vega[o](...arguments)}),a(e)}var lfe={operator(e,t){const n=t.ast,i=e.functions;return r=>Sf(n,i,r)},parameter(e,t){const n=t.ast,i=e.functions;return(r,s)=>Sf(n,i,s,r)},event(e,t){const n=t.ast,i=e.functions;return r=>Sf(n,i,void 0,void 0,r)},handler(e,t){const n=t.ast,i=e.functions;return(r,s)=>{const a=s.item&&s.item.datum;return Sf(n,i,r,a,s)}},encode(e,t){const{marktype:n,channels:i}=t,r=e.functions,s=n==="group"||n==="image"||n==="rect";return(a,o)=>{const u=a.datum;let l=0,c;for(const f in i)c=Sf(i[f].ast,r,o,u,void 0,a),a[f]!==c&&(a[f]=c,l=1);return n!=="rule"&&efe(a,i,s),l}}};const cfe="5.23.0",ffe={version:cfe};function yk(e){return q(e,"or")}function xk(e){return q(e,"and")}function vk(e){return q(e,"not")}function kg(e,t){if(vk(e))kg(e.not,t);else if(xk(e))for(const n of e.and)kg(n,t);else if(yk(e))for(const n of e.or)kg(n,t);else t(e)}function Tl(e,t){return vk(e)?{not:Tl(e.not,t)}:xk(e)?{and:e.and.map(n=>Tl(n,t))}:yk(e)?{or:e.or.map(n=>Tl(n,t))}:t(e)}const de=structuredClone;function EL(e){throw new Error(e)}function tc(e,t){const n={};for(const i of t)Z(e,i)&&(n[i]=e[i]);return n}function Vn(e,t){const n={...e};for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>Ge(e)).join(",")})`};function Ae(e){if(Ie(e))return e;const t=J(e)?e:Ge(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function D2(e){return e===!1||e===null}function ke(e,t){return e.includes(t)}function nc(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function bk(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function SL(e,...t){for(const n of t)hfe(e,n??{});return e}function hfe(e,t){for(const n of j(t))bc(e,n,t[n],!0)}function Br(e,t){const n=[],i={};let r;for(const s of e)r=t(s),!(r in i)&&(i[r]=1,n.push(s));return n}function dfe(e,t){const n=j(e),i=j(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function kL(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function wk(e,t){for(const n of e)if(t.has(n))return!0;return!1}function I2(e){const t=new Set;for(const n of e){const r=rs(n).map((a,o)=>o===0?a:`[${a}]`),s=r.map((a,o)=>r.slice(0,o+1).join(""));for(const a of s)t.add(a)}return t}function _k(e,t){return e===void 0||t===void 0?!0:wk(I2(e),I2(t))}function He(e){return j(e).length===0}const j=Object.keys,Jt=Object.values,Ja=Object.entries;function Vh(e){return e===!0||e===!1}function it(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function ph(e,t){return vk(e)?`!(${ph(e.not,t)})`:xk(e)?`(${e.and.map(n=>ph(n,t)).join(") && (")})`:yk(e)?`(${e.or.map(n=>ph(n,t)).join(") || (")})`:t(e)}function G0(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&G0(e[n],t)&&delete e[n],He(e)}function Pd(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Ek(e,t="datum"){const n=rs(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(G).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function AL(e,t="datum"){return`${t}[${G(rs(e).join("."))}]`}function je(e){return`datum['${e.replaceAll("'","\\'")}']`}function pfe(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Ii(e){return`${rs(e).map(pfe).join("\\.")}`}function xu(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Ic(e){return`${rs(e).join(".")}`}function ic(e){return e?rs(e).length:0}function yt(...e){return e.find(t=>t!==void 0)}let CL=42;function $L(e){const t=++CL;return e?String(e)+t:t}function gfe(){CL=42}function TL(e){return FL(e)?e:`__${e}`}function FL(e){return e.startsWith("__")}function Wh(e){if(e!==void 0)return(e%360+360)%360}function I1(e){return Ie(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const $F=Object.getPrototypeOf(structuredClone({}));function ai(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor.name!==t.constructor.name)return!1;let n,i;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(i=n;i--!==0;)if(!ai(e[i],t[i]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const s of e.entries())if(!t.has(s[0]))return!1;for(const s of e.entries())if(!ai(s[1],t.get(s[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const s of e.entries())if(!t.has(s[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(n=e.length,n!=t.length)return!1;for(i=n;i--!==0;)if(e[i]!==t[i])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&e.valueOf!==$F.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&e.toString!==$F.toString)return e.toString()===t.toString();const r=Object.keys(e);if(n=r.length,n!==Object.keys(t).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,r[i]))return!1;for(i=n;i--!==0;){const s=r[i];if(!ai(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}function Ge(e){const t=[];return function n(i){if(i&&i.toJSON&&typeof i.toJSON=="function"&&(i=i.toJSON()),i===void 0)return;if(typeof i=="number")return isFinite(i)?""+i:"null";if(typeof i!="object")return JSON.stringify(i);let r,s;if(Array.isArray(i)){for(s="[",r=0;r<i.length;r++)r&&(s+=","),s+=n(i[r])||"null";return s+"]"}if(i===null)return"null";if(t.includes(i))throw new TypeError("Converting circular structure to JSON");const a=t.push(i)-1,o=Object.keys(i).sort();for(s="",r=0;r<o.length;r++){const u=o[r],l=n(i[u]);l&&(s&&(s+=","),s+=JSON.stringify(u)+":"+l)}return t.splice(a,1),`{${s}}`}(e)}function q(e,t){return K(e)&&Z(e,t)&&e[t]!==void 0}const Us="row",js="column",P1="facet",rt="x",jt="y",vr="x2",fs="y2",po="xOffset",Pc="yOffset",br="radius",sa="radius2",Bi="theta",aa="theta2",wr="latitude",_r="longitude",Er="latitude2",Pi="longitude2",go="time",Xn="color",hs="fill",ds="stroke",Kn="shape",oa="size",Lu="angle",ua="opacity",mo="fillOpacity",yo="strokeOpacity",xo="strokeWidth",vo="strokeDash",Ld="text",rc="order",zd="detail",L1="key",vu="tooltip",z1="href",B1="url",U1="description",mfe={x:1,y:1,x2:1,y2:1},ML={theta:1,theta2:1,radius:1,radius2:1};function OL(e){return Z(ML,e)}const Sk={longitude:1,longitude2:1,latitude:1,latitude2:1};function NL(e){switch(e){case wr:return"y";case Er:return"y2";case _r:return"x";case Pi:return"x2"}}function RL(e){return Z(Sk,e)}const yfe=j(Sk),kk={...mfe,...ML,...Sk,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,time:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function Fl(e){return e===Xn||e===hs||e===ds}const DL={row:1,column:1,facet:1},$i=j(DL),Ak={...kk,...DL},xfe=j(Ak),{order:bCe,detail:wCe,tooltip:_Ce,...vfe}=Ak,{row:ECe,column:SCe,facet:kCe,...bfe}=vfe;function wfe(e){return Z(bfe,e)}function IL(e){return Z(Ak,e)}const _fe=[vr,fs,Er,Pi,aa,sa];function PL(e){return zu(e)!==e}function zu(e){switch(e){case vr:return rt;case fs:return jt;case Er:return wr;case Pi:return _r;case aa:return Bi;case sa:return br}return e}function Za(e){if(OL(e))switch(e){case Bi:return"startAngle";case aa:return"endAngle";case br:return"outerRadius";case sa:return"innerRadius"}return e}function ps(e){switch(e){case rt:return vr;case jt:return fs;case wr:return Er;case _r:return Pi;case Bi:return aa;case br:return sa}}function Qn(e){switch(e){case rt:case vr:return"width";case jt:case fs:return"height"}}function LL(e){switch(e){case rt:return"xOffset";case jt:return"yOffset";case vr:return"x2Offset";case fs:return"y2Offset";case Bi:return"thetaOffset";case br:return"radiusOffset";case aa:return"theta2Offset";case sa:return"radius2Offset"}}function Ck(e){switch(e){case rt:return"xOffset";case jt:return"yOffset"}}function Efe(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const Sfe=j(kk),{x:ACe,y:CCe,x2:$Ce,y2:TCe,xOffset:FCe,yOffset:MCe,latitude:OCe,longitude:NCe,latitude2:RCe,longitude2:DCe,theta:ICe,theta2:PCe,radius:LCe,radius2:zCe,...$k}=kk,kfe=j($k),Tk={x:1,y:1},la=j(Tk);function xt(e){return Z(Tk,e)}const Fk={theta:1,radius:1},Afe=j(Fk);function j1(e){return e==="width"?rt:jt}const zL={xOffset:1,yOffset:1};function Bd(e){return Z(zL,e)}const Cfe={time:1};function ev(e){return e in Cfe}const{text:BCe,tooltip:UCe,href:jCe,url:qCe,description:VCe,detail:WCe,key:HCe,order:GCe,...BL}=$k,$fe=j(BL);function Tfe(e){return Z($k,e)}function Ffe(e){switch(e){case Xn:case hs:case ds:case oa:case Kn:case ua:case xo:case vo:return!0;case mo:case yo:case Lu:case go:return!1}}const UL={...Tk,...Fk,...zL,...BL},Mk=j(UL);function gs(e){return Z(UL,e)}function Mfe(e,t){return Nfe(e)[t]}const jL={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:YCe,...Ofe}=jL;function Nfe(e){switch(e){case Xn:case hs:case ds:case U1:case zd:case L1:case vu:case z1:case rc:case ua:case mo:case yo:case xo:case P1:case Us:case js:return jL;case rt:case jt:case po:case Pc:case wr:case _r:case go:return Ofe;case vr:case fs:case Er:case Pi:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case oa:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case vo:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Kn:return{point:"always",geoshape:"always"};case Ld:return{text:"always"};case Lu:return{point:"always",square:"always",text:"always"};case B1:return{image:"always"};case Bi:return{text:"always",arc:"always"};case br:return{text:"always",arc:"always"};case aa:case sa:return{arc:"always"}}}function tv(e){switch(e){case rt:case jt:case Bi:case br:case po:case Pc:case oa:case Lu:case xo:case ua:case mo:case yo:case go:case vr:case fs:case aa:case sa:return;case P1:case Us:case js:case Kn:case vo:case Ld:case vu:case z1:case B1:case U1:return"discrete";case Xn:case hs:case ds:return"flexible";case wr:case _r:case Er:case Pi:case zd:case L1:case rc:return}}const Rfe={argmax:1,argmin:1,average:1,count:1,distinct:1,exponential:1,exponentialb:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Dfe={count:1,min:1,max:1};function Xs(e){return q(e,"argmin")}function bo(e){return q(e,"argmax")}function Ok(e){return J(e)&&Z(Rfe,e)}const Ife=new Set(["count","valid","missing","distinct"]);function q1(e){return J(e)&&Ife.has(e)}function Pfe(e){return J(e)&&ke(["min","max"],e)}const Lfe=new Set(["count","sum","distinct","valid","missing"]),zfe=new Set(["mean","average","median","q1","q3","min","max"]);function qL(e){return ao(e)&&(e=ty(e,void 0)),"bin"+j(e).map(t=>V1(e[t])?it(`_${t}_${Ja(e[t])}`):it(`_${t}_${e[t]}`)).join("")}function Je(e){return e===!0||Bu(e)&&!e.binned}function Wt(e){return e==="binned"||Bu(e)&&e.binned===!0}function Bu(e){return K(e)}function V1(e){return q(e,"param")}function TF(e){switch(e){case Us:case js:case oa:case Xn:case hs:case ds:case xo:case ua:case mo:case yo:case Kn:return 6;case vo:return 4;default:return 10}}function Ud(e){return q(e,"expr")}function Ht(e,{level:t}={level:0}){const n=j(e||{}),i={};for(const r of n)i[r]=t===0?ii(e[r]):Ht(e[r],{level:t-1});return i}function VL(e){const{anchor:t,frame:n,offset:i,orient:r,angle:s,limit:a,color:o,subtitleColor:u,subtitleFont:l,subtitleFontSize:c,subtitleFontStyle:f,subtitleFontWeight:h,subtitleLineHeight:d,subtitlePadding:p,...g}=e,m={...g,...o?{fill:o}:{}},y={...t?{anchor:t}:{},...n?{frame:n}:{},...i?{offset:i}:{},...r?{orient:r}:{},...s!==void 0?{angle:s}:{},...a!==void 0?{limit:a}:{}},x={...u?{subtitleColor:u}:{},...l?{subtitleFont:l}:{},...c?{subtitleFontSize:c}:{},...f?{subtitleFontStyle:f}:{},...h?{subtitleFontWeight:h}:{},...d?{subtitleLineHeight:d}:{},...p?{subtitlePadding:p}:{}},v=tc(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:v,nonMarkTitleProperties:y,subtitle:x}}function _a(e){return J(e)||L(e)&&J(e[0])}function re(e){return q(e,"signal")}function Uu(e){return q(e,"step")}function Bfe(e){return L(e)?!1:q(e,"fields")&&!q(e,"data")}function Ufe(e){return L(e)?!1:q(e,"fields")&&q(e,"data")}function Is(e){return L(e)?!1:q(e,"field")&&q(e,"data")}const jfe={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},qfe=j(jfe),Vfe={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},P2=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function WL(e){const t=L(e.condition)?e.condition.map(FF):FF(e.condition);return{...ii(e),condition:t}}function ii(e){if(Ud(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function FF(e){if(Ud(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function et(e){if(Ud(e)){const{expr:t,...n}=e;return{signal:t,...n}}return re(e)?e:e!==void 0?{value:e}:void 0}function Wfe(e){return re(e)?e.signal:G(e)}function MF(e){return re(e)?e.signal:G(e.value)}function nr(e){return re(e)?e.signal:e==null?null:G(e)}function Hfe(e,t,n){for(const i of n){const r=es(i,t.markDef,t.config);r!==void 0&&(e[i]=et(r))}return e}function HL(e){return[].concat(e.type,e.style??[])}function We(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&q(t,r)?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:es(e,t,n,i)}function es(e,t,n,{vgChannel:i}={}){const r=L2(e,t,n.style);return yt(i?r:void 0,r,i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function L2(e,t,n){return GL(e,HL(t),n)}function GL(e,t,n){t=Q(t);let i;for(const r of t){const s=n[r];q(s,e)&&(i=s[e])}return i}function YL(e,t){return Q(e).reduce((n,i)=>(n.field.push(X(i,t)),n.order.push(i.sort??"ascending"),n),{field:[],order:[]})}function XL(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(ai(r,i))return;n.push(i)}),n}function KL(e,t){return ai(e,t)||!t?e:e?[...Q(e),...Q(t)].join(", "):t}function QL(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((_a(n)||re(n))&&(_a(i)||re(i)))return{explicit:e.explicit,value:KL(n,i)};if(_a(n)||re(n))return{explicit:e.explicit,value:n};if(_a(i)||re(i))return{explicit:e.explicit,value:i};if(!_a(n)&&!re(n)&&!_a(i)&&!re(i))return{explicit:e.explicit,value:XL(n,i)};throw new Error("It should never reach here")}function Nk(e){return`Invalid specification ${Ge(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Gfe='Autosize "fit" only works for single views and layered views.';function OF(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function NF(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function RF(e){return e?`Dropping "fit-${e}" because spec has discrete ${Qn(e)}.`:'Dropping "fit" because spec has discrete size.'}function Rk(e){return`Unknown field for ${e}. Cannot calculate view size.`}function DF(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Yfe(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function Xfe(e){return`The "nearest" transform is not supported for ${e} marks.`}function JL(e){return`Selection not supported for ${e} yet.`}function Kfe(e){return`Cannot find a selection named "${e}".`}const Qfe="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Jfe="Sequntial scales are deprecated. The available quantitative scale type values are linear, log, pow, sqrt, symlog, time and utc",Zfe="Legend bindings are only supported for selections over an individual field or encoding channel.";function ehe(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function the(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const nhe="The same selection must be used to override scale domains in a layered view.",ihe='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function rhe(e){return`Unknown repeated value "${e}".`}function IF(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const she="Multiple timer selections in one unit spec are not supported. Ignoring all but the first.",Dk="Animation involving facet, layer, or concat is currently unsupported.";function ahe(e){return`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${G(e)}.`}function ohe(e,t,n,i){return(e.length?"Multiple ":"No ")+`matching ${G(t)} encoding found for selection ${G(n.param)}. Using "field": ${G(i)}.`}const uhe="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function lhe(e){return`Unrecognized parse "${e}".`}function PF(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const che="Attempt to add the same child twice.";function fhe(e){return`Ignoring an invalid transform: ${Ge(e)}.`}const hhe='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function LF(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function dhe(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${Ge(t)} is overridden by a child projection ${Ge(n)}.`}const phe="Arc marks uses theta channel rather than angle, replacing angle with theta.";function ghe(e){return`${e}Offset dropped because ${e} is continuous`}function mhe(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${Ge(n)}}.`}function ZL(e){return`Invalid field type "${e}".`}function yhe(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function xhe(e){return`Invalid aggregation operator "${e}".`}function e8(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function vhe(e){return`Position range does not support relative band size for ${e}.`}function z2(e,t){return`Dropping ${Ge(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const bhe="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function W1(e,t,n){return`${e} dropped as it is incompatible with "${t}".`}function whe(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function _he(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function Ehe(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function She(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function nv(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function khe(e){return`The ${e} for range marks cannot be an expression`}function Ahe(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function Che(e,t){return`Specified orient "${e}" overridden with "${t}".`}function $he(e){return`Cannot use the scale property "${e}" with non-color channel.`}function The(e){return`Cannot use the relative band size with ${e} scale.`}function Fhe(e){return`Using unaggregated domain with raw field has no effect (${Ge(e)}).`}function Mhe(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function Ohe(e){return`Unaggregated domain is currently unsupported for log scale (${Ge(e)}).`}function Nhe(e){return`Cannot apply size to non-oriented mark "${e}".`}function Rhe(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Dhe(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function t8(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function n8(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Ihe(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ge(n)} and ${Ge(i)}). Using ${Ge(n)}.`}function Phe(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${Ge(n)} and ${Ge(i)}). Using the union of the two domains.`}function Lhe(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function zhe(e){return`Dropping sort property ${Ge(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const zF="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Bhe="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Uhe="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",jhe="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function qhe(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Vhe(e){return`Stack is applied to a non-linear scale (${e}).`}function Whe(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Y0(e,t){return`Invalid ${e}: ${Ge(t)}.`}function Hhe(e){return`Dropping day from datetime ${Ge(e)} as day cannot be combined with other units.`}function Ghe(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Yhe(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Xhe(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function BF(e){return`1D error band does not support ${e}.`}function i8(e){return`Channel ${e} is required for "binned" bin.`}function Khe(e){return`Channel ${e} should not be used with "binned" bin.`}function Qhe(e){return`Domain for ${e} is required for threshold scale.`}const r8=Fw(Tw);let bu=r8;function Jhe(e){return bu=e,bu}function Zhe(){return bu=r8,bu}function Ik(...e){bu.error(...e)}function V(...e){bu.warn(...e)}function ede(...e){bu.debug(...e)}function ju(e){if(e&&K(e)){for(const t of Lk)if(q(e,t))return!0}return!1}const s8=["january","february","march","april","may","june","july","august","september","october","november","december"],tde=s8.map(e=>e.substr(0,3)),a8=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],nde=a8.map(e=>e.substr(0,3));function ide(e){if(I1(e)&&(e=+e),Ie(e))return e>4&&V(Y0("quarter",e)),e-1;throw new Error(Y0("quarter",e))}function rde(e){if(I1(e)&&(e=+e),Ie(e))return e-1;{const t=e.toLowerCase(),n=s8.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=tde.indexOf(i);if(r!==-1)return r;throw new Error(Y0("month",e))}}function sde(e){if(I1(e)&&(e=+e),Ie(e))return e%7;{const t=e.toLowerCase(),n=a8.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=nde.indexOf(i);if(r!==-1)return r;throw new Error(Y0("day",e))}}function Pk(e,t){const n=[];if(t&&e.day!==void 0&&j(e).length>1&&(V(Hhe(e)),e=de(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?rde(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?ide(e.quarter):e.quarter;n.push(Ie(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?sde(e.day):e.day;n.push(Ie(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r>"u"?0:r)}return n}function wu(e){const n=Pk(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function ade(e){const n=Pk(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function ode(e){const t=Pk(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const o8={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},Lk=j(o8);function ude(e){return Z(o8,e)}function qu(e){return K(e)?e.binned:u8(e)}function u8(e){return e&&e.startsWith("binned")}function zk(e){return e.startsWith("utc")}function lde(e){return e.substring(3)}const cde={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function H1(e){return Lk.filter(t=>c8(e,t))}function l8(e){const t=H1(e);return t[t.length-1]}function c8(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function fde(e,t,{end:n}={end:!1}){const i=Ek(t),r=zk(e)?"utc":"";function s(u){return u==="quarter"?`(${r}quarter(${i})-1)`:`${r}${u}(${i})`}let a;const o={};for(const u of Lk)c8(e,u)&&(o[u]=s(u),a=u);return n&&(o[a]+="+1"),ade(o)}function f8(e){if(!e)return;const t=H1(e);return`timeUnitSpecifier(${Ge(t)}, ${Ge(cde)})`}function hde(e,t,n){if(!e)return;const i=f8(e);return`${n||zk(e)?"utc":"time"}Format(${t}, ${i})`}function zt(e){if(!e)return;let t;return J(e)?u8(e)?t={unit:e.substring(6),binned:!0}:t={unit:e}:K(e)&&(t={...e,...e.unit?{unit:e.unit}:{}}),zk(t.unit)&&(t.utc=!0,t.unit=lde(t.unit)),t}function dde(e){const{utc:t,...n}=zt(e);return n.unit?(t?"utc":"")+j(n).map(i=>it(`${i==="unit"?"":`_${i}_`}${n[i]}`)).join(""):(t?"utc":"")+"timeunit"+j(n).map(i=>it(`_${i}_${n[i]}`)).join("")}function h8(e,t=n=>n){const n=zt(e),i=l8(n.unit);if(i&&i!=="day"){const r={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},{step:s,part:a}=d8(i,n.step),o={...r,[a]:+r[a]+s};return`${t(wu(o))} - ${t(wu(r))}`}}const pde={year:1,month:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};function gde(e){return Z(pde,e)}function d8(e,t=1){if(gde(e))return{part:e,step:t};switch(e){case"day":case"dayofyear":return{part:"date",step:t};case"quarter":return{part:"month",step:t*3};case"week":return{part:"date",step:t*7}}}function mde(e){return q(e,"param")}function Bk(e){return!!e?.field&&e.equal!==void 0}function Uk(e){return!!e?.field&&e.lt!==void 0}function jk(e){return!!e?.field&&e.lte!==void 0}function qk(e){return!!e?.field&&e.gt!==void 0}function Vk(e){return!!e?.field&&e.gte!==void 0}function Wk(e){if(e?.field){if(L(e.range)&&e.range.length===2)return!0;if(re(e.range))return!0}return!1}function Hk(e){return!!e?.field&&(L(e.oneOf)||L(e.in))}function yde(e){return!!e?.field&&e.valid!==void 0}function p8(e){return Hk(e)||Bk(e)||Wk(e)||Uk(e)||qk(e)||jk(e)||Vk(e)}function Fr(e,t){return ny(e,{timeUnit:t,wrapTime:!0})}function xde(e,t){return e.map(n=>Fr(n,t))}function g8(e,t=!0){const{field:n}=e,i=zt(e.timeUnit),{unit:r,binned:s}=i||{},a=X(e,{expr:"datum"}),o=r?`time(${s?a:fde(r,n)})`:a;if(Bk(e))return`${o}===${Fr(e.equal,r)}`;if(Uk(e)){const u=e.lt;return`${o}<${Fr(u,r)}`}else if(qk(e)){const u=e.gt;return`${o}>${Fr(u,r)}`}else if(jk(e)){const u=e.lte;return`${o}<=${Fr(u,r)}`}else if(Vk(e)){const u=e.gte;return`${o}>=${Fr(u,r)}`}else{if(Hk(e))return`indexof([${xde(e.oneOf,r).join(",")}], ${o}) !== -1`;if(yde(e))return G1(o,e.valid);if(Wk(e)){const{range:u}=Ht(e),l=re(u)?{signal:`${u.signal}[0]`}:u[0],c=re(u)?{signal:`${u.signal}[1]`}:u[1];if(l!==null&&c!==null&&t)return"inrange("+o+", ["+Fr(l,r)+", "+Fr(c,r)+"])";const f=[];return l!==null&&f.push(`${o} >= ${Fr(l,r)}`),c!==null&&f.push(`${o} <= ${Fr(c,r)}`),f.length>0?f.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${Ge(e)}`)}function G1(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function vde(e){return p8(e)&&e.timeUnit?{...e,timeUnit:zt(e.timeUnit)}:e}const jd={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function bde(e){return e==="quantitative"||e==="temporal"}function m8(e){return e==="ordinal"||e==="nominal"}const _u=jd.quantitative,Gk=jd.ordinal,sc=jd.temporal,Yk=jd.nominal,Lc=jd.geojson;function wde(e){if(e)switch(e=e.toLowerCase(),e){case"q":case _u:return"quantitative";case"t":case sc:return"temporal";case"o":case Gk:return"ordinal";case"n":case Yk:return"nominal";case Lc:return"geojson"}}const Gt={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",TIME:"time",UTC:"utc",POINT:"point",BAND:"band"},B2={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function _de(e,t){const n=B2[e],i=B2[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const Ede={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function UF(e){return Ede[e]}const y8=new Set(["linear","log","pow","sqrt","symlog"]),x8=new Set([...y8,"time","utc"]);function v8(e){return y8.has(e)}const b8=new Set(["quantile","quantize","threshold"]),Sde=new Set([...x8,...b8,"sequential","identity"]),kde=new Set(["ordinal","bin-ordinal","point","band"]);function Bt(e){return kde.has(e)}function fr(e){return Sde.has(e)}function Ur(e){return x8.has(e)}function ac(e){return b8.has(e)}const Ade={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,tickBandPaddingInner:.25,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:4,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0,framesPerSecond:2,animationDuration:5};function Cde(e){return!J(e)&&q(e,"name")}function w8(e){return q(e,"param")}function $de(e){return q(e,"unionWith")}function Tde(e){return K(e)&&"field"in e}const Fde={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,domainRaw:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:XCe,domain:KCe,range:QCe,rangeMax:JCe,rangeMin:ZCe,scheme:e$e,...Mde}=Fde,Ode=j(Mde);function U2(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Ur(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Ur(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"domainRaw":case"clamp":return Ur(e);case"nice":return Ur(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return fr(e)&&!ke(["log","time","utc","threshold","quantile"],e)}}function _8(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Fl(e)?void 0:$he(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"domainRaw":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Nde(e,t){return ke([Gk,Yk],t)?e===void 0||Bt(e):t===sc?ke([Gt.TIME,Gt.UTC,void 0],e):t===_u?v8(e)||ac(e)||e===void 0:!0}function Rde(e,t,n=!1){if(!gs(e))return!1;switch(e){case rt:case jt:case po:case Pc:case Bi:case br:return Ur(t)||t==="band"?!0:t==="point"?!n:!1;case go:return ke(["linear","band"],t);case oa:case xo:case ua:case mo:case yo:case Lu:return Ur(t)||ac(t)||ke(["band","point","ordinal"],t);case Xn:case hs:case ds:return t!=="band";case vo:case Kn:return t==="ordinal"||ac(t)}}function Dde(e){return K(e)&&"value"in e}const Dn={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},E8=Dn.arc,Y1=Dn.area,X1=Dn.bar,Ide=Dn.image,K1=Dn.line,Q1=Dn.point,Pde=Dn.rect,X0=Dn.rule,S8=Dn.text,Xk=Dn.tick,Lde=Dn.trail,Kk=Dn.circle,Qk=Dn.square,k8=Dn.geoshape;function wo(e){return["line","area","trail"].includes(e)}function Hh(e){return["rect","bar","image","arc","tick"].includes(e)}const zde=new Set(j(Dn));function ts(e){return q(e,"type")}const Bde=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Ude=["fill","fillOpacity"],jde=[...Bde,...Ude],qde={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},jF=j(qde),iv=["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],Vde={area:["line","point"],bar:iv,rect:iv,line:["point"],tick:["bandSize","thickness",...iv]},Wde={color:"#4c78a8",invalid:"break-paths-show-path-domains",timeUnitBandSize:1},Hde={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},A8=j(Hde);function Eu(e){return q(e,"band")}const Gde={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Yde=5,Jk={binSpacing:0,continuousBandSize:Yde,minBandSize:.25,timeUnitBandPosition:.5},Xde={...Jk,binSpacing:1},Kde={...Jk,thickness:1};function Qde(e){return ts(e)?e.type:e}function C8(e,{isPath:t}){return e===void 0||e==="break-paths-show-path-domains"?t?"break-paths-show-domains":"filter":e===null?"show":e}function Zk({markDef:e,config:t,scaleChannel:n,scaleType:i,isCountAggregate:r}){if(!i||!fr(i)||r)return"always-valid";const s=C8(We("invalid",e,t),{isPath:wo(e.type)});return t.scale?.invalid?.[n]!==void 0?"show":s}function Jde(e){return e==="break-paths-filter-domains"||e==="break-paths-show-domains"}function $8({scaleName:e,scale:t,mode:n}){const i=`domain('${e}')`;if(!t||!e)return;const r=`${i}[0]`,s=`peek(${i})`,a=t.domainHasZero();return a==="definitely"?{scale:e,value:0}:a==="maybe"?{signal:`scale('${e}', inrange(0, ${i}) ? 0 : ${n==="zeroOrMin"?r:s})`}:{signal:`scale('${e}', ${n==="zeroOrMin"?r:s})`}}function T8({scaleChannel:e,channelDef:t,scale:n,scaleName:i,markDef:r,config:s}){const a=n?.get("type"),o=dr(t),u=q1(o?.aggregate),l=Zk({scaleChannel:e,markDef:r,config:s,scaleType:a,isCountAggregate:u});if(o&&l==="show"){const c=s.scale.invalid?.[e]??"zero-or-min";return{test:G1(X(o,{expr:"datum"}),!1),...Zde(c,n,i)}}}function Zde(e,t,n){if(Dde(e)){const{value:i}=e;return re(i)?{signal:i.signal}:{value:i}}return $8({scale:t,scaleName:n,mode:"zeroOrMin"})}function eA(e){const{channel:t,channelDef:n,markDef:i,scale:r,scaleName:s,config:a}=e,o=zu(t),u=tA(e),l=T8({scaleChannel:o,channelDef:n,scale:r,scaleName:s,markDef:i,config:a});return l!==void 0?[l,u]:u}function epe(e){const{datum:t}=e;return ju(t)?wu(t):`${Ge(t)}`}function tu(e,t,n,i){const r={};if(t&&(r.scale=t),ms(e)){const{datum:s}=e;ju(s)?r.signal=wu(s):re(s)?r.signal=s.signal:Ud(s)?r.signal=s.expr:r.value=s}else r.field=X(e,n);if(i){const{offset:s,band:a}=i;s&&(r.offset=s),a&&(r.band=a)}return r}function K0({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,endSuffix:s="end",bandPosition:a=.5}){const o=!re(a)&&0<a&&a<1?"datum":void 0,u=X(t,{expr:o,suffix:r}),l=n!==void 0?X(n,{expr:o}):X(t,{suffix:s,expr:o}),c={};if(a===0||a===1){c.scale=e;const f=a===0?u:l;c.field=f}else{const f=re(a)?`(1-${a.signal}) * ${u} + ${a.signal} * ${l}`:`${1-a} * ${u} + ${a} * ${l}`;c.signal=`scale("${e}", ${f})`}return i&&(c.offset=i),c}function tpe({scaleName:e,fieldDef:t}){const n=X(t,{expr:"datum"}),i=X(t,{expr:"datum",suffix:"end"});return`abs(scale("${e}", ${i}) - scale("${e}", ${n}))`}function tA({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:a,stack:o,offset:u,defaultRef:l,bandPosition:c}){if(t){if(ge(t)){const f=a?.get("type");if(Nn(t)){c??(c=eo({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:h,timeUnit:d,type:p}=t;if(Je(h)||c&&d&&p===sc)return o?.impute?tu(t,s,{binSuffix:"mid"},{offset:u}):c&&!Bt(f)?K0({scaleName:s,fieldOrDatumDef:t,bandPosition:c,offset:u}):tu(t,s,Gd(t,e)?{binSuffix:"range"}:{},{offset:u});if(Wt(h)){if(W(n))return K0({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:c,offset:u});V(i8(e===rt?vr:fs))}}return tu(t,s,Bt(f)?{binSuffix:"range"}:{},{offset:u,band:f==="band"?c??t.bandPosition??.5:void 0})}else if(hr(t)){const f=t.value,h=u?{offset:u}:{};return{...gh(e,f),...h}}}return we(l)&&(l=l()),l&&{...l,...u?{offset:u}:{}}}function gh(e,t){return ke(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:ke(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:et(t)}function Su(e){return e&&e!=="number"&&e!=="time"}function F8(e,t,n){return`${e}(${t}${n?`, ${Ge(n)}`:""})`}const npe=" – ";function nA({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){if(Su(n))return ir({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const a=M8(e,i,r),o=oc(e);if(t===void 0&&n===void 0&&s.customFormatTypes){if(o==="quantitative"){if(r&&s.normalizedNumberFormatType)return ir({fieldOrDatumDef:e,format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,expr:i,config:s});if(s.numberFormatType)return ir({fieldOrDatumDef:e,format:s.numberFormat,formatType:s.numberFormatType,expr:i,config:s})}if(o==="temporal"&&s.timeFormatType&&W(e)&&e.timeUnit===void 0)return ir({fieldOrDatumDef:e,format:s.timeFormat,formatType:s.timeFormatType,expr:i,config:s})}if(lc(e)){const u=rpe({field:a,timeUnit:W(e)?zt(e.timeUnit)?.unit:void 0,format:t,formatType:s.timeFormatType,rawTimeFormat:s.timeFormat,isUTCScale:Vu(e)&&e.scale?.type===Gt.UTC});return u?{signal:u}:void 0}if(t=j2({type:o,specifiedFormat:t,config:s,normalizeStack:r}),W(e)&&Je(e.bin)){const u=X(e,{expr:i,binSuffix:"end"});return{signal:qd(a,u,t,n,s)}}else return t||oc(e)==="quantitative"?{signal:`${R8(a,t)}`}:{signal:`isValid(${a}) ? ${a} : ""+${a}`}}function M8(e,t,n){return W(e)?n?`${X(e,{expr:t,suffix:"end"})}-${X(e,{expr:t,suffix:"start"})}`:X(e,{expr:t}):epe(e)}function ir({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:a}){if(a??(a=M8(e,i,r)),a!=="datum.value"&&W(e)&&Je(e.bin)){const o=X(e,{expr:i,binSuffix:"end"});return{signal:qd(a,o,t,n,s)}}return{signal:F8(n,a,t)}}function O8(e,t,n,i,r,s){if(!(J(i)&&Su(i))&&!(n===void 0&&i===void 0&&r.customFormatTypes&&oc(e)==="quantitative"&&(r.normalizedNumberFormatType&&uc(e)&&e.stack==="normalize"||r.numberFormatType))){if(uc(e)&&e.stack==="normalize"&&r.normalizedNumberFormat)return j2({type:"quantitative",config:r,normalizeStack:!0});if(lc(e)){const a=W(e)?zt(e.timeUnit)?.unit:void 0;return a===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:ipe({specifiedFormat:n,timeUnit:a,config:r,omitTimeFormatConfig:s})}return j2({type:t,specifiedFormat:n,config:r})}}function N8(e,t,n){if(e&&(re(e)||e==="number"||e==="time"))return e;if(lc(t)&&n!=="time"&&n!=="utc")return W(t)&&zt(t?.timeUnit)?.utc?"utc":"time"}function j2({type:e,specifiedFormat:t,config:n,normalizeStack:i}){if(J(t))return t;if(e===_u)return i?n.normalizedNumberFormat:n.numberFormat}function ipe({specifiedFormat:e,timeUnit:t,config:n,omitTimeFormatConfig:i}){return e||(t?{signal:f8(t)}:i?void 0:n.timeFormat)}function R8(e,t){return`format(${e}, "${t||""}")`}function qF(e,t,n,i){return Su(n)?F8(n,e,t):R8(e,(J(t)?t:void 0)??i.numberFormat)}function qd(e,t,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return qd(e,t,r.numberFormat,r.numberFormatType,r);const s=qF(e,n,i,r),a=qF(t,n,i,r);return`${G1(e,!1)} ? "null" : ${s} + "${npe}" + ${a}`}function rpe({field:e,timeUnit:t,format:n,formatType:i,rawTimeFormat:r,isUTCScale:s}){return!t||n?!t&&i?`${i}(${e}, '${n}')`:(n=J(n)?n:r,`${s?"utc":"time"}Format(${e}, '${n}')`):hde(t,e,s)}const J1="min",spe={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function VF(e){return Z(spe,e)}function ape(e){return q(e,"encoding")}function qs(e){return e&&(e.op==="count"||q(e,"field"))}function D8(e){return e&&L(e)}function Vd(e){return q(e,"row")||q(e,"column")}function iA(e){return q(e,"header")}function Z1(e){return q(e,"facet")}function ope(e){return q(e,"param")}function upe(e){return!J(e)&&q(e,"repeat")}function WF(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return{...n?{timeUnit:n}:{},...i?{bin:i}:{},...r?{aggregate:r}:{},field:t}}function rA(e){return q(e,"sort")}function eo({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(ge(e)&&e.bandPosition!==void 0)return e.bandPosition;if(W(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return es("timeUnitBandPosition",n,i);if(Je(s))return .5}}function I8({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:a}){const o=Qn(e),u=We(a?"size":o,i,r,{vgChannel:o});if(u!==void 0)return u;if(W(t)){const{timeUnit:l,bin:c}=t;if(l&&!n)return{band:es("timeUnitBandSize",i,r)};if(Je(c)&&!Bt(s))return{band:1}}if(Hh(i.type))return s?Bt(s)?r[i.type]?.discreteBandSize||{band:1}:r[i.type]?.continuousBandSize:r[i.type]?.discreteBandSize}function P8(e,t,n,i){return Je(e.bin)||e.timeUnit&&Nn(e)&&e.type==="temporal"?eo({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function L8(e){return q(e,"sort")&&!q(e,"field")}function Wd(e){return q(e,"condition")}function ey(e){const t=e?.condition;return!!t&&!L(t)&&W(t)}function Hd(e){const t=e?.condition;return!!t&&!L(t)&&ge(t)}function lpe(e){const t=e?.condition;return!!t&&(L(t)||hr(t))}function W(e){return q(e,"field")||e?.aggregate==="count"}function oc(e){return e?.type}function ms(e){return q(e,"datum")}function Oa(e){return Nn(e)&&!J0(e)||Q0(e)}function HF(e){return Nn(e)&&e.type==="quantitative"&&!e.bin||Q0(e)}function Q0(e){return ms(e)&&Ie(e.datum)}function ge(e){return W(e)||ms(e)}function Nn(e){return e&&(q(e,"field")||e.aggregate==="count")&&q(e,"type")}function hr(e){return q(e,"value")}function Vu(e){return q(e,"scale")||q(e,"sort")}function uc(e){return q(e,"axis")||q(e,"stack")||q(e,"impute")}function z8(e){return q(e,"legend")}function B8(e){return q(e,"format")||q(e,"formatType")}function cpe(e){return Vn(e,["legend","axis","header","scale"])}function fpe(e){return q(e,"op")}function X(e,t={}){let n=e.field;const i=t.prefix;let r=t.suffix,s="";if(dpe(e))n=TL("count");else{let a;if(!t.nofn)if(fpe(e))a=e.op;else{const{bin:o,aggregate:u,timeUnit:l}=e;Je(o)?(a=qL(o),r=(t.binSuffix??"")+(t.suffix??"")):u?bo(u)?(s=`["${n}"]`,n=`argmax_${u.argmax}`):Xs(u)?(s=`["${n}"]`,n=`argmin_${u.argmin}`):a=String(u):l&&!qu(l)&&(a=dde(l),r=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+(t.suffix??""))}a&&(n=n?`${a}_${n}`:a)}return r&&(n=`${n}_${r}`),i&&(n=`${i}_${n}`),t.forAs?Ic(n):t.expr?AL(n,t.expr)+s:Ii(n)+s}function J0(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return W(e)&&!!e.bin;case"temporal":return!1}throw new Error(ZL(e.type))}function hpe(e){return Vu(e)&&ac(e.scale?.type)}function dpe(e){return e.aggregate==="count"}function ppe(e,t){const{field:n,bin:i,timeUnit:r,aggregate:s}=e;if(s==="count")return t.countTitle;if(Je(i))return`${n} (binned)`;if(r&&!qu(r)){const a=zt(r)?.unit;if(a)return`${n} (${H1(a).join("-")})`}else if(s)return bo(s)?`${n} for max ${s.argmax}`:Xs(s)?`${n} for min ${s.argmin}`:`${Pd(s)} of ${n}`;return n}function gpe(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(bo(t))return`${r} for argmax(${t.argmax})`;if(Xs(t))return`${r} for argmin(${t.argmin})`;const s=i&&!qu(i)?zt(i):void 0,a=t||s?.unit||s?.maxbins&&"timeunit"||Je(n)&&"bin";return a?`${a.toUpperCase()}(${r})`:r}const U8=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return gpe(e);default:return ppe(e,t)}};let j8=U8;function q8(e){j8=e}function mpe(){q8(U8)}function Ml(e,t,{allowDisabling:n,includeDefault:i=!0}){const r=sA(e)?.title;if(!W(e))return r??e.title;const s=e,a=i?aA(s,t):void 0;return n?yt(r,s.title,a):r??s.title??a}function sA(e){if(uc(e)&&e.axis)return e.axis;if(z8(e)&&e.legend)return e.legend;if(iA(e)&&e.header)return e.header}function aA(e,t){return j8(e,t)}function Z0(e){if(B8(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}else{const t=sA(e)??{},{format:n,formatType:i}=t;return{format:n,formatType:i}}}function ype(e,t){switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(rA(e)&&L(e.sort))return"ordinal";const{aggregate:n,bin:i,timeUnit:r}=e;if(r)return"temporal";if(i||n&&!bo(n)&&!Xs(n))return"quantitative";if(Vu(e)&&e.scale?.type)switch(B2[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function dr(e){if(W(e))return e;if(ey(e))return e.condition}function Ct(e){if(ge(e))return e;if(Hd(e))return e.condition}function V8(e,t,n,i={}){if(J(e)||Ie(e)||ao(e)){const r=J(e)?"string":Ie(e)?"number":"boolean";return V(mhe(t,r,e)),{value:e}}return ge(e)?em(e,t,n,i):Hd(e)?{...e,condition:em(e.condition,t,n,i)}:e}function em(e,t,n,i){if(B8(e)){const{format:r,formatType:s,...a}=e;if(Su(s)&&!n.customFormatTypes)return V(LF(t)),em(a,t,n,i)}else{const r=uc(e)?"axis":z8(e)?"legend":iA(e)?"header":null;if(r&&e[r]){const{format:s,formatType:a,...o}=e[r];if(Su(a)&&!n.customFormatTypes)return V(LF(t)),em({...e,[r]:o},t,n,i)}}return W(e)?oA(e,t,i):xpe(e)}function xpe(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Ie(n)?"quantitative":J(n)?"nominal":ju(n)?"temporal":void 0,{...e,type:t}}function oA(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:a}=e,o={...e};if(!n&&i&&!Ok(i)&&!bo(i)&&!Xs(i)&&(V(xhe(i)),delete o.aggregate),r&&(o.timeUnit=zt(r)),a&&(o.field=`${a}`),Je(s)&&(o.bin=ty(s,t)),Wt(s)&&!xt(t)&&V(Khe(t)),Nn(o)){const{type:u}=o,l=wde(u);u!==l&&(o.type=l),u!=="quantitative"&&q1(i)&&(V(yhe(u,i)),o.type="quantitative")}else if(!PL(t)){const u=ype(o,t);o.type=u}if(Nn(o)){const{compatible:u,warning:l}=vpe(o,t)||{};u===!1&&V(l)}if(rA(o)&&J(o.sort)){const{sort:u}=o;if(VF(u))return{...o,sort:{encoding:u}};const l=u.substring(1);if(u.charAt(0)==="-"&&VF(l))return{...o,sort:{encoding:l,order:"descending"}}}if(iA(o)){const{header:u}=o;if(u){const{orient:l,...c}=u;if(l)return{...o,header:{...c,labelOrient:u.labelOrient||l,titleOrient:u.titleOrient||l}}}}return o}function ty(e,t){return ao(e)?{maxbins:TF(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?{...e,maxbins:TF(t)}:e}const sl={compatible:!0};function vpe(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Us:case js:case P1:return J0(e)?sl:{compatible:!1,warning:_he(t)};case rt:case jt:case po:case Pc:case Xn:case hs:case ds:case Ld:case zd:case L1:case vu:case z1:case B1:case Lu:case Bi:case br:case U1:return sl;case _r:case Pi:case wr:case Er:return n!==_u?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:sl;case ua:case mo:case yo:case xo:case oa:case aa:case sa:case vr:case fs:case go:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:sl;case Kn:case vo:return!J0(e)&&!hpe(e)?{compatible:!1,warning:Ehe(t)}:sl;case rc:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:sl}}function lc(e){const{formatType:t}=Z0(e);return t==="time"||!t&&bpe(e)}function bpe(e){return e&&(e.type==="temporal"||W(e)&&!!e.timeUnit)}function ny(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){const s=t&&zt(t)?.unit;let a=s||n==="temporal",o;return Ud(e)?o=e.expr:re(e)?o=e.signal:ju(e)?(a=!0,o=wu(e)):(J(e)||Ie(e))&&a&&(o=`datetime(${Ge(e)})`,ude(s)&&(Ie(e)&&e<1e4||J(e)&&isNaN(Date.parse(e)))&&(o=wu({[s]:e}))),o?i&&a?`time(${o})`:o:r?void 0:Ge(e)}function W8(e,t){const{type:n}=e;return t.map(i=>{const r=W(e)&&!qu(e.timeUnit)?e.timeUnit:void 0,s=ny(i,{timeUnit:r,type:n,undefinedIfExprNotRequired:!0});return s!==void 0?{signal:s}:i})}function Gd(e,t){return Je(e.bin)?gs(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const GF={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Yd(e){return e?.condition}const H8=["domain","grid","labels","ticks","title"],wpe={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},G8={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},_pe={...G8,style:1,labelExpr:1,encoding:1};function YF(e){return Z(_pe,e)}const Epe={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Y8=j(Epe);function ca(e){return q(e,"mark")}class iy{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return ca(t)?Qde(t.mark)===this.name:!1}}function nu(e,t){const n=e&&e[t];return n?L(n)?nc(n,i=>!!i.field):W(n)||ey(n):!1}function X8(e,t){const n=e&&e[t];return n?L(n)?nc(n,i=>!!i.field):W(n)||ms(n)||Hd(n):!1}function K8(e,t){if(xt(t)){const n=e[t];if((W(n)||ms(n))&&(m8(n.type)||W(n)&&n.timeUnit)){const i=Ck(t);return X8(e,i)}}return!1}function Q8(e){return nc(xfe,t=>{if(nu(e,t)){const n=e[t];if(L(n))return nc(n,i=>!!i.aggregate);{const i=dr(n);return i&&!!i.aggregate}}return!1})}function J8(e,t){const n=[],i=[],r=[],s=[],a={};return uA(e,(o,u)=>{if(W(o)){const{field:l,aggregate:c,bin:f,timeUnit:h,...d}=o;if(c||h||f){const g=sA(o)?.title;let m=X(o,{forAs:!0});const y={...g?[]:{title:Ml(o,t,{allowDisabling:!0})},...d,field:m};if(c){let x;if(bo(c)?(x="argmax",m=X({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${m}.${l}`):Xs(c)?(x="argmin",m=X({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${m}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(x=c),x){const v={op:x,as:m};l&&(v.field=l),s.push(v)}}else if(n.push(m),Nn(o)&&Je(f)){if(i.push({bin:f,field:l,as:m}),n.push(X(o,{binSuffix:"end"})),Gd(o,u)&&n.push(X(o,{binSuffix:"range"})),xt(u)){const x={field:`${m}_end`};a[`${u}2`]=x}y.bin="binned",PL(u)||(y.type=_u)}else if(h&&!qu(h)){r.push({timeUnit:h,field:l,as:m});const x=Nn(o)&&o.type!==sc&&"time";x&&(u===Ld||u===vu?y.formatType=x:Tfe(u)?y.legend={formatType:x,...y.legend}:xt(u)&&(y.axis={formatType:x,...y.axis}))}a[u]=y}else n.push(l),a[u]=e[u]}else a[u]=e[u]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:a}}function Spe(e,t,n){const i=Mfe(t,n);if(i){if(i==="binned"){const r=e[t===vr?rt:jt];return!!(W(r)&&W(e[t])&&Wt(r.bin))}}else return!1;return!0}function kpe(e,t,n,i){const r={};for(const s of j(e))IL(s)||V(whe(s));for(let s of Sfe){if(!e[s])continue;const a=e[s];if(Bd(s)){const o=Efe(s),u=r[o];if(W(u)&&bde(u.type)&&W(a)&&!u.timeUnit){V(ghe(o));continue}}if(s==="angle"&&t==="arc"&&!e.theta&&(V(phe),s=Bi),!Spe(e,s,t)){V(W1(s,t));continue}if(s===oa&&t==="line"&&dr(e[s])?.aggregate){V(bhe);continue}if(s===Xn&&(n?"fill"in e:"stroke"in e)){V(e8("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(s===zd||s===rc&&!L(a)&&!hr(a)||s===vu&&L(a)){if(a){if(s===rc){const o=e[s];if(L8(o)){r[s]=o;continue}}r[s]=Q(a).reduce((o,u)=>(W(u)?o.push(oA(u,s)):V(z2(u,s)),o),[])}}else{if(s===vu&&a===null)r[s]=null;else if(!W(a)&&!ms(a)&&!hr(a)&&!Wd(a)&&!re(a)){V(z2(a,s));continue}r[s]=V8(a,s,i)}}return r}function ry(e,t){const n={};for(const i of j(e)){const r=V8(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function Ape(e){const t=[];for(const n of j(e))if(nu(e,n)){const i=e[n],r=Q(i);for(const s of r)W(s)?t.push(s):ey(s)&&t.push(s.condition)}return t}function uA(e,t,n){if(e)for(const i of j(e)){const r=e[i];if(L(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function Cpe(e,t,n,i){return e?j(e).reduce((r,s)=>{const a=e[s];return L(a)?a.reduce((o,u)=>t.call(i,o,u,s),r):t.call(i,r,a,s)},n):n}function Z8(e,t){return j(t).reduce((n,i)=>{switch(i){case rt:case jt:case z1:case U1:case B1:case vr:case fs:case po:case Pc:case Bi:case aa:case br:case sa:case go:case wr:case _r:case Er:case Pi:case Ld:case Kn:case Lu:case vu:return n;case rc:if(e==="line"||e==="trail")return n;case zd:case L1:{const r=t[i];if(L(r)||W(r))for(const s of Q(r))s.aggregate||n.push(X(s,{}));return n}case oa:if(e==="trail")return n;case Xn:case hs:case ds:case ua:case mo:case yo:case vo:case xo:{const r=dr(t[i]);return r&&!r.aggregate&&n.push(X(r,{})),n}}},[])}function $pe(e){const{tooltip:t,...n}=e;if(!t)return{filteredEncoding:n};let i,r;if(L(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return L(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function q2(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:a,titlePrefix:o})=>{const u=i?` of ${lA(t)}`:"";return{field:a+t.field,type:t.type,title:re(o)?{signal:`${o}"${escape(u)}"`}:o+u}}),s=Ape(n).map(cpe);return{tooltip:[...r,...Br(s,Ae)]}}function lA(e){const{title:t,field:n}=e;return yt(t,n)}function cA(e,t,n,i,r){const{scale:s,axis:a}=n;return({partName:o,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,extraEncoding:f={}})=>{const h=lA(n);return e9(e,o,r,{mark:u,encoding:{[t]:{field:`${l}_${n.field}`,type:n.type,...h!==void 0?{title:h}:{},...s!==void 0?{scale:s}:{},...a!==void 0?{axis:a}:{}},...J(c)?{[`${t}2`]:{field:`${c}_${n.field}`}}:{},...i,...f}})}}function e9(e,t,n,i){const{clip:r,color:s,opacity:a}=e,o=e.type;return e[t]||e[t]===void 0&&n[t]?[{...i,mark:{...n[t],...r?{clip:r}:{},...s?{color:s}:{},...a?{opacity:a}:{},...ts(i.mark)?i.mark:{type:i.mark},style:`${o}-${String(t)}`,...ao(e[t])?{}:e[t]}}]:[]}function t9(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],a=i[`${r}2`],o=i[`${r}Error`],u=i[`${r}Error2`];return{continuousAxisChannelDef:zp(s,n),continuousAxisChannelDef2:zp(a,n),continuousAxisChannelDefError:zp(o,n),continuousAxisChannelDefError2:zp(u,n),continuousAxis:r}}function zp(e,t){if(e?.aggregate){const{aggregate:n,...i}=e;return n!==t&&V(Xhe(n,t)),i}else return e}function n9(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(ts(n)&&n.orient)return n.orient;if(Oa(r)){if(Oa(s)){const a=W(r)&&r.aggregate,o=W(s)&&s.aggregate;if(!a&&o===t)return"vertical";if(!o&&a===t)return"horizontal";if(a===t&&o===t)throw new Error("Both x and y cannot have aggregate");return lc(s)&&!lc(r)?"horizontal":"vertical"}return"horizontal"}else{if(Oa(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}const tm="boxplot",Tpe=["box","median","outliers","rule","ticks"],Fpe=new iy(tm,r9);function i9(e){return Ie(e)?"tukey":e}function r9(e,{config:t}){e={...e,encoding:ry(e.encoding,t)};const{mark:n,encoding:i,params:r,projection:s,...a}=e,o=ts(n)?n:{type:n};r&&V(JL("boxplot"));const u=o.extent??t.boxplot.extent,l=We("size",o,t),c=o.invalid,f=i9(u),{bins:h,timeUnits:d,transform:p,continuousAxisChannelDef:g,continuousAxis:m,groupby:y,aggregate:x,encodingWithoutContinuousAxis:v,ticksOrient:b,boxOrient:w,customTooltipWithoutAggregatedField:E}=Mpe(e,u,t),_=Ic(g.field),{color:k,size:A,...T}=v,$=ap=>cA(o,m,g,ap,t.boxplot),R=$(T),O=$(v),F=(K(t.boxplot.box)?t.boxplot.box.color:t.mark.color)||"#4c78a8",C=$({...T,...A?{size:A}:{},color:{condition:{test:`${je(`lower_box_${g.field}`)} >= ${je(`upper_box_${g.field}`)}`,...k||{value:F}}}}),M=q2([{fieldPrefix:f==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:f==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],g,v),D={type:"tick",color:"black",opacity:1,orient:b,invalid:c,aria:!1},B=f==="min-max"?M:q2([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,v),z=[...R({partName:"rule",mark:{type:"rule",invalid:c,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:B}),...R({partName:"rule",mark:{type:"rule",invalid:c,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:B}),...R({partName:"ticks",mark:D,positionPrefix:"lower_whisker",extraEncoding:B}),...R({partName:"ticks",mark:D,positionPrefix:"upper_whisker",extraEncoding:B})],ee=[...f!=="tukey"?z:[],...O({partName:"box",mark:{type:"bar",...l?{size:l}:{},orient:w,invalid:c,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:M}),...C({partName:"median",mark:{type:"tick",invalid:c,...K(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{},...l?{size:l}:{},orient:b,aria:!1},positionPrefix:"mid_box",extraEncoding:M})];if(f==="min-max")return{...a,transform:(a.transform??[]).concat(p),layer:ee};const he=je(`lower_box_${g.field}`),le=je(`upper_box_${g.field}`),me=`(${le} - ${he})`,Xe=`${he} - ${u} * ${me}`,ye=`${le} + ${u} * ${me}`,nn=je(g.field),Ao={joinaggregate:s9(g.field),groupby:y},da={transform:[{filter:`(${Xe} <= ${nn}) && (${nn} <= ${ye})`},{aggregate:[{op:"min",field:g.field,as:`lower_whisker_${_}`},{op:"max",field:g.field,as:`upper_whisker_${_}`},{op:"min",field:`lower_box_${g.field}`,as:`lower_box_${_}`},{op:"max",field:`upper_box_${g.field}`,as:`upper_box_${_}`},...x],groupby:y}],layer:z},{tooltip:te,...be}=T,{scale:Ee,axis:H}=g,qt=lA(g),Ue=Vn(H,["title"]),rn=e9(o,"outliers",t.boxplot,{transform:[{filter:`(${nn} < ${Xe}) || (${nn} > ${ye})`}],mark:"point",encoding:{[m]:{field:g.field,type:g.type,...qt!==void 0?{title:qt}:{},...Ee!==void 0?{scale:Ee}:{},...He(Ue)?{}:{axis:Ue}},...be,...k?{color:k}:{},...E?{tooltip:E}:{}}})[0];let Ot;const Ar=[...h,...d,Ao];return rn?Ot={transform:Ar,layer:[rn,da]}:(Ot=da,Ot.transform.unshift(...Ar)),{...a,layer:[Ot,{transform:p,layer:ee}]}}function s9(e){const t=Ic(e);return[{op:"q1",field:e,as:`lower_box_${t}`},{op:"q3",field:e,as:`upper_box_${t}`}]}function Mpe(e,t,n){const i=n9(e,tm),{continuousAxisChannelDef:r,continuousAxis:s}=t9(e,i,tm),a=r.field,o=Ic(a),u=i9(t),l=[...s9(a),{op:"median",field:a,as:`mid_box_${o}`},{op:"min",field:a,as:(u==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:a,as:(u==="min-max"?"upper_whisker_":"max_")+o}],c=u==="min-max"||u==="tukey"?[]:[{calculate:`${je(`upper_box_${o}`)} - ${je(`lower_box_${o}`)}`,as:`iqr_${o}`},{calculate:`min(${je(`upper_box_${o}`)} + ${je(`iqr_${o}`)} * ${t}, ${je(`max_${o}`)})`,as:`upper_whisker_${o}`},{calculate:`max(${je(`lower_box_${o}`)} - ${je(`iqr_${o}`)} * ${t}, ${je(`min_${o}`)})`,as:`lower_whisker_${o}`}],{[s]:f,...h}=e.encoding,{customTooltipWithoutAggregatedField:d,filteredEncoding:p}=$pe(h),{bins:g,timeUnits:m,aggregate:y,groupby:x,encoding:v}=J8(p,n),b=i==="vertical"?"horizontal":"vertical",w=i,E=[...g,...m,{aggregate:[...y,...l],groupby:x},...c];return{bins:g,timeUnits:m,transform:E,groupby:x,aggregate:y,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:v,ticksOrient:b,boxOrient:w,customTooltipWithoutAggregatedField:d}}const fA="errorbar",Ope=["ticks","rule"],Npe=new iy(fA,a9);function a9(e,{config:t}){e={...e,encoding:ry(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:a,markDef:o,outerSpec:u,tooltipEncoding:l}=o9(e,fA,t);delete s.size;const c=cA(o,r,i,s,t.errorbar),f=o.thickness,h=o.size,d={type:"tick",orient:a,aria:!1,...f!==void 0?{thickness:f}:{},...h!==void 0?{size:h}:{}},p=[...c({partName:"ticks",mark:d,positionPrefix:"lower",extraEncoding:l}),...c({partName:"ticks",mark:d,positionPrefix:"upper",extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...f!==void 0?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return{...u,transform:n,...p.length>1?{layer:p}:{...p[0]}}}function Rpe(e,t){const{encoding:n}=e;if(Dpe(n))return{orient:n9(e,t),inputType:"raw"};const i=Ipe(n),r=Ppe(n),s=n.x,a=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const o=n.x2,u=n.y2;if(ge(o)&&ge(u))throw new Error(`${t} cannot have both x2 and y2`);if(ge(o)){if(Oa(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(ge(u)){if(Oa(a))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const o=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(ge(u)&&!ge(o))throw new Error(`${t} cannot have xError2 without xError`);if(ge(c)&&!ge(l))throw new Error(`${t} cannot have yError2 without yError`);if(ge(o)&&ge(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(ge(o)){if(Oa(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(ge(l)){if(Oa(a))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function Dpe(e){return(ge(e.x)||ge(e.y))&&!ge(e.x2)&&!ge(e.y2)&&!ge(e.xError)&&!ge(e.xError2)&&!ge(e.yError)&&!ge(e.yError2)}function Ipe(e){return ge(e.x2)||ge(e.y2)}function Ppe(e){return ge(e.xError)||ge(e.xError2)||ge(e.yError)||ge(e.yError2)}function o9(e,t,n){const{mark:i,encoding:r,params:s,projection:a,...o}=e,u=ts(i)?i:{type:i};s&&V(JL(t));const{orient:l,inputType:c}=Rpe(e,t),{continuousAxisChannelDef:f,continuousAxisChannelDef2:h,continuousAxisChannelDefError:d,continuousAxisChannelDefError2:p,continuousAxis:g}=t9(e,l,t),{errorBarSpecificAggregate:m,postAggregateCalculates:y,tooltipSummary:x,tooltipTitleWithFieldName:v}=Lpe(u,f,h,d,p,c,t,n),{[g]:b,[g==="x"?"x2":"y2"]:w,[g==="x"?"xError":"yError"]:E,[g==="x"?"xError2":"yError2"]:_,...k}=r,{bins:A,timeUnits:T,aggregate:$,groupby:R,encoding:O}=J8(k,n),F=[...$,...m],C=c!=="raw"?[]:R,M=q2(x,f,O,v);return{transform:[...o.transform??[],...A,...T,...F.length===0?[]:[{aggregate:F,groupby:C}],...y],groupby:C,continuousAxisChannelDef:f,continuousAxis:g,encodingWithoutContinuousAxis:O,ticksOrient:l==="vertical"?"horizontal":"vertical",markDef:u,outerSpec:o,tooltipEncoding:M}}function Lpe(e,t,n,i,r,s,a,o){let u=[],l=[];const c=t.field;let f,h=!1;if(s==="raw"){const d=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":o.errorbar.center,p=e.extent?e.extent:d==="mean"?"stderr":"iqr";if(d==="median"!=(p==="iqr")&&V(Yhe(d,p,a)),p==="stderr"||p==="stdev")u=[{op:p,field:c,as:`extent_${c}`},{op:d,field:c,as:`center_${c}`}],l=[{calculate:`${je(`center_${c}`)} + ${je(`extent_${c}`)}`,as:`upper_${c}`},{calculate:`${je(`center_${c}`)} - ${je(`extent_${c}`)}`,as:`lower_${c}`}],f=[{fieldPrefix:"center_",titlePrefix:Pd(d)},{fieldPrefix:"upper_",titlePrefix:XF(d,p,"+")},{fieldPrefix:"lower_",titlePrefix:XF(d,p,"-")}],h=!0;else{let g,m,y;p==="ci"?(g="mean",m="ci0",y="ci1"):(g="median",m="q1",y="q3"),u=[{op:m,field:c,as:`lower_${c}`},{op:y,field:c,as:`upper_${c}`},{op:g,field:c,as:`center_${c}`}],f=[{fieldPrefix:"upper_",titlePrefix:Ml({field:c,aggregate:y,type:"quantitative"},o,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Ml({field:c,aggregate:m,type:"quantitative"},o,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Ml({field:c,aggregate:g,type:"quantitative"},o,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&V(Ghe(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:je(n.field),as:`upper_${c}`},{calculate:je(c),as:`lower_${c}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`${je(c)} + ${je(i.field)}`,as:`upper_${c}`}],r?l.push({calculate:`${je(c)} + ${je(r.field)}`,as:`lower_${c}`}):l.push({calculate:`${je(c)} - ${je(i.field)}`,as:`lower_${c}`}));for(const d of l)f.push({fieldPrefix:d.as.substring(0,6),titlePrefix:xu(xu(d.calculate,"datum['",""),"']","")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:h}}function XF(e,t,n){return`${Pd(e)} ${n} ${t}`}const hA="errorband",zpe=["band","borders"],Bpe=new iy(hA,u9);function u9(e,{config:t}){e={...e,encoding:ry(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:a,outerSpec:o,tooltipEncoding:u}=o9(e,hA,t),l=a,c=cA(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let h={type:f?"area":"rect"},d={type:f?"line":"rule"};const p={...l.interpolate?{interpolate:l.interpolate}:{},...l.tension&&l.interpolate?{tension:l.tension}:{}};return f?(h={...h,...p,ariaRoleDescription:"errorband"},d={...d,...p,aria:!1}):l.interpolate?V(BF("interpolate")):l.tension&&V(BF("tension")),{...o,transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"lower",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"upper",extraEncoding:u})]}}const l9={};function dA(e,t,n){const i=new iy(e,t);l9[e]={normalizer:i,parts:n}}function Upe(){return j(l9)}dA(tm,r9,Tpe);dA(fA,a9,Ope);dA(hA,u9,zpe);const jpe=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],c9={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},f9={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},qpe=j(c9),Vpe=j(f9),Wpe={header:1,headerRow:1,headerColumn:1,headerFacet:1},h9=j(Wpe),d9=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Hpe={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Gpe={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},pr="_vgsid_",Ype={point:{on:"click",fields:[pr],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[pointerdown, window:pointerup] > window:pointermove!",encodings:["x","y"],translate:"[pointerdown, window:pointerup] > window:pointermove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function pA(e){return e==="legend"||!!e?.legend}function rv(e){return pA(e)&&K(e)}function gA(e){return!!e?.select}function p9(e){const t=[];for(const n of e||[]){if(gA(n))continue;const{expr:i,bind:r,...s}=n;if(r&&i){const a={...s,bind:r,init:i};t.push(a)}else{const a={...s,...i?{update:i}:{},...r?{bind:r}:{}};t.push(a)}}return t}function Xpe(e){return sy(e)||yA(e)||mA(e)}function mA(e){return q(e,"concat")}function sy(e){return q(e,"vconcat")}function yA(e){return q(e,"hconcat")}function g9({step:e,offsetIsDiscrete:t}){return t?e.for??"offset":"position"}function ns(e){return q(e,"step")}function KF(e){return q(e,"view")||q(e,"width")||q(e,"height")}const QF=20,Kpe={align:1,bounds:1,center:1,columns:1,spacing:1},Qpe=j(Kpe);function Jpe(e,t,n){const i=n[t],r={},{spacing:s,columns:a}=i;s!==void 0&&(r.spacing=s),a!==void 0&&(Z1(e)&&!Vd(e.facet)||mA(e))&&(r.columns=a),sy(e)&&(r.columns=1);for(const o of Qpe)if(e[o]!==void 0)if(o==="spacing"){const u=e[o];r[o]=Ie(u)?u:{row:u.row??s,column:u.column??s}}else r[o]=e[o];return r}function V2(e,t){return e[t]??e[t==="width"?"continuousWidth":"continuousHeight"]}function W2(e,t){const n=nm(e,t);return ns(n)?n.step:m9}function nm(e,t){const n=e[t]??e[t==="width"?"discreteWidth":"discreteHeight"];return yt(n,{step:e.step})}const m9=20,Zpe={continuousWidth:200,continuousHeight:200,step:m9},ege={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:Zpe,mark:Wde,arc:{},area:{},bar:Xde,circle:{},geoshape:{},image:{},line:{},point:{},rect:Jk,rule:{color:"black"},square:{},text:{color:"black"},tick:Kde,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:Ade,projection:{},legend:Hpe,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Ype,style:{},title:{},facet:{spacing:QF},concat:{spacing:QF},normalizedNumberFormat:".0%"},_s=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],JF={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},ZF={blue:_s[0],orange:_s[1],red:_s[2],teal:_s[3],green:_s[4],yellow:_s[5],purple:_s[6],pink:_s[7],brown:_s[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function tge(e={}){return{signals:[{name:"color",value:K(e)?{...ZF,...e}:ZF}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function nge(e){return{signals:[{name:"fontSize",value:K(e)?{...JF,...e}:JF}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function ige(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function y9(e){const t=j(e||{}),n={};for(const i of t){const r=e[i];n[i]=Yd(r)?WL(r):ii(r)}return n}function rge(e){const t=j(e),n={};for(const i of t)n[i]=y9(e[i]);return n}const sge=[...A8,...Y8,...h9,"background","padding","legend","lineBreak","scale","style","title","view"];function x9(e={}){const{color:t,font:n,fontSize:i,selection:r,...s}=e,a=vc({},de(ege),n?ige(n):{},t?tge(t):{},i?nge(i):{},s||{});r&&bc(a,"selection",r,!0);const o=Vn(a,sge);for(const u of["background","lineBreak","padding"])a[u]&&(o[u]=ii(a[u]));for(const u of A8)a[u]&&(o[u]=Ht(a[u]));for(const u of Y8)a[u]&&(o[u]=y9(a[u]));for(const u of h9)a[u]&&(o[u]=Ht(a[u]));if(a.legend&&(o.legend=Ht(a.legend)),a.scale){const{invalid:u,...l}=a.scale,c=Ht(u,{level:1});o.scale={...Ht(l),...j(c).length>0?{invalid:c}:{}}}return a.style&&(o.style=rge(a.style)),a.title&&(o.title=Ht(a.title)),a.view&&(o.view=Ht(a.view)),o}const age=new Set(["view",...zde]),oge=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],uge={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...Vde};function lge(e){e=de(e);for(const t of oge)delete e[t];if(e.axis)for(const t in e.axis)Yd(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of jpe)delete e.legend[t];if(e.mark){for(const t of jF)delete e.mark[t];e.mark.tooltip&&K(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(p9(e.params)),delete e.params);for(const t of age){for(const i of jF)delete e[t][i];const n=uge[t];if(n)for(const i of n)delete e[t][i];fge(e,t)}for(const t of Upe())delete e[t];cge(e);for(const t in e)K(e[t])&&He(e[t])&&delete e[t];return He(e)?void 0:e}function cge(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=VL(e.title);He(t)||(e.style["group-title"]={...e.style["group-title"],...t}),He(n)||(e.style["group-subtitle"]={...e.style["group-subtitle"],...n}),He(i)?delete e.title:e.title=i}function fge(e,t,n,i){const r=e[t];t==="view"&&(n="cell");const s={...r,...e.style[n??t]};He(s)||(e.style[n??t]=s),delete e[t]}function ay(e){return q(e,"layer")}function hge(e){return q(e,"repeat")}function dge(e){return!L(e.repeat)&&q(e.repeat,"layer")}class xA{map(t,n){return Z1(t)?this.mapFacet(t,n):hge(t)?this.mapRepeat(t,n):yA(t)?this.mapHConcat(t,n):sy(t)?this.mapVConcat(t,n):mA(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(ay(t))return this.mapLayer(t,n);if(ca(t))return this.mapUnit(t,n);throw new Error(Nk(t))}mapLayer(t,n){return{...t,layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))}}mapHConcat(t,n){return{...t,hconcat:t.hconcat.map(i=>this.map(i,n))}}mapVConcat(t,n){return{...t,vconcat:t.vconcat.map(i=>this.map(i,n))}}mapConcat(t,n){const{concat:i,...r}=t;return{...r,concat:i.map(s=>this.map(s,n))}}mapFacet(t,n){return{...t,spec:this.map(t.spec,n)}}mapRepeat(t,n){return{...t,spec:this.map(t.spec,n)}}}const pge={zero:1,center:1,normalize:1};function gge(e){return Z(pge,e)}const mge=new Set([E8,X1,Y1,X0,Q1,Kk,Qk,K1,S8,Xk]),yge=new Set([X1,Y1,E8]);function al(e){return W(e)&&oc(e)==="quantitative"&&!e.bin}function eM(e,t,{orient:n,type:i}){const r=t==="x"?"y":"radius",s=t==="x"&&["bar","area"].includes(i),a=e[t],o=e[r];if(W(a)&&W(o))if(al(a)&&al(o)){if(a.stack)return t;if(o.stack)return r;const u=W(a)&&!!a.aggregate,l=W(o)&&!!o.aggregate;if(u!==l)return u?t:r;if(s){if(n==="vertical")return r;if(n==="horizontal")return t}}else{if(al(a))return t;if(al(o))return r}else{if(al(a))return s&&n==="vertical"?void 0:t;if(al(o))return s&&n==="horizontal"?void 0:r}}function xge(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function v9(e,t){const n=ts(e)?e:{type:e},i=n.type;if(!mge.has(i))return null;const r=eM(t,"x",n)||eM(t,"theta",n);if(!r)return null;const s=t[r],a=W(s)?X(s,{}):void 0,o=xge(r),u=[],l=new Set;if(t[o]){const g=t[o],m=W(g)?X(g,{}):void 0;m&&m!==a&&(u.push(o),l.add(m))}const c=o==="x"?"xOffset":"yOffset",f=t[c],h=W(f)?X(f,{}):void 0;h&&h!==a&&(u.push(c),l.add(h));const d=kfe.reduce((g,m)=>{if(m!=="tooltip"&&nu(t,m)){const y=t[m];for(const x of Q(y)){const v=dr(x);if(v.aggregate)continue;const b=X(v,{});(!b||!l.has(b))&&g.push({channel:m,fieldDef:v})}}return g},[]);let p;return s.stack!==void 0?ao(s.stack)?p=s.stack?"zero":null:p=s.stack:yge.has(i)&&(p="zero"),!p||!gge(p)||Q8(t)&&d.length===0?null:(s?.scale?.type&&s?.scale?.type!==Gt.LINEAR&&s?.stack&&V(Vhe(s.scale.type)),ge(t[ps(r)])?(s.stack!==void 0&&V(qhe(r)),null):(W(s)&&s.aggregate&&!Lfe.has(s.aggregate)&&V(Whe(s.aggregate)),{groupbyChannels:u,groupbyFields:l,fieldChannel:r,impute:s.impute===null?!1:wo(i),stackBy:d,offset:p}))}function b9(e,t,n){const i=Ht(e),r=We("orient",i,n);if(i.orient=_ge(i.type,t,r),r!==void 0&&r!==i.orient&&V(Che(i.orient,r)),i.type==="bar"&&i.orient){const u=We("cornerRadiusEnd",i,n);if(u!==void 0){const l=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Gde[i.orient];for(const c of l)i[c]=u;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}const s=We("opacity",i,n),a=We("fillOpacity",i,n);return s===void 0&&a===void 0&&(i.opacity=bge(i.type,t)),We("cursor",i,n)===void 0&&(i.cursor=vge(i,t,n)),i}function vge(e,t,n){return t.href||e.href||We("href",e,n)?"pointer":e.cursor}function bge(e,t){if(ke([Q1,Xk,Kk,Qk],e)&&!Q8(t))return .7}function wge(e,t,{graticule:n}){if(n)return!1;const i=es("filled",e,t),r=e.type;return yt(i,r!==Q1&&r!==K1&&r!==X0)}function _ge(e,t,n){switch(e){case Q1:case Kk:case Qk:case S8:case Pde:case Ide:return}const{x:i,y:r,x2:s,y2:a}=t;switch(e){case X1:if(W(i)&&(Wt(i.bin)||W(r)&&r.aggregate&&!i.aggregate))return"vertical";if(W(r)&&(Wt(r.bin)||W(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(a||s){if(n)return n;if(!s)return(W(i)&&i.type===_u&&!Je(i.bin)||Q0(i))&&W(r)&&Wt(r.bin)?"horizontal":"vertical";if(!a)return(W(r)&&r.type===_u&&!Je(r.bin)||Q0(r))&&W(i)&&Wt(i.bin)?"vertical":"horizontal"}case X0:if(s&&!(W(i)&&Wt(i.bin))&&a&&!(W(r)&&Wt(r.bin)))return;case Y1:if(a)return W(r)&&Wt(r.bin)?"horizontal":"vertical";if(s)return W(i)&&Wt(i.bin)?"vertical":"horizontal";if(e===X0){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case K1:case Xk:{const o=HF(i),u=HF(r);if(n)return n;if(o&&!u)return e!=="tick"?"horizontal":"vertical";if(!o&&u)return e!=="tick"?"vertical":"horizontal";if(o&&u)return"vertical";{const l=Nn(i)&&i.type===sc,c=Nn(r)&&r.type===sc;if(l&&!c)return"vertical";if(!l&&c)return"horizontal"}return}}return"vertical"}function Ege(e){const{point:t,line:n,...i}=e;return j(i).length>1?i:i.type}function Sge(e){for(const t of["line","area","rule","trail"])e[t]&&(e={...e,[t]:Vn(e[t],["point","line"])});return e}function sv(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?K(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?K(t.point)?t.point:{}:void 0}function tM(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class kge{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(ca(t)){const{mark:i,encoding:r}=t,s=ts(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!sv(s,n[s.type],r);case"area":return!!sv(s,n[s.type],r)||!!tM(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:a,mark:o,name:u,encoding:l,...c}=t,f=ry(l,r),h=ts(o)?o:{type:o},d=sv(h,r[h.type],f),p=h.type==="area"&&tM(h,r[h.type]),g=[{name:u,...s?{params:s}:{},mark:Ege({...h.type==="area"&&h.opacity===void 0&&h.fillOpacity===void 0?{opacity:.7}:{},...h}),encoding:Vn(f,["shape"])}],m=v9(b9(h,f,r),f);let y=f;if(m){const{fieldChannel:x,offset:v}=m;y={...f,[x]:{...f[x],...v?{stack:v}:{}}}}return y=Vn(y,["y2","x2"]),p&&g.push({...a?{projection:a}:{},mark:{type:"line",...tc(h,["clip","interpolate","tension","tooltip"]),...p},encoding:y}),d&&g.push({...a?{projection:a}:{},mark:{type:"point",opacity:1,filled:!0,...tc(h,["clip","tooltip"]),...d},encoding:y}),i({...c,layer:g},{...n,config:Sge(r)})}}function Age(e,t){return t?Vd(e)?_9(e,t):w9(e,t):e}function av(e,t){return t?_9(e,t):e}function H2(e,t,n){const i=t[e];if(upe(i)){if(i.repeat in n)return{...t,[e]:n[i.repeat]};V(rhe(i.repeat));return}return t}function w9(e,t){if(e=H2("field",e,t),e!==void 0){if(e===null)return null;if(rA(e)&&qs(e.sort)){const n=H2("field",e.sort,t);e={...e,...n?{sort:n}:{}}}return e}}function nM(e,t){if(W(e))return w9(e,t);{const n=H2("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function iM(e,t){if(ge(e)){const n=nM(e,t);if(n)return n;if(Wd(e))return{condition:e.condition}}else{if(Hd(e)){const n=nM(e.condition,t);if(n)return{...e,condition:n};{const{condition:i,...r}=e;return r}}return e}}function _9(e,t){const n={};for(const i in e)if(q(e,i)){const r=e[i];if(L(r))n[i]=r.map(s=>iM(s,t)).filter(s=>s);else{const s=iM(r,t);s!==void 0&&(n[i]=s)}}return n}class Cge{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(ca(t)){const{encoding:n,mark:i}=t;if(i==="line"||ts(i)&&i.type==="line")for(const r of _fe){const s=zu(r),a=n[s];if(n[r]&&(W(a)&&!Wt(a.bin)||ms(a)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return V(Ahe(!!r.x2,!!r.y2)),i({...t,mark:K(s)?{...s,type:"rule"}:"rule"},n)}}class $ge extends xA{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[Fpe,Npe,Bpe,new kge,new Cge]}map(t,n){if(ca(t)){const i=nu(t.encoding,Us),r=nu(t.encoding,js),s=nu(t.encoding,P1);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=av(t.encoding,n.repeater),a={...t,...t.name?{name:[n.repeaterPrefix,t.name].filter(u=>u).join("_")}:{},...s?{encoding:s}:{}};if(i||r)return this.mapUnitWithParentEncodingOrProjection(a,n);const o=this.mapLayerOrUnit.bind(this);for(const u of this.nonFacetUnitNormalizers)if(u.hasMatchingType(a,n.config))return u.run(a,n,o);return a}mapRepeat(t,n){return dge(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r,...s}=t,{row:a,column:o,layer:u}=i,{repeater:l={},repeaterPrefix:c=""}=n;return a||o?this.mapRepeat({...t,repeat:{...a?{row:a}:{},...o?{column:o}:{}},spec:{repeat:{layer:u},spec:r}},n):{...s,layer:u.map(f=>{const h={...l,layer:f},d=`${(r.name?`${r.name}_`:"")+c}child__layer_${it(f)}`,p=this.mapLayerOrUnit(r,{...n,repeater:h,repeaterPrefix:d});return p.name=d,p})}}mapNonLayerRepeat(t,n){const{repeat:i,spec:r,data:s,...a}=t;!L(i)&&t.columns&&(t=Vn(t,["columns"]),V(IF("repeat")));const o=[],{repeater:u={},repeaterPrefix:l=""}=n,c=!L(i)&&i.row||[u?u.row:null],f=!L(i)&&i.column||[u?u.column:null],h=L(i)&&i||[u?u.repeat:null];for(const p of h)for(const g of c)for(const m of f){const y={repeat:p,row:g,column:m,layer:u.layer},x=(r.name?`${r.name}_`:"")+l+"child__"+(L(i)?`${it(p)}`:(i.row?`row_${it(g)}`:"")+(i.column?`column_${it(m)}`:"")),v=this.map(r,{...n,repeater:y,repeaterPrefix:x});v.name=x,o.push(Vn(v,["data"]))}const d=L(i)?t.columns:i.column?i.column.length:1;return{data:r.data??s,align:"all",...a,columns:d,concat:o}}mapFacet(t,n){const{facet:i}=t;return Vd(i)&&t.columns&&(t=Vn(t,["columns"]),V(IF("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:a,config:o}=n,u=sM({parentProjection:a,projection:r}),l=rM({parentEncoding:s,encoding:av(i,n.repeater)});return this.mapUnit({...t,...u?{projection:u}:{},...l?{encoding:l}:{}},{config:o})}mapFacetedUnit(t,n){const{row:i,column:r,facet:s,...a}=t.encoding,{mark:o,width:u,projection:l,height:c,view:f,params:h,encoding:d,...p}=t,{facetMapping:g,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:s},n),y=av(a,n.repeater);return this.mapFacet({...p,...m,facet:g,spec:{...u?{width:u}:{},...c?{height:c}:{},...f?{view:f}:{},...l?{projection:l}:{},mark:o,encoding:y,...h?{params:h}:{}}},n)}getFacetMappingAndLayout(t,n){const{row:i,column:r,facet:s}=t;if(i||r){s&&V(She([...i?[Us]:[],...r?[js]:[]]));const a={},o={};for(const u of[Us,js]){const l=t[u];if(l){const{align:c,center:f,spacing:h,columns:d,...p}=l;a[u]=p;for(const g of["align","center","spacing"])l[g]!==void 0&&(o[g]??(o[g]={}),o[g][u]=l[g])}}return{facetMapping:a,layout:o}}else{const{align:a,center:o,spacing:u,columns:l,...c}=s;return{facetMapping:Age(c,n.repeater),layout:{...a?{align:a}:{},...o?{center:o}:{},...u?{spacing:u}:{},...l?{columns:l}:{}}}}}mapLayer(t,{parentEncoding:n,parentProjection:i,...r}){const{encoding:s,projection:a,...o}=t,u={...r,parentEncoding:rM({parentEncoding:n,encoding:s,layer:!0}),parentProjection:sM({parentProjection:i,projection:a})};return super.mapLayer({...o,...t.name?{name:[u.repeaterPrefix,t.name].filter(l=>l).join("_")}:{}},u)}}function rM({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...j(e),...j(t)]);for(const s of r){const a=t[s],o=e[s];if(ge(a)){const u={...o,...a};i[s]=u}else Hd(a)?i[s]={...a,condition:{...o,...a.condition}}:a||a===null?i[s]=a:(n||hr(o)||re(o)||ge(o)||L(o))&&(i[s]=o)}}else i=t;return!i||He(i)?void 0:i}function sM(e){const{parentProjection:t,projection:n}=e;return t&&n&&V(dhe({parentProjection:t,projection:n})),n??t}function vA(e){return q(e,"filter")}function Tge(e){return q(e,"stop")}function E9(e){return q(e,"lookup")}function Fge(e){return q(e,"data")}function Mge(e){return q(e,"param")}function Oge(e){return q(e,"pivot")}function Nge(e){return q(e,"density")}function Rge(e){return q(e,"quantile")}function Dge(e){return q(e,"regression")}function Ige(e){return q(e,"loess")}function Pge(e){return q(e,"sample")}function Lge(e){return q(e,"window")}function zge(e){return q(e,"joinaggregate")}function Bge(e){return q(e,"flatten")}function Uge(e){return q(e,"calculate")}function S9(e){return q(e,"bin")}function jge(e){return q(e,"impute")}function qge(e){return q(e,"timeUnit")}function Vge(e){return q(e,"aggregate")}function Wge(e){return q(e,"stack")}function Hge(e){return q(e,"fold")}function Gge(e){return q(e,"extent")&&!q(e,"density")&&!q(e,"regression")}function Yge(e){return e.map(t=>vA(t)?{filter:Tl(t.filter,vde)}:t)}class Xge extends xA{map(t,n){return n.emptySelections??(n.emptySelections={}),n.selectionPredicates??(n.selectionPredicates={}),t=aM(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=aM(t,n),t.encoding){const i={};for(const[r,s]of Ja(t.encoding))i[r]=k9(s,n);t={...t,encoding:i}}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const{selection:i,...r}=t;return i?{...r,params:Ja(i).map(([s,a])=>{const{init:o,bind:u,empty:l,...c}=a;c.type==="single"?(c.type="point",c.toggle=!1):c.type==="multi"&&(c.type="point"),n.emptySelections[s]=l!=="none";for(const f of Jt(n.selectionPredicates[s]??{}))f.empty=l!=="none";return{name:s,value:o,select:c,bind:u}})}:t}}function aM(e,t){const{transform:n,...i}=e;if(n){const r=n.map(s=>{if(vA(s))return{filter:G2(s,t)};if(S9(s)&&Bu(s.bin))return{...s,bin:A9(s.bin)};if(E9(s)){const{selection:a,...o}=s.from;return a?{...s,from:{param:a,...o}}:s}return s});return{...i,transform:r}}return e}function k9(e,t){const n=de(e);if(W(n)&&Bu(n.bin)&&(n.bin=A9(n.bin)),Vu(n)&&n.scale?.domain?.selection){const{selection:i,...r}=n.scale.domain;n.scale.domain={...r,...i?{param:i}:{}}}if(Wd(n))if(L(n.condition))n.condition=n.condition.map(i=>{const{selection:r,param:s,test:a,...o}=i;return s?i:{...o,test:G2(i,t)}});else{const{selection:i,param:r,test:s,...a}=k9(n.condition,t);n.condition=r?n.condition:{...a,test:G2(n.condition,t)}}return n}function A9(e){const t=e.extent;if(t?.selection){const{selection:n,...i}=t;return{...e,extent:{...i,param:n}}}return e}function G2(e,t){const n=i=>Tl(i,r=>{var s;const a=t.emptySelections[r]??!0,o={param:r,empty:a};return(s=t.selectionPredicates)[r]??(s[r]=[]),t.selectionPredicates[r].push(o),o});return e.selection?n(e.selection):Tl(e.test||e.filter,i=>i.selection?n(i.selection):i)}class Y2 extends xA{map(t,n){const i=n.selections??[];if(t.params&&!ca(t)){const r=[];for(const s of t.params)gA(s)?i.push(s):r.push(s);t.params=r}return n.selections=i,super.map(t,n)}mapUnit(t,n){const i=n.selections;if(!i||!i.length)return t;const r=(n.path??[]).concat(t.name),s=[];for(const a of i)if(!a.views||!a.views.length)s.push(a);else for(const o of a.views)(J(o)&&(o===t.name||r.includes(o))||L(o)&&o.map(u=>r.indexOf(u)).every((u,l,c)=>u!==-1&&(l===0||u>c[l-1])))&&s.push(a);return s.length&&(t.params=s),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=Y2.prototype[e];Y2.prototype[e]=function(n,i){return t.call(this,n,Kge(n,i))}}function Kge(e,t){return e.name?{...t,path:(t.path??[]).concat(e.name)}:t}function C9(e,t){t===void 0&&(t=x9(e.config));const n=e0e(e,t),{width:i,height:r}=e,s=t0e(n,{width:i,height:r,autosize:e.autosize},t);return{...n,...s?{autosize:s}:{}}}const Qge=new $ge,Jge=new Xge,Zge=new Y2;function e0e(e,t={}){const n={config:t};return Zge.map(Qge.map(Jge.map(e,n),n),n)}function oM(e){return J(e)?{type:e}:e??{}}function t0e(e,t,n){let{width:i,height:r}=t;const s=ca(e)||ay(e),a={};s?i=="container"&&r=="container"?(a.type="fit",a.contains="padding"):i=="container"?(a.type="fit-x",a.contains="padding"):r=="container"&&(a.type="fit-y",a.contains="padding"):(i=="container"&&(V(OF("width")),i=void 0),r=="container"&&(V(OF("height")),r=void 0));const o={type:"pad",...a,...n?oM(n.autosize):{},...oM(e.autosize)};if(o.type==="fit"&&!s&&(V(Gfe),o.type="pad"),i=="container"&&!(o.type=="fit"||o.type=="fit-x")&&V(NF("width")),r=="container"&&!(o.type=="fit"||o.type=="fit-y")&&V(NF("height")),!ai(o,{type:"pad"}))return o}function n0e(e){return["fit","fit-x","fit-y"].includes(e)}function i0e(e){return e?`fit-${j1(e)}`:"fit"}const r0e=["background","padding"];function uM(e,t){const n={};for(const i of r0e)e&&e[i]!==void 0&&(n[i]=ii(e[i]));return t&&(n.params=e.params),n}class fa{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new fa(de(this.explicit),de(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(t){return yt(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of j(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function Dr(e){return{explicit:!0,value:e}}function ei(e){return{explicit:!1,value:e}}function $9(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:oy(t,n,i,r)}}function oy(e,t,n,i){return e.explicit&&t.explicit&&V(Ihe(n,i,e.value,t.value)),e}function to(e,t,n,i,r=oy){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:ai(e.value,t.value)?e:r(e,t,n,i)}class s0e extends fa{constructor(t={},n={},i=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function cc(e){return q(e,"url")}function Gh(e){return q(e,"values")}function T9(e){return q(e,"name")&&!cc(e)&&!Gh(e)&&!Ba(e)}function Ba(e){return e&&(F9(e)||M9(e)||bA(e))}function F9(e){return q(e,"sequence")}function M9(e){return q(e,"sphere")}function bA(e){return q(e,"graticule")}var ot;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup",e[e.PreFilterInvalid=5]="PreFilterInvalid",e[e.PostFilterInvalid=6]="PostFilterInvalid"})(ot||(ot={}));function O9({invalid:e,isPath:t}){switch(C8(e,{isPath:t})){case"filter":return{marks:"exclude-invalid-values",scales:"exclude-invalid-values"};case"break-paths-show-domains":return{marks:t?"include-invalid-values":"exclude-invalid-values",scales:"include-invalid-values"};case"break-paths-filter-domains":return{marks:t?"include-invalid-values":"exclude-invalid-values",scales:"exclude-invalid-values"};case"show":return{marks:"include-invalid-values",scales:"include-invalid-values"}}}function a0e(e){const{marks:t,scales:n}=O9(e);return t===n?ot.Main:n==="include-invalid-values"?ot.PreFilterInvalid:ot.PostFilterInvalid}class Ve{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){V(che);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this);const i=t.parent.removeChild(t);this._parent=n,n.addChild(this,i),t.parent=this}}class Wn extends Ve{clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}constructor(t,n,i,r){super(t,n),this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${$L()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}function ov(e){return e.as!==void 0}function lM(e){return`${e}_end`}class Wr extends Ve{clone(){return new Wr(null,de(this.timeUnits))}constructor(t,n){super(t),this.timeUnits=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,a)=>{const{field:o,timeUnit:u}=s;if(u){let l;if(qu(u)){if(at(n)){const{mark:c,markDef:f,config:h}=n,d=eo({fieldDef:s,markDef:f,config:h});(Hh(c)||d)&&(l={timeUnit:zt(u),field:o})}}else l={as:X(s,{forAs:!0}),field:o,timeUnit:u};if(at(n)){const{mark:c,markDef:f,config:h}=n,d=eo({fieldDef:s,markDef:f,config:h});Hh(c)&&xt(a)&&d!==.5&&(l.rectBandPosition=d)}l&&(r[Ae(l)]=l)}return r},{});return He(i)?null:new Wr(t,i)}static makeFromTransform(t,n){const{timeUnit:i,...r}={...n},s=zt(i),a={...r,timeUnit:s};return new Wr(t,{[Ae(a)]:a})}merge(t){this.timeUnits={...this.timeUnits};for(const n in t.timeUnits)this.timeUnits[n]||(this.timeUnits[n]=t.timeUnits[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Ja(this.timeUnits)){const s=ov(r)?r.as:`${r.field}_end`;t.has(s)||(n[i]=r)}this.timeUnits=n}producedFields(){return new Set(Jt(this.timeUnits).map(t=>ov(t)?t.as:lM(t.field)))}dependentFields(){return new Set(Jt(this.timeUnits).map(t=>t.field))}hash(){return`TimeUnit ${Ae(this.timeUnits)}`}assemble(){const t=[];for(const n of Jt(this.timeUnits)){const{rectBandPosition:i}=n,r=zt(n.timeUnit);if(ov(n)){const{field:s,as:a}=n,{unit:o,utc:u,...l}=r,c=[a,`${a}_end`];t.push({field:Ii(s),type:"timeunit",...o?{units:H1(o)}:{},...u?{timezone:"utc"}:{},...l,as:c}),t.push(...cM(c,i,r))}else if(n){const{field:s}=n,a=s.replaceAll("\\.","."),o=N9({timeUnit:r,field:a}),u=lM(a);t.push({type:"formula",expr:o,as:u}),t.push(...cM([a,u],i,r))}}return t}}const uy="offsetted_rect_start",ly="offsetted_rect_end";function N9({timeUnit:e,field:t,reverse:n}){const{unit:i,utc:r}=e,s=l8(i),{part:a,step:o}=d8(s,e.step);return`${r?"utcOffset":"timeOffset"}('${a}', ${je(t)}, ${n?-o:o})`}function cM([e,t],n,i){if(n!==void 0&&n!==.5){const r=je(e),s=je(t);return[{type:"formula",expr:fM([N9({timeUnit:i,field:e,reverse:!0}),r],n+.5),as:`${e}_${uy}`},{type:"formula",expr:fM([r,s],n+.5),as:`${e}_${ly}`}]}return[]}function fM([e,t],n){return`${1-n} * ${e} + ${n} * ${t}`}const Xd="_tuple_fields";class o0e{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const u0e={defined:()=>!0,parse:(e,t,n)=>{const i=t.name,r=t.project??(t.project=new o0e),s={},a={},o=new Set,u=(p,g)=>{const m=g==="visual"?p.channel:p.field;let y=it(`${i}_${m}`);for(let x=1;o.has(y);x++)y=it(`${i}_${m}_${x}`);return o.add(y),{[g]:y}},l=t.type,c=e.config.selection[l],f=n.value!==void 0?Q(n.value):null;let{fields:h,encodings:d}=K(n.select)?n.select:{};if(!h&&!d&&f){for(const p of f)if(K(p))for(const g of j(p))wfe(g)?(d||(d=[])).push(g):l==="interval"?(V(ihe),d=c.encodings):(h??(h=[])).push(g)}!h&&!d&&(d=c.encodings,"fields"in c&&(h=c.fields));for(const p of d??[]){const g=e.fieldDef(p);if(g){let m=g.field;if(g.aggregate){V(Yfe(p,g.aggregate));continue}else if(!m){V(DF(p));continue}if(g.timeUnit&&!qu(g.timeUnit)){m=e.vgField(p);const y={timeUnit:g.timeUnit,as:m,field:g.field};a[Ae(y)]=y}if(!s[m]){const y=l==="interval"&&gs(p)&&fr(e.getScaleComponent(p).get("type"))?"R":g.bin?"R-RE":"E",x={field:m,channel:p,type:y,index:r.items.length};x.signals={...u(x,"data"),...u(x,"visual")},r.items.push(s[m]=x),r.hasField[m]=s[m],r.hasSelectionId=r.hasSelectionId||m===pr,RL(p)?(x.geoChannel=p,x.channel=NL(p),r.hasChannel[x.channel]=s[m]):r.hasChannel[p]=s[m]}}else V(DF(p))}for(const p of h??[]){if(r.hasField[p])continue;const g={type:"E",field:p,index:r.items.length};g.signals={...u(g,"data")},r.items.push(g),r.hasField[p]=g,r.hasSelectionId=r.hasSelectionId||p===pr}f&&(t.init=f.map(p=>r.items.map(g=>K(p)?p[g.geoChannel||g.channel]!==void 0?p[g.geoChannel||g.channel]:p[g.field]:p))),He(a)||(r.timeUnit=new Wr(null,a))},signals:(e,t,n)=>{const i=t.name+Xd;return n.filter(s=>s.name===i).length>0||t.project.hasSelectionId?n:n.concat({name:i,value:t.project.items.map(P9)})}},R9="_curr",Ag="anim_value",dl="anim_clock",X2="eased_anim_clock",D9="min_extent",I9="max_range_extent",uv="last_tick_at",lv="is_playing",l0e=1/60*1e3,c0e=(e,t)=>[{name:X2,update:dl},{name:`${e}_domain`,init:`domain('${t}')`},{name:D9,init:`extent(${e}_domain)[0]`},{name:I9,init:`extent(range('${t}'))[1]`},{name:Ag,update:`invert('${t}', ${X2})`}],f0e={defined:e=>e.type==="point",topLevelSignals:(e,t,n)=>(Hr(t)&&(n=n.concat([{name:dl,init:"0",on:[{events:{type:"timer",throttle:l0e},update:`${lv} ? (${dl} + (now() - ${uv}) > ${I9} ? 0 : ${dl} + (now() - ${uv})) : ${dl}`}]},{name:uv,init:"now()",on:[{events:[{signal:dl},{signal:lv}],update:"now()"}]},{name:lv,init:"true"}])),n),signals:(e,t,n)=>{const i=t.name,r=i+Xd,s=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=Jt(e.component.selection??{}).reduce((c,f)=>f.type==="interval"?c.concat(f.name+Ol):c,[]).map(c=>`indexof(item().mark.name, '${c}') < 0`).join(" && "),u=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${o?` && ${o}`:""}`;let l=`unit: ${iu(e)}, `;if(t.project.hasSelectionId)l+=`${pr}: ${a}[${G(pr)}]`;else if(Hr(t))l+=`fields: ${r}, values: [${Ag} ? ${Ag} : ${D9}]`;else{const c=s.items.map(f=>e.fieldDef(f.channel)?.bin?`[${a}[${G(e.vgField(f.channel,{}))}], ${a}[${G(e.vgField(f.channel,{binSuffix:"end"}))}]]`:`${a}[${G(f.field)}]`).join(", ");l+=`fields: ${r}, values: [${c}]`}if(Hr(t))return n.concat(c0e(t.name,e.scaleName(go)),[{name:i+Qs,on:[{events:[{signal:X2},{signal:Ag}],update:`{${l}}`,force:!0}]}]);{const c=t.events;return n.concat([{name:i+Qs,on:c?[{events:c,update:`${u} ? {${l}} : null`,force:!0}]:[]}])}}};function P9(e){const{signals:t,hasLegend:n,index:i,...r}=e;return r.field=Ii(r.field),r}function ku(e,t=!0,n=yn){if(L(e)){const i=e.map(r=>ku(r,t,n));return t?`[${i.join(", ")}]`:i}else if(ju(e))return n(t?wu(e):ode(e));return t?n(Ge(e)):e}function h0e(e,t){for(const n of Jt(e.component.selection??{})){const i=n.name;let r=`${i}${Qs}, ${n.resolve==="global"?"true":`{unit: ${iu(e)}}`}`;for(const s of fy)s.defined(n)&&(s.signals&&(t=s.signals(e,n,t)),s.modifyExpr&&(r=s.modifyExpr(e,n,r)));t.push({name:i+z0e,on:[{events:{signal:n.name+Qs},update:`modify(${G(n.name+Au)}, ${r})`}]})}return wA(t)}function d0e(e,t){if(e.component.selection&&j(e.component.selection).length){const n=G(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:ho("pointermove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return wA(t)}function p0e(e,t){let n=!1;for(const i of Jt(e.component.selection??{})){const r=i.name,s=G(r+Au);if(t.filter(o=>o.name===r).length===0){const o=i.resolve==="global"?"union":i.resolve,u=i.type==="point"?", true, true)":")";t.push({name:i.name,update:`${e7}(${s}, ${G(o)}${u}`})}n=!0;for(const o of fy)o.defined(i)&&o.topLevelSignals&&(t=o.topLevelSignals(e,i,t))}return n&&t.filter(r=>r.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"pointermove",update:"isTuple(group()) ? group() : unit"}]}),wA(t)}function g0e(e,t){const n=[],i=[],r=iu(e,{escape:!1});for(const s of Jt(e.component.selection??{})){const a={name:s.name+Au};if(s.project.hasSelectionId&&(a.transform=[{type:"collect",sort:{field:pr}}]),s.init){const u=s.project.items.map(P9);a.values=s.project.hasSelectionId?s.init.map(l=>({unit:r,[pr]:ku(l,!1)[0]})):s.init.map(l=>({unit:r,fields:u,values:ku(l,!1)}))}if([...n,...t].filter(u=>u.name===s.name+Au).length||n.push(a),Hr(s)&&t.length){const u=e.lookupDataSource(e.getDataName(ot.Main)),l=t.find(f=>f.name===u),c=l.transform.find(f=>f.type==="filter"&&f.expr.includes("vlSelectionTest"));if(c){l.transform=l.transform.filter(h=>h!==c);const f={name:l.name+R9,source:l.name,transform:[c]};i.push(f)}}}return n.concat(t,i)}function L9(e,t){for(const n of Jt(e.component.selection??{}))for(const i of fy)i.defined(n)&&i.marks&&(t=i.marks(e,n,t));return t}function m0e(e,t){for(const n of e.children)at(n)&&(t=L9(n,t));return t}function y0e(e,t,n,i){const r=s7(e,t.param,t);return{signal:fr(n.get("type"))&&L(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function wA(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const Vs={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!gs(r))continue;const s=e.getScaleComponent(r),a=s?s.get("type"):void 0;if(a=="sequential"&&V(Jfe),!s||!fr(a)){V(Qfe);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(a=>n.filter(o=>o.name===a.signals.data).length===0);if(!e.parent||Q2(e)||i.length===0)return n;const r=n.find(a=>a.name===t.name);let s=r.update;if(s.includes(e7))r.update=`{${i.map(a=>`${G(Ii(a.field))}: ${a.signals.data}`).join(", ")}}`;else{for(const a of i){const o=`${G(Ii(a.field))}: ${a.signals.data}`;s.includes(o)||(s=`${s.substring(0,s.length-1)}, ${o}}`)}r.update=s}return n.concat(i.map(a=>({name:a.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!Q2(e))for(const i of t.scales){const r=n.find(s=>s.name===i.signals.data);r.push="outer",delete r.value,delete r.update}return n}};function K2(e,t){return`domain(${G(e.scaleName(t))})`}function Q2(e){return e.parent&&qc(e.parent)&&(!e.parent.parent||Q2(e.parent.parent))}const Ol="_brush",z9="_scale_trigger",kf="geo_interval_init_tick",B9="_init",x0e="_center",v0e={defined:e=>e.type==="interval",parse:(e,t,n)=>{var i;if(e.hasProjection){const r={...K(n.select)?n.select:{}};r.fields=[pr],r.encodings||(r.encodings=n.value?j(n.value):[_r,wr]),n.select={type:"interval",...r}}if(t.translate&&!Vs.defined(t)){const r=`!event.item || event.item.mark.name !== ${G(t.name+Ol)}`;for(const s of t.events){if(!s.between){V(`${s} is not an ordered event stream for interval selections.`);continue}const a=Q((i=s.between[0]).filter??(i.filter=[]));a.includes(r)||a.push(r)}}},signals:(e,t,n)=>{const i=t.name,r=i+Qs,s=Jt(t.project.hasChannel).filter(o=>o.channel===rt||o.channel===jt),a=t.init?t.init[0]:null;if(n.push(...s.reduce((o,u)=>o.concat(b0e(e,t,u,a&&a[u.index])),[])),e.hasProjection){const o=G(e.projectionName()),u=e.projectionName()+x0e,{x:l,y:c}=t.project.hasChannel,f=l&&l.signals.visual,h=c&&c.signals.visual,d=l?a&&a[l.index]:`${u}[0]`,p=c?a&&a[c.index]:`${u}[1]`,g=w=>e.getSizeSignalRef(w).signal,m=`[[${f?f+"[0]":"0"}, ${h?h+"[0]":"0"}],[${f?f+"[1]":g("width")}, ${h?h+"[1]":g("height")}]]`;a&&(n.unshift({name:i+B9,init:`[scale(${o}, [${l?d[0]:d}, ${c?p[0]:p}]), scale(${o}, [${l?d[1]:d}, ${c?p[1]:p}])]`}),(!l||!c)&&(n.find(E=>E.name===u)||n.unshift({name:u,update:`invert(${o}, [${g("width")}/2, ${g("height")}/2])`})));const y=`intersect(${m}, {markname: ${G(e.getName("marks"))}}, unit.mark)`,x=`{unit: ${iu(e)}}`,v=`vlSelectionTuples(${y}, ${x})`,b=s.map(w=>w.signals.visual);return n.concat({name:r,on:[{events:[...b.length?[{signal:b.join(" || ")}]:[],...a?[{signal:kf}]:[]],update:v}]})}else{if(!Vs.defined(t)){const l=i+z9,c=s.map(f=>{const h=f.channel,{data:d,visual:p}=f.signals,g=G(e.scaleName(h)),m=e.getScaleComponent(h).get("type"),y=fr(m)?"+":"";return`(!isArray(${d}) || (${y}invert(${g}, ${p})[0] === ${y}${d}[0] && ${y}invert(${g}, ${p})[1] === ${y}${d}[1]))`});c.length&&n.push({name:l,value:{},on:[{events:s.map(f=>({scale:e.scaleName(f.channel)})),update:c.join(" && ")+` ? ${l} : {}`}]})}const o=s.map(l=>l.signals.data),u=`unit: ${iu(e)}, fields: ${i+Xd}, values`;return n.concat({name:r,...a?{init:`{${u}: ${ku(a)}}`}:{},...o.length?{on:[{events:[{signal:o.join(" || ")}],update:`${o.join(" && ")} ? {${u}: [${o}]} : null`}]}:{}})}},topLevelSignals:(e,t,n)=>(at(e)&&e.hasProjection&&t.init&&(n.filter(r=>r.name===kf).length||n.unshift({name:kf,value:null,on:[{events:"timer{1}",update:`${kf} === null ? {} : ${kf}`}]})),n),marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,a=r?.signals.visual,o=s?.signals.visual,u=`data(${G(t.name+Au)})`;if(Vs.defined(t)||!r&&!s)return n;const l={x:r!==void 0?{signal:`${a}[0]`}:{value:0},y:s!==void 0?{signal:`${o}[0]`}:{value:0},x2:r!==void 0?{signal:`${a}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${o}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of j(l))l[m]=[{test:`${u}.length && ${u}[0].unit === ${iu(e)}`,...l[m]},{value:0}];const{fill:c,fillOpacity:f,cursor:h,...d}=t.mark,p=j(d).reduce((m,y)=>(m[y]=[{test:[r!==void 0&&`${a}[0] !== ${a}[1]`,s!==void 0&&`${o}[0] !== ${o}[1]`].filter(x=>x).join(" && "),value:d[y]},{value:null}],m),{}),g=h??(t.translate?"move":null);return[{name:`${i+Ol}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:c},fillOpacity:{value:f}},update:l}},...n,{name:i+Ol,type:"rect",clip:!0,encode:{enter:{...g?{cursor:{value:g}}:{},fill:{value:"transparent"}},update:{...l,...p}}}]}};function b0e(e,t,n,i){const r=!e.hasProjection,s=n.channel,a=n.signals.visual,o=G(r?e.scaleName(s):e.projectionName()),u=h=>`scale(${o}, ${h})`,l=e.getSizeSignalRef(s===rt?"width":"height").signal,c=`${s}(unit)`,f=t.events.reduce((h,d)=>[...h,{events:d.between[0],update:`[${c}, ${c}]`},{events:d,update:`[${a}[0], clamp(${c}, 0, ${l})]`}],[]);if(r){const h=n.signals.data,d=Vs.defined(t),p=e.getScaleComponent(s),g=p?p.get("type"):void 0,m=i?{init:ku(i,!0,u)}:{value:[]};return f.push({events:{signal:t.name+z9},update:fr(g)?`[${u(`${h}[0]`)}, ${u(`${h}[1]`)}]`:"[0, 0]"}),d?[{name:h,on:[]}]:[{name:a,...m,on:f},{name:h,...i?{init:ku(i)}:{},on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${o}, ${a})`}]}]}else{const h=s===rt?0:1,d=t.name+B9,p=i?{init:`[${d}[0][${h}], ${d}[1][${h}]]`}:{value:[]};return[{name:a,...p,on:f}]}}function zc({model:e,channelDef:t,vgChannel:n,invalidValueRef:i,mainRefFn:r}){const s=Wd(t)&&t.condition;let a=[];s&&(a=Q(s).map(l=>{const c=r(l);if(ope(l)){const{param:f,empty:h}=l;return{test:r7(e,{param:f,empty:h}),...c}}else return{test:sm(e,l.test),...c}})),i!==void 0&&a.push(i);const o=r(t);return o!==void 0&&a.push(o),a.length>1||a.length===1&&a[0].test?{[n]:a}:a.length===1?{[n]:a[0]}:{}}function _A(e,t="text"){const n=e.encoding[t];return zc({model:e,channelDef:n,vgChannel:t,mainRefFn:i=>cy(i,e.config),invalidValueRef:void 0})}function cy(e,t,n="datum"){if(e){if(hr(e))return et(e.value);if(ge(e)){const{format:i,formatType:r}=Z0(e);return nA({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function U9(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,a=n.tooltip;if(L(a))return{tooltip:hM({tooltip:a},s,r,t)};{const o=t.reactiveGeom?"datum.datum":"datum";return zc({model:e,channelDef:a,vgChannel:"tooltip",mainRefFn:l=>{const c=cy(l,r,o);if(c)return c;if(l===null)return;let f=We("tooltip",i,r);if(f===!0&&(f={content:"encoding"}),J(f))return{value:f};if(K(f))return re(f)?f:f.content==="encoding"?hM(n,s,r,t):{signal:o}},invalidValueRef:void 0})}}function j9(e,t,n,{reactiveGeom:i}={}){const r={...n,...n.tooltipFormat},s=new Set,a=i?"datum.datum":"datum",o=[];function u(c,f){const h=zu(f),d=Nn(c)?c:{...c,type:e[h].type},p=d.title||aA(d,r),g=Q(p).join(", ").replaceAll(/"/g,'\\"');let m;if(xt(f)){const y=f==="x"?"x2":"y2",x=dr(e[y]);if(Wt(d.bin)&&x){const v=X(d,{expr:a}),b=X(x,{expr:a}),{format:w,formatType:E}=Z0(d);m=qd(v,b,w,E,r),s.add(y)}}if((xt(f)||f===Bi||f===br)&&t&&t.fieldChannel===f&&t.offset==="normalize"){const{format:y,formatType:x}=Z0(d);m=nA({fieldOrDatumDef:d,format:y,formatType:x,expr:a,config:r,normalizeStack:!0}).signal}m??(m=cy(d,r,a).signal),o.push({channel:f,key:g,value:m})}uA(e,(c,f)=>{W(c)?u(c,f):ey(c)&&u(c.condition,f)});const l={};for(const{channel:c,key:f,value:h}of o)!s.has(c)&&!l[f]&&(l[f]=h);return l}function hM(e,t,n,{reactiveGeom:i}={}){const r=j9(e,t,n,{reactiveGeom:i}),s=Ja(r).map(([a,o])=>`"${a}": ${o}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function w0e(e){const{markDef:t,config:n}=e,i=We("aria",t,n);return i===!1?{}:{...i?{aria:i}:{},..._0e(e),...E0e(e)}}function _0e(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=We("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:Z(Vfe,t)?{}:{ariaRoleDescription:{value:t}}}function E0e(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return zc({model:e,channelDef:s,vgChannel:"description",mainRefFn:u=>cy(u,e.config),invalidValueRef:void 0});const a=We("description",n,i);if(a!=null)return{description:et(a)};if(i.aria===!1)return{};const o=j9(t,r,i);if(!He(o))return{description:{signal:Ja(o).map(([u,l],c)=>`"${c>0?"; ":""}${u}: " + (${l})`).join(" + ")}}}function Yt(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:a}=n;let{defaultRef:o,defaultValue:u}=n;const l=r[e];o===void 0&&(u??(u=We(e,i,s,{vgChannel:a,ignoreVgConfig:!Wd(l)})),u!==void 0&&(o=et(u)));const c={markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e)},f=T8({...c,scaleChannel:e,channelDef:l});return zc({model:t,channelDef:l,vgChannel:a??e,invalidValueRef:f,mainRefFn:d=>tA({...c,channel:e,channelDef:d,stack:null,defaultRef:o})})}function q9(e,t={filled:void 0}){const{markDef:n,encoding:i,config:r}=e,{type:s}=n,a=t.filled??We("filled",n,r),o=ke(["bar","point","circle","square","geoshape"],s)?"transparent":void 0,u=We(a===!0?"color":void 0,n,r,{vgChannel:"fill"})??r.mark[a===!0&&"color"]??o,l=We(a===!1?"color":void 0,n,r,{vgChannel:"stroke"})??r.mark[a===!1&&"color"],c=a?"fill":"stroke",f={...u?{fill:et(u)}:{},...l?{stroke:et(l)}:{}};return n.color&&(a?n.fill:n.stroke)&&V(e8("property",{fill:"fill"in n,stroke:"stroke"in n})),{...f,...Yt("color",e,{vgChannel:c,defaultValue:a?u:l}),...Yt("fill",e,{defaultValue:i.fill?u:void 0}),...Yt("stroke",e,{defaultValue:i.stroke?l:void 0})}}function S0e(e){const{encoding:t,mark:n}=e,i=t.order;return!wo(n)&&hr(i)?zc({model:e,channelDef:i,vgChannel:"zindex",mainRefFn:r=>et(r.value),invalidValueRef:void 0}):{}}function fc({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const s=`${e}Offset`,a=t[s],o=n[s];if((s==="xOffset"||s==="yOffset")&&o)return{offsetType:"encoding",offset:tA({channel:s,channelDef:o,markDef:t,config:i?.config,scaleName:i.scaleName(s),scale:i.getScaleComponent(s),stack:null,defaultRef:et(a),bandPosition:r})};const u=t[s];return u?{offsetType:"visual",offset:u}:{}}function $n(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:a,stack:o}=t,u=r[e],l=r[ps(e)],c=t.scaleName(e),f=t.getScaleComponent(e),{offset:h,offsetType:d}=fc({channel:e,markDef:s,encoding:r,model:t,bandPosition:.5}),p=EA({model:t,defaultPos:n,channel:e,scaleName:c,scale:f}),g=!u&&xt(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:k0e({channel:e,channelDef:u,channel2Def:l,markDef:s,config:a,scaleName:c,scale:f,stack:o,offset:h,defaultRef:p,bandPosition:d==="encoding"?0:void 0});return g?{[i||e]:g}:void 0}function k0e(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:a}=e;if(ge(n)&&r&&t===r.fieldChannel){if(W(n)){let o=n.bandPosition;if(o===void 0&&a.type==="text"&&(t==="radius"||t==="theta")&&(o=.5),o!==void 0)return K0({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:o,offset:s})}return tu(n,i,{suffix:"end"},{offset:s})}return eA(e)}function EA({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:a}=e;return()=>{const o=zu(n),u=Za(n),l=We(n,s,a,{vgChannel:u});if(l!==void 0)return gh(n,l);switch(t){case"zeroOrMin":return dM({scaleName:i,scale:r,mode:"zeroOrMin",mainChannel:o,config:a});case"zeroOrMax":return dM({scaleName:i,scale:r,mode:{zeroOrMax:{widthSignal:e.width.signal,heightSignal:e.height.signal}},mainChannel:o,config:a});case"mid":return{...e[Qn(n)],mult:.5}}}}function dM({mainChannel:e,config:t,...n}){const i=$8(n),{mode:r}=n;if(i)return i;switch(e){case"radius":{if(r==="zeroOrMin")return{value:0};const{widthSignal:s,heightSignal:a}=r.zeroOrMax;return{signal:`min(${s},${a})/2`}}case"theta":return r==="zeroOrMin"?{value:0}:{signal:"2*PI"};case"x":return r==="zeroOrMin"?{value:0}:{field:{group:"width"}};case"y":return r==="zeroOrMin"?{field:{group:"height"}}:{value:0}}}const A0e={left:"x",center:"xc",right:"x2"},C0e={top:"y",middle:"yc",bottom:"y2"};function V9(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Za(e);const r=e==="x"?"align":"baseline",s=We(r,t,n);let a;return re(s)?(V(khe(r)),a=void 0):a=s,e==="x"?A0e[a||(i==="top"?"left":"center")]:C0e[a||i]}function im(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?W9(e,t,{defaultPos:n,defaultPos2:i}):$n(e,t,{defaultPos:n})}function W9(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,a=ps(e),o=Qn(e),u=$0e(t,i,a),l=u[o]?V9(e,r,s):Za(e);return{...$n(e,t,{defaultPos:n,vgChannel:l}),...u}}function $0e(e,t,n){const{encoding:i,mark:r,markDef:s,stack:a,config:o}=e,u=zu(n),l=Qn(n),c=Za(n),f=i[u],h=e.scaleName(u),d=e.getScaleComponent(u),{offset:p}=n in i||n in s?fc({channel:n,markDef:s,encoding:i,model:e}):fc({channel:u,markDef:s,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=Qn(n),y=e.markDef[m];return y!=null?{[m]:{value:y}}:{[c]:{field:e.getName(n)}}}const g=T0e({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:o,scaleName:h,scale:d,stack:a,offset:p,defaultRef:void 0});return g!==void 0?{[c]:g}:Bp(n,s)||Bp(n,{[n]:L2(n,s,o.style),[l]:L2(l,s,o.style)})||Bp(n,o[r])||Bp(n,o.mark)||{[c]:EA({model:e,defaultPos:t,channel:n,scaleName:h,scale:d})()}}function T0e({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:a,stack:o,offset:u,defaultRef:l}){return ge(t)&&o&&e.charAt(0)===o.fieldChannel.charAt(0)?tu(t,s,{suffix:"start"},{offset:u}):eA({channel:e,channelDef:n,scaleName:s,scale:a,stack:o,markDef:i,config:r,offset:u,defaultRef:l})}function Bp(e,t){const n=Qn(e),i=Za(e);if(t[i]!==void 0)return{[i]:gh(e,t[i])};if(t[e]!==void 0)return{[i]:gh(e,t[e])};if(t[n]){const r=t[n];if(Eu(r))V(vhe(n));else return{[n]:gh(e,r)}}}function Ks(e,t){const{config:n,encoding:i,markDef:r}=e,s=r.type,a=ps(t),o=Qn(t),u=i[t],l=i[a],c=e.getScaleComponent(t),f=c?c.get("type"):void 0,h=r.orient,d=i[o]??i.size??We("size",r,n,{vgChannel:o}),p=LL(t),g=s==="bar"&&(t==="x"?h==="vertical":h==="horizontal")||s==="tick"&&(t==="y"?h==="vertical":h==="horizontal");return W(u)&&(Je(u.bin)||Wt(u.bin)||u.timeUnit&&!l)&&!(d&&!Eu(d))&&!i[p]&&!Bt(f)?O0e({fieldDef:u,fieldDef2:l,channel:t,model:e}):(ge(u)&&Bt(f)||g)&&!l?M0e(u,t,e):W9(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function F0e(e,t,n,i,r,s,a){if(Eu(r))if(n){const u=n.get("type");if(u==="band"){let l=`bandwidth('${t}')`;r.band!==1&&(l=`${r.band} * ${l}`);const c=es("minBandSize",{type:a},i);return{signal:c?`max(${nr(c)}, ${l})`:l}}else r.band!==1&&(V(The(u)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(re(r))return r;if(r)return{value:r}}if(n){const u=n.get("range");if(Uu(u)&&Ie(u.step))return{value:u.step-2}}if(!s){const{bandPaddingInner:u,barBandPaddingInner:l,rectBandPaddingInner:c,tickBandPaddingInner:f}=i.scale,h=yt(u,a==="tick"?f:a==="bar"?l:c);if(re(h))return{signal:`(1 - (${h.signal})) * ${e}`};if(Ie(h))return{signal:`${1-h} * ${e}`}}return{value:W2(i.view,e)-2}}function M0e(e,t,n){const{markDef:i,encoding:r,config:s,stack:a}=n,o=i.orient,u=n.scaleName(t),l=n.getScaleComponent(t),c=Qn(t),f=ps(t),h=LL(t),d=n.scaleName(h),p=n.getScaleComponent(Ck(t)),g=i.type==="tick"||o==="horizontal"&&t==="y"||o==="vertical"&&t==="x";let m;(r.size||i.size)&&(g?m=Yt("size",n,{vgChannel:c,defaultRef:et(i.size)}):V(Nhe(i.type)));const y=!!m,x=I8({channel:t,fieldDef:e,markDef:i,config:s,scaleType:(l||p)?.get("type"),useVlSizeChannel:g});m=m||{[c]:F0e(c,d||u,p||l,s,x,!!e,i.type)};const v=(l||p)?.get("type")==="band"&&Eu(x)&&!y?"top":"middle",b=V9(t,i,s,v),w=b==="xc"||b==="yc",{offset:E,offsetType:_}=fc({channel:t,markDef:i,encoding:r,model:n,bandPosition:w?.5:0}),k=eA({channel:t,channelDef:e,markDef:i,config:s,scaleName:u,scale:l,stack:a,offset:E,defaultRef:EA({model:n,defaultPos:"mid",channel:t,scaleName:u,scale:l}),bandPosition:w?_==="encoding"?0:.5:re(x)?{signal:`(1-${x})/2`}:Eu(x)?(1-x.band)/2:0});if(c)return{[b]:k,...m};{const A=Za(f),T=m[c],$=E?{...T,offset:E}:T;return{[b]:k,[A]:L(k)?[k[0],{...k[1],offset:$}]:{...k,offset:$}}}}function pM(e,t,n,i,r,s,a){if(OL(e))return 0;const o=e==="x"||e==="y2",u=o?-t/2:t/2;if(re(n)||re(r)||re(i)||s){const l=nr(n),c=nr(r),f=nr(i),h=nr(s),p=s?`(${a} < ${h} ? ${o?"":"-"}0.5 * (${h} - (${a})) : ${u})`:u,g=f?`${f} + `:"",m=l?`(${l} ? -1 : 1) * `:"",y=c?`(${c} + ${p})`:p;return{signal:g+m+y}}else return r=r||0,i+(n?-r-u:+r+u)}function O0e({fieldDef:e,fieldDef2:t,channel:n,model:i}){const{config:r,markDef:s,encoding:a}=i,o=i.getScaleComponent(n),u=i.scaleName(n),l=o?o.get("type"):void 0,c=o.get("reverse"),f=I8({channel:n,fieldDef:e,markDef:s,config:r,scaleType:l}),d=i.component.axes[n]?.[0]?.get("translate")??.5,p=xt(n)?We("binSpacing",s,r)??0:0,g=ps(n),m=Za(n),y=Za(g),x=es("minBandSize",s,r),{offset:v}=fc({channel:n,markDef:s,encoding:a,model:i,bandPosition:0}),{offset:b}=fc({channel:g,markDef:s,encoding:a,model:i,bandPosition:0}),w=tpe({fieldDef:e,scaleName:u}),E=pM(n,p,c,d,v,x,w),_=pM(g,p,c,d,b??v,x,w),k=re(f)?{signal:`(1-${f.signal})/2`}:Eu(f)?(1-f.band)/2:.5,A=eo({fieldDef:e,fieldDef2:t,markDef:s,config:r});if(Je(e.bin)||e.timeUnit){const T=e.timeUnit&&A!==.5;return{[y]:gM({fieldDef:e,scaleName:u,bandPosition:k,offset:_,useRectOffsetField:T}),[m]:gM({fieldDef:e,scaleName:u,bandPosition:re(k)?{signal:`1-${k.signal}`}:1-k,offset:E,useRectOffsetField:T})}}else if(Wt(e.bin)){const T=tu(e,u,{},{offset:_});if(W(t))return{[y]:T,[m]:tu(t,u,{},{offset:E})};if(Bu(e.bin)&&e.bin.step)return{[y]:T,[m]:{signal:`scale("${u}", ${X(e,{expr:"datum"})} + ${e.bin.step})`,offset:E}}}V(i8(g))}function gM({fieldDef:e,scaleName:t,bandPosition:n,offset:i,useRectOffsetField:r}){return K0({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i,...r?{startSuffix:uy,endSuffix:ly}:{}})}const N0e=new Set(["aria","width","height"]);function Ui(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?q9(e):{};return{...R0e(e.markDef,t),...mM("fill",n),...mM("stroke",i),...Yt("opacity",e),...Yt("fillOpacity",e),...Yt("strokeOpacity",e),...Yt("strokeWidth",e),...Yt("strokeDash",e),...S0e(e),...U9(e),..._A(e,"href"),...w0e(e)}}function mM(e,t){return t?{[e]:t}:{}}function R0e(e,t){return qfe.reduce((n,i)=>(!N0e.has(i)&&q(e,i)&&t[i]!=="ignore"&&(n[i]=et(e[i])),n),{})}function SA(e){const{config:t,markDef:n}=e,i=new Set;if(e.forEachFieldDef((r,s)=>{let a;if(!gs(s)||!(a=e.getScaleType(s)))return;const o=q1(r.aggregate),u=Zk({scaleChannel:s,markDef:n,config:t,scaleType:a,isCountAggregate:o});if(Jde(u)){const l=e.vgField(s,{expr:"datum",binSuffix:e.stack?.impute?"mid":void 0});l&&i.add(l)}}),i.size>0)return{defined:{signal:[...i].map(s=>G1(s,!0)).join(" && ")}}}function yM(e,t){if(t!==void 0)return{[e]:et(t)}}const cv="voronoi",H9={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(cv)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(wo(s))return V(Xfe(s)),n;const a={name:e.getName(cv),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...U9(e,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let o=0,u=!1;return n.forEach((l,c)=>{const f=l.name??"";f===e.component.mark[0].name?o=c:f.includes(cv)&&(u=!0)}),u||n.splice(o+1,0,a),n}},G9={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!pA(e.bind),parse:(e,t,n)=>t7(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,a=t.init&&t.init[0],o=H9.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((u,l)=>{const c=it(`${i}_${u.field}`);n.filter(h=>h.name===c).length||n.unshift({name:c,...a?{init:ku(a[l])}:{value:null},on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${o}[${G(u.field)}] : null`}]:[],bind:s[u.field]??s[u.channel]??s})}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(l=>l.name===i+Qs),a=i+Xd,o=r.items.map(l=>it(`${i}_${l.field}`)),u=o.map(l=>`${l} !== null`).join(" && ");return o.length&&(s.update=`${u} ? {fields: ${a}, values: [${o.join(", ")}]} : null`),delete s.value,delete s.on,n}},rm="_toggle",Y9={defined:e=>e.type==="point"&&!Hr(e)&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+rm,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Qs,i=t.name+rm;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${iu(e)}}, `)+`${i} ? ${n} : null`}},D0e={defined:e=>e.clear!==void 0&&e.clear!==!1&&!Hr(e),parse:(e,t)=>{t.clear&&(t.clear=J(t.clear)?ho(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(G9.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===it(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(a=>a.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const a=n.findIndex(o=>o.name===r.signals.data);i(a,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Qs);i(r,"null"),Y9.defined(t)&&(r=n.findIndex(s=>s.name===t.name+rm),i(r,"false"))}return n}},X9={defined:e=>{const t=e.resolve==="global"&&e.bind&&pA(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==pr;return t&&!n&&V(Zfe),t&&n},parse:(e,t,n)=>{const i=de(n);if(i.select=J(i.select)?{type:i.select,toggle:t.toggle}:{...i.select,toggle:t.toggle},t7(t,i),K(n.select)&&(n.select.on||n.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const o of t.events)o.filter=Q(o.filter??[]),o.filter.includes(a)||o.filter.push(a)}const r=rv(t.bind)?t.bind.legend:"click",s=J(r)?ho(r,"view"):Q(r);t.bind={legend:{merge:s}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=rv(t.bind)&&t.bind.legend,s=a=>o=>{const u=de(o);return u.markname=a,u};for(const a of t.project.items){if(!a.hasLegend)continue;const o=`${it(a.field)}_legend`,u=`${i}_${o}`;if(n.filter(c=>c.name===u).length===0){const c=r.merge.map(s(`${o}_symbols`)).concat(r.merge.map(s(`${o}_labels`))).concat(r.merge.map(s(`${o}_entries`)));n.unshift({name:u,...t.init?{}:{value:null},on:[{events:c,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]})}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(h=>h.name===i+Qs),a=i+Xd,o=r.items.filter(h=>h.hasLegend).map(h=>it(`${i}_${it(h.field)}_legend`)),l=`${o.map(h=>`${h} !== null`).join(" && ")} ? {fields: ${a}, values: [${o.join(", ")}]} : null`;t.events&&o.length>0?s.on.push({events:o.map(h=>({signal:h})),update:l}):o.length>0&&(s.update=l,delete s.value,delete s.on);const c=n.find(h=>h.name===i+rm),f=rv(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push({...c.on[0],events:f}):c.on[0].events=f),n}};function I0e(e,t,n){const i=e.fieldDef(t)?.field;for(const r of Jt(e.component.selection??{})){const s=r.project.hasField[i]??r.project.hasChannel[t];if(s&&X9.defined(r)){const a=n.get("selections")??[];a.push(r.name),n.set("selections",a,!1),s.hasLegend=!0}}}const K9="_translate_anchor",Q9="_translate_delta",P0e={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Vs.defined(t),s=i+K9,{x:a,y:o}=t.project.hasChannel;let u=ho(t.translate,"scope");return r||(u=u.map(l=>(l.between[0].markname=i+Ol,l))),n.push({name:s,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(a!==void 0?`, extent_x: ${r?K2(e,rt):`slice(${a.signals.visual})`}`:"")+(o!==void 0?`, extent_y: ${r?K2(e,jt):`slice(${o.signals.visual})`}`:"")+"}"}]},{name:i+Q9,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),a!==void 0&&xM(e,t,a,"width",n),o!==void 0&&xM(e,t,o,"height",n),n}};function xM(e,t,n,i,r){const s=t.name,a=s+K9,o=s+Q9,u=n.channel,l=Vs.defined(t),c=r.find(w=>w.name===n.signals[l?"data":"visual"]),f=e.getSizeSignalRef(i).signal,h=e.getScaleComponent(u),d=h&&h.get("type"),p=h&&h.get("reverse"),g=l?u===rt?p?"":"-":p?"-":"":"",m=`${a}.extent_${u}`,y=`${g}${o}.${u} / ${l?`${f}`:`span(${m})`}`,x=!l||!h?"panLinear":d==="log"?"panLog":d==="symlog"?"panSymlog":d==="pow"?"panPow":"panLinear",v=l?d==="pow"?`, ${h.get("exponent")??1}`:d==="symlog"?`, ${h.get("constant")??1}`:"":"",b=`${x}(${m}, ${y}${v})`;c.on.push({events:{signal:o},update:l?b:`clampRange(${b}, 0, ${f})`})}const J9="_zoom_anchor",Z9="_zoom_delta",L0e={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Vs.defined(t),s=i+Z9,{x:a,y:o}=t.project.hasChannel,u=G(e.scaleName(rt)),l=G(e.scaleName(jt));let c=ho(t.zoom,"scope");return r||(c=c.map(f=>(f.markname=i+Ol,f))),n.push({name:i+J9,on:[{events:c,update:r?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),a!==void 0&&vM(e,t,a,"width",n),o!==void 0&&vM(e,t,o,"height",n),n}};function vM(e,t,n,i,r){const s=t.name,a=n.channel,o=Vs.defined(t),u=r.find(x=>x.name===n.signals[o?"data":"visual"]),l=e.getSizeSignalRef(i).signal,c=e.getScaleComponent(a),f=c&&c.get("type"),h=o?K2(e,a):u.name,d=s+Z9,p=`${s}${J9}.${a}`,g=!o||!c?"zoomLinear":f==="log"?"zoomLog":f==="symlog"?"zoomSymlog":f==="pow"?"zoomPow":"zoomLinear",m=o?f==="pow"?`, ${c.get("exponent")??1}`:f==="symlog"?`, ${c.get("constant")??1}`:"":"",y=`${g}(${h}, ${p}, ${d}${m})`;u.on.push({events:{signal:d},update:o?y:`clampRange(${y}, 0, ${l})`})}const Au="_store",Qs="_tuple",z0e="_modify",e7="vlSelectionResolve",fy=[f0e,v0e,u0e,Y9,G9,Vs,X9,D0e,P0e,L0e,H9];function B0e(e){let t=e.parent;for(;t&&!ci(t);)t=t.parent;return t}function iu(e,{escape:t}={escape:!0}){let n=t?G(e.name):e.name;const i=B0e(e);if(i){const{facet:r}=i;for(const s of $i)r[s]&&(n+=` + '__facet_${s}_' + (facet[${G(i.vgField(s))}])`)}return n}function kA(e){return Jt(e.component.selection??{}).reduce((t,n)=>t||n.project.hasSelectionId,!1)}function t7(e,t){(J(t.select)||!t.select.on)&&delete e.events,(J(t.select)||!t.select.clear)&&delete e.clear,(J(t.select)||!t.select.toggle)&&delete e.toggle}function Hr(e){return e.events?.find(t=>"type"in t&&t.type==="timer")}function J2(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...J2(e.object)),t.push(...J2(e.property))),t)}function n7(e){return e.object.type==="MemberExpression"?n7(e.object):e.object.name==="datum"}function i7(e){const t=VS(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&n7(i)&&n.add(J2(i).slice(1).join("."))}),n}class Bc extends Ve{clone(){return new Bc(null,this.model,de(this.filter))}constructor(t,n,i){super(t),this.model=n,this.filter=i,this.expr=sm(this.model,this.filter,this),this._dependentFields=i7(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function U0e(e,t){const n={},i=e.config.selection;if(!t||!t.length)return n;let r=0;for(const s of t){const a=it(s.name),o=s.select,u=J(o)?o:o.type,l=K(o)?de(o):{type:u},c=i[u];for(const d in c)d==="fields"||d==="encodings"||(d==="mark"&&(l.mark={...c.mark,...l.mark}),(l[d]===void 0||l[d]===!0)&&(l[d]=de(c[d]??l[d])));const f=n[a]={...l,name:a,type:u,init:s.value,bind:s.bind,events:J(l.on)?ho(l.on,"scope"):Q(de(l.on))};if(Hr(f)&&(r++,r>1)){delete n[a];continue}const h=de(s);for(const d of fy)d.defined(f)&&d.parse&&d.parse(e,f,h)}return r>1&&V(she),n}function r7(e,t,n,i="datum"){const r=J(t)?t:t.param,s=it(r),a=G(s+Au);let o;try{o=e.getSelectionComponent(s,r)}catch{return`!!${s}`}if(o.project.timeUnit){const h=n??e.component.data.raw,d=o.project.timeUnit.clone();h.parent?d.insertAsParentOf(h):h.parent=d}const u=o.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",l=o.resolve==="global"?")":`, ${G(o.resolve)})`,c=`${u}${a}, ${i}${l}`,f=`length(data(${a}))`;return t.empty===!1?`${f} && ${c}`:`!${f} || ${c}`}function s7(e,t,n){const i=it(t),r=n.encoding;let s=n.field,a;try{a=e.getSelectionComponent(i,t)}catch{return i}if(!r&&!s)s=a.project.items[0].field,a.project.items.length>1&&V(ahe(s));else if(r&&!s){const o=a.project.items.filter(u=>u.channel===r);!o.length||o.length>1?(s=a.project.items[0].field,V(ohe(o,r,n,s))):s=o[0].field}return`${a.name}[${G(Ii(s))}]`}function j0e(e,t){for(const[n,i]of Ja(e.component.selection??{})){const r=e.getName(`lookup_${n}`);e.component.data.outputNodes[r]=i.materialized=new Wn(new Bc(t,e,{param:n}),r,ot.Lookup,e.component.data.outputNodeRefCounts)}}function sm(e,t,n){return ph(t,i=>J(i)?i:mde(i)?r7(e,i,n):g8(i))}function q0e(e,t){if(e)return L(e)&&!_a(e)?e.map(n=>aA(n,t)).join(", "):e}function fv(e,t,n,i){var r,s;e.encode??(e.encode={}),(r=e.encode)[t]??(r[t]={}),(s=e.encode[t]).update??(s.update={}),e.encode[t].update[n]=i}function Zf(e,t,n,i={header:!1}){const{disable:r,orient:s,scale:a,labelExpr:o,title:u,zindex:l,...c}=e.combine();if(!r){for(const f in c){const h=f,d=wpe[h],p=c[h];if(d&&d!==t&&d!=="both")delete c[h];else if(Yd(p)){const{condition:g,...m}=p,y=Q(g),x=GF[h];if(x){const{vgProp:v,part:b}=x,w=[...y.map(E=>{const{test:_,...k}=E;return{test:sm(null,_),...k}}),m];fv(c,b,v,w),delete c[h]}else if(x===null){const v={signal:y.map(b=>{const{test:w,...E}=b;return`${sm(null,w)} ? ${MF(E)} : `}).join("")+MF(m)};c[h]=v}}else if(re(p)){const g=GF[h];if(g){const{vgProp:m,part:y}=g;fv(c,y,m,p),delete c[h]}}ke(["labelAlign","labelBaseline"],h)&&c[h]===null&&delete c[h]}if(t==="grid"){if(!c.grid)return;if(c.encode){const{grid:f}=c.encode;c.encode={...f?{grid:f}:{}},He(c.encode)&&delete c.encode}return{scale:a,orient:s,...c,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:yt(l,0)}}else{if(!i.header&&e.mainExtracted)return;if(o!==void 0){let h=o;c.encode?.labels?.update&&re(c.encode.labels.update.text)&&(h=xu(o,"datum.label",c.encode.labels.update.text.signal)),fv(c,"labels","text",{signal:h})}if(c.labelAlign===null&&delete c.labelAlign,c.encode){for(const h of H8)e.hasAxisPart(h)||delete c.encode[h];He(c.encode)&&delete c.encode}const f=q0e(u,n);return{scale:a,orient:s,grid:!1,...f?{title:f}:{},...c,...n.aria===!1?{aria:!1}:{},zindex:yt(l,0)}}}}function a7(e){const{axes:t}=e.component,n=[];for(const i of la)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",a=e.getSizeSignalRef(s).signal;s!==a&&n.push({name:s,update:a})}}return n}function V0e(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>Zf(r,"grid",t)),...i.map(r=>Zf(r,"grid",t)),...n.map(r=>Zf(r,"main",t)),...i.map(r=>Zf(r,"main",t))].filter(r=>r)}function bM(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",a=t[n==="x"?"axisBottom":"axisLeft"]||{},o=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...j(a),...j(o)]),l={};for(const c of u.values())l[c]={signal:`${i.signal} === "${s}" ? ${nr(a[c])} : ${nr(o[c])}`};return l}return t[r]})])}function W0e(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:v8(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",a=re(n)?"axisOrient":`axis${Pd(n)}`,o=[...r,...r.map(l=>s+l.substr(4))],u=["axis",a,s];return{vlOnlyAxisConfig:bM(o,i,e,n),vgAxisConfig:bM(u,i,e,n),axisConfigStyle:H0e([...u,...o],i)}}function H0e(e,t){const n=[{}];for(const i of e){let r=t[i]?.style;if(r){r=Q(r);for(const s of r)n.push(t.style[s])}}return Object.assign.apply(null,n)}function Z2(e,t,n,i={}){const r=GL(e,n,t);if(r!==void 0)return{configFrom:"style",configValue:r};for(const s of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(i[s]?.[e]!==void 0)return{configFrom:s,configValue:i[s][e]};return{}}const wM={scale:({model:e,channel:t})=>e.scaleName(t),format:({format:e})=>e,formatType:({formatType:e})=>e,grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>t.grid??G0e(n,e),gridScale:({model:e,channel:t})=>Y0e(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||u7(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||o7(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>e.labelFlush??K0e(t.type,n),labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>e.labelOverlap??Q0e(t.type,n,W(t)&&!!t.timeUnit,W(t)?t.sort:void 0),orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{const s=e==="x"?"width":e==="y"?"height":void 0,a=s?t.getSizeSignalRef(s):void 0;return n.tickCount??Z0e({fieldOrDatumDef:i,scaleType:r,size:a,values:n.values})},tickMinStep:eme,title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=l7(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",a=t.fieldDef(s);return XL(r?[WF(r)]:[],W(a)?[WF(a)]:[])},values:({axis:e,fieldOrDatumDef:t})=>tme(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>e.zindex??nme(n,t)};function G0e(e,t){return!Bt(e)&&W(t)&&!Je(t?.bin)&&!Wt(t?.bin)}function Y0e(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function X0e(e,t,n,i,r){const s=t?.labelAngle;if(s!==void 0)return re(s)?s:Wh(s);{const{configValue:a}=Z2("labelAngle",i,t?.style,r);return a!==void 0?Wh(a):n===rt&&ke([Yk,Gk],e.type)&&!(W(e)&&e.timeUnit)?270:void 0}}function ew(e){return`(((${e.signal} % 360) + 360) % 360)`}function o7(e,t,n,i){if(e!==void 0)if(n==="x"){if(re(e)){const r=ew(e),s=re(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(re(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(re(e)){const r=ew(e),s=re(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(re(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function u7(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(re(e)){const a=ew(e),o=re(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?`(${a} + 90)`:a} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${a} && ${a} < ${180+r}) === ${o} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(re(t)){const a=r<e&&e<180+r?"===":"!==";return{signal:`${`${t.signal} ${a} "${s}"`} ? "left" : "right"`}}return(r<e&&e<180+r)==(t===s)?"left":"right"}function K0e(e,t){if(t==="x"&&ke(["quantitative","temporal"],e))return!0}function Q0e(e,t,n,i){if(n&&!K(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function J0e(e){return e==="x"?"bottom":"left"}function Z0e({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){if(!i&&!Bt(t)&&t!=="log"){if(W(e)){if(Je(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&ke(["month","hours","day","quarter"],zt(e.timeUnit)?.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function eme({format:e,fieldOrDatumDef:t}){if(e==="d")return 1;if(W(t)){const{timeUnit:n}=t;if(n){const i=h8(n);if(i)return{signal:i}}}}function l7(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,a=r?r.title:void 0;if(s&&a)return KL(s,a);if(s)return s;if(a)return a;if(s!==void 0)return s;if(a!==void 0)return a}function tme(e,t){const n=e.values;if(L(n))return W8(t,n);if(re(n))return n}function nme(e,t){return e==="rect"&&J0(t)?1:0}class hc extends Ve{clone(){return new hc(null,de(this.transform))}constructor(t,n){super(t),this.transform=n,this._dependentFields=i7(this.transform.calculate)}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(Vu(i)&&D8(i.sort)){const{field:s,timeUnit:a}=i,o=i.sort,u=o.map((l,c)=>`${g8({field:s,timeUnit:a,equal:l})} ? ${c} : `).join("")+o.length;t=new hc(t,{calculate:u,as:dc(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Ae(this.transform)}`}}function dc(e,t,n){return X(e,{prefix:t,suffix:"sort_index",...n})}function hy(e,t){return ke(["top","bottom"],t)?"column":ke(["left","right"],t)||e==="row"?"row":"column"}function pc(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return yt((t||{})[e],r[e],n.header[e])}function dy(e,t,n,i){const r={};for(const s of e){const a=pc(s,t||{},n,i);a!==void 0&&(r[s]=a)}return r}const AA=["row","column"],CA=["header","footer"];function ime(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:a,titleOrient:o}=dy(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),u=hy(t,o),l=Wh(a);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:{text:n,...t==="row"?{orient:"left"}:{},style:"guide-title",...f7(l,u),...c7(u,l,s),...h7(i,r,t,qpe,c9)}}}function c7(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=u7(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function f7(e,t){const n=o7(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function rme(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of CA)if(n[r])for(const s of n[r]){const a=ame(e,t,r,n,s);a!=null&&i.push(a)}return i}function sme(e,t){const{sort:n}=e;return qs(n)?{field:X(n,{expr:"datum"}),order:n.order??"ascending"}:L(n)?{field:dc(e,t,{expr:"datum"}),order:"ascending"}:{field:X(e,{expr:"datum"}),order:n??"ascending"}}function tw(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:a,labelOrient:o,labelExpr:u}=dy(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=nA({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,c=hy(t,o);return{text:{signal:u?xu(xu(u,"datum.label",l),"datum.value",X(e,{expr:"parent"})):l},...t==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...f7(s,c),...c7(c,s,a),...h7(n,e,t,Vpe,f9)}}function ame(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:a}=i,o=e.config?e.config:void 0;if(a&&r.labels){const{labelOrient:f}=dy(["labelOrient"],a.header,o,t);(t==="row"&&!ke(["top","bottom"],f)||t==="column"&&!ke(["left","right"],f))&&(s=tw(a,t,o))}const u=ci(e)&&!Vd(e.facet),l=r.axes,c=l?.length>0;if(s||c){const f=t==="row"?"height":"width";return{name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`,...i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:sme(a,t)}:{},...c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{},...s?{title:s}:{},...r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{},...c?{axes:l}:{}}}}return null}const ome={column:{start:0,end:1},row:{start:1,end:0}};function ume(e,t){return ome[t][e]}function lme(e,t){const n={};for(const i of $i){const r=e[i];if(r?.facetFieldDef){const{titleAnchor:s,titleOrient:a}=dy(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),o=hy(i,a),u=ume(s,o);u!==void 0&&(n[o]=u)}}return He(n)?void 0:n}function h7(e,t,n,i,r){const s={};for(const a of i){if(!r[a])continue;const o=pc(a,t?.header,e,n);o!==void 0&&(s[r[a]]=o)}return s}function $A(e){return[...Up(e,"width"),...Up(e,"height"),...Up(e,"childWidth"),...Up(e,"childHeight")]}function Up(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const a=s.get("type"),o=s.get("range");if(Bt(a)&&Uu(o)){const u=e.scaleName(n);return ci(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[_M(u,o)]:[_M(u,o),{name:r,update:d7(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),a=s?"containerSize()[0]":"containerSize()[1]",o=V2(e.config.view,s?"width":"height"),u=`isFinite(${a}) ? ${a} : ${o}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:r,value:i}]}function _M(e,t){const n=`${e}_step`;return re(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function d7(e,t,n){const i=t.get("type"),r=t.get("padding"),s=yt(t.get("paddingOuter"),r);let a=t.get("paddingInner");return a=i==="band"?a!==void 0?a:r:1,`bandspace(${n}, ${nr(a)}, ${nr(s)}) * ${e}_step`}function p7(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function g7(e,t){return j(e).reduce((n,i)=>({...n,...zc({model:t,channelDef:e[i],vgChannel:i,mainRefFn:r=>et(r.value),invalidValueRef:void 0})}),{})}function m7(e,t){if(ci(t))return e==="theta"?"independent":"shared";if(qc(t))return"shared";if(DA(t))return xt(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function TA(e,t){const n=e.scale[t],i=xt(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&V(Lhe(t)),"independent"):e[i][t]||"shared"}const cme={...Gpe,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},y7=j(cme);class fme extends fa{}const EM={symbols:hme,gradient:dme,labels:pme,entries:gme};function hme(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){if(s!=="symbol")return;const{markDef:a,encoding:o,config:u,mark:l}=n,c=a.filled&&l!=="trail";let f={...Hfe({},n,jde),...q9(n,{filled:c})};const h=r.get("symbolOpacity")??u.legend.symbolOpacity,d=r.get("symbolFillColor")??u.legend.symbolFillColor,p=r.get("symbolStrokeColor")??u.legend.symbolStrokeColor,g=h===void 0?x7(o.opacity)??a.opacity:void 0;if(f.fill){if(i==="fill"||c&&i===Xn)delete f.fill;else if(q(f.fill,"field"))d?delete f.fill:(f.fill=et(u.legend.symbolBaseFillColor??"black"),f.fillOpacity=et(g??1));else if(L(f.fill)){const m=nw(o.fill??o.color)??a.fill??(c&&a.color);m&&(f.fill=et(m))}}if(f.stroke){if(i==="stroke"||!c&&i===Xn)delete f.stroke;else if(q(f.stroke,"field")||p)delete f.stroke;else if(L(f.stroke)){const m=yt(nw(o.stroke||o.color),a.stroke,c?a.color:void 0);m&&(f.stroke={value:m})}}if(i!==ua){const m=W(t)&&b7(n,r,t);m?f.opacity=[{test:m,...et(g??1)},et(u.legend.unselectedOpacity)]:g&&(f.opacity=et(g))}return f={...f,...e},He(f)?void 0:f}function dme(e,{model:t,legendType:n,legendCmpt:i}){if(n!=="gradient")return;const{config:r,markDef:s,encoding:a}=t;let o={};const l=(i.get("gradientOpacity")??r.legend.gradientOpacity)===void 0?x7(a.opacity)||s.opacity:void 0;return l&&(o.opacity=et(l)),o={...o,...e},He(o)?void 0:o}function pme(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},a=n.config,o=W(t)?b7(n,r,t):void 0,u=o?[{test:o,value:1},{value:a.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=s;let f;Su(c)?f=ir({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:a}):l===void 0&&c===void 0&&a.customFormatTypes&&(t.type==="quantitative"&&a.numberFormatType?f=ir({fieldOrDatumDef:t,field:"datum.value",format:a.numberFormat,formatType:a.numberFormatType,config:a}):t.type==="temporal"&&a.timeFormatType&&W(t)&&t.timeUnit===void 0&&(f=ir({fieldOrDatumDef:t,field:"datum.value",format:a.timeFormat,formatType:a.timeFormatType,config:a})));const h={...u?{opacity:u}:{},...f?{text:f}:{},...e};return He(h)?void 0:h}function gme(e,{legendCmpt:t}){return t.get("selections")?.length?{...e,fill:{value:"transparent"}}:e}function x7(e){return v7(e,(t,n)=>Math.max(t,n.value))}function nw(e){return v7(e,(t,n)=>yt(t,n.value))}function v7(e,t){if(lpe(e))return Q(e.condition).reduce(t,e.value);if(hr(e))return e.value}function b7(e,t,n){const i=t.get("selections");if(!i?.length)return;const r=G(n.field);return i.map(s=>`(!length(data(${G(it(s)+Au)})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`).join(" || ")}const SM={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return O8(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return N8(i,t,n)},gradientLength:e=>{const{legend:t,legendConfig:n}=e;return t.gradientLength??n.gradientLength??_me(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>e.labelOverlap??t.labelOverlap??Eme(n),symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>e.symbolType??yme(t.type,n,i.shape,t.shape),title:({fieldOrDatumDef:e,config:t})=>Ml(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Fl(n)&&Ur(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>mme(t,e)};function mme(e,t){const n=e.values;if(L(n))return W8(t,n);if(re(n))return n}function yme(e,t,n,i){if(t!=="shape"){const r=nw(n)??i;if(r)return r}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function xme(e){const{legend:t}=e;return yt(t.type,vme(e))}function vme({channel:e,timeUnit:t,scaleType:n}){if(Fl(e)){if(ke(["quarter","month","day"],t))return"symbol";if(Ur(n))return"gradient"}return"symbol"}function bme({legendConfig:e,legendType:t,orient:n,legend:i}){return i.direction??e[t?"gradientDirection":"symbolDirection"]??wme(n,t)}function wme(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function _me({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:a,gradientVerticalMaxLength:o,gradientVerticalMinLength:u}=e;if(Ur(r))return n==="horizontal"?i==="top"||i==="bottom"?kM(t,"width",a,s):a:kM(t,"height",u,o)}function kM(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function Eme(e){if(ke(["quantile","threshold","log","symlog"],e))return"greedy"}function w7(e){const t=at(e)?Sme(e):$me(e);return e.component.legends=t,t}function Sme(e){const{encoding:t}=e,n={};for(const i of[Xn,...d9]){const r=Ct(t[i]);!r||!e.getScaleComponent(i)||i===Kn&&W(r)&&r.type===Lc||(n[i]=Cme(e,i))}return n}function kme(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function Ame(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!n?.values;case"title":if(t==="title"&&e===i?.title)return!0}return e===(n||{})[t]}function Cme(e,t){let n=e.legend(t);const{markDef:i,encoding:r,config:s}=e,a=s.legend,o=new fme({},kme(e,t));I0e(e,t,o);const u=n!==void 0?!n:a.disable;if(o.set("disable",u,n!==void 0),u)return o;n=n||{};const l=e.getScaleComponent(t).get("type"),c=Ct(r[t]),f=W(c)?zt(c.timeUnit)?.unit:void 0,h=n.orient||s.legend.orient||"right",d=xme({legend:n,channel:t,timeUnit:f,scaleType:l}),p=bme({legend:n,legendType:d,orient:h,legendConfig:a}),g={legend:n,channel:t,model:e,markDef:i,encoding:r,fieldOrDatumDef:c,legendConfig:a,config:s,scaleType:l,orient:h,legendType:d,direction:p};for(const b of y7){if(d==="gradient"&&b.startsWith("symbol")||d==="symbol"&&b.startsWith("gradient"))continue;const w=b in SM?SM[b](g):n[b];if(w!==void 0){const E=Ame(w,b,n,e.fieldDef(t));(E||s.legend[b]===void 0)&&o.set(b,w,E)}}const m=n?.encoding??{},y=o.get("selections"),x={},v={fieldOrDatumDef:c,model:e,channel:t,legendCmpt:o,legendType:d};for(const b of["labels","legend","title","symbols","gradient","entries"]){const w=g7(m[b]??{},e),E=b in EM?EM[b](w,v):w;E!==void 0&&!He(E)&&(x[b]={...y?.length&&W(c)?{name:`${it(c.field)}_legend_${b}`}:{},...y?.length?{interactive:!!y}:{},update:E})}return He(x)||o.set("encode",x,!!n?.encoding),o}function $me(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){w7(i);for(const r of j(i.component.legends))n.legend[r]=TA(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=_7(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of j(t))for(const r of e.children)r.component.legends[i]&&n.legend[i]==="shared"&&delete r.component.legends[i];return t}function _7(e,t){if(!e)return t.clone();const n=e.getWithExplicit("orient"),i=t.getWithExplicit("orient");if(n.explicit&&i.explicit&&n.value!==i.value)return;let r=!1;for(const s of y7){const a=to(e.getWithExplicit(s),t.getWithExplicit(s),s,"legend",(o,u)=>{switch(s){case"symbolType":return Tme(o,u);case"title":return QL(o,u);case"type":return r=!0,ei("symbol")}return oy(o,u,s,"legend")});e.setWithExplicit(s,a)}return r&&(e.implicit?.encode?.gradient&&G0(e.implicit,["encode","gradient"]),e.explicit?.encode?.gradient&&G0(e.explicit,["encode","gradient"])),e}function Tme(e,t){return t.value==="circle"?t:e}function Fme(e,t,n,i){var r,s;e.encode??(e.encode={}),(r=e.encode)[t]??(r[t]={}),(s=e.encode[t]).update??(s.update={}),e.encode[t].update[n]=i}function E7(e){const t=e.component.legends,n={};for(const r of j(t)){const s=e.getScaleComponent(r),a=Ge(s.get("domains"));if(n[a])for(const o of n[a])_7(o,t[r])||n[a].push(t[r]);else n[a]=[t[r].clone()]}return Jt(n).flat().map(r=>Mme(r,e.config)).filter(r=>r!==void 0)}function Mme(e,t){const{disable:n,labelExpr:i,selections:r,...s}=e.combine();if(!n){if(t.aria===!1&&s.aria==null&&(s.aria=!1),s.encode?.symbols){const a=s.encode.symbols.update;a.fill&&a.fill.value!=="transparent"&&!a.stroke&&!s.stroke&&(a.stroke={value:"transparent"});for(const o of d9)s[o]&&delete a[o]}if(s.title||delete s.title,i!==void 0){let a=i;s.encode?.labels?.update&&re(s.encode.labels.update.text)&&(a=xu(i,"datum.label",s.encode.labels.update.text.signal)),Fme(s,"labels","text",{signal:a})}return s}}function Ome(e){return qc(e)||DA(e)?Nme(e):S7(e)}function Nme(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),S7(e))}function S7(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(a=>a.signal).join(", ")}]`},s=t.data.reduce((a,o)=>{const u=re(o)?o.signal:`data('${e.lookupDataSource(o)}')`;return ke(a,u)||a.push(u),a},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]},...n}]}else return[{name:i,translate:{signal:"[width / 2, height / 2]"},...n}]}const Rme=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class k7 extends fa{constructor(t,n,i,r){super({...n},{name:t}),this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function A7(e){e.component.projection=at(e)?Dme(e):Lme(e)}function Dme(e){if(e.hasProjection){const t=Ht(e.specifiedProjection),n=!(t&&(t.scale!=null||t.translate!=null)),i=n?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,r=n?Ime(e):void 0,s=new k7(e.projectionName(!0),{...Ht(e.config.projection),...t},i,r);return s.get("type")||s.set("type","equalEarth",!1),s}}function Ime(e){const t=[],{encoding:n}=e;for(const i of[[_r,wr],[Pi,Er]])(Ct(n[i[0]])||Ct(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Kn)&&e.typedFieldDef(Kn).type===Lc&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(ot.Main)),t}function Pme(e,t){const n=bk(Rme,r=>!!(!Z(e.explicit,r)&&!Z(t.explicit,r)||Z(e.explicit,r)&&Z(t.explicit,r)&&ai(e.get(r),t.get(r))));if(ai(e.size,t.size)){if(n)return e;if(ai(e.explicit,{}))return t;if(ai(t.explicit,{}))return e}return null}function Lme(e){if(e.children.length===0)return;let t;for(const i of e.children)A7(i);const n=bk(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=Pme(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new k7(i,t.specifiedProjection,t.size,de(t.data));for(const s of e.children){const a=s.component.projection;a&&(a.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(a.get("name"),i),a.merged=!0)}return r}}function zme(e,t,n,i){if(Gd(t,n)){const r=at(e)?e.axis(n)??e.legend(n)??{}:{},s=X(t,{expr:"datum"}),a=X(t,{expr:"datum",binSuffix:"end"});return{formulaAs:X(t,{binSuffix:"range",forAs:!0}),formula:qd(s,a,r.format,r.formatType,i)}}return{}}function C7(e,t){return`${qL(e)}_${t}`}function Bme(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function FA(e,t,n){const i=ty(n,void 0)??{},r=C7(i,t);return e.getName(`${r}_bins`)}function Ume(e){return"as"in e}function AM(e,t,n){let i,r;Ume(e)?i=J(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[X(e,{forAs:!0}),X(e,{binSuffix:"end",forAs:!0})];const s={...ty(t,void 0)},a=C7(s,e.field),{signal:o,extentSignal:u}=Bme(n,a);if(V1(s.extent)){const c=s.extent;r=s7(n,c.param,c),delete s.extent}const l={bin:s,field:e.field,as:[i],...o?{signal:o}:{},...u?{extentSignal:u}:{},...r?{span:r}:{}};return{key:a,binComponent:l}}class Gr extends Ve{clone(){return new Gr(null,de(this.bins))}constructor(t,n){super(t),this.bins=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,a)=>{if(Nn(s)&&Je(s.bin)){const{key:o,binComponent:u}=AM(s,s.bin,n);r[o]={...u,...r[o],...zme(n,s,a,n.config)}}return r},{});return He(i)?null:new Gr(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=AM(n,n.bin,i);return new Gr(t,{[r]:s})}merge(t,n){for(const i of j(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=Br([...this.bins[i].as,...t.bins[i].as],Ae)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(Jt(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Jt(this.bins).map(t=>t.field))}hash(){return`Bin ${Ae(this.bins)}`}assemble(){return Jt(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,{extent:s,...a}=t.bin,o={type:"bin",field:Ii(t.field),as:i,signal:t.signal,...V1(s)?{extent:null}:{extent:s},...t.span?{span:{signal:`span(${t.span})`}}:{},...a};!s&&t.extentSignal&&(n.push({type:"extent",field:Ii(t.field),signal:t.extentSignal}),o.extent={signal:t.extentSignal}),n.push(o);for(const u of r)for(let l=0;l<2;l++)n.push({type:"formula",expr:X({field:i[l]},{expr:"datum"}),as:u[l]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function jme(e,t,n,i){const r=at(i)?i.encoding[ps(t)]:void 0;if(Nn(n)&&at(i)&&P8(n,r,i.markDef,i.config)){e.add(X(n,{})),e.add(X(n,{suffix:"end"}));const{mark:s,markDef:a,config:o}=i,u=eo({fieldDef:n,markDef:a,config:o});Hh(s)&&u!==.5&&xt(t)&&(e.add(X(n,{suffix:uy})),e.add(X(n,{suffix:ly}))),n.bin&&Gd(n,t)&&e.add(X(n,{binSuffix:"range"}))}else if(RL(t)){const s=NL(t);e.add(i.getName(s))}else e.add(X(n));return Vu(n)&&Tde(n.scale?.range)&&e.add(n.scale.range.field),e}function qme(e,t){for(const n of j(t)){const i=t[n];for(const r of j(i))n in e?e[n][r]=new Set([...e[n][r]??[],...i[r]]):e[n]={[r]:i[r]}}}class ar extends Ve{clone(){return new ar(null,new Set(this.dimensions),de(this.measures))}constructor(t,n,i){super(t),this.dimensions=n,this.measures=i}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(a=>{a.aggregate&&(i=!0)});const r={},s=new Set;return!i||(n.forEachFieldDef((a,o)=>{const{aggregate:u,field:l}=a;if(u)if(u==="count")r["*"]??(r["*"]={}),r["*"].count=new Set([X(a,{forAs:!0})]);else{if(Xs(u)||bo(u)){const c=Xs(u)?"argmin":"argmax",f=u[c];r[f]??(r[f]={}),r[f][c]=new Set([X({op:c,field:f},{forAs:!0})])}else r[l]??(r[l]={}),r[l][u]=new Set([X(a,{forAs:!0})]);gs(o)&&n.scaleDomain(o)==="unaggregated"&&(r[l]??(r[l]={}),r[l].min=new Set([X({field:l,aggregate:"min"},{forAs:!0})]),r[l].max=new Set([X({field:l,aggregate:"max"},{forAs:!0})]))}else jme(s,o,a,n)}),s.size+j(r).length===0)?null:new ar(t,s,r)}static makeFromTransform(t,n){var i;const r=new Set,s={};for(const a of n.aggregate){const{op:o,field:u,as:l}=a;o&&(o==="count"?(s["*"]??(s["*"]={}),s["*"].count=new Set([l||X(a,{forAs:!0})])):(s[u]??(s[u]={}),(i=s[u])[o]??(i[o]=new Set),s[u][o].add(l||X(a,{forAs:!0}))))}for(const a of n.groupby??[])r.add(a);return r.size+j(s).length===0?null:new ar(t,r,s)}merge(t){return kL(this.dimensions,t.dimensions)?(qme(this.measures,t.measures),!0):(ede("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...j(this.measures)])}producedFields(){const t=new Set;for(const n of j(this.measures))for(const i of j(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${Ae({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of j(this.measures))for(const a of j(this.measures[s]))for(const o of this.measures[s][a])i.push(o),t.push(a),n.push(s==="*"?null:Ii(s));return{type:"aggregate",groupby:[...this.dimensions].map(Ii),ops:t,fields:n,as:i}}}class Uc extends Ve{constructor(t,n,i,r){super(t),this.model=n,this.name=i,this.data=r;for(const s of $i){const a=n.facet[s];if(a){const{bin:o,sort:u}=a;this[s]={name:n.getName(`${s}_domain`),fields:[X(a),...Je(o)?[X(a,{binSuffix:"end"})]:[]],...qs(u)?{sortField:u}:L(u)?{sortIndexField:dc(a,s)}:{}}}}this.childModel=n.child}hash(){let t="Facet";for(const n of $i)this[n]&&(t+=` ${n.charAt(0)}:${Ae(this[n])}`);return t}get fields(){const t=[];for(const n of $i)this[n]?.fields&&t.push(...this[n].fields);return t}dependentFields(){const t=new Set(this.fields);for(const n of $i)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of la){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(Bt(r)&&Uu(s)){const a=py(this.childModel,n),o=RA(a);o?t[n]=o:V(Rk(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],a=[],o=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),a.push("max")):(s.push(i[r]),a.push("distinct")),o.push(`distinct_${i[r]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=J1,field:f}=u;s.push(f),a.push(c),o.push(X(u,{forAs:!0}))}else l&&(s.push(l),a.push("max"),o.push(l));return{name:this[t].name,source:n??this.data,transform:[{type:"aggregate",groupby:this[t].fields,...s.length?{fields:s,ops:a,as:o}:{}}]}}assembleFacetHeaderData(t){const{columns:n}=this.model.layout,{layoutHeaders:i}=this.model.component,r=[],s={};for(const u of AA){for(const l of CA){const c=(i[u]&&i[u][l])??[];for(const f of c)if(f.axes?.length>0){s[u]=!0;break}}if(s[u]){const l=`length(data("${this.facet.name}"))`,c=u==="row"?n?{signal:`ceil(${l} / ${n})`}:1:n?{signal:`min(${l}, ${n})`}:{signal:l};r.push({name:`${this.facet.name}_${u}`,transform:[{type:"sequence",start:0,stop:c}]})}}const{row:a,column:o}=s;return(a||o)&&r.unshift(this.assembleRowColumnHeaderData("facet",null,t)),r}assemble(){const t=[];let n=null;const i=this.getChildIndependentFieldsWithStep(),{column:r,row:s,facet:a}=this;if(r&&s&&(i.x||i.y)){n=`cross_${this.column.name}_${this.row.name}`;const o=[].concat(i.x??[],i.y??[]),u=o.map(()=>"distinct");t.push({name:n,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:o,ops:u}]})}for(const o of[js,Us])this[o]&&t.push(this.assembleRowColumnHeaderData(o,n,i));if(a){const o=this.assembleFacetHeaderData(i);o&&t.push(...o)}return t}}function CM(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function Vme(e,t){const n=Ek(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=CM(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=CM(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return V(lhe(t)),null}function Wme(e){const t={};return kg(e.filter,n=>{if(p8(n)){let i=null;Bk(n)?i=ii(n.equal):jk(n)?i=ii(n.lte):Uk(n)?i=ii(n.lt):qk(n)?i=ii(n.gt):Vk(n)?i=ii(n.gte):Wk(n)?i=n.range[0]:Hk(n)&&(i=(n.oneOf??n.in)[0]),i&&(ju(i)?t[n.field]="date":Ie(i)?t[n.field]="number":J(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function Hme(e){const t={};function n(i){lc(i)?t[i.field]="date":i.type==="quantitative"&&Pfe(i.aggregate)?t[i.field]="number":ic(i.field)>1?i.field in t||(t[i.field]="flatten"):Vu(i)&&qs(i.sort)&&ic(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((at(e)||ci(e))&&e.forEachFieldDef((i,r)=>{if(Nn(i))n(i);else{const s=zu(r),a=e.fieldDef(s);n({...i,type:a.type})}}),at(e)){const{mark:i,markDef:r,encoding:s}=e;if(wo(i)&&!e.encoding.order){const a=r.orient==="horizontal"?"y":"x",o=s[a];W(o)&&o.type==="quantitative"&&!(o.field in t)&&(t[o.field]="number")}}return t}function Gme(e){const t={};if(at(e)&&e.component.selection)for(const n of j(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&ic(r.field)>1&&(t[r.field]="flatten")}return t}class hn extends Ve{clone(){return new hn(null,de(this._parse))}constructor(t,n){super(t),this._parse=n}hash(){return`Parse ${Ae(this._parse)}`}static makeExplicit(t,n,i){let r={};const s=n.data;return!Ba(s)&&s?.format?.parse&&(r=s.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const o of j(i)){const u=r.getWithExplicit(o);u.value!==void 0&&(u.explicit||u.value===i[o]||u.value==="derived"||i[o]==="flatten"?delete i[o]:V(PF(o,i[o],u.value)))}for(const o of j(n)){const u=r.get(o);u!==void 0&&(u===n[o]?delete n[o]:V(PF(o,n[o],u)))}const s=new fa(n,i);r.copyAll(s);const a={};for(const o of j(s.combine())){const u=s.get(o);u!==null&&(a[o]=u)}return j(a).length===0||r.parseNothing?null:new hn(t,a)}get parse(){return this._parse}merge(t){this._parse={...this._parse,...t.parse},t.remove()}assembleFormatParse(){const t={};for(const n of j(this._parse)){const i=this._parse[n];ic(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(j(this._parse))}dependentFields(){return new Set(j(this._parse))}assembleTransforms(t=!1){return j(this._parse).filter(n=>t?ic(n)>1:!0).map(n=>{const i=Vme(n,this._parse[n]);return i?{type:"formula",expr:i,as:Ic(n)}:null}).filter(n=>n!==null)}}class no extends Ve{clone(){return new no(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([pr])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:pr}}}class Kd extends Ve{clone(){return new Kd(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Ae(this.params)}`}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class Qd extends Ve{clone(){return new Qd(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){return new Set([this.params.as??"data"])}hash(){return`Hash ${Ae(this.params)}`}assemble(){return{type:"sequence",...this.params}}}class Cu extends Ve{constructor(t){super(null),t??(t={name:"source"});let n;if(Ba(t)||(n=t.format?{...Vn(t.format,["parse"])}:{}),Gh(t))this._data={values:t.values};else if(cc(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];ke(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else M9(t)?this._data={values:[{type:"Sphere"}]}:(T9(t)||Ba(t))&&(this._data={});this._generator=Ba(t),t.name&&(this._name=t.name),n&&!He(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var $M=function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},Yme=function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},eh;function MA(e){return e instanceof Cu||e instanceof Kd||e instanceof Qd}class OA{constructor(){eh.set(this,void 0),$M(this,eh,!1,"f")}setModified(){$M(this,eh,!0,"f")}get modifiedFlag(){return Yme(this,eh,"f")}}eh=new WeakMap;class Wu extends OA{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class NA extends OA{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class Xme extends NA{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of j(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class Kme extends NA{constructor(t){super(),this.requiresSelectionId=t&&kA(t)}run(t){t instanceof no&&(this.requiresSelectionId&&(MA(t.parent)||t.parent instanceof ar||t.parent instanceof hn)||(this.setModified(),t.remove()))}}class Qme extends OA{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof Wr&&(i=t.producedFields(),wk(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class Jme extends NA{constructor(){super()}run(t){t instanceof Wn&&!t.isRequired()&&(this.setModified(),t.remove())}}class Zme extends Wu{run(t){if(!MA(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof hn)if(t instanceof hn)this.setModified(),t.merge(n);else{if(_k(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class e1e extends Wu{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof hn);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const a of i){const o=a.parse;for(const u of j(o))u in r?r[u]!==o[u]&&s.add(u):r[u]=o[u]}for(const a of s)delete r[a];if(!He(r)){this.setModified();const a=new hn(t,r);for(const o of n){if(o instanceof hn)for(const u of j(r))delete o.parse[u];t.removeChild(o),o.parent=a,o instanceof hn&&j(o.parse).length===0&&o.remove()}}}}}class t1e extends Wu{run(t){t instanceof Wn||t.numChildren()>0||t instanceof Uc||t instanceof Cu||(this.setModified(),t.remove())}}class n1e extends Wu{run(t){const n=t.children.filter(r=>r instanceof Wr),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class i1e extends Wu{run(t){const n=t.children.filter(r=>r instanceof ar),i={};for(const r of n){const s=Ae(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of j(i)){const s=i[r];if(s.length>1){const a=s.pop();for(const o of s)a.merge(o)&&(t.removeChild(o),o.parent=a,o.remove(),this.setModified())}}}}class r1e extends Wu{constructor(t){super(),this.model=t}run(t){const n=!(MA(t)||t instanceof Bc||t instanceof hn||t instanceof no),i=[],r=[];for(const s of t.children)s instanceof Gr&&(n&&!_k(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const a of i)s.merge(a,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof Gr?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const a of r)s.merge(a,this.model.renameSignal.bind(this.model));this.setModified()}}}class s1e extends Wu{run(t){const n=[...t.children];if(!nc(n,a=>a instanceof Wn)||t.numChildren()<=1)return;const r=[];let s;for(const a of n)if(a instanceof Wn){let o=a;for(;o.numChildren()===1;){const[u]=o.children;if(u instanceof Wn)o=u;else break}r.push(...o.children),s?(t.removeChild(a),a.parent=s.parent,s.parent.removeChild(s),s.parent=o,this.setModified()):s=o}else r.push(a);if(r.length){this.setModified();for(const a of r)a.parent.removeChild(a),a.parent=s}}}class Hu extends Ve{clone(){return new Hu(null,de(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=Br(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){return t.as??X(t)}hash(){return`JoinAggregateTransform ${Ae(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return{type:"joinaggregate",as:i,ops:n,fields:t,...r!==void 0?{groupby:r}:{}}}}class gc extends Ve{clone(){return new gc(null,{...this.filter})}constructor(t,n){super(t),this.filter=n}static make(t,n,i){const{config:r,markDef:s}=n,{marks:a,scales:o}=i;if(a==="include-invalid-values"&&o==="include-invalid-values")return null;const u=n.reduceFieldDef((l,c,f)=>{const h=gs(f)&&n.getScaleComponent(f);if(h){const d=h.get("type"),{aggregate:p}=c,g=Zk({scaleChannel:f,markDef:s,config:r,scaleType:d,isCountAggregate:q1(p)});g!=="show"&&g!=="always-valid"&&(l[c.field]=c)}return l},{});return j(u).length?new gc(t,u):null}dependentFields(){return new Set(j(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Ae(this.filter)}`}assemble(){const t=j(this.filter).reduce((n,i)=>{const r=this.filter[i],s=X(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (${iw(s)}))`):r.type==="quantitative"&&n.push(iw(s))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}function iw(e){return`isValid(${e}) && isFinite(+${e})`}function a1e(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=X(i);return r&&t.push(r),t},[])}function o1e(e){return L(e)&&e.every(t=>J(t))&&e.length>1}class Ws extends Ve{clone(){return new Ws(null,de(this._stack))}constructor(t,n){super(t),this._stack=n}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:a="zero"}=n,o=[],u=[];if(n.sort!==void 0)for(const f of n.sort)o.push(f.field),u.push(yt(f.order,"ascending"));const l={field:o,order:u};let c;return o1e(s)?c=s:J(s)?c=[s,`${s}_end`]:c=[`${n.stack}_start`,`${n.stack}_end`],new Ws(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:a,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:s,fieldChannel:a,offset:o,impute:u}=i,l=s.map(d=>{const p=r[d];return dr(p)}).filter(d=>!!d),c=a1e(n),f=n.encoding.order;let h;if(L(f)||W(f))h=YL(f);else{const d=L8(f)?f.sort:a==="y"?"descending":"ascending";h=c.reduce((p,g)=>(p.field.includes(g)||(p.field.push(g),p.order.push(d)),p),{field:[],order:[]})}return new Ws(t,{dimensionFieldDefs:l,stackField:n.vgField(a),facetby:[],stackby:c,sort:h,offset:o,impute:u,as:[n.vgField(a,{suffix:"start",forAs:!0}),n.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Ae(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[X(r,{binSuffix:"mid"})]:[X(r,{}),X(r,{binSuffix:"end"})]:[X(r)]).flat():i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:s,sort:a,offset:o,impute:u,as:l}=this._stack;if(u)for(const c of i){const{bandPosition:f=.5,bin:h}=c;if(h){const d=X(c,{expr:"datum"}),p=X(c,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${iw(d)} ? ${f}*${d}+${1-f}*${p} : ${d}`,as:X(c,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...s,...n],key:X(c,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:a,as:l,offset:o}),t}}class jc extends Ve{clone(){return new jc(null,de(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=Br(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return(this.transform.groupby??[]).forEach(t.add,t),(this.transform.sort??[]).forEach(n=>t.add(n.field)),this.transform.window.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){return t.as??X(t)}hash(){return`WindowTransform ${Ae(this.transform)}`}assemble(){const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),t.push(f.field===void 0?null:f.field);const s=this.transform.frame,a=this.transform.groupby;if(s&&s[0]===null&&s[1]===null&&n.every(f=>Ok(f)))return{type:"joinaggregate",as:i,ops:n,fields:t,...a!==void 0?{groupby:a}:{}};const o=[],u=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)o.push(f.field),u.push(f.order??"ascending");const l={field:o,order:u},c=this.transform.ignorePeers;return{type:"window",params:r,as:i,ops:n,fields:t,sort:l,...c!==void 0?{ignorePeers:c}:{},...a!==void 0?{groupby:a}:{},...s!==void 0?{frame:s}:{}}}}function u1e(e){function t(n){if(!(n instanceof Uc)){const i=n.clone();if(i instanceof Wn){const r=sw+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof ar||i instanceof Ws||i instanceof jc||i instanceof Hu)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function rw(e){if(e instanceof Uc)if(e.numChildren()===1&&!(e.children[0]instanceof Wn)){const t=e.children[0];(t instanceof ar||t instanceof Ws||t instanceof jc||t instanceof Hu)&&t.addDimensions(e.fields),t.swapWithParent(),rw(e)}else{const t=e.model.component.data.main;$7(t);const n=u1e(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(rw)}function $7(e){if(e instanceof Wn&&e.type===ot.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Uc||(t.swapWithParent(),$7(e))}}const sw="scale_",jp=5;function aw(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!aw(t.children))return!1}return!0}function Vi(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function TM(e,t,n){let i=e.sources,r=!1;return r=Vi(new Jme,i)||r,r=Vi(new Kme(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=Vi(new t1e,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=Vi(new Zme,i)||r,r=Vi(new r1e(t),i)||r,r=Vi(new Qme,i)||r,r=Vi(new e1e,i)||r,r=Vi(new i1e,i)||r,r=Vi(new n1e,i)||r,r=Vi(new Xme,i)||r,r=Vi(new s1e,i)||r),e.sources=i,r}function l1e(e,t){aw(e.sources);let n=0,i=0;for(let r=0;r<jp&&TM(e,t,!0);r++)n++;e.sources.map(rw);for(let r=0;r<jp&&TM(e,t,!1);r++)i++;aw(e.sources),Math.max(n,i)===jp&&V(`Maximum optimization runs(${jp}) reached.`)}class Nt{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Nt(()=>t(n))}}function T7(e){at(e)?c1e(e):f1e(e)}function c1e(e){const t=e.component.scales;for(const n of j(t)){const i=d1e(e,n);if(t[n].setWithExplicit("domains",i),g1e(e,n),e.component.data.isFaceted){let s=e;for(;!ci(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const o of i.value)Is(o)&&(o.data=sw+o.data.replace(sw,""))}}}function f1e(e){for(const n of e.children)T7(n);const t=e.component.scales;for(const n of j(t)){let i,r=null;for(const s of e.children){const a=s.component.scales[n];if(a){i===void 0?i=a.getWithExplicit("domains"):i=to(i,a.getWithExplicit("domains"),"domains","scale",ow);const o=a.get("selectionExtent");r&&o&&r.param!==o.param&&V(nhe),r=o}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function h1e(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=FM(t,n);if(!r){V(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=FM(t,n);if(r)return"unaggregated"}return e}function d1e(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=h1e(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]={...e.specifiedScales[t],domain:r}),t==="x"&&Ct(i.x2)?Ct(i.x)?to(ya(n,r,e,"x"),ya(n,r,e,"x2"),"domain","scale",ow):ya(n,r,e,"x2"):t==="y"&&Ct(i.y2)?Ct(i.y)?to(ya(n,r,e,"y"),ya(n,r,e,"y2"),"domain","scale",ow):ya(n,r,e,"y2"):ya(n,r,e,t)}function p1e(e,t,n){return e.map(i=>({signal:`{data: ${ny(i,{timeUnit:n,type:t})}}`}))}function hv(e,t,n){const i=zt(n)?.unit;return t==="temporal"||i?p1e(e,t,i):[e]}function ya(e,t,n,i){const{encoding:r,markDef:s,mark:a,config:o,stack:u}=n,l=Ct(r[i]),{type:c}=l,f=l.timeUnit,h=a0e({invalid:es("invalid",s,o),isPath:wo(a)});if($de(t)){const g=ya(e,void 0,n,i),m=hv(t.unionWith,c,f);return Dr([...m,...g.value])}else{if(re(t))return Dr([t]);if(t&&t!=="unaggregated"&&!w8(t))return Dr(hv(t,c,f))}if(u&&i===u.fieldChannel){if(u.offset==="normalize")return ei([[0,1]]);const g=n.requestDataName(h);return ei([{data:g,field:n.vgField(i,{suffix:"start"})},{data:g,field:n.vgField(i,{suffix:"end"})}])}const d=gs(i)&&W(l)?m1e(n,i,e):void 0;if(ms(l)){const g=hv([l.datum],c,f);return ei(g)}const p=l;if(t==="unaggregated"){const{field:g}=l;return ei([{data:n.requestDataName(h),field:X({field:g,aggregate:"min"})},{data:n.requestDataName(h),field:X({field:g,aggregate:"max"})}])}else if(Je(p.bin)){if(Bt(e))return ei(e==="bin-ordinal"?[]:[{data:Vh(d)?n.requestDataName(h):n.requestDataName(ot.Raw),field:n.vgField(i,Gd(p,i)?{binSuffix:"range"}:{}),sort:d===!0||!K(d)?{field:n.vgField(i,{}),op:"min"}:d}]);{const{bin:g}=p;if(Je(g)){const m=FA(n,p.field,g);return ei([new Nt(()=>{const y=n.getSignalName(m);return`[${y}.start, ${y}.stop]`})])}else return ei([{data:n.requestDataName(h),field:n.vgField(i,{})}])}}else if(p.timeUnit&&ke(["time","utc"],e)){const g=r[ps(i)];if(P8(p,g,s,o)){const m=n.requestDataName(h),y=eo({fieldDef:p,fieldDef2:g,markDef:s,config:o}),x=Hh(a)&&y!==.5&&xt(i);return ei([{data:m,field:n.vgField(i,x?{suffix:uy}:{})},{data:m,field:n.vgField(i,{suffix:x?ly:"end"})}])}}return ei(d?[{data:Vh(d)?n.requestDataName(h):n.requestDataName(ot.Raw),field:n.vgField(i),sort:d}]:[{data:n.requestDataName(h),field:n.vgField(i)}])}function dv(e,t){const{op:n,field:i,order:r}=e;return{op:n??(t?"sum":J1),...i?{field:Ii(i)}:{},...r?{order:r}:{}}}function g1e(e,t){const n=e.component.scales[t],i=e.specifiedScales[t].domain,r=e.fieldDef(t)?.bin,s=w8(i)?i:void 0,a=Bu(r)&&V1(r.extent)?r.extent:void 0;(s||a)&&n.set("selectionExtent",s??a,!0)}function m1e(e,t,n){if(!Bt(n))return;const i=e.fieldDef(t),r=i.sort;if(D8(r))return{op:"min",field:dc(i,t),order:"ascending"};const{stack:s}=e,a=s?new Set([...s.groupbyFields,...s.stackBy.map(o=>o.fieldDef.field)]):void 0;if(qs(r)){const o=s&&!a.has(r.field);return dv(r,o)}else if(ape(r)){const{encoding:o,order:u}=r,l=e.fieldDef(o),{aggregate:c,field:f}=l,h=s&&!a.has(f);if(Xs(c)||bo(c))return dv({field:X(l),order:u},h);if(Ok(c)||!c)return dv({op:c,field:f,order:u},h)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(ke(["ascending",void 0],r))return!0}}function FM(e,t){const{aggregate:n,type:i}=e;return n?J(n)&&!zfe.has(n)?{valid:!1,reason:Mhe(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:Ohe(e)}:{valid:!0}:{valid:!1,reason:Fhe(e)}}function ow(e,t,n,i){return e.explicit&&t.explicit&&V(Phe(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function y1e(e){const t=Br(e.map(a=>{if(Is(a)){const{sort:o,...u}=a;return u}return a}),Ae),n=Br(e.map(a=>{if(Is(a)){const o=a.sort;return o!==void 0&&!Vh(o)&&("op"in o&&o.op==="count"&&delete o.field,o.order==="ascending"&&delete o.order),o}}).filter(a=>a!==void 0),Ae);if(t.length===0)return;if(t.length===1){const a=e[0];if(Is(a)&&n.length>0){let o=n[0];if(n.length>1){V(zF);const u=n.filter(l=>K(l)&&"op"in l&&l.op!=="min");n.every(l=>K(l)&&"op"in l)&&u.length===1?o=u[0]:o=!0}else if(K(o)&&"field"in o){const u=o.field;a.field===u&&(o=o.order?{order:o.order}:!0)}return{...a,sort:o}}return a}const i=Br(n.map(a=>Vh(a)||!("op"in a)||J(a.op)&&Z(Dfe,a.op)?a:(V(zhe(a)),!0)),Ae);let r;i.length===1?r=i[0]:i.length>1&&(V(zF),r=!0);const s=Br(e.map(a=>Is(a)?a.data:null),a=>a);return s.length===1&&s[0]!==null?{data:s[0],fields:t.map(o=>o.field),...r?{sort:r}:{}}:{fields:t,...r?{sort:r}:{}}}function RA(e){if(Is(e)&&J(e.field))return e.field;if(Bfe(e)){let t;for(const n of e.fields)if(Is(n)&&J(n.field)){if(!t)t=n.field;else if(t!==n.field)return V(Bhe),t}return V(Uhe),t}else if(Ufe(e)){V(jhe);const t=e.fields[0];return J(t)?t:void 0}}function py(e,t){const i=e.component.scales[t].get("domains").map(r=>(Is(r)&&(r.data=e.lookupDataSource(r.data)),r));return y1e(i)}function F7(e){return qc(e)||DA(e)?e.children.reduce((t,n)=>t.concat(F7(n)),MM(e)):MM(e)}function MM(e){return j(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:a,selectionExtent:o,domains:u,range:l,reverse:c,...f}=r,h=x1e(r.range,s,n,e),d=py(e,n),p=o?y0e(e,o,i,d):null;return t.push({name:s,type:a,...d?{domain:d}:{},...p?{domainRaw:p}:{},range:h,...c!==void 0?{reverse:c}:{},...f}),t},[])}function x1e(e,t,n,i){if(xt(n)){if(Uu(e))return{step:{signal:`${t}_step`}}}else if(K(e)&&Is(e))return{...e,data:i.lookupDataSource(e.data)};return e}class M7 extends fa{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainHasZero(){const t=this.get("type");if(ke([Gt.LOG,Gt.TIME,Gt.UTC],t))return"definitely-not";const n=this.get("zero");if(n===!0||n===void 0&&ke([Gt.LINEAR,Gt.SQRT,Gt.POW],t))return"definitely";const i=this.get("domains");if(i.length>0){let r=!1,s=!1,a=!1;for(const o of i){if(L(o)){const u=o[0],l=o[o.length-1];if(Ie(u)&&Ie(l))if(u<=0&&l>=0){r=!0;continue}else{s=!0;continue}}a=!0}if(r)return"definitely";if(s&&!a)return"definitely-not"}return"maybe"}}const v1e=["range","scheme"];function b1e(e){const t=e.component.scales;for(const n of Mk){const i=t[n];if(!i)continue;const r=w1e(n,e);i.setWithExplicit("range",r)}}function OM(e,t){const n=e.fieldDef(t);if(n?.bin){const{bin:i,field:r}=n,s=Qn(t),a=e.getName(s);if(K(i)&&i.binned&&i.step!==void 0)return new Nt(()=>{const o=e.scaleName(t),u=`(domain("${o}")[1] - domain("${o}")[0]) / ${i.step}`;return`${e.getSignalName(a)} / (${u})`});if(Je(i)){const o=FA(e,r,i);return new Nt(()=>{const u=e.getSignalName(o),l=`(${u}.stop - ${u}.start) / ${u}.step`;return`${e.getSignalName(a)} / (${l})`})}}}function w1e(e,t){const n=t.specifiedScales[e],{size:i}=t,s=t.getScaleComponent(e).get("type");for(const f of v1e)if(n[f]!==void 0){const h=U2(s,f),d=_8(e,f);if(!h)V(t8(s,f,e));else if(d)V(d);else switch(f){case"range":{const p=n.range;if(L(p)){if(xt(e))return Dr(p.map(g=>{if(g==="width"||g==="height"){const m=t.getName(g),y=t.getSignalName.bind(t);return Nt.fromName(y,m)}return g}))}else if(K(p))return Dr({data:t.requestDataName(ot.Main),field:p.field,sort:{op:"min",field:t.vgField(e)}});return Dr(p)}case"scheme":return Dr(_1e(n[f]))}}const a=e===rt||e==="xOffset"?"width":"height",o=i[a];if(ns(o)){if(xt(e))if(Bt(s)){const f=N7(o,t,e);if(f)return Dr({step:f})}else V(n8(a));else if(Bd(e)){const f=e===po?"x":"y";if(t.getScaleComponent(f).get("type")==="band"){const p=R7(o,s);if(p)return Dr(p)}}}const{rangeMin:u,rangeMax:l}=n,c=E1e(e,t);return(u!==void 0||l!==void 0)&&U2(s,"rangeMin")&&L(c)&&c.length===2?Dr([u??c[0],l??c[1]]):ei(c)}function _1e(e){return Cde(e)?{scheme:e.name,...Vn(e,["name"])}:{scheme:e}}function O7(e,t,n,{center:i}={}){const r=Qn(e),s=t.getName(r),a=t.getSignalName.bind(t);return e===jt&&fr(n)?i?[Nt.fromName(o=>`${a(o)}/2`,s),Nt.fromName(o=>`-${a(o)}/2`,s)]:[Nt.fromName(a,s),0]:i?[Nt.fromName(o=>`-${a(o)}/2`,s),Nt.fromName(o=>`${a(o)}/2`,s)]:[0,Nt.fromName(a,s)]}function E1e(e,t){const{size:n,config:i,mark:r,encoding:s}=t,{type:a}=Ct(s[e]),u=t.getScaleComponent(e).get("type"),{domain:l,domainMid:c}=t.specifiedScales[e];switch(e){case rt:case jt:{if(ke(["point","band"],u)){const f=D7(e,n,i.view);if(ns(f))return{step:N7(f,t,e)}}return O7(e,t,u)}case po:case Pc:return S1e(e,t,u);case oa:{const f=C1e(r,i),h=$1e(r,n,t,i);return ac(u)?A1e(f,h,k1e(u,i,l,e)):[f,h]}case Bi:return[0,Math.PI*2];case Lu:return[0,360];case br:return[0,new Nt(()=>{const f=t.getSignalName(ci(t.parent)?"child_width":"width"),h=t.getSignalName(ci(t.parent)?"child_height":"height");return`min(${f},${h})/2`})];case go:return{step:1e3/i.scale.framesPerSecond};case xo:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case vo:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Kn:return"symbol";case Xn:case hs:case ds:return u==="ordinal"?a==="nominal"?"category":"ordinal":c!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case ua:case mo:case yo:return[i.scale.minOpacity,i.scale.maxOpacity]}}function N7(e,t,n){const{encoding:i}=t,r=t.getScaleComponent(n),s=Ck(n),a=i[s];if(g9({step:e,offsetIsDiscrete:ge(a)&&m8(a.type)})==="offset"&&X8(i,s)){const u=t.getScaleComponent(s);let c=`domain('${t.scaleName(s)}').length`;if(u.get("type")==="band"){const h=u.get("paddingInner")??u.get("padding")??0,d=u.get("paddingOuter")??u.get("padding")??0;c=`bandspace(${c}, ${h}, ${d})`}const f=r.get("paddingInner")??r.get("padding");return{signal:`${e.step} * ${c} / (1-${Wfe(f)})`}}else return e.step}function R7(e,t){if(g9({step:e,offsetIsDiscrete:Bt(t)})==="offset")return{step:e.step}}function S1e(e,t,n){const i=e===po?"x":"y",r=t.getScaleComponent(i);if(!r)return O7(i,t,n,{center:!0});const s=r.get("type"),a=t.scaleName(i),{markDef:o,config:u}=t;if(s==="band"){const l=D7(i,t.size,t.config.view);if(ns(l)){const c=R7(l,n);if(c)return c}return[0,{signal:`bandwidth('${a}')`}]}else{const l=t.encoding[i];if(W(l)&&l.timeUnit){const c=h8(l.timeUnit,p=>`scale('${a}', ${p})`),f=t.config.scale.bandWithNestedOffsetPaddingInner,h=eo({fieldDef:l,markDef:o,config:u})-.5,d=h!==0?` + ${h}`:"";if(f){const p=re(f)?`${f.signal}/2`+d:`${f/2+h}`,g=re(f)?`(1 - ${f.signal}/2)`+d:`${1-f/2+h}`;return[{signal:`${p} * (${c})`},{signal:`${g} * (${c})`}]}return[0,{signal:c}]}return EL(`Cannot use ${e} scale if ${i} scale is not discrete.`)}}function D7(e,t,n){const i=e===rt?"width":"height",r=t[i];return r||nm(n,i)}function k1e(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&L(n)?n.length+1:(V(Qhe(i)),3)}}function A1e(e,t,n){const i=()=>{const r=nr(t),s=nr(e),a=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${a}, ${a})`};return re(t)?new Nt(i):{signal:i()}}function C1e(e,t){switch(e){case"bar":case"tick":return t.scale.minBandSize;case"line":case"trail":case"rule":return t.scale.minStrokeWidth;case"text":return t.scale.minFontSize;case"point":case"square":case"circle":return t.scale.minSize}throw new Error(W1("size",e))}const NM=.95;function $1e(e,t,n,i){const r={x:OM(n,"x"),y:OM(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=RM(t,r,i.view);return Ie(s)?s-1:new Nt(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=RM(t,r,i.view);return Ie(s)?Math.pow(NM*s,2):new Nt(()=>`pow(${NM} * ${s.signal}, 2)`)}}throw new Error(W1("size",e))}function RM(e,t,n){const i=ns(e.width)?e.width.step:W2(n,"width"),r=ns(e.height)?e.height.step:W2(n,"height");return t.x||t.y?new Nt(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function I7(e,t){at(e)?T1e(e,t):L7(e,t)}function T1e(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:a}=e;for(const o of j(n)){const u=a[o],l=n[o],c=e.getScaleComponent(o),f=Ct(r[o]),h=u[t],d=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=U2(d,t),y=_8(o,t);if(h!==void 0&&(m?y&&V(y):V(t8(d,t,o))),m&&y===void 0)if(h!==void 0){const x=f.timeUnit,v=f.type;switch(t){case"domainMax":case"domainMin":ju(u[t])||v==="temporal"||x?l.set(t,{signal:ny(u[t],{type:v,timeUnit:x})},!0):l.set(t,u[t],!0);break;default:l.copyKeyFromObject(t,u)}}else{const x=q(DM,t)?DM[t]({model:e,channel:o,fieldOrDatumDef:f,scaleType:d,scalePadding:p,scalePaddingInner:g,domain:u.domain,domainMin:u.domainMin,domainMax:u.domainMax,markDef:s,config:i,hasNestedOffsetScale:K8(r,o),hasSecondaryRangeChannel:!!r[ps(o)]}):i.scale[t];x!==void 0&&l.set(t,x,!1)}}}const DM={bins:({model:e,fieldOrDatumDef:t})=>W(t)?F1e(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>M1e(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:s})=>O1e(e,t,n,i,r,s),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>N1e(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:s})=>R1e(e,t,n.type,i,r.scale,s),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:s})=>D1e(e,t,n,i,r.scale,s),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=W(e)?e.sort:void 0;return I1e(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r,config:s,hasSecondaryRangeChannel:a})=>P1e(e,t,n,i,r,s.scale,a)};function P7(e){at(e)?b1e(e):L7(e,"range")}function L7(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?P7(i):I7(i,t);for(const i of j(n)){let r;for(const s of e.children){const a=s.component.scales[i];if(a){const o=a.getWithExplicit(t);r=to(r,o,t,"scale",$9((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function F1e(e,t){const n=t.bin;if(Je(n)){const i=FA(e,t.field,n);return new Nt(()=>e.getSignalName(i))}else if(Wt(n)&&Bu(n)&&n.step!==void 0)return{step:n.step}}function M1e(e,t){if(ke([Xn,hs,ds],e)&&t!=="nominal")return"hcl"}function O1e(e,t,n,i,r,s){if(!(dr(s)?.bin||L(n)||r!=null||i!=null||ke([Gt.TIME,Gt.UTC],e)))return xt(t)?!0:void 0}function N1e(e,t,n,i,r,s){if(xt(e)){if(Ur(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:a,orient:o}=r;if(a==="bar"&&!(W(i)&&(i.bin||i.timeUnit))&&(o==="vertical"&&e==="x"||o==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===Gt.POINT)return n.pointPadding}}function R1e(e,t,n,i,r,s=!1){if(e===void 0){if(xt(t)){const{bandPaddingInner:a,barBandPaddingInner:o,rectBandPaddingInner:u,tickBandPaddingInner:l,bandWithNestedOffsetPaddingInner:c}=r;return s?c:yt(a,n==="bar"?o:n==="tick"?l:u)}else if(Bd(t)&&i===Gt.BAND)return r.offsetBandPaddingInner}}function D1e(e,t,n,i,r,s=!1){if(e===void 0){if(xt(t)){const{bandPaddingOuter:a,bandWithNestedOffsetPaddingOuter:o}=r;if(s)return o;if(n===Gt.BAND)return yt(a,re(i)?{signal:`${i.signal}/2`}:i/2)}else if(Bd(t)){if(n===Gt.POINT)return .5;if(n===Gt.BAND)return r.offsetBandPaddingOuter}}}function I1e(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return fr(e)&&t==="descending"?re(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(fr(e)&&t==="descending")return!0}function P1e(e,t,n,i,r,s,a){if(!!n&&n!=="unaggregated"&&fr(r)){if(L(n)){const u=n[0],l=n[n.length-1];if(Ie(u)&&u<=0&&Ie(l)&&l>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!ac(r))return!0;if(!(W(t)&&t.bin)&&ke([...la,...Afe],e)){const{orient:u,type:l}=i;return ke(["bar","area","line","trail"],l)&&(u==="horizontal"&&e==="y"||u==="vertical"&&e==="x")?!1:ke(["bar","area"],l)&&!a?!0:s?.zero}return!1}function L1e(e,t,n,i,r=!1){const s=z1e(t,n,i,r),{type:a}=e;return gs(t)?a!==void 0?Rde(t,a)?W(n)&&!Nde(a,n.type)?(V(Dhe(a,s)),s):a:(V(Rhe(t,a,s)),s):s:null}function z1e(e,t,n,i){switch(t.type){case"nominal":case"ordinal":{if(Fl(e)||tv(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&V(nv(e,"ordinal")),"ordinal";if(ev(e))return"band";if(xt(e)||Bd(e)){if(ke(["rect","bar","image","rule","tick"],n.type)||i)return"band"}else if(n.type==="arc"&&e in Fk)return"band";const r=n[Qn(e)];return Eu(r)||uc(t)&&t.axis?.tickBand?"band":"point"}case"temporal":return Fl(e)?"time":tv(e)==="discrete"?(V(nv(e,"temporal")),"ordinal"):W(t)&&t.timeUnit&&zt(t.timeUnit).utc?"utc":ev(e)?"band":"time";case"quantitative":return Fl(e)?W(t)&&Je(t.bin)?"bin-ordinal":"linear":tv(e)==="discrete"?(V(nv(e,"quantitative")),"ordinal"):ev(e)?"band":"linear";case"geojson":return}throw new Error(ZL(t.type))}function B1e(e,{ignoreRange:t}={}){z7(e),T7(e);for(const n of Ode)I7(e,n);t||P7(e)}function z7(e){at(e)?e.component.scales=U1e(e):e.component.scales=q1e(e)}function U1e(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const s of Mk){const a=Ct(t[s]);if(a&&n===k8&&s===Kn&&a.type===Lc)continue;let o=a&&a.scale;if(a&&o!==null&&o!==!1){o??(o={});const u=K8(t,s),l=L1e(o,s,a,i,u);r[s]=new M7(e.scaleName(`${s}`,!0),{value:l,explicit:o.type===l})}}return r}const j1e=$9((e,t)=>UF(e)-UF(t));function q1e(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const s of e.children){z7(s);for(const a of j(s.component.scales))if((t=r.scale)[a]??(t[a]=m7(a,e)),r.scale[a]==="shared"){const o=i[a],u=s.component.scales[a].getWithExplicit("type");o?_de(o.value,u.value)?i[a]=to(o,u,"type","scale",j1e):(r.scale[a]="independent",delete i[a]):i[a]=u}}for(const s of j(i)){const a=e.scaleName(s,!0),o=i[s];n[s]=new M7(a,o);for(const u of e.children){const l=u.component.scales[s];l&&(u.renameScale(l.get("name"),a),l.merged=!0)}}return n}class pv{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function at(e){return e?.type==="unit"}function ci(e){return e?.type==="facet"}function DA(e){return e?.type==="concat"}function qc(e){return e?.type==="layer"}class IA{constructor(t,n,i,r,s,a,o){this.type=n,this.parent=i,this.config=s,this.parent=i,this.config=s,this.view=Ht(o),this.name=t.name??r,this.title=_a(t.title)?{text:t.title}:t.title?Ht(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new pv,this.projectionNameMap=i?i.projectionNameMap:new pv,this.signalNameMap=i?i.signalNameMap:new pv,this.data=t.data,this.description=t.description,this.transforms=Yge(t.transform??[]),this.layout=n==="layer"||n==="unit"?{}:Jpe(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:Z1(t)||i?.component.data.isFaceted&&t.data===void 0},layoutSize:new fa,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...a?de(a):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){B1e(this)}parseProjection(){A7(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){w7(this)}assembleEncodeFromView(t){const{style:n,...i}=t,r={};for(const s of j(i)){const a=i[s];a!==void 0&&(r[s]=et(a))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=et(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...n}:He(n)?void 0:n}assembleLayout(){if(!this.layout)return;const{spacing:t,...n}=this.layout,{component:i,config:r}=this,s=lme(i.layoutHeaders,r);return{padding:t,...this.assembleDefaultLayout(),...n,...s?{titleBand:s}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of $i)t[i].title&&n.push(ime(this,i));for(const i of AA)n=n.concat(rme(this,i));return n}assembleAxes(){return V0e(this.component.axes,this.config)}assembleLegends(){return E7(this)}assembleProjections(){return Ome(this)}assembleTitle(){const{encoding:t,...n}=this.title??{},i={...VL(this.config.title).nonMarkTitleProperties,...n,...t?{encode:{update:t}}:{}};if(i.text)return ke(["unit","layer"],this.type)?ke(["middle",void 0],i.anchor)&&(i.frame??(i.frame="group")):i.anchor??(i.anchor="start"),He(i)?void 0:i}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||ci(this.parent)?F7(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const a=this.assembleLegends();return a.length>0&&(n.legends=a),n}getName(t){return it((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(ot[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(ci(this.parent)){const n=p7(t),i=j1(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),a=r.get("range");if(Bt(s)&&Uu(a)){const o=r.get("name"),u=py(this,i),l=RA(u);if(l){const c=X({aggregate:"distinct",field:l},{expr:"datum"});return{signal:d7(o,r,c)}}else return V(Rk(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(IL(t)&&gs(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getScaleType(t){const n=this.getScaleComponent(t);return n?n.get("type"):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Kfe(n));return i}hasAxisOrientSignalRef(){return this.component.axes.x?.some(t=>t.hasOrientSignalRef())||this.component.axes.y?.some(t=>t.hasOrientSignalRef())}}class B7 extends IA{vgField(t,n={}){const i=this.fieldDef(t);if(i)return X(i,n)}reduceFieldDef(t,n){return Cpe(this.getMapping(),(i,r,s)=>{const a=dr(r);return a?t(i,a,s):i},n)}forEachFieldDef(t,n){uA(this.getMapping(),(i,r)=>{const s=dr(i);s&&t(s,r)},n)}}class gy extends Ve{clone(){return new gy(null,de(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=de(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"value",i[1]??"density"];const r=this.transform.resolve??"shared";this.transform.resolve=r}dependentFields(){return new Set([this.transform.density,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Ae(this.transform)}`}assemble(){const{density:t,...n}=this.transform,i={type:"kde",field:t,...n};return i.resolve=this.transform.resolve,i}}class my extends Ve{clone(){return new my(null,de(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=de(n)}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return`ExtentTransform ${Ae(this.transform)}`}assemble(){const{extent:t,param:n}=this.transform;return{type:"extent",field:t,signal:n}}}class yy extends Ve{clone(){return new yy(this.parent,de(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=de(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,a)=>r[a]??s)}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Ae(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class xy extends Ve{clone(){return new xy(null,de(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=de(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"key",i[1]??"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Ae(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class Nl extends Ve{clone(){return new Nl(null,de(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[_r,wr],[Pi,Er]]){const s=r.map(a=>{const o=Ct(n.encoding[a]);return W(o)?o.field:ms(o)?{expr:`${o.datum}`}:hr(o)?{expr:`${o.value}`}:void 0});(s[0]||s[1])&&(t=new Nl(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(Kn)){const r=n.typedFieldDef(Kn);r.type===Lc&&(t=new Nl(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}constructor(t,n,i,r){super(t),this.fields=n,this.geojson=i,this.signal=r}dependentFields(){const t=(this.fields??[]).filter(J);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Ae(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class Yh extends Ve{clone(){return new Yh(null,this.projection,de(this.fields),de(this.as))}constructor(t,n,i,r){super(t),this.projection=n,this.fields=i,this.as=r}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[_r,wr],[Pi,Er]]){const r=i.map(a=>{const o=Ct(n.encoding[a]);return W(o)?o.field:ms(o)?{expr:`${o.datum}`}:hr(o)?{expr:`${o.value}`}:void 0}),s=i[0]===Pi?"2":"";(r[0]||r[1])&&(t=new Yh(t,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return t}dependentFields(){return new Set(this.fields.filter(J))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Ae(this.fields)} ${Ae(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class ru extends Ve{clone(){return new ru(null,de(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set([this.transform.impute,this.transform.key,...this.transform.groupby??[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,n){return new ru(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(W(r)&&W(s)){const a=r.impute?r:s.impute?s:void 0;if(a===void 0)return;const o=r.impute?s:s.impute?r:void 0,{method:u,value:l,frame:c,keyvals:f}=a.impute,h=Z8(n.mark,i);return new ru(t,{impute:a.field,key:o.field,...u?{method:u}:{},...l!==void 0?{value:l}:{},...c?{frame:c}:{},...f!==void 0?{keyvals:f}:{},...h.length?{groupby:h}:{}})}return null}hash(){return`Impute ${Ae(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:a,frame:o=[null,null]}=this.transform,u={type:"impute",field:t,key:n,...i?{keyvals:Tge(i)?this.processSequence(i):i}:{},method:"value",...s?{groupby:s}:{},value:!r||r==="value"?a:null};if(r&&r!=="value"){const l={type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:o,ignorePeers:!1,...s?{groupby:s}:{}},c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}class vy extends Ve{clone(){return new vy(null,de(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=de(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.loess]}dependentFields(){return new Set([this.transform.loess,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Ae(this.transform)}`}assemble(){const{loess:t,on:n,...i}=this.transform;return{type:"loess",x:n,y:t,...i}}}class Xh extends Ve{clone(){return new Xh(null,de(this.transform),this.secondary)}constructor(t,n,i){super(t),this.transform=n,this.secondary=i}static make(t,n,i,r){const s=n.component.data.sources,{from:a}=i;let o=null;if(Fge(a)){let u=q7(a.data,s);u||(u=new Cu(a.data),s.push(u));const l=n.getName(`lookup_${r}`);o=new Wn(u,l,ot.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=o}else if(Mge(a)){const u=a.param;i={as:u,...i};let l;try{l=n.getSelectionComponent(it(u),u)}catch{throw new Error(ehe(u))}if(o=l.materialized,!o)throw new Error(the(u))}return new Xh(t,i,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?Q(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Ae({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t={values:this.transform.from.fields,...this.transform.as?{as:Q(this.transform.as)}:{}};else{let n=this.transform.as;J(n)||(V(hhe),n="_lookup"),t={as:[n]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...t,...this.transform.default?{default:this.transform.default}:{}}}}class by extends Ve{clone(){return new by(null,de(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=de(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"prob",i[1]??"value"]}dependentFields(){return new Set([this.transform.quantile,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Ae(this.transform)}`}assemble(){const{quantile:t,...n}=this.transform;return{type:"quantile",field:t,...n}}}class wy extends Ve{clone(){return new wy(null,de(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=de(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.regression]}dependentFields(){return new Set([this.transform.regression,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Ae(this.transform)}`}assemble(){const{regression:t,on:n,...i}=this.transform;return{type:"regression",x:n,y:t,...i}}}class _y extends Ve{clone(){return new _y(null,de(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=Br((this.transform.groupby??[]).concat(t),n=>n)}producedFields(){}dependentFields(){return new Set([this.transform.pivot,this.transform.value,...this.transform.groupby??[]])}hash(){return`PivotTransform ${Ae(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return{type:"pivot",field:t,value:n,...r!==void 0?{limit:r}:{},...s!==void 0?{op:s}:{},...i!==void 0?{groupby:i}:{}}}}class Ey extends Ve{clone(){return new Ey(null,de(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Ae(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function U7(e){let t=0;function n(i,r){if(i instanceof Cu&&!i.isGenerator&&!cc(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof hn&&(i.parent instanceof Cu&&!r.source?(r.format={...r.format,parse:i.assembleFormatParse()},r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Uc){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}switch((i instanceof Kd||i instanceof Qd||i instanceof gc||i instanceof Bc||i instanceof hc||i instanceof Yh||i instanceof ar||i instanceof Xh||i instanceof jc||i instanceof Hu||i instanceof xy||i instanceof yy||i instanceof gy||i instanceof vy||i instanceof by||i instanceof wy||i instanceof no||i instanceof Ey||i instanceof _y||i instanceof my)&&r.transform.push(i.assemble()),(i instanceof Gr||i instanceof Wr||i instanceof ru||i instanceof Ws||i instanceof Nl)&&r.transform.push(...i.assemble()),i instanceof Wn&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof Wn?i.setSource(r.name):(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof Wn&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let s=r.name;!r.source||r.transform.length>0?e.push(r):s=r.source;for(const a of i.children)n(a,{name:null,source:s,transform:[]});break}}}return n}function V1e(e){const t=[],n=U7(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function W1e(e,t){const n=[],i=U7(n);let r=0;for(const a of e.sources){a.hasName()||(a.dataName=`source_${r++}`);const o=a.assemble();i(a,o)}for(const a of n)a.transform.length===0&&delete a.transform;let s=0;for(const[a,o]of n.entries())(o.transform??[]).length===0&&!o.source&&n.splice(s++,0,n.splice(a,1)[0]);for(const a of n)for(const o of a.transform??[])o.type==="lookup"&&(o.from=e.outputNodes[o.from].getSource());for(const a of n)a.name in t&&(a.values=t[a.name]);return n}function H1e(e){return e==="top"||e==="left"||re(e)?"header":"footer"}function G1e(e){for(const t of $i)Y1e(e,t);IM(e,"x"),IM(e,"y")}function Y1e(e,t){const{facet:n,config:i,child:r,component:s}=e;if(e.channelHasField(t)){const a=n[t],o=pc("title",null,i,t);let u=Ml(a,i,{allowDisabling:!0,includeDefault:o===void 0||!!o});r.component.layoutHeaders[t].title&&(u=L(u)?u.join(", "):u,u+=` / ${r.component.layoutHeaders[t].title}`,r.component.layoutHeaders[t].title=null);const l=pc("labelOrient",a.header,i,t),c=a.header!==null?yt(a.header?.labels,i.header.labels,!0):!1,f=ke(["bottom","right"],l)?"footer":"header";s.layoutHeaders[t]={title:a.header!==null?u:null,facetFieldDef:a,[f]:t==="facet"?[]:[j7(e,t,c)]}}}function j7(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function IM(e,t){const{child:n}=e;if(n.component.axes[t]){const{layoutHeaders:i,resolve:r}=e.component;if(r.axis[t]=TA(r,t),r.axis[t]==="shared"){const s=t==="x"?"column":"row",a=i[s];for(const o of n.component.axes[t]){const u=H1e(o.get("orient"));a[u]??(a[u]=[j7(e,s,!1)]);const l=Zf(o,"main",e.config,{header:!0});l&&a[u][0].axes.push(l),o.mainExtracted=!0}}}}function X1e(e){PA(e),am(e,"width"),am(e,"height")}function K1e(e){PA(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";am(e,t),am(e,n)}function PA(e){for(const t of e.children)t.parseLayoutSize()}function am(e,t){const n=p7(t),i=j1(n),r=e.component.resolve,s=e.component.layoutSize;let a;for(const o of e.children){const u=o.component.layoutSize.getWithExplicit(n),l=r.scale[i]??m7(i,e);if(l==="independent"&&u.value==="step"){a=void 0;break}if(a){if(l==="independent"&&a.value!==u.value){a=void 0;break}a=to(a,u,n,"")}else a=u}if(a){for(const o of e.children)e.renameSignal(o.getName(n),e.getName(t)),o.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,a)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function Q1e(e){const{size:t,component:n}=e;for(const i of la){const r=Qn(i);if(t[r]){const s=t[r];n.layoutSize.set(r,ns(s)?"step":s,!0)}else{const s=J1e(e,r);n.layoutSize.set(r,s,!1)}}}function J1e(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),a=r.get("range");if(Bt(s)){const o=nm(i.view,t);return Uu(a)||ns(o)?"step":o}else return V2(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return V2(i.view,t);{const s=nm(i.view,t);return ns(s)?s.step:s}}}function uw(e,t,n){return X(t,{suffix:`by_${X(e)}`,...n})}class mh extends B7{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve),this.child=jA(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!Vd(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=j(t),i={};for(const r of n){if(![Us,js].includes(r)){V(W1(r,"facet"));break}const s=t[r];if(s.field===void 0){V(z2(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=oA(t,n);return i.header?i.header=Ht(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return q(this.facet,t)}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Sy(this),this.child.parseData()}parseLayoutSize(){PA(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection,Object.values(this.component.selection).some(t=>Hr(t))&&Ik(Dk)}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),G1e(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){const t={};for(const n of $i)for(const i of CA){const r=this.component.layoutHeaders[n],s=r[i],{facetFieldDef:a}=r;if(a){const o=pc("titleOrient",a.header,this.config,n);if(["right","bottom"].includes(o)){const u=hy(n,o);t.titleAnchor??(t.titleAnchor={}),t.titleAnchor[u]="end"}}if(s?.[0]){const o=n==="row"?"height":"width",u=i==="header"?"headerBand":"footerBand";n!=="facet"&&!this.child.component.layoutSize.get(o)&&(t[u]??(t[u]={}),t[u][n]=.5),r.title&&(t.offset??(t.offset={}),t.offset[n==="row"?"rowTitle":"columnTitle"]=10)}}return t}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),{...this.getHeaderLayoutMixins(),...i?{columns:i}:{},bounds:"full",align:r}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof mh))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(t){return this.parent&&this.parent instanceof mh?{...this.channelHasField("column")?{encode:{update:{columns:{field:X(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(t)}:super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof mh){if(this.child.channelHasField("column")){const r=X(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of la){const s=this.child.component.scales[r];if(s&&!s.merged){const a=s.get("type"),o=s.get("range");if(Bt(a)&&Uu(o)){const u=py(this.child,r),l=RA(u);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):V(Rk(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:a,as:o}=this.getCardinalityAggregateForChild(),u=[];for(const c of $i){const f=this.facet[c];if(f){u.push(X(f));const{bin:h,sort:d}=f;if(Je(h)&&u.push(X(f,{binSuffix:"end"})),qs(d)){const{field:p,op:g=J1}=d,m=uw(f,d);i&&r?(s.push(m),a.push("max"),o.push(m)):(s.push(p),a.push(g),o.push(m))}else if(L(d)){const p=dc(f,c);s.push(p),a.push("max"),o.push(p)}}}const l=!!i&&!!r;return{name:t,data:n,groupby:u,...l||s.length>0?{aggregate:{...l?{cross:l}:{},...s.length?{fields:s,ops:a,as:o}:{}}}:{}}}facetSortFields(t){const{facet:n}=this,i=n[t];return i?qs(i.sort)?[uw(i,i.sort,{expr:"datum"})]:L(i.sort)?[dc(i,t,{expr:"datum"})]:[X(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(qs(r)?r.order:!L(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return tw(t.facet,"facet",n);const i={row:["top","bottom"],column:["left","right"]};for(const r of AA)if(t[r]){const s=pc("labelOrient",t[r]?.header,n,r);if(i[r].includes(s))return tw(t[r],r,n)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=V1e(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),a=t.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...s?{title:s}:{},...a?{style:a}:{},from:{facet:this.assembleFacet()},sort:{field:$i.map(u=>this.facetSortFields(u)).flat(),order:$i.map(u=>this.facetSortOrder(u)).flat()},...i.length>0?{data:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup(d0e(this,[]))}]}getMapping(){return this.facet}}function Z1e(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(qs(s.sort)){const{field:a,op:o=J1}=s.sort;e=r=new Hu(e,{joinaggregate:[{op:o,field:a,as:uw(s,s.sort,{forAs:!0})}],groupby:[X(s)]})}return r}return null}function q7(e,t){for(const n of t){const i=n.data;if(e.name&&n.hasName()&&e.name!==n.dataName)continue;const r=e.format?.mesh,s=i.format?.feature;if(r&&s)continue;const a=e.format?.feature;if((a||s)&&a!==s)continue;const o=i.format?.mesh;if(!((r||o)&&r!==o)){if(Gh(e)&&Gh(i)){if(ai(e.values,i.values))return n}else if(cc(e)&&cc(i)){if(e.url===i.url)return n}else if(T9(e)&&e.name===n.dataName)return n}}return null}function eye(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Cu({values:[]});return t.push(i),i}const n=q7(e.data,t);if(n)return Ba(e.data)||(n.data.format=SL({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Cu(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function tye(e,t,n){let i=0;for(const r of t.transforms){let s,a;if(Uge(r))a=e=new hc(e,r),s="derived";else if(vA(r)){const o=Wme(r);a=e=hn.makeWithAncestors(e,{},o,n)??e,e=new Bc(e,t,r.filter)}else if(S9(r))a=e=Gr.makeFromTransform(e,r,t),s="number";else if(qge(r))s="date",n.getWithExplicit(r.field).value===void 0&&(e=new hn(e,{[r.field]:s}),n.set(r.field,s,!1)),a=e=Wr.makeFromTransform(e,r);else if(Vge(r))a=e=ar.makeFromTransform(e,r),s="number",kA(t)&&(e=new no(e));else if(E9(r))a=e=Xh.make(e,t,r,i++),s="derived";else if(Lge(r))a=e=new jc(e,r),s="number";else if(zge(r))a=e=new Hu(e,r),s="number";else if(Wge(r))a=e=Ws.makeFromTransform(e,r),s="derived";else if(Hge(r))a=e=new xy(e,r),s="derived";else if(Gge(r))a=e=new my(e,r),s="derived";else if(Bge(r))a=e=new yy(e,r),s="derived";else if(Oge(r))a=e=new _y(e,r),s="derived";else if(Pge(r))e=new Ey(e,r);else if(jge(r))a=e=ru.makeFromTransform(e,r),s="derived";else if(Nge(r))a=e=new gy(e,r),s="derived";else if(Rge(r))a=e=new by(e,r),s="derived";else if(Dge(r))a=e=new wy(e,r),s="derived";else if(Ige(r))a=e=new vy(e,r),s="derived";else{V(fhe(r));continue}if(a&&s!==void 0)for(const o of a.producedFields()??[])n.set(o,s,!1)}return e}function Sy(e){let t=eye(e,e.component.data.sources);const{outputNodes:n,outputNodeRefCounts:i}=e.component.data,r=e.data,a=!(r&&(Ba(r)||cc(r)||Gh(r)))&&e.parent?e.parent.component.data.ancestorParse.clone():new s0e;Ba(r)?(F9(r)?t=new Qd(t,r.sequence):bA(r)&&(t=new Kd(t,r.graticule)),a.parseNothing=!0):r?.format?.parse===null&&(a.parseNothing=!0),t=hn.makeExplicit(t,e,a)??t,t=new no(t);const o=e.parent&&qc(e.parent);(at(e)||ci(e))&&o&&(t=Gr.makeFromEncoding(t,e)??t),e.transforms.length>0&&(t=tye(t,e,a));const u=Gme(e),l=Hme(e);t=hn.makeWithAncestors(t,{},{...u,...l},a)??t,at(e)&&(t=Nl.parseAll(t,e),t=Yh.parseAll(t,e)),(at(e)||ci(e))&&(o||(t=Gr.makeFromEncoding(t,e)??t),t=Wr.makeFromEncoding(t,e)??t,t=hc.parseAllForSortIndex(t,e));const c=t=qp(ot.Raw,e,t);if(at(e)){const m=ar.makeFromEncoding(t,e);m&&(t=m,kA(e)&&(t=new no(t))),t=ru.makeFromEncoding(t,e)??t,t=Ws.makeFromEncoding(t,e)??t}let f,h;if(at(e)){const{markDef:m,mark:y,config:x}=e,v=We("invalid",m,x),{marks:b,scales:w}=h=O9({invalid:v,isPath:wo(y)});b!==w&&w==="include-invalid-values"&&(f=t=qp(ot.PreFilterInvalid,e,t)),b==="exclude-invalid-values"&&(t=gc.make(t,e,h)??t)}const d=t=qp(ot.Main,e,t);let p;if(at(e)&&h){const{marks:m,scales:y}=h;m==="include-invalid-values"&&y==="exclude-invalid-values"&&(t=gc.make(t,e,h)??t,p=t=qp(ot.PostFilterInvalid,e,t))}at(e)&&j0e(e,d);let g=null;if(ci(e)){const m=e.getName("facet");t=Z1e(t,e.facet)??t,g=new Uc(t,e,m,d.getSource()),n[m]=g}return{...e.component.data,outputNodes:n,outputNodeRefCounts:i,raw:c,main:d,facetRoot:g,ancestorParse:a,preFilterInvalid:f,postFilterInvalid:p}}function qp(e,t,n){const{outputNodes:i,outputNodeRefCounts:r}=t.component.data,s=t.getDataName(e),a=new Wn(n,s,e,r);return i[s]=a,a}class nye extends IA{constructor(t,n,i,r){super(t,"concat",n,i,r,t.resolve),(t.resolve?.axis?.x==="shared"||t.resolve?.axis?.y==="shared")&&V(uhe),this.children=this.getChildren(t).map((s,a)=>jA(s,this,this.getName(`concat_${a}`),void 0,r))}parseData(){this.component.data=Sy(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of j(t.component.selection))this.component.selection[n]=t.component.selection[n]}Object.values(this.component.selection).some(t=>Hr(t))&&Ik(Dk)}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return sy(t)?t.vconcat:yA(t)?t.hconcat:t.concat}parseLayoutSize(){K1e(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=$A(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return{type:"group",name:t.getName("group"),...n?{title:n}:{},...i?{style:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){const t=this.layout.columns;return{...t!=null?{columns:t}:{},bounds:"full",align:"each"}}}function iye(e){return e===!1||e===null}const rye={disable:1,gridScale:1,scale:1,...G8,labelExpr:1,encode:1},V7=j(rye);class LA extends fa{constructor(t={},n={},i=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new LA(de(this.explicit),de(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!iye(this.get(t))}hasOrientSignalRef(){return re(this.explicit.orient)}}function sye(e,t,n){const{encoding:i,config:r}=e,s=Ct(i[t])??Ct(i[ps(t)]),a=e.axis(t)||{},{format:o,formatType:u}=a;if(Su(u))return{text:ir({fieldOrDatumDef:s,field:"datum.value",format:o,formatType:u,config:r}),...n};if(o===void 0&&u===void 0&&r.customFormatTypes){if(oc(s)==="quantitative"){if(uc(s)&&s.stack==="normalize"&&r.normalizedNumberFormatType)return{text:ir({fieldOrDatumDef:s,field:"datum.value",format:r.normalizedNumberFormat,formatType:r.normalizedNumberFormatType,config:r}),...n};if(r.numberFormatType)return{text:ir({fieldOrDatumDef:s,field:"datum.value",format:r.numberFormat,formatType:r.numberFormatType,config:r}),...n}}if(oc(s)==="temporal"&&r.timeFormatType&&W(s)&&!s.timeUnit)return{text:ir({fieldOrDatumDef:s,field:"datum.value",format:r.timeFormat,formatType:r.timeFormatType,config:r}),...n}}return n}function aye(e){return la.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[dye(n,e)]),t),{})}const oye={bottom:"top",top:"bottom",left:"right",right:"left"};function uye(e){const{axes:t,resolve:n}=e.component,i={top:0,bottom:0,right:0,left:0};for(const r of e.children){r.parseAxesAndHeaders();for(const s of j(r.component.axes))n.axis[s]=TA(e.component.resolve,s),n.axis[s]==="shared"&&(t[s]=lye(t[s],r.component.axes[s]),t[s]||(n.axis[s]="independent",delete t[s]))}for(const r of la){for(const s of e.children)if(s.component.axes[r]){if(n.axis[r]==="independent"){t[r]=(t[r]??[]).concat(s.component.axes[r]);for(const a of s.component.axes[r]){const{value:o,explicit:u}=a.getWithExplicit("orient");if(!re(o)){if(i[o]>0&&!u){const l=oye[o];i[o]>i[l]&&a.set("orient",l,!1)}i[o]++}}}delete s.component.axes[r]}if(n.axis[r]==="independent"&&t[r]&&t[r].length>1)for(const[s,a]of(t[r]||[]).entries())s>0&&a.get("grid")&&!a.explicit.grid&&(a.implicit.grid=!1)}}function lye(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!=!!s)return;if(r&&s){const a=r.getWithExplicit("orient"),o=s.getWithExplicit("orient");if(a.explicit&&o.explicit&&a.value!==o.value)return;e[i]=cye(r,s)}}}else return t.map(n=>n.clone());return e}function cye(e,t){for(const n of V7){const i=to(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return QL(r,s);case"gridScale":return{explicit:r.explicit,value:yt(r.value,s.value)}}return oy(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function fye(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(re(n.labelAngle)?n.labelAngle:Wh(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===l7(i,r))return!0}return e===n[t]}const hye=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function dye(e,t){let n=t.axis(e);const i=new LA,r=Ct(t.encoding[e]),{mark:s,config:a}=t,o=n?.orient||a[e==="x"?"axisX":"axisY"]?.orient||a.axis?.orient||J0e(e),u=t.getScaleComponent(e).get("type"),l=W0e(e,u,o,t.config),c=n!==void 0?!n:Z2("disable",a.style,n?.style,l).configValue;if(i.set("disable",c,n!==void 0),c)return i;n=n||{};const f=X0e(r,n,e,a.style,l),h=N8(n.formatType,r,u),d=O8(r,r.type,n.format,n.formatType,a,!0),p={fieldOrDatumDef:r,axis:n,channel:e,model:t,scaleType:u,orient:o,labelAngle:f,format:d,formatType:h,mark:s,config:a};for(const y of V7){const x=y in wM?wM[y](p):YF(y)?n[y]:void 0,v=x!==void 0,b=fye(x,y,n,t,e);if(v&&b)i.set(y,x,b);else{const{configValue:w=void 0,configFrom:E=void 0}=YF(y)&&y!=="values"?Z2(y,a.style,n.style,l):{},_=w!==void 0;v&&!_?i.set(y,x,b):(E!=="vgAxisConfig"||hye.has(y)&&_||Yd(w)||re(w))&&i.set(y,w,!1)}}const g=n.encoding??{},m=H8.reduce((y,x)=>{if(!i.hasAxisPart(x))return y;const v=g7(g[x]??{},t),b=x==="labels"?sye(t,e,v):v;return b!==void 0&&!He(b)&&(y[x]={update:b}),y},{});return He(m)||i.set("encode",m,!!n.encoding||n.labelAngle!==void 0),i}function pye({encoding:e,size:t}){for(const n of la){const i=Qn(n);ns(t[i])&&Oa(e[n])&&(delete t[i],V(n8(i)))}return t}const gye={vgMark:"arc",encodeEntry:e=>({...Ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...$n("x",e,{defaultPos:"mid"}),...$n("y",e,{defaultPos:"mid"}),...Ks(e,"radius"),...Ks(e,"theta")})},mye={vgMark:"area",encodeEntry:e=>({...Ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...im("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"}),...im("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"}),...SA(e)})},yye={vgMark:"rect",encodeEntry:e=>({...Ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Ks(e,"x"),...Ks(e,"y")})},xye={vgMark:"shape",encodeEntry:e=>({...Ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[{type:"geoshape",projection:e.projectionName(),...n&&W(n)&&n.type===Lc?{field:X(n,{expr:"datum"})}:{}}]}},vye={vgMark:"image",encodeEntry:e=>({...Ui(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...Ks(e,"x"),...Ks(e,"y"),..._A(e,"url")})},bye={vgMark:"line",encodeEntry:e=>({...Ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...$n("x",e,{defaultPos:"mid"}),...$n("y",e,{defaultPos:"mid"}),...Yt("size",e,{vgChannel:"strokeWidth"}),...SA(e)})},wye={vgMark:"trail",encodeEntry:e=>({...Ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...$n("x",e,{defaultPos:"mid"}),...$n("y",e,{defaultPos:"mid"}),...Yt("size",e),...SA(e)})};function zA(e,t){const{config:n}=e;return{...Ui(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...$n("x",e,{defaultPos:"mid"}),...$n("y",e,{defaultPos:"mid"}),...Yt("size",e),...Yt("angle",e),..._ye(e,n,t)}}function _ye(e,t,n){return n?{shape:{value:n}}:Yt("shape",e)}const Eye={vgMark:"symbol",encodeEntry:e=>zA(e)},Sye={vgMark:"symbol",encodeEntry:e=>zA(e,"circle")},kye={vgMark:"symbol",encodeEntry:e=>zA(e,"square")},Aye={vgMark:"rect",encodeEntry:e=>({...Ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Ks(e,"x"),...Ks(e,"y")})},Cye={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:{...Ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...im("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"}),...im("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"}),...Yt("size",e,{vgChannel:"strokeWidth"})}}},$ye={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return{...Ui(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...$n("x",e,{defaultPos:"mid"}),...$n("y",e,{defaultPos:"mid"}),..._A(e),...Yt("size",e,{vgChannel:"fontSize"}),...Yt("angle",e),...yM("align",Tye(e.markDef,n,t)),...yM("baseline",Fye(e.markDef,n,t)),...$n("radius",e,{defaultPos:null}),...$n("theta",e,{defaultPos:null})}}};function Tye(e,t,n){if(We("align",e,n)===void 0)return"center"}function Fye(e,t,n){if(We("baseline",e,n)===void 0)return"middle"}const Mye={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"x":"y",s=i==="horizontal"?"y":"x",a=i==="horizontal"?"height":"width";return{...Ui(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Ks(e,r),...$n(s,e,{defaultPos:"mid",vgChannel:s==="y"?"yc":"xc"}),[a]:et(We("thickness",n,t))}}},Vp={arc:gye,area:mye,bar:yye,circle:Sye,geoshape:xye,image:vye,line:bye,point:Eye,rect:Aye,rule:Cye,square:kye,text:$ye,tick:Mye,trail:wye};function Oye(e){if(ke([K1,Y1,Lde],e.mark)){const t=Z8(e.mark,e.encoding);if(t.length>0)return Nye(e,t)}else if(e.mark===X1){const t=P2.some(n=>We(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return Rye(e)}return BA(e)}const PM="faceted_path_";function Nye(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:PM+e.requestDataName(ot.Main),data:e.requestDataName(ot.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:BA(e,{fromPrefix:PM})}]}const LM="stack_group_";function Rye(e){const[t]=BA(e,{fromPrefix:LM}),n=e.scaleName(e.stack.fieldChannel),i=(l={})=>e.vgField(e.stack.fieldChannel,l),r=(l,c)=>{const f=[i({prefix:"min",suffix:"start",expr:c}),i({prefix:"max",suffix:"start",expr:c}),i({prefix:"min",suffix:"end",expr:c}),i({prefix:"max",suffix:"end",expr:c})];return`${l}(${f.map(h=>`scale('${n}',${h})`).join(",")})`};let s,a;e.stack.fieldChannel==="x"?(s={...tc(t.encode.update,["y","yc","y2","height",...P2]),x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}},a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update={...Vn(t.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(s={...tc(t.encode.update,["x","xc","x2","width"]),y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}},a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update={...Vn(t.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const l of P2){const c=es(l,e.markDef,e.config);t.encode.update[l]?(s[l]=t.encode.update[l],delete t.encode.update[l]):c&&(s[l]=et(c)),c&&(t.encode.update[l]={value:0})}const o=[];if(e.stack.groupbyChannels?.length>0)for(const l of e.stack.groupbyChannels){const c=e.fieldDef(l),f=X(c);f&&o.push(f),(c?.bin||c?.timeUnit)&&o.push(X(c,{binSuffix:"end"}))}return s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((l,c)=>{if(t.encode.update[c])return{...l,[c]:t.encode.update[c]};{const f=es(c,e.markDef,e.config);return f!==void 0?{...l,[c]:et(f)}:l}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(ot.Main),name:LM+e.requestDataName(ot.Main),groupby:o,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:a},marks:[t]}]}]}function Dye(e){const{encoding:t,stack:n,mark:i,markDef:r,config:s}=e,a=t.order;if(!(!L(a)&&hr(a)&&D2(a.value)||!a&&D2(We("order",r,s)))){if((L(a)||W(a))&&!n)return YL(a,{expr:"datum"});if(wo(i)){const o=r.orient==="horizontal"?"y":"x",u=t[o];if(W(u))return{field:o}}}}function BA(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,a=yt(i.clip,Iye(e),Pye(e)),o=HL(i),u=r.key,l=Dye(e),c=Lye(e),f=We("aria",i,s),h=Vp[n].postEncodingTransform?Vp[n].postEncodingTransform(e):null;return[{name:e.getName("marks"),type:Vp[n].vgMark,...a?{clip:a}:{},...o?{style:o}:{},...u?{key:u.field}:{},...l?{sort:l}:{},...c||{},...f===!1?{aria:f}:{},from:{data:t.fromPrefix+e.requestDataName(ot.Main)},encode:{update:Vp[n].encodeEntry(e)},...h?{transform:h}:{}}]}function Iye(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t?.get("selectionExtent")||n?.get("selectionExtent")?!0:void 0}function Pye(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function Lye(e){if(!e.component.selection)return null;const t=j(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=j(i.component.selection).length,i=i.parent;return n?{interactive:t>0||e.mark==="geoshape"||!!e.encoding.tooltip||!!e.markDef.tooltip}:null}class W7 extends B7{constructor(t,n,i,r={},s){super(t,"unit",n,i,s,void 0,KF(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[],this.correctDataNames=l=>(l.from?.data&&(l.from.data=this.lookupDataSource(l.from.data),"time"in this.encoding&&(l.from.data=l.from.data+R9)),l.from?.facet?.data&&(l.from.facet.data=this.lookupDataSource(l.from.facet.data)),l);const a=ts(t.mark)?{...t.mark}:{type:t.mark},o=a.type;a.filled===void 0&&(a.filled=wge(a,s,{graticule:t.data&&bA(t.data)}));const u=this.encoding=kpe(t.encoding||{},o,a.filled,s);this.markDef=b9(a,u,s),this.size=pye({encoding:u,size:KF(t)?{...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}}:r}),this.stack=v9(this.markDef,u),this.specifiedScales=this.initScales(o,u),this.specifiedAxes=this.initAxes(u),this.specifiedLegends=this.initLegends(u),this.specifiedProjection=t.projection,this.selection=(t.params??[]).filter(l=>gA(l))}get hasProjection(){const{encoding:t}=this,n=this.mark===k8,i=t&&yfe.some(r=>ge(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return Mk.reduce((i,r)=>{const s=Ct(n[r]);return s&&(i[r]=this.initScale(s.scale??{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=Ht(t);return L(n)&&(r.domain=n.map(ii)),L(i)&&(r.range=i.map(ii)),r}initAxes(t){return la.reduce((n,i)=>{const r=t[i];if(ge(r)||i===rt&&ge(t.x2)||i===jt&&ge(t.y2)){const s=ge(r)?r.axis:void 0;n[i]=s&&this.initAxis({...s})}return n},{})}initAxis(t){const n=j(t),i={};for(const r of n){const s=t[r];i[r]=Yd(s)?WL(s):ii(s)}return i}initLegends(t){return $fe.reduce((n,i)=>{const r=Ct(t[i]);if(r&&Ffe(i)){const s=r.legend;n[i]=s&&Ht(s)}return n},{})}parseData(){this.component.data=Sy(this)}parseLayoutSize(){Q1e(this)}parseSelections(){this.component.selection=U0e(this,this.selection)}parseMarkGroup(){this.component.mark=Oye(this)}parseAxesAndHeaders(){this.component.axes=aye(this)}assembleSelectionTopLevelSignals(t){return p0e(this,t)}assembleSignals(){return[...a7(this),...h0e(this,[])]}assembleSelectionData(t){return g0e(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return $A(this)}assembleMarks(){let t=this.component.mark??[];return(!this.parent||!qc(this.parent))&&(t=L9(this,t)),t.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return nu(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return dr(n)}typedFieldDef(t){const n=this.fieldDef(t);return Nn(n)?n:null}}class UA extends IA{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const a={...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}};this.children=t.layer.map((o,u)=>{if(ay(o))return new UA(o,this,this.getName(`layer_${u}`),a,s);if(ca(o))return new W7(o,this,this.getName(`layer_${u}`),a,s);throw new Error(Nk(o))})}parseData(){this.component.data=Sy(this);for(const t of this.children)t.parseData()}parseLayoutSize(){X1e(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of j(t.component.selection))this.component.selection[n]=t.component.selection[n]}Object.values(this.component.selection).some(t=>Hr(t))&&Ik(Dk)}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){uye(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),a7(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),$A(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of Q(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return m0e(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),E7(this))}}function jA(e,t,n,i,r){if(Z1(e))return new mh(e,t,n,r);if(ay(e))return new UA(e,t,n,i,r);if(ca(e))return new W7(e,t,n,i,r);if(Xpe(e))return new nye(e,t,n,r);throw new Error(Nk(e))}function zye(e,t={}){t.logger&&Jhe(t.logger),t.fieldTitle&&q8(t.fieldTitle);try{const n=x9(vc(t.config,e.config)),i=C9(e,n),r=jA(i,null,"",void 0,n);return r.parse(),l1e(r.component.data,r),{spec:Uye(r,Bye(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&Zhe(),t.fieldTitle&&mpe()}}function Bye(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):J(t)&&(t={type:t}),r&&s&&n0e(t.type)){if(r==="step"&&s==="step")V(RF()),t.type="pad";else if(r==="step"||s==="step"){const a=r==="step"?"width":"height";V(RF(j1(a)));const o=a==="width"?"height":"width";t.type=i0e(o)}}return{...j(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t},...uM(n,!1),...uM(e,!0)}}function Uye(e,t,n={},i){const r=e.config?lge(e.config):void 0,s=W1e(e.component.data,n),a=e.assembleSelectionData(s),o=e.assembleProjections(),u=e.assembleTitle(),l=e.assembleGroupStyle(),c=e.assembleGroupEncodeEntry(!0);let f=e.assembleLayoutSignals();f=f.filter(p=>(p.name==="width"||p.name==="height")&&p.value!==void 0?(t[p.name]=+p.value,!1):!0);const{params:h,...d}=t;return{$schema:"https://vega.github.io/schema/vega/v5.json",...e.description?{description:e.description}:{},...d,...u?{title:u}:{},...l?{style:l}:{},...c?{encode:{update:c}}:{},data:a,...o.length>0?{projections:o}:{},...e.assembleGroup([...f,...e.assembleSelectionTopLevelSignals([]),...p9(h)]),...r?{config:r}:{},...i?{usermeta:i}:{}}}const jye=ffe.version,qye=Object.freeze(Object.defineProperty({__proto__:null,accessPathDepth:ic,accessPathWithDatum:Ek,accessWithDatumToUnescapedPath:je,compile:zye,contains:ke,deepEqual:ai,deleteNestedProperty:G0,duplicate:de,entries:Ja,every:bk,fieldIntersection:_k,flatAccessWithDatum:AL,getFirstDefined:yt,hasIntersection:wk,hasProperty:q,hash:Ae,internalField:TL,isBoolean:Vh,isEmpty:He,isEqual:dfe,isInternalField:FL,isNullOrFalse:D2,isNumeric:I1,keys:j,logicalExpr:ph,mergeDeep:SL,never:EL,normalize:C9,normalizeAngle:Wh,omit:Vn,pick:tc,prefixGenerator:I2,removePathFromField:Ic,replaceAll:xu,replacePathInField:Ii,resetIdCounter:gfe,setEqual:kL,some:nc,stringify:Ge,titleCase:Pd,unique:Br,uniqueId:$L,vals:Jt,varName:it,version:jye},Symbol.toStringTag,{value:"Module"}));function H7(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var Vye="2.15.0",Wye={version:Vye};const ol="#fff",zM="#888",Hye={background:"#333",view:{stroke:zM},title:{color:ol,subtitleColor:ol},style:{"guide-label":{fill:ol},"guide-title":{fill:ol}},axis:{domainColor:ol,gridColor:zM,tickColor:ol}},Mo="#4572a7",Gye={background:"#fff",arc:{fill:Mo},area:{fill:Mo},line:{stroke:Mo,strokeWidth:2},path:{stroke:Mo},rect:{fill:Mo},shape:{stroke:Mo},symbol:{fill:Mo,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Oo="#30a2da",gv="#cbcbcb",Yye="#999",Xye="#333",BM="#f0f0f0",UM="#333",Kye={arc:{fill:Oo},area:{fill:Oo},axis:{domainColor:gv,grid:!0,gridColor:gv,gridWidth:1,labelColor:Yye,labelFontSize:10,titleColor:Xye,tickColor:gv,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:BM,group:{fill:BM},legend:{labelColor:UM,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:UM,titleFontSize:14,titlePadding:10},line:{stroke:Oo,strokeWidth:2},path:{stroke:Oo,strokeWidth:.5},rect:{fill:Oo},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Oo},bar:{binSpacing:2,fill:Oo,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},No="#000",Qye={group:{fill:"#e5e5e5"},arc:{fill:No},area:{fill:No},line:{stroke:No},path:{stroke:No},rect:{fill:No},shape:{stroke:No},symbol:{fill:No,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Jye=22,Zye="normal",jM="Benton Gothic, sans-serif",qM=11.5,exe="normal",Ro="#82c6df",mv="Benton Gothic Bold, sans-serif",VM="normal",WM=13,Af={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"]},txe={background:"#ffffff",title:{anchor:"start",color:"#000000",font:mv,fontSize:Jye,fontWeight:Zye},arc:{fill:Ro},area:{fill:Ro},line:{stroke:Ro,strokeWidth:2},path:{stroke:Ro},rect:{fill:Ro},shape:{stroke:Ro},symbol:{fill:Ro,size:30},axis:{labelFont:jM,labelFontSize:qM,labelFontWeight:exe,titleFont:mv,titleFontSize:WM,titleFontWeight:VM},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:jM,labelFontSize:qM,symbolType:"square",titleFont:mv,titleFontSize:WM,titleFontWeight:VM},range:{category:Af["category-6"],diverging:Af["fireandice-6"],heatmap:Af["fire-7"],ordinal:Af["fire-7"],ramp:Af["fire-7"]}},Do="#ab5787",Wp="#979797",nxe={background:"#f9f9f9",arc:{fill:Do},area:{fill:Do},line:{stroke:Do},path:{stroke:Do},rect:{fill:Do},shape:{stroke:Do},symbol:{fill:Do,size:30},axis:{domainColor:Wp,domainWidth:.5,gridWidth:.2,labelColor:Wp,tickColor:Wp,tickWidth:.2,titleColor:Wp},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},Io="#3e5c69",ixe={background:"#fff",arc:{fill:Io},area:{fill:Io},line:{stroke:Io},path:{stroke:Io},rect:{fill:Io},shape:{stroke:Io},symbol:{fill:Io},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},xi="#1696d2",HM="#000000",rxe="#FFFFFF",Hp="Lato",yv="Lato",sxe="Lato",axe="#DEDDDD",oxe=18,Cf={"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},uxe={background:rxe,title:{anchor:"start",fontSize:oxe,font:Hp},axisX:{domain:!0,domainColor:HM,domainWidth:1,grid:!1,labelFontSize:12,labelFont:yv,labelAngle:0,tickColor:HM,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:Hp},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:axe,gridWidth:1,labelFontSize:12,labelFont:yv,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:Hp,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:yv,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:Hp,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Cf["six-groups-cat-1"],diverging:Cf["diverging-colors"],heatmap:Cf["diverging-colors"],ordinal:Cf["six-groups-seq"],ramp:Cf["shades-blue"]},area:{fill:xi},rect:{fill:xi},line:{color:xi,stroke:xi,strokeWidth:5},trail:{color:xi,stroke:xi,strokeWidth:0,size:1},path:{stroke:xi,strokeWidth:.5},point:{filled:!0},text:{font:sxe,color:xi,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:xi,stroke:null}},arc:{fill:xi},shape:{stroke:xi},symbol:{fill:xi,size:30}},Po="#3366CC",GM="#ccc",Gp="Arial, sans-serif",lxe={arc:{fill:Po},area:{fill:Po},path:{stroke:Po},rect:{fill:Po},shape:{stroke:Po},symbol:{stroke:Po},circle:{fill:Po},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:Gp,fontSize:12},"guide-title":{font:Gp,fontSize:12},"group-title":{font:Gp,fontSize:12}},title:{font:Gp,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:GM,tickColor:GM,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},qA=e=>e*(1/3+1),YM=qA(9),XM=qA(10),KM=qA(12),$f="Segoe UI",QM="wf_standard-font, helvetica, arial, sans-serif",JM="#252423",Tf="#605E5C",ZM="transparent",cxe="#C8C6C4",Hi="#118DFF",fxe="#12239E",hxe="#E66C37",dxe="#6B007B",pxe="#E044A7",gxe="#744EC2",mxe="#D9B300",yxe="#D64550",G7=Hi,Y7="#DEEFFF",eO=[Y7,G7],xxe=[Y7,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",G7],vxe={view:{stroke:ZM},background:ZM,font:$f,header:{titleFont:QM,titleFontSize:KM,titleColor:JM,labelFont:$f,labelFontSize:XM,labelColor:Tf},axis:{ticks:!1,grid:!1,domain:!1,labelColor:Tf,labelFontSize:YM,titleFont:QM,titleColor:JM,titleFontSize:KM,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:cxe,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:Hi},line:{stroke:Hi,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:$f,fontSize:YM,fill:Tf},arc:{fill:Hi},area:{fill:Hi,line:!0,opacity:.6},path:{stroke:Hi},rect:{fill:Hi},point:{fill:Hi,filled:!0,size:75},shape:{stroke:Hi},symbol:{fill:Hi,strokeWidth:1.5,size:50},legend:{titleFont:$f,titleFontWeight:"bold",titleColor:Tf,labelFont:$f,labelFontSize:XM,labelColor:Tf,symbolType:"circle",symbolSize:75},range:{category:[Hi,fxe,hxe,dxe,pxe,gxe,mxe,yxe],diverging:eO,heatmap:eO,ordinal:xxe}},xv='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',bxe='IBM Plex Sans Condensed, system-ui, -apple-system, BlinkMacSystemFont, ".SFNSText-Regular", sans-serif',vv=400,Yp={textPrimary:{g90:"#f4f4f4",g100:"#f4f4f4",white:"#161616",g10:"#161616"},textSecondary:{g90:"#c6c6c6",g100:"#c6c6c6",white:"#525252",g10:"#525252"},layerAccent01:{white:"#e0e0e0",g10:"#e0e0e0",g90:"#525252",g100:"#393939"},gridBg:{white:"#ffffff",g10:"#ffffff",g90:"#161616",g100:"#161616"}},wxe=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],_xe=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function ky({theme:e,background:t}){const n=["white","g10"].includes(e)?"light":"dark",i=Yp.gridBg[e],r=Yp.textPrimary[e],s=Yp.textSecondary[e],a=n==="dark"?wxe:_xe,o=n==="dark"?"#d4bbff":"#6929c4";return{background:t,arc:{fill:o},area:{fill:o},path:{stroke:o},rect:{fill:o},shape:{stroke:o},symbol:{stroke:o},circle:{fill:o},view:{fill:i,stroke:i},group:{fill:i},title:{color:r,anchor:"start",dy:-15,fontSize:16,font:xv,fontWeight:600},axis:{labelColor:s,labelFontSize:12,labelFont:bxe,labelFontWeight:vv,titleColor:r,titleFontWeight:600,titleFontSize:12,grid:!0,gridColor:Yp.layerAccent01[e],labelAngle:0},axisX:{titlePadding:10},axisY:{titlePadding:2.5},style:{"guide-label":{font:xv,fill:s,fontWeight:vv},"guide-title":{font:xv,fill:s,fontWeight:vv}},range:{category:a,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const Exe=ky({theme:"white",background:"#ffffff"}),Sxe=ky({theme:"g10",background:"#f4f4f4"}),kxe=ky({theme:"g90",background:"#262626"}),Axe=ky({theme:"g100",background:"#161616"}),Cxe=Wye.version,$xe=Object.freeze(Object.defineProperty({__proto__:null,carbong10:Sxe,carbong100:Axe,carbong90:kxe,carbonwhite:Exe,dark:Hye,excel:Gye,fivethirtyeight:Kye,ggplot2:Qye,googlecharts:lxe,latimes:txe,powerbi:vxe,quartz:nxe,urbaninstitute:uxe,version:Cxe,vox:ixe},Symbol.toStringTag,{value:"Module"}));function Txe(e,t,n,i){if(L(e))return`[${e.map(r=>t(J(r)?r:tO(r,n))).join(", ")}]`;if(K(e)){let r="";const{title:s,image:a,...o}=e;s&&(r+=`<h2>${t(s)}</h2>`),a&&(r+=`<img src="${new URL(t(a),i||location.href).href}">`);const u=Object.keys(o);if(u.length>0){r+="<table>";for(const l of u){let c=o[l];c!==void 0&&(K(c)&&(c=tO(c,n)),r+=`<tr><td class="key">${t(l)}</td><td class="value">${t(c)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function Fxe(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function tO(e,t){return JSON.stringify(e,Fxe(t))}var Mxe=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black;
}
#vg-tooltip-element.visible {
  visibility: visible;
}
#vg-tooltip-element h2 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 13px;
}
#vg-tooltip-element table {
  border-spacing: 0;
}
#vg-tooltip-element table tr {
  border: none;
}
#vg-tooltip-element table tr td {
  overflow: hidden;
  text-overflow: ellipsis;
  padding-top: 2px;
  padding-bottom: 2px;
}
#vg-tooltip-element table tr td.key {
  color: #808080;
  max-width: 150px;
  text-align: right;
  padding-right: 4px;
}
#vg-tooltip-element table tr td.value {
  display: block;
  max-width: 300px;
  max-height: 7em;
  text-align: left;
}
#vg-tooltip-element.dark-theme {
  background-color: rgba(32, 32, 32, 0.9);
  border: 1px solid #f5f5f5;
  color: white;
}
#vg-tooltip-element.dark-theme td.key {
  color: #bfbfbf;
}
`;const X7="vg-tooltip-element",Oxe={offsetX:10,offsetY:10,id:X7,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:Nxe,maxDepth:2,formatTooltip:Txe,baseURL:"",anchor:"cursor",position:["top","bottom","left","right","top-left","top-right","bottom-left","bottom-right"]};function Nxe(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function Rxe(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return Mxe.toString().replace(X7,e)}function K7(e,t,{offsetX:n,offsetY:i}){const r=Q7({x1:e.clientX,x2:e.clientX,y1:e.clientY,y2:e.clientY},t,n,i),s=["bottom-right","bottom-left","top-right","top-left"];for(const a of s)if(J7(r[a],t))return r[a];return r["top-left"]}function Dxe(e,t,n,i,r){const{position:s,offsetX:a,offsetY:o}=r,u=e._el.getBoundingClientRect(),l=e._origin,c=Ixe(u,l,n),f=Q7(c,i,a,o),h=Array.isArray(s)?s:[s];for(const d of h)if(J7(f[d],i)&&!Pxe(t,f[d],i))return f[d];return K7(t,i,r)}function Ixe(e,t,n){const i=n.isVoronoi?n.datum.bounds:n.bounds;let r=e.left+t[0]+i.x1,s=e.top+t[1]+i.y1,a=n;for(;a.mark.group;)a=a.mark.group,r+=a.x??0,s+=a.y??0;const o=i.x2-i.x1,u=i.y2-i.y1;return{x1:r,x2:r+o,y1:s,y2:s+u}}function Q7(e,t,n,i){const r=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,a=e.x1-t.width-n,o=r-t.width/2,u=e.x2+n,l=e.y1-t.height-i,c=s-t.height/2,f=e.y2+i;return{top:{x:o,y:l},bottom:{x:o,y:f},left:{x:a,y:c},right:{x:u,y:c},"top-left":{x:a,y:l},"top-right":{x:u,y:l},"bottom-left":{x:a,y:f},"bottom-right":{x:u,y:f}}}function J7(e,t){return e.x>=0&&e.y>=0&&e.x+t.width<=window.innerWidth&&e.y+t.height<=window.innerHeight}function Pxe(e,t,n){return e.clientX>=t.x&&e.clientX<=t.x+n.width&&e.clientY>=t.y&&e.clientY<=t.y+n.height}class Lxe{constructor(t){this.options={...Oxe,...t};const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=Rxe(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(t,n,i,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),(document.fullscreenElement??document.body).appendChild(this.el)),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(r,this.options.sanitize,this.options.maxDepth,this.options.baseURL),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:s,y:a}=this.options.anchor==="mark"?Dxe(t,n,i,this.el.getBoundingClientRect(),this.options):K7(n,this.el.getBoundingClientRect(),this.options);this.el.style.top=`${a}px`,this.el.style.left=`${s}px`}}var bv={};/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var zxe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),Bxe=Object.prototype.hasOwnProperty;function lw(e,t){return Bxe.call(e,t)}function cw(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var i=[];for(var r in e)lw(e,r)&&i.push(r);return i}function oi(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function fw(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function Bo(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Z7(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function hw(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(hw(e[t]))return!0}else if(typeof e=="object"){for(var i=cw(e),r=i.length,s=0;s<r;s++)if(hw(e[i[s]]))return!0}}return!1}function nO(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r<"u"&&n.push(i+": "+r)}return n.join(`
`)}var ez=function(e){zxe(t,e);function t(n,i,r,s,a){var o=this.constructor,u=e.call(this,nO(n,{name:i,index:r,operation:s,tree:a}))||this;return u.name=i,u.index=r,u.operation=s,u.tree=a,Object.setPrototypeOf(u,o.prototype),u.message=nO(n,{name:i,index:r,operation:s,tree:a}),u}return t}(Error),lt=ez,Uxe=oi,wl={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=om(n,this.path);i&&(i=oi(i));var r=su(n,{op:"remove",path:this.from}).removed;return su(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=om(n,this.from);return su(n,{op:"add",path:this.path,value:oi(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Kh(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},jxe={add:function(e,t,n){return fw(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:wl.move,copy:wl.copy,test:wl.test,_get:wl._get};function om(e,t){if(t=="")return e;var n={op:"_get",path:t};return su(e,n),n.value}function su(e,t,n,i,r,s){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):um(t,0)),t.path===""){var a={newDocument:e};if(t.op==="add")return a.newDocument=t.value,a;if(t.op==="replace")return a.newDocument=t.value,a.removed=e,a;if(t.op==="move"||t.op==="copy")return a.newDocument=om(e,t.from),t.op==="move"&&(a.removed=e),a;if(t.op==="test"){if(a.test=Kh(e,t.value),a.test===!1)throw new lt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return a.newDocument=e,a}else{if(t.op==="remove")return a.removed=e,a.newDocument=null,a;if(t.op==="_get")return t.value=e,a;if(n)throw new lt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return a}}else{i||(e=oi(e));var o=t.path||"",u=o.split("/"),l=e,c=1,f=u.length,h=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=um;;){if(d=u[c],d&&d.indexOf("~")!=-1&&(d=Z7(d)),r&&(d=="__proto__"||d=="prototype"&&c>0&&u[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&h===void 0&&(l[d]===void 0?h=u.slice(0,c).join("/"):c==f-1&&(h=t.path),h!==void 0&&p(t,0,e,h)),c++,Array.isArray(l)){if(d==="-")d=l.length;else{if(n&&!fw(d))throw new lt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);fw(d)&&(d=~~d)}if(c>=f){if(n&&t.op==="add"&&d>l.length)throw new lt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var a=jxe[t.op].call(t,l,d,e);if(a.test===!1)throw new lt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return a}}else if(c>=f){var a=wl[t.op].call(t,l,d,e);if(a.test===!1)throw new lt("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return a}if(l=l[d],n&&c<f&&(!l||typeof l!="object"))throw new lt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Ay(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new lt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=oi(e));for(var s=new Array(t.length),a=0,o=t.length;a<o;a++)s[a]=su(e,t[a],n,!0,r,a),e=s[a].newDocument;return s.newDocument=e,s}function qxe(e,t,n){var i=su(e,t);if(i.test===!1)throw new lt("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function um(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new lt("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(wl[e.op]){if(typeof e.path!="string")throw new lt("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new lt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new lt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new lt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&hw(e.value))throw new lt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new lt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new lt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var a={op:"_get",path:e.from,value:void 0},o=tz([a],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new lt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new lt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function tz(e,t,n){try{if(!Array.isArray(e))throw new lt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Ay(oi(t),oi(e),n||!0);else{n=n||um;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof lt)return r;throw r}}function Kh(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,s,a;if(n&&i){if(s=e.length,s!=t.length)return!1;for(r=s;r--!==0;)if(!Kh(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var o=Object.keys(e);if(s=o.length,s!==Object.keys(t).length)return!1;for(r=s;r--!==0;)if(!t.hasOwnProperty(o[r]))return!1;for(r=s;r--!==0;)if(a=o[r],!Kh(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}var Vxe=Object.freeze({__proto__:null,JsonPatchError:lt,_areEquals:Kh,applyOperation:su,applyPatch:Ay,applyReducer:qxe,deepClone:Uxe,getValueByPointer:om,validate:tz,validator:um});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var VA=new WeakMap,Wxe=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),Hxe=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function Gxe(e){return VA.get(e)}function Yxe(e,t){return e.observers.get(t)}function Xxe(e,t){e.observers.delete(t.callback)}function Kxe(e,t){t.unobserve()}function Qxe(e,t){var n=[],i,r=Gxe(e);if(!r)r=new Wxe(e),VA.set(e,r);else{var s=Yxe(r,t);i=s&&s.observer}if(i)return i;if(i={},r.value=oi(e),t){i.callback=t,i.next=null;var a=function(){dw(i)},o=function(){clearTimeout(i.next),i.next=setTimeout(a)};typeof window<"u"&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return i.patches=n,i.object=e,i.unobserve=function(){dw(i),clearTimeout(i.next),Xxe(r,i),typeof window<"u"&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new Hxe(t,i)),i}function dw(e,t){t===void 0&&(t=!1);var n=VA.get(e.object);WA(n.value,e.object,e.patches,"",t),e.patches.length&&Ay(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function WA(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=cw(t),a=cw(e),o=!1,u=a.length-1;u>=0;u--){var l=a[u],c=e[l];if(lw(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null&&Array.isArray(c)===Array.isArray(f)?WA(c,f,n,i+"/"+Bo(l),r):c!==f&&(r&&n.push({op:"test",path:i+"/"+Bo(l),value:oi(c)}),n.push({op:"replace",path:i+"/"+Bo(l),value:oi(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+Bo(l),value:oi(c)}),n.push({op:"remove",path:i+"/"+Bo(l)}),o=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!o&&s.length==a.length))for(var u=0;u<s.length;u++){var l=s[u];!lw(e,l)&&t[l]!==void 0&&n.push({op:"add",path:i+"/"+Bo(l),value:oi(t[l])})}}}function Jxe(e,t,n){n===void 0&&(n=!1);var i=[];return WA(e,t,i,"",n),i}var Zxe=Object.freeze({__proto__:null,compare:Jxe,generate:dw,observe:Qxe,unobserve:Kxe});Object.assign({},Vxe,Zxe,{JsonPatchError:ez,deepClone:oi,escapePathComponent:Bo,unescapePathComponent:Z7});function eve(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var wv,iO;function tve(){if(iO)return wv;iO=1;class e{constructor(){this.max=1e3,this.map=new Map}get(n){const i=this.map.get(n);if(i!==void 0)return this.map.delete(n),this.map.set(n,i),i}delete(n){return this.map.delete(n)}set(n,i){if(!this.delete(n)&&i!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(n,i)}return this}}return wv=e,wv}var _v,rO;function HA(){if(rO)return _v;rO=1;const e=Object.freeze({loose:!0}),t=Object.freeze({});return _v=i=>i?typeof i!="object"?e:i:t,_v}var Xp={exports:{}},Ev,sO;function GA(){if(sO)return Ev;sO=1;const e="2.0.0",t=256,n=Number.MAX_SAFE_INTEGER||9007199254740991,i=16,r=t-6;return Ev={MAX_LENGTH:t,MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:r,MAX_SAFE_INTEGER:n,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:e,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Ev}var Sv,aO;function Cy(){return aO||(aO=1,Sv=typeof process=="object"&&bv&&bv.NODE_DEBUG&&/\bsemver\b/i.test(bv.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{}),Sv}var oO;function YA(){return oO||(oO=1,function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:r}=GA(),s=Cy();t=e.exports={};const a=t.re=[],o=t.safeRe=[],u=t.src=[],l=t.t={};let c=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",r],[f,i]],d=g=>{for(const[m,y]of h)g=g.split(`${m}*`).join(`${m}{0,${y}}`).split(`${m}+`).join(`${m}{1,${y}}`);return g},p=(g,m,y)=>{const x=d(m),v=c++;s(g,v,m),l[g]=v,u[v]=m,a[v]=new RegExp(m,y?"g":void 0),o[v]=new RegExp(x,y?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),p("MAINVERSION",`(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${u[l.NUMERICIDENTIFIER]}|${u[l.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${u[l.NUMERICIDENTIFIERLOOSE]}|${u[l.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${u[l.PRERELEASEIDENTIFIER]}(?:\\.${u[l.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${u[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[l.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${f}+`),p("BUILD",`(?:\\+(${u[l.BUILDIDENTIFIER]}(?:\\.${u[l.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${u[l.MAINVERSION]}${u[l.PRERELEASE]}?${u[l.BUILD]}?`),p("FULL",`^${u[l.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${u[l.MAINVERSIONLOOSE]}${u[l.PRERELEASELOOSE]}?${u[l.BUILD]}?`),p("LOOSE",`^${u[l.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${u[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${u[l.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:${u[l.PRERELEASE]})?${u[l.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:${u[l.PRERELEASELOOSE]})?${u[l.BUILD]}?)?)?`),p("XRANGE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),p("COERCE",`${u[l.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",u[l.COERCEPLAIN]+`(?:${u[l.PRERELEASE]})?(?:${u[l.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",u[l.COERCE],!0),p("COERCERTLFULL",u[l.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${u[l.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",p("TILDE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${u[l.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",p("CARET",`^${u[l.LONECARET]}${u[l.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${u[l.LONECARET]}${u[l.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${u[l.GTLT]}\\s*(${u[l.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]}|${u[l.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${u[l.XRANGEPLAIN]})\\s+-\\s+(${u[l.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${u[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[l.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Xp,Xp.exports)),Xp.exports}var kv,uO;function nve(){if(uO)return kv;uO=1;const e=/^[0-9]+$/,t=(i,r)=>{const s=e.test(i),a=e.test(r);return s&&a&&(i=+i,r=+r),i===r?0:s&&!a?-1:a&&!s?1:i<r?-1:1};return kv={compareIdentifiers:t,rcompareIdentifiers:(i,r)=>t(r,i)},kv}var Av,lO;function XA(){if(lO)return Av;lO=1;const e=Cy(),{MAX_LENGTH:t,MAX_SAFE_INTEGER:n}=GA(),{safeRe:i,t:r}=YA(),s=HA(),{compareIdentifiers:a}=nve();class o{constructor(l,c){if(c=s(c),l instanceof o){if(l.loose===!!c.loose&&l.includePrerelease===!!c.includePrerelease)return l;l=l.version}else if(typeof l!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof l}".`);if(l.length>t)throw new TypeError(`version is longer than ${t} characters`);e("SemVer",l,c),this.options=c,this.loose=!!c.loose,this.includePrerelease=!!c.includePrerelease;const f=l.trim().match(c.loose?i[r.LOOSE]:i[r.FULL]);if(!f)throw new TypeError(`Invalid Version: ${l}`);if(this.raw=l,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>n||this.major<0)throw new TypeError("Invalid major version");if(this.minor>n||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>n||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(h=>{if(/^[0-9]+$/.test(h)){const d=+h;if(d>=0&&d<n)return d}return h}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(l){if(e("SemVer.compare",this.version,this.options,l),!(l instanceof o)){if(typeof l=="string"&&l===this.version)return 0;l=new o(l,this.options)}return l.version===this.version?0:this.compareMain(l)||this.comparePre(l)}compareMain(l){return l instanceof o||(l=new o(l,this.options)),a(this.major,l.major)||a(this.minor,l.minor)||a(this.patch,l.patch)}comparePre(l){if(l instanceof o||(l=new o(l,this.options)),this.prerelease.length&&!l.prerelease.length)return-1;if(!this.prerelease.length&&l.prerelease.length)return 1;if(!this.prerelease.length&&!l.prerelease.length)return 0;let c=0;do{const f=this.prerelease[c],h=l.prerelease[c];if(e("prerelease compare",c,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return a(f,h)}while(++c)}compareBuild(l){l instanceof o||(l=new o(l,this.options));let c=0;do{const f=this.build[c],h=l.build[c];if(e("build compare",c,f,h),f===void 0&&h===void 0)return 0;if(h===void 0)return 1;if(f===void 0)return-1;if(f===h)continue;return a(f,h)}while(++c)}inc(l,c,f){switch(l){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",c,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",c,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",c,f),this.inc("pre",c,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",c,f),this.inc("pre",c,f);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const h=Number(f)?1:0;if(!c&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[h];else{let d=this.prerelease.length;for(;--d>=0;)typeof this.prerelease[d]=="number"&&(this.prerelease[d]++,d=-2);if(d===-1){if(c===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(h)}}if(c){let d=[c,h];f===!1&&(d=[c]),a(this.prerelease[0],c)===0?isNaN(this.prerelease[1])&&(this.prerelease=d):this.prerelease=d}break}default:throw new Error(`invalid increment argument: ${l}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Av=o,Av}var Cv,cO;function Vc(){if(cO)return Cv;cO=1;const e=XA();return Cv=(n,i,r)=>new e(n,r).compare(new e(i,r)),Cv}var $v,fO;function ive(){if(fO)return $v;fO=1;const e=Vc();return $v=(n,i,r)=>e(n,i,r)===0,$v}var Tv,hO;function rve(){if(hO)return Tv;hO=1;const e=Vc();return Tv=(n,i,r)=>e(n,i,r)!==0,Tv}var Fv,dO;function sve(){if(dO)return Fv;dO=1;const e=Vc();return Fv=(n,i,r)=>e(n,i,r)>0,Fv}var Mv,pO;function ave(){if(pO)return Mv;pO=1;const e=Vc();return Mv=(n,i,r)=>e(n,i,r)>=0,Mv}var Ov,gO;function ove(){if(gO)return Ov;gO=1;const e=Vc();return Ov=(n,i,r)=>e(n,i,r)<0,Ov}var Nv,mO;function uve(){if(mO)return Nv;mO=1;const e=Vc();return Nv=(n,i,r)=>e(n,i,r)<=0,Nv}var Rv,yO;function lve(){if(yO)return Rv;yO=1;const e=ive(),t=rve(),n=sve(),i=ave(),r=ove(),s=uve();return Rv=(o,u,l,c)=>{switch(u){case"===":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o===l;case"!==":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o!==l;case"":case"=":case"==":return e(o,l,c);case"!=":return t(o,l,c);case">":return n(o,l,c);case">=":return i(o,l,c);case"<":return r(o,l,c);case"<=":return s(o,l,c);default:throw new TypeError(`Invalid operator: ${u}`)}},Rv}var Dv,xO;function cve(){if(xO)return Dv;xO=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(c,f){if(f=n(f),c instanceof t){if(c.loose===!!f.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),a("comparator",c,f),this.options=f,this.loose=!!f.loose,this.parse(c),this.semver===e?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(c){const f=this.options.loose?i[r.COMPARATORLOOSE]:i[r.COMPARATOR],h=c.match(f);if(!h)throw new TypeError(`Invalid comparator: ${c}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new o(h[2],this.options.loose):this.semver=e}toString(){return this.value}test(c){if(a("Comparator.test",c,this.options.loose),this.semver===e||c===e)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return s(c,this.operator,this.semver,this.options)}intersects(c,f){if(!(c instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(c.value,f).test(this.value):c.operator===""?c.value===""?!0:new u(this.value,f).test(c.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||s(this.semver,"<",c.semver,f)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||s(this.semver,">",c.semver,f)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}Dv=t;const n=HA(),{safeRe:i,t:r}=YA(),s=lve(),a=Cy(),o=XA(),u=nz();return Dv}var Iv,vO;function nz(){if(vO)return Iv;vO=1;const e=/\s+/g;class t{constructor(C,M){if(M=r(M),C instanceof t)return C.loose===!!M.loose&&C.includePrerelease===!!M.includePrerelease?C:new t(C.raw,M);if(C instanceof s)return this.raw=C.value,this.set=[[C]],this.formatted=void 0,this;if(this.options=M,this.loose=!!M.loose,this.includePrerelease=!!M.includePrerelease,this.raw=C.trim().replace(e," "),this.set=this.raw.split("||").map(D=>this.parseRange(D.trim())).filter(D=>D.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const D=this.set[0];if(this.set=this.set.filter(B=>!g(B[0])),this.set.length===0)this.set=[D];else if(this.set.length>1){for(const B of this.set)if(B.length===1&&m(B[0])){this.set=[B];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let C=0;C<this.set.length;C++){C>0&&(this.formatted+="||");const M=this.set[C];for(let D=0;D<M.length;D++)D>0&&(this.formatted+=" "),this.formatted+=M[D].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(C){const D=((this.options.includePrerelease&&d)|(this.options.loose&&p))+":"+C,B=i.get(D);if(B)return B;const z=this.options.loose,ee=z?u[l.HYPHENRANGELOOSE]:u[l.HYPHENRANGE];C=C.replace(ee,R(this.options.includePrerelease)),a("hyphen replace",C),C=C.replace(u[l.COMPARATORTRIM],c),a("comparator trim",C),C=C.replace(u[l.TILDETRIM],f),a("tilde trim",C),C=C.replace(u[l.CARETTRIM],h),a("caret trim",C);let he=C.split(" ").map(ye=>x(ye,this.options)).join(" ").split(/\s+/).map(ye=>$(ye,this.options));z&&(he=he.filter(ye=>(a("loose invalid filter",ye,this.options),!!ye.match(u[l.COMPARATORLOOSE])))),a("range list",he);const le=new Map,me=he.map(ye=>new s(ye,this.options));for(const ye of me){if(g(ye))return[ye];le.set(ye.value,ye)}le.size>1&&le.has("")&&le.delete("");const Xe=[...le.values()];return i.set(D,Xe),Xe}intersects(C,M){if(!(C instanceof t))throw new TypeError("a Range is required");return this.set.some(D=>y(D,M)&&C.set.some(B=>y(B,M)&&D.every(z=>B.every(ee=>z.intersects(ee,M)))))}test(C){if(!C)return!1;if(typeof C=="string")try{C=new o(C,this.options)}catch{return!1}for(let M=0;M<this.set.length;M++)if(O(this.set[M],C,this.options))return!0;return!1}}Iv=t;const n=tve(),i=new n,r=HA(),s=cve(),a=Cy(),o=XA(),{safeRe:u,t:l,comparatorTrimReplace:c,tildeTrimReplace:f,caretTrimReplace:h}=YA(),{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:p}=GA(),g=F=>F.value==="<0.0.0-0",m=F=>F.value==="",y=(F,C)=>{let M=!0;const D=F.slice();let B=D.pop();for(;M&&D.length;)M=D.every(z=>B.intersects(z,C)),B=D.pop();return M},x=(F,C)=>(a("comp",F,C),F=E(F,C),a("caret",F),F=b(F,C),a("tildes",F),F=k(F,C),a("xrange",F),F=T(F,C),a("stars",F),F),v=F=>!F||F.toLowerCase()==="x"||F==="*",b=(F,C)=>F.trim().split(/\s+/).map(M=>w(M,C)).join(" "),w=(F,C)=>{const M=C.loose?u[l.TILDELOOSE]:u[l.TILDE];return F.replace(M,(D,B,z,ee,he)=>{a("tilde",F,D,B,z,ee,he);let le;return v(B)?le="":v(z)?le=`>=${B}.0.0 <${+B+1}.0.0-0`:v(ee)?le=`>=${B}.${z}.0 <${B}.${+z+1}.0-0`:he?(a("replaceTilde pr",he),le=`>=${B}.${z}.${ee}-${he} <${B}.${+z+1}.0-0`):le=`>=${B}.${z}.${ee} <${B}.${+z+1}.0-0`,a("tilde return",le),le})},E=(F,C)=>F.trim().split(/\s+/).map(M=>_(M,C)).join(" "),_=(F,C)=>{a("caret",F,C);const M=C.loose?u[l.CARETLOOSE]:u[l.CARET],D=C.includePrerelease?"-0":"";return F.replace(M,(B,z,ee,he,le)=>{a("caret",F,B,z,ee,he,le);let me;return v(z)?me="":v(ee)?me=`>=${z}.0.0${D} <${+z+1}.0.0-0`:v(he)?z==="0"?me=`>=${z}.${ee}.0${D} <${z}.${+ee+1}.0-0`:me=`>=${z}.${ee}.0${D} <${+z+1}.0.0-0`:le?(a("replaceCaret pr",le),z==="0"?ee==="0"?me=`>=${z}.${ee}.${he}-${le} <${z}.${ee}.${+he+1}-0`:me=`>=${z}.${ee}.${he}-${le} <${z}.${+ee+1}.0-0`:me=`>=${z}.${ee}.${he}-${le} <${+z+1}.0.0-0`):(a("no pr"),z==="0"?ee==="0"?me=`>=${z}.${ee}.${he}${D} <${z}.${ee}.${+he+1}-0`:me=`>=${z}.${ee}.${he}${D} <${z}.${+ee+1}.0-0`:me=`>=${z}.${ee}.${he} <${+z+1}.0.0-0`),a("caret return",me),me})},k=(F,C)=>(a("replaceXRanges",F,C),F.split(/\s+/).map(M=>A(M,C)).join(" ")),A=(F,C)=>{F=F.trim();const M=C.loose?u[l.XRANGELOOSE]:u[l.XRANGE];return F.replace(M,(D,B,z,ee,he,le)=>{a("xRange",F,D,B,z,ee,he,le);const me=v(z),Xe=me||v(ee),ye=Xe||v(he),nn=ye;return B==="="&&nn&&(B=""),le=C.includePrerelease?"-0":"",me?B===">"||B==="<"?D="<0.0.0-0":D="*":B&&nn?(Xe&&(ee=0),he=0,B===">"?(B=">=",Xe?(z=+z+1,ee=0,he=0):(ee=+ee+1,he=0)):B==="<="&&(B="<",Xe?z=+z+1:ee=+ee+1),B==="<"&&(le="-0"),D=`${B+z}.${ee}.${he}${le}`):Xe?D=`>=${z}.0.0${le} <${+z+1}.0.0-0`:ye&&(D=`>=${z}.${ee}.0${le} <${z}.${+ee+1}.0-0`),a("xRange return",D),D})},T=(F,C)=>(a("replaceStars",F,C),F.trim().replace(u[l.STAR],"")),$=(F,C)=>(a("replaceGTE0",F,C),F.trim().replace(u[C.includePrerelease?l.GTE0PRE:l.GTE0],"")),R=F=>(C,M,D,B,z,ee,he,le,me,Xe,ye,nn)=>(v(D)?M="":v(B)?M=`>=${D}.0.0${F?"-0":""}`:v(z)?M=`>=${D}.${B}.0${F?"-0":""}`:ee?M=`>=${M}`:M=`>=${M}${F?"-0":""}`,v(me)?le="":v(Xe)?le=`<${+me+1}.0.0-0`:v(ye)?le=`<${me}.${+Xe+1}.0-0`:nn?le=`<=${me}.${Xe}.${ye}-${nn}`:F?le=`<${me}.${Xe}.${+ye+1}-0`:le=`<=${le}`,`${M} ${le}`.trim()),O=(F,C,M)=>{for(let D=0;D<F.length;D++)if(!F[D].test(C))return!1;if(C.prerelease.length&&!M.includePrerelease){for(let D=0;D<F.length;D++)if(a(F[D].semver),F[D].semver!==s.ANY&&F[D].semver.prerelease.length>0){const B=F[D].semver;if(B.major===C.major&&B.minor===C.minor&&B.patch===C.patch)return!0}return!1}return!0};return Iv}var Pv,bO;function fve(){if(bO)return Pv;bO=1;const e=nz();return Pv=(n,i,r)=>{try{i=new e(i,r)}catch{return!1}return i.test(n)},Pv}var hve=fve(),iz=eve(hve);function dve(e,t,n){const i=e.open(t),r=250,{origin:s}=new URL(t);let a=40;function o(l){l.source===i&&(a=0,e.removeEventListener("message",o,!1))}e.addEventListener("message",o,!1);function u(){a<=0||(i.postMessage(n,s),setTimeout(u,r),a-=1)}setTimeout(u,r)}var pve=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box;
}
.vega-embed.has-actions {
  padding-right: 38px;
}
.vega-embed details:not([open]) > :not(summary) {
  display: none !important;
}
.vega-embed summary {
  list-style: none;
  position: absolute;
  top: 0;
  right: 0;
  padding: 6px;
  z-index: 1000;
  background: white;
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
  color: #1b1e23;
  border: 1px solid #aaa;
  border-radius: 999px;
  opacity: 0.2;
  transition: opacity 0.4s ease-in;
  cursor: pointer;
  line-height: 0px;
}
.vega-embed summary::-webkit-details-marker {
  display: none;
}
.vega-embed summary:active {
  box-shadow: #aaa 0px 0px 0px 1px inset;
}
.vega-embed summary svg {
  width: 14px;
  height: 14px;
}
.vega-embed details[open] summary {
  opacity: 0.7;
}
.vega-embed:hover summary, .vega-embed:focus-within summary {
  opacity: 1 !important;
  transition: opacity 0.2s ease;
}
.vega-embed .vega-actions {
  position: absolute;
  z-index: 1001;
  top: 35px;
  right: -9px;
  display: flex;
  flex-direction: column;
  padding-bottom: 8px;
  padding-top: 8px;
  border-radius: 4px;
  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
  border: 1px solid #d9d9d9;
  background: white;
  animation-duration: 0.15s;
  animation-name: scale-in;
  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
  text-align: left;
}
.vega-embed .vega-actions a {
  padding: 8px 16px;
  font-family: sans-serif;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  color: #434a56;
  text-decoration: none;
}
.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {
  background-color: #f7f7f9;
  color: black;
}
.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
  content: "";
  display: inline-block;
  position: absolute;
}
.vega-embed .vega-actions::before {
  left: auto;
  right: 14px;
  top: -16px;
  border: 8px solid rgba(0, 0, 0, 0);
  border-bottom-color: #d9d9d9;
}
.vega-embed .vega-actions::after {
  left: auto;
  right: 15px;
  top: -14px;
  border: 7px solid rgba(0, 0, 0, 0);
  border-bottom-color: #fff;
}
.vega-embed .chart-wrapper.fit-x {
  width: 100%;
}
.vega-embed .chart-wrapper.fit-y {
  height: 100%;
}

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px;
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
`;function rz(e,...t){for(const n of t)gve(e,n);return e}function gve(e,t){for(const n of Object.keys(t))bc(e,n,t[n],!0)}const Mr=Zce;let Qh=qye;const wO=typeof window<"u"?window:void 0;Qh===void 0&&wO?.vl?.compile&&(Qh=wO.vl);const mve={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},yve={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},th={vega:"Vega","vega-lite":"Vega-Lite"},lm={vega:Mr.version,"vega-lite":Qh?Qh.version:"not available"},xve={vega:e=>e,"vega-lite":(e,t)=>Qh.compile(e,{config:t}).spec},vve=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,bve="chart-wrapper";function wve(e){return typeof e=="function"}function _O(e,t,n,i){const r=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,a=window.open("");a.document.write(r+e+s),a.document.title=`${th[i]} JSON Source`}function _ve(e,t){if(e.$schema){const n=H7(e.$schema);t&&t!==n.library&&console.warn(`The given visualization spec is written in ${th[n.library]}, but mode argument sets ${th[t]??t}.`);const i=n.library;return iz(lm[i],`^${n.version.slice(1)}`)||console.warn(`The input spec uses ${th[i]} ${n.version}, but the current version of ${th[i]} is v${lm[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function sz(e){return!!(e&&"load"in e)}function EO(e){return sz(e)?e:Mr.loader(e)}function Eve(e){const t=e.usermeta?.embedOptions??{};return J(t.defaultStyle)&&(t.defaultStyle=!1),t}async function Sve(e,t,n={}){let i,r;J(t)?(r=EO(n.loader),i=JSON.parse(await r.load(t))):i=t;const s=Eve(i),a=s.loader;(!r||a)&&(r=EO(n.loader??a));const o=await SO(s,r),u=await SO(n,r),l={...rz(u,o),config:vc(u.config??{},o.config??{})};return await Ave(e,i,l,r)}async function SO(e,t){const n=J(e.config)?JSON.parse(await t.load(e.config)):e.config??{},i=J(e.patch)?JSON.parse(await t.load(e.patch)):e.patch;return{...e,...i?{patch:i}:{},...n?{config:n}:{}}}function kve(e){const t=e.getRootNode?e.getRootNode():document;return t instanceof ShadowRoot?{root:t,rootContainer:t}:{root:document,rootContainer:document.head??document.body}}async function Ave(e,t,n={},i){const r=n.theme?vc($xe[n.theme],n.config??{}):n.config,s=ao(n.actions)?n.actions:rz({},mve,n.actions??{}),a={...yve,...n.i18n},o=n.renderer??"canvas",u=n.logLevel??Mr.Warn,l=n.downloadFileName??"visualization",c=typeof e=="string"?document.querySelector(e):e;if(!c)throw new Error(`${e} does not exist`);if(n.defaultStyle!==!1){const w="vega-embed-style",{root:E,rootContainer:_}=kve(c);if(!E.getElementById(w)){const k=document.createElement("style");k.id=w,k.innerHTML=n.defaultStyle===void 0||n.defaultStyle===!0?pve.toString():n.defaultStyle,_.appendChild(k)}}const f=_ve(t,n.mode);let h=xve[f](t,r);if(f==="vega-lite"&&h.$schema){const w=H7(h.$schema);iz(lm.vega,`^${w.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${w.version}, but current version is v${lm.vega}.`)}c.classList.add("vega-embed"),s&&c.classList.add("has-actions"),c.innerHTML="";let d=c;if(s){const w=document.createElement("div");w.classList.add(bve),c.appendChild(w),d=w}const p=n.patch;if(p&&(h=p instanceof Function?p(h):Ay(h,p,!0,!1).newDocument),n.formatLocale&&Mr.formatLocale(n.formatLocale),n.timeFormatLocale&&Mr.timeFormatLocale(n.timeFormatLocale),n.expressionFunctions)for(const w in n.expressionFunctions){const E=n.expressionFunctions[w];"fn"in E?Mr.expressionFunction(w,E.fn,E.visitor):E instanceof Function&&Mr.expressionFunction(w,E)}const{ast:g}=n,m=Mr.parse(h,f==="vega-lite"?{}:r,{ast:g}),y=new(n.viewClass||Mr.View)(m,{loader:i,logLevel:u,renderer:o,...g?{expr:Mr.expressionInterpreter??n.expr??lfe}:{}});if(y.addSignalListener("autosize",(w,E)=>{const{type:_}=E;_=="fit-x"?(d.classList.add("fit-x"),d.classList.remove("fit-y")):_=="fit-y"?(d.classList.remove("fit-x"),d.classList.add("fit-y")):_=="fit"?d.classList.add("fit-x","fit-y"):d.classList.remove("fit-x","fit-y")}),n.tooltip!==!1){const{loader:w,tooltip:E}=n,_=w&&!sz(w)?w?.baseURL:void 0,k=wve(E)?E:new Lxe({baseURL:_,...E===!0?{}:E}).call;y.tooltip(k)}let{hover:x}=n;if(x===void 0&&(x=f==="vega"),x){const{hoverSet:w,updateSet:E}=typeof x=="boolean"?{}:x;y.hover(w,E)}n&&(n.width!=null&&y.width(n.width),n.height!=null&&y.height(n.height),n.padding!=null&&y.padding(n.padding)),await y.initialize(d,n.bind).runAsync();let v;if(s!==!1){let w=c;if(n.defaultStyle!==!1||n.forceActionsMenu){const _=document.createElement("details");_.title=a.CLICK_TO_VIEW_ACTIONS,c.append(_),w=_;const k=document.createElement("summary");k.innerHTML=vve,_.append(k),v=A=>{_.contains(A.target)||_.removeAttribute("open")},document.addEventListener("click",v)}const E=document.createElement("div");if(w.append(E),E.classList.add("vega-actions"),s===!0||s.export!==!1){for(const _ of["svg","png"])if(s===!0||s.export===!0||s.export[_]){const k=a[`${_.toUpperCase()}_ACTION`],A=document.createElement("a"),T=K(n.scaleFactor)?n.scaleFactor[_]:n.scaleFactor;A.text=k,A.href="#",A.target="_blank",A.download=`${l}.${_}`,A.addEventListener("mousedown",async function($){$.preventDefault();const R=await y.toImageURL(_,T);this.href=R}),E.append(A)}}if(s===!0||s.source!==!1){const _=document.createElement("a");_.text=a.SOURCE_ACTION,_.href="#",_.addEventListener("click",function(k){_O(Yy(t),n.sourceHeader??"",n.sourceFooter??"",f),k.preventDefault()}),E.append(_)}if(f==="vega-lite"&&(s===!0||s.compiled!==!1)){const _=document.createElement("a");_.text=a.COMPILED_ACTION,_.href="#",_.addEventListener("click",function(k){_O(Yy(h),n.sourceHeader??"",n.sourceFooter??"","vega"),k.preventDefault()}),E.append(_)}if(s===!0||s.editor!==!1){const _=n.editorUrl??"https://vega.github.io/editor/",k=document.createElement("a");k.text=a.EDITOR_ACTION,k.href="#",k.addEventListener("click",function(A){dve(window,_,{config:r,mode:p?"vega":f,renderer:o,spec:Yy(p?h:t)}),A.preventDefault()}),E.append(k)}}function b(){v&&document.removeEventListener("click",v),y.finalize()}return{view:y,spec:t,vgSpec:h,finalize:b,embedOptions:n}}const Cve={key:0,class:"error-message"},$ve=wm({__name:"VegaLite",props:{spec:{type:String,required:!0}},setup(e){const t=e,n=ri(),i=ri();function r(){let s;try{s=JSON.parse(t.spec)}catch(a){a instanceof Error?(console.error("Error parsing spec",a),i.value="Error parsing spec: "+a.message):(console.error("Error parsing spec: Non-error value",a),i.value="Error parsing spec: Unknown error"),n.value.innerHTML="";return}Sve(n.value,s).then(a=>{console.log("Chart rendered successfully"),i.value=null}).catch(a=>{console.error("Error rendering chart",a),i.value="Error rendering chart: "+a.toString(),n.value.innerHTML=""})}return cN(()=>{r()}),bh(()=>t.spec,r),(s,a)=>(Ra(),Fg(ij,null,[tj("div",{ref_key:"vegaContainer",ref:n,class:"vega-chart-container"},null,512),i.value?(Ra(),Fg("div",Cve,fN(i.value),1)):nj("",!0)],64))}}),Tve=hN($ve,[["__scopeId","data-v-bd58cf71"]]),Fve=wm({__name:"TableComponent",setup(e){return(t,n)=>(Ra(),Fg("div",null,"TABLE COMPONENT STUB"))}});function Mve(e){let{source:t,representation:n}=e;const{transformation:i}=e;return Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]),i?{source:t,transformation:i,representation:n}:{source:t,representation:n}}const Kp=2147483648,Ove=4294967295;class KA{constructor(t){this._size=t,this._bits=new Uint32Array(Math.ceil(t/32))}get length(){return this._size}count(){const t=this._bits.length;let n=0;for(let i=0;i<t;++i)for(let r=this._bits[i];r;++n)r&=r-1;return n}get(t){return this._bits[t>>5]&Kp>>>t}set(t){this._bits[t>>5]|=Kp>>>t}clear(t){this._bits[t>>5]&=~(Kp>>>t)}scan(t){for(let n=this.next(0);n>=0;n=this.next(n+1))t(n)}next(t){const n=this._bits,i=n.length;let r=t>>5,s=n[r]&Ove>>>t;for(;r<i;s=n[++r])if(s!==0)return(r<<5)+Math.clz32(s);return-1}nth(t){let n=this.next(0);for(;t--&&n>=0;)n=this.next(n+1);return n}not(){const t=this._bits,n=t.length;for(let r=0;r<n;++r)t[r]=~t[r];const i=this._size%32;return i&&(t[n-1]&=Kp>>i-1),this}and(t){if(t){const n=this._bits,i=t._bits,r=n.length;for(let s=0;s<r;++s)n[s]&=i[s]}return this}or(t){if(t){const n=this._bits,i=t._bits,r=n.length;for(let s=0;s<r;++s)n[s]|=i[s]}return this}}function Nve(e,t,n,i,r){return e==null?null:e<t?-1/0:e>n?1/0:(e=Math.max(t,Math.min(e,n)),t+i*Math.floor(1e-14+(e-t)/i+(r||0)))}function io(e){return e instanceof Date}function cm(e){return e instanceof RegExp}function ro(e){return e===Object(e)}function QA(e,t){return e==null||t==null||e!==e||t!==t?!1:e===t?!0:io(e)||io(t)?+e==+t:cm(e)&&cm(t)?e+""==t+"":ro(e)&&ro(t)?Rve(e,t):!1}function Rve(e,t){if(Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;if(e.length||t.length)return kO(e,t);const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length||(n.sort(),i.sort(),!kO(n,i,(s,a)=>s===a)))return!1;const r=n.length;for(let s=0;s<r;++s){const a=n[s];if(!QA(e[a],t[a]))return!1}return!0}function kO(e,t,n=QA){const i=e.length;if(i!==t.length)return!1;for(let r=0;r<i;++r)if(!n(e[r],t[r]))return!1;return!0}function Dve(e,t,n){if(t instanceof Map){if(t.has(e))return t.get(e)}else{const i=`${e}`;if(Object.hasOwn(t,i))return t[i]}return n!==void 0?n:e}function Ive(e,t,n){let i=arguments.length;e=+e,t=+t,n=i<2?(t=e,e=0,1):i<3?1:+n,i=Math.max(0,Math.ceil((t-e)/n))|0;const r=new Array(i);for(let s=0;s<i;++s)r[s]=e+s*n;return r}const Re=void 0;function In(e){return Array.isArray(e)}const Pve=Object.getPrototypeOf(Int8Array);function $y(e){return e instanceof Pve}function _o(e){return In(e)||$y(e)}function Sr(e){return typeof e=="string"}function rr(e){return e!=null&&e===e}const Jd=e=>_o(e)||Sr(e);function Lve(e){return _o(e)?e.filter(t=>rr(t)):e}function zve(...e){return[].concat(...e)}function Bve(e,t,n){return Jd(e)?e.includes(t,n):!1}function Uve(e,t){return Jd(e)?e.indexOf(t):-1}function jve(e,t){return _o(e)?e.join(t):Re}function qve(e,t){return Jd(e)?e.lastIndexOf(t):-1}function Vve(e){return Jd(e)?e.length:0}function Wve(e,t){return _o(e)?e.map(n=>rr(n)?n[t]:Re):Re}function Hve(e){return _o(e)?e.slice().reverse():Sr(e)?e.split("").reverse().join(""):Re}function Gve(e,t,n){return Jd(e)?e.slice(t,n):Re}const Yve=Object.freeze(Object.defineProperty({__proto__:null,compact:Lve,concat:zve,includes:Bve,indexof:Uve,join:jve,lastindexof:qve,length:Vve,pluck:Wve,reverse:Hve,slice:Gve},Symbol.toStringTag,{value:"Module"}));function Cg(e,t,n="0"){const i=e+"",r=i.length;return r<t?Array(t-r+1).join(n)+i:i}const Tr=e=>(e<10?"0":"")+e,Xve=e=>e<0?"-"+Cg(-e,6):e>9999?"+"+Cg(e,6):Cg(e,4);function az(e,t,n,i,r,s,a,o,u){const l=o?"Z":"";return Xve(e)+"-"+Tr(t+1)+"-"+Tr(n)+(!u||a?"T"+Tr(i)+":"+Tr(r)+":"+Tr(s)+"."+Cg(a,3)+l:s?"T"+Tr(i)+":"+Tr(r)+":"+Tr(s)+l:r||i||!o?"T"+Tr(i)+":"+Tr(r)+l:"")}function oz(e,t){return isNaN(e)?"Invalid Date":az(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds(),!1,t)}function Ty(e,t){return isNaN(e)?"Invalid Date":az(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds(),!0,t)}const Kve=/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function uz(e){return e.match(Kve)&&!isNaN(Date.parse(e))}function Qve(e,t=Date.parse){return uz(e)?t(e):e}const lz=6e4,cz=864e5,fz=6048e5,ct=new Date,ft=new Date,bt=e=>(ct.setTime(typeof e=="string"?Qve(e):e),ct);function Jve(e,t){return oz(bt(e),!t)}function Zve(e,t){return Ty(bt(e),!t)}function ebe(){return Date.now()}function tbe(e){return+bt(e)}function nbe(e,t,n,i,r,s,a){return arguments.length?new Date(e,t||0,n??1,i||0,r||0,s||0,a||0):new Date(Date.now())}function ibe(e){return bt(e).getFullYear()}function rbe(e){return Math.floor(bt(e).getMonth()/3)}function sbe(e){return bt(e).getMonth()}function abe(e,t){const n=t||0;ft.setTime(+e),ft.setDate(ft.getDate()-(ft.getDay()+7-n)%7),ft.setHours(0,0,0,0),ct.setTime(+e),ct.setMonth(0),ct.setDate(1),ct.setDate(1-(ct.getDay()+7-n)%7),ct.setHours(0,0,0,0);const i=(ft.getTimezoneOffset()-ct.getTimezoneOffset())*lz;return Math.floor((1+(+ft-+ct)-i)/fz)}function obe(e){return bt(e).getDate()}function ube(e){ft.setTime(+e),ft.setHours(0,0,0,0),ct.setTime(+ft),ct.setMonth(0),ct.setDate(1);const t=(ft.getTimezoneOffset()-ct.getTimezoneOffset())*lz;return Math.floor(1+(+ft-+ct-t)/cz)}function lbe(e){return bt(e).getDay()}function cbe(e){return bt(e).getHours()}function fbe(e){return bt(e).getMinutes()}function hbe(e){return bt(e).getSeconds()}function dbe(e){return bt(e).getMilliseconds()}function pbe(e,t,n,i,r,s,a){return arguments.length?new Date(Date.UTC(e,t||0,n??1,i||0,r||0,s||0,a||0)):new Date(Date.now())}function gbe(e){return bt(e).getUTCFullYear()}function mbe(e){return Math.floor(bt(e).getUTCMonth()/3)}function ybe(e){return bt(e).getUTCMonth()}function xbe(e,t){const n=t||0;return ft.setTime(+e),ft.setUTCDate(ft.getUTCDate()-(ft.getUTCDay()+7-n)%7),ft.setUTCHours(0,0,0,0),ct.setTime(+e),ct.setUTCMonth(0),ct.setUTCDate(1),ct.setUTCDate(1-(ct.getUTCDay()+7-n)%7),ct.setUTCHours(0,0,0,0),Math.floor((1+(+ft-+ct))/fz)}function vbe(e){return bt(e).getUTCDate()}function bbe(e){ft.setTime(+e),ft.setUTCHours(0,0,0,0);const t=Date.UTC(ft.getUTCFullYear(),0,1);return Math.floor(1+(+ft-t)/cz)}function wbe(e){return bt(e).getUTCDay()}function _be(e){return bt(e).getUTCHours()}function Ebe(e){return bt(e).getUTCMinutes()}function Sbe(e){return bt(e).getUTCSeconds()}function kbe(e){return bt(e).getUTCMilliseconds()}const Abe=Object.freeze(Object.defineProperty({__proto__:null,date:obe,datetime:nbe,dayofweek:lbe,dayofyear:ube,format_date:Jve,format_utcdate:Zve,hours:cbe,milliseconds:dbe,minutes:fbe,month:sbe,now:ebe,quarter:rbe,seconds:hbe,timestamp:tbe,utcdate:vbe,utcdatetime:pbe,utcdayofweek:wbe,utcdayofyear:bbe,utchours:_be,utcmilliseconds:kbe,utcminutes:Ebe,utcmonth:ybe,utcquarter:mbe,utcseconds:Sbe,utcweek:xbe,utcyear:gbe,week:abe,year:ibe},Symbol.toStringTag,{value:"Module"}));function Cbe(e){return JSON.parse(e)}function $be(e){return JSON.stringify(e)}const Tbe=Object.freeze(Object.defineProperty({__proto__:null,parse_json:Cbe,to_json:$be},Symbol.toStringTag,{value:"Module"}));let Fbe=Math.random;function Wc(){return Fbe()}function Mbe(){return Wc()}function Obe(e){return Number.isNaN(e)}function Nbe(e){return Number.isFinite(e)}function Rbe(e){return Math.abs(e)}function Dbe(e){return Math.cbrt(e)}function Ibe(e){return Math.ceil(e)}function Pbe(e){return Math.clz32(e)}function Lbe(e){return Math.exp(e)}function zbe(e){return Math.expm1(e)}function Bbe(e){return Math.floor(e)}function Ube(e){return Math.fround(e)}function jbe(...e){return Math.max(...e)}function qbe(...e){return Math.min(...e)}function Vbe(e){return Math.log(e)}function Wbe(e){return Math.log10(e)}function Hbe(e){return Math.log1p(e)}function Gbe(e){return Math.log2(e)}function Ybe(e,t){return Math.pow(e,t)}function Xbe(e){return Math.round(e)}function Kbe(e){return Math.sign(e)}function Qbe(e){return Math.sqrt(e)}function Jbe(e){return Math.trunc(e)}function Zbe(e){return 180*e/Math.PI}function e2e(e){return Math.PI*e/180}function t2e(e){return Math.acos(e)}function n2e(e){return Math.acosh(e)}function i2e(e){return Math.asin(e)}function r2e(e){return Math.asinh(e)}function s2e(e){return Math.atan(e)}function a2e(e,t){return Math.atan2(e,t)}function o2e(e){return Math.atanh(e)}function u2e(e){return Math.cos(e)}function l2e(e){return Math.cosh(e)}function c2e(e){return Math.sin(e)}function f2e(e){return Math.sinh(e)}function h2e(e){return Math.tan(e)}function d2e(e){return Math.tanh(e)}const p2e=Object.freeze(Object.defineProperty({__proto__:null,abs:Rbe,acos:t2e,acosh:n2e,asin:i2e,asinh:r2e,atan:s2e,atan2:a2e,atanh:o2e,cbrt:Dbe,ceil:Ibe,clz32:Pbe,cos:u2e,cosh:l2e,degrees:Zbe,exp:Lbe,expm1:zbe,floor:Bbe,fround:Ube,greatest:jbe,is_finite:Nbe,is_nan:Obe,least:qbe,log:Vbe,log10:Wbe,log1p:Hbe,log2:Gbe,pow:Ybe,radians:e2e,random:Mbe,round:Xbe,sign:Kbe,sin:c2e,sinh:f2e,sqrt:Qbe,tan:h2e,tanh:d2e,trunc:Jbe},Symbol.toStringTag,{value:"Module"}));function JA(e){return e instanceof Map}function g2e(e){return e instanceof Set}function Fy(e){return JA(e)||g2e(e)}function ZA(e){return Array.from(e)}function m2e(e,t){return Fy(e)?e.has(t):e!=null?Object.hasOwn(e,`${t}`):!1}function y2e(e){return JA(e)?ZA(e.keys()):e!=null?Object.keys(e):[]}function x2e(e){return Fy(e)?ZA(e.values()):e!=null?Object.values(e):[]}function v2e(e){return Fy(e)?ZA(e.entries()):e!=null?Object.entries(e):[]}function b2e(e){return e?Object.fromEntries(e):Re}const w2e=Object.freeze(Object.defineProperty({__proto__:null,entries:v2e,has:m2e,keys:y2e,object:b2e,values:x2e},Symbol.toStringTag,{value:"Module"}));function _2e(e){return e==null?e:new Date(e)}function E2e(e){return e==null?e:Number.parseFloat(e)}function S2e(e,t){return e==null?e:Number.parseInt(e,t)}function k2e(e,t,n){return e==null?!1:String(e).endsWith(t,n)}function A2e(e,t,n){const i=e==null?e:String(e).match(t);return n==null||i==null?i:typeof n=="number"?i[n]:i.groups?i.groups[n]:null}function C2e(e,t){return e==null?e:String(e).normalize(t)}function $2e(e,t,n){return e==null?e:String(e).padEnd(t,n)}function T2e(e,t,n){return e==null?e:String(e).padStart(t,n)}function F2e(e){return e==null?e:String(e).toUpperCase()}function M2e(e){return e==null?e:String(e).toLowerCase()}function O2e(e,t){return e==null?e:String(e).repeat(t)}function N2e(e,t,n){return e==null?e:String(e).replace(t,String(n))}function R2e(e,t,n){return e==null?[]:String(e).split(t,n)}function D2e(e,t,n){return e==null?!1:String(e).startsWith(t,n)}function I2e(e,t,n){return e==null?e:String(e).substring(t,n)}function P2e(e){return e==null?e:String(e).trim()}const L2e=Object.freeze(Object.defineProperty({__proto__:null,endswith:k2e,lower:M2e,match:A2e,normalize:C2e,padend:$2e,padstart:T2e,parse_date:_2e,parse_float:E2e,parse_int:S2e,repeat:O2e,replace:N2e,split:R2e,startswith:D2e,substring:I2e,trim:P2e,upper:F2e},Symbol.toStringTag,{value:"Module"})),_l={bin:Nve,equal:QA,recode:Dve,sequence:Ive,...Yve,...Abe,...Tbe,...p2e,...w2e,...L2e};function is(e){return e!=null?In(e)?e:[e]:[]}function Jh(e){return typeof e=="bigint"}function Js(e){return e===void 0?e+"":Jh(e)?e+"n":JSON.stringify(e)}let z2e=class{constructor(t,n,i){this.name=t,this.fields=n,this.params=i}toString(){const t=[...this.fields.map(n=>`d[${Js(n)}]`),...this.params.map(Js)];return`d => op.${this.name}(${t})`}toObject(){return{expr:this.toString(),func:!0}}};function xe(e,t=[],n=[]){return new z2e(e,is(t),is(n))}const hz=e=>xe("any",e),dz=()=>xe("count"),pz=e=>xe("array_agg",e),gz=e=>xe("array_agg_distinct",e),mz=(e,t)=>xe("map_agg",[e,t]),yz=(e,t)=>xe("object_agg",[e,t]),xz=(e,t)=>xe("entries_agg",[e,t]),ul={..._l,row_object:(...e)=>xe("row_object",null,e.flat()),count:dz,any:hz,array_agg:pz,array_agg_distinct:gz,object_agg:yz,map_agg:mz,entries_agg:xz,valid:e=>xe("valid",e),invalid:e=>xe("invalid",e),distinct:e=>xe("distinct",e),mode:e=>xe("mode",e),sum:e=>xe("sum",e),product:e=>xe("product",e),mean:e=>xe("mean",e),average:e=>xe("average",e),variance:e=>xe("variance",e),variancep:e=>xe("variancep",e),stdev:e=>xe("stdev",e),stdevp:e=>xe("stdevp",e),min:e=>xe("min",e),max:e=>xe("max",e),quantile:(e,t)=>xe("quantile",e,t),median:e=>xe("median",e),covariance:(e,t)=>xe("covariance",[e,t]),covariancep:(e,t)=>xe("covariancep",[e,t]),corr:(e,t)=>xe("corr",[e,t]),bins:(e,t,n,i,r)=>xe("bins",e,[t,n,i,r]),row_number:()=>xe("row_number"),rank:()=>xe("rank"),avg_rank:()=>xe("avg_rank"),dense_rank:()=>xe("dense_rank"),percent_rank:()=>xe("percent_rank"),cume_dist:()=>xe("cume_dist"),ntile:e=>xe("ntile",null,e),lag:(e,t,n)=>xe("lag",e,[t,n]),lead:(e,t,n)=>xe("lead",e,[t,n]),first_value:e=>xe("first_value",e),last_value:e=>xe("last_value",e),nth_value:(e,t)=>xe("nth_value",e,t),fill_down:(e,t)=>xe("fill_down",e,t),fill_up:(e,t)=>xe("fill_up",e,t)};function pt(e,t){throw Error(e,{cause:t})}function B2e(e,t){e=Fy(e)?e:new Set(e);let n=t,i=0;for(;e.has(n);)n=t+ ++i;return n}function en(e){return typeof e=="function"}function Hc(e,t){const n=Array(e);if(en(t))for(let i=0;i<e;++i)n[i]=t(i);else n.fill(t);return n}function U2e(e,t,n=15,i=!0,r=0,s){const o=Math.LN10;if(s==null){const u=Math.ceil(Math.log(n)/o),l=t-e||Math.abs(e)||1,c=[5,2];for(s=Math.max(r,Math.pow(10,Math.round(Math.log(l)/o)-u));Math.ceil(l/s)>n;)s*=10;const f=c.length;for(let h=0;h<f;++h){const d=s/c[h];d>=r&&l/d<=n&&(s=d)}}if(i){let u=Math.log(s);const l=u>=0?0:~~(-u/o)+1,c=Math.pow(10,-l-1);u=Math.floor(e/s+c)*s,e=e<u?u-s:u,t=Math.ceil(t/s)*s}return[e,t===e?e+s:t,s]}function mc(e){const t=typeof e;return t==="string"?`"${e}"`:t!=="object"||!e?e:io(e)?+e:In(e)||$y(e)?`[${e.map(mc)}]`:cm(e)?e+"":j2e(e)}function j2e(e){let t="{",n=-1;for(const i in e)++n>0&&(t+=","),t+=`"${i}":${mc(e[i])}`;return t+="}",t}function fm(e,t){const n=e.length;return n===1?(i,r)=>mc(e[0](i,r)):(i,r)=>{let s="";for(let a=0;a<n;++a){a>0&&(s+="|");const o=e[a](i,r);if(t&&(o==null||o!==o))return null;s+=mc(o)}return s}}function q2e(){const e=new Map;return{count(){return e.size},values(){return Array.from(e.values(),t=>t.v)},increment(t){const n=mc(t),i=e.get(n);i?++i.n:e.set(n,{v:t,n:1})},decrement(t){const n=mc(t),i=e.get(n);i.n===1?e.delete(n):--i.n},forEach(t){e.forEach(({v:n,n:i})=>t(n,i))}}}function $s(){}function V2e(e,t=0,n=e.length){let i=e[t++];for(let r=t;r<n;++r)i*=e[r];return i}function _t(e){return e.init=e.init||$s,e.add=e.add||$s,e.rem=e.rem||$s,e}function AO(e,t){return e.product_v=!1,e.product=t}const vz={count:{create:()=>_t({value:e=>e.count}),param:[]},array_agg:{create:()=>_t({init:e=>e.values=!0,value:e=>e.list.values(e.stream)}),param:[1]},object_agg:{create:()=>_t({init:e=>e.values=!0,value:e=>Object.fromEntries(e.list.values())}),param:[2]},map_agg:{create:()=>_t({init:e=>e.values=!0,value:e=>new Map(e.list.values())}),param:[2]},entries_agg:{create:()=>_t({init:e=>e.values=!0,value:e=>e.list.values(e.stream)}),param:[2]},any:{create:()=>_t({add:(e,t)=>{e.any==null&&(e.any=t)},value:e=>e.valid?e.any:Re}),param:[1]},valid:{create:()=>_t({value:e=>e.valid}),param:[1]},invalid:{create:()=>_t({value:e=>e.count-e.valid}),param:[1]},distinct:{create:()=>({init:e=>e.distinct=q2e(),value:e=>e.distinct.count()+(e.valid===e.count?0:1),add:(e,t)=>e.distinct.increment(t),rem:(e,t)=>e.distinct.decrement(t)}),param:[1]},array_agg_distinct:{create:()=>_t({value:e=>e.distinct.values()}),param:[1],req:["distinct"]},mode:{create:()=>_t({value:e=>{let t=Re,n=0;return e.distinct.forEach((i,r)=>{r>n&&(n=r,t=i)}),t}}),param:[1],req:["distinct"]},sum:{create:()=>({init:e=>e.sum=0,value:e=>e.valid?e.sum:Re,add:(e,t)=>Jh(t)?e.sum===0?e.sum=t:e.sum+=t:e.sum+=+t,rem:(e,t)=>e.sum-=t}),param:[1]},product:{create:()=>({init:e=>AO(e,1),value:e=>e.valid?e.product_v?AO(e,V2e(e.list.values())):e.product:void 0,add:(e,t)=>Jh(t)&&e.product===1?e.product=t:e.product*=t,rem:(e,t)=>t==0||t===1/0||t===-1/0?e.product_v=!0:e.product/=t}),param:[1],stream:["array_agg"]},mean:{create:()=>({init:e=>e.mean=0,value:e=>e.valid?e.mean:Re,add:(e,t)=>{e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid},rem:(e,t)=>{e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean}}),param:[1]},average:{create:()=>_t({value:e=>e.valid?e.mean:Re}),param:[1],req:["mean"]},variance:{create:()=>({init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):Re,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean)}),param:[1],req:["mean"]},variancep:{create:()=>_t({value:e=>e.valid>1?e.dev/e.valid:Re}),param:[1],req:["variance"]},stdev:{create:()=>_t({value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):Re}),param:[1],req:["variance"]},stdevp:{create:()=>_t({value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):Re}),param:[1],req:["variance"]},min:{create:()=>({init:e=>e.min=Re,value:e=>e.min=Number.isNaN(e.min)?e.list.min():e.min,add:(e,t)=>{(t<e.min||e.min===Re)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)}}),param:[1],stream:["array_agg"]},max:{create:()=>({init:e=>e.max=Re,value:e=>e.max=Number.isNaN(e.max)?e.list.max():e.max,add:(e,t)=>{(t>e.max||e.max===Re)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)}}),param:[1],stream:["array_agg"]},quantile:{create:e=>_t({value:t=>t.list.quantile(e)}),param:[1,1],req:["array_agg"]},median:{create:()=>_t({value:e=>e.list.quantile(.5)}),param:[1],req:["array_agg"]},covariance:{create:()=>({init:e=>{e.cov=e.mean_x=e.mean_y=e.dev_x=e.dev_y=0},value:e=>e.valid>1?e.cov/(e.valid-1):Re,add:(e,t,n)=>{const i=t-e.mean_x,r=n-e.mean_y;e.mean_x+=i/e.valid,e.mean_y+=r/e.valid;const s=n-e.mean_y;e.dev_x+=i*(t-e.mean_x),e.dev_y+=r*s,e.cov+=i*s},rem:(e,t,n)=>{const i=t-e.mean_x,r=n-e.mean_y;e.mean_x-=e.valid?i/e.valid:e.mean_x,e.mean_y-=e.valid?r/e.valid:e.mean_y;const s=n-e.mean_y;e.dev_x-=i*(t-e.mean_x),e.dev_y-=r*s,e.cov-=i*s}}),param:[2]},covariancep:{create:()=>_t({value:e=>e.valid>1?e.cov/e.valid:Re}),param:[2],req:["covariance"]},corr:{create:()=>_t({value:e=>e.valid>1?e.cov/(Math.sqrt(e.dev_x)*Math.sqrt(e.dev_y)):Re}),param:[2],req:["covariance"]},bins:{create:(e,t,n,i)=>_t({value:r=>U2e(r.min,r.max,e,t,n,i)}),param:[1,4],req:["min","max"]}},CO={create(){let e;return{init:()=>e=1,value:t=>{const n=t.index;return n&&!t.peer(n)?e=n+1:e}}},param:[]},$O={create(){let e;return{init:()=>e=0,value:t=>{const{index:n,peer:i,size:r}=t;let s=n;if(e<s){for(;s+1<r&&i(s+1);)++s;e=s}return(1+e)/r}}},param:[]},bz={row_number:{create(){return{init:$s,value:e=>e.index+1}},param:[]},rank:CO,avg_rank:{create(){let e,t;return{init:()=>(e=-1,t=1),value:n=>{const i=n.index;if(i>=e){for(t=e=i+1;n.peer(e);t+=++e);t/=e-i}return t}}},param:[]},dense_rank:{create(){let e;return{init:()=>e=1,value:t=>{const n=t.index;return n&&!t.peer(n)?++e:e}}},param:[]},percent_rank:{create(){const{init:e,value:t}=CO.create();return{init:e,value:n=>(t(n)-1)/(n.size-1)}},param:[]},cume_dist:$O,ntile:{create(e){e=+e,e>0||pt("ntile num must be greater than zero.");const{init:t,value:n}=$O.create();return{init:t,value:i=>Math.ceil(e*n(i))}},param:[0,1]},lag:{create(e,t=Re){return e=+e||1,{init:$s,value:(n,i)=>{const r=n.index-e;return r>=0?n.value(r,i):t}}},param:[1,2]},lead:{create(e,t=Re){return e=+e||1,{init:$s,value:(n,i)=>{const r=n.index+e;return r<n.size?n.value(r,i):t}}},param:[1,2]},first_value:{create(){return{init:$s,value:(e,t)=>e.value(e.i0,t)}},param:[1]},last_value:{create(){return{init:$s,value:(e,t)=>e.value(e.i1-1,t)}},param:[1]},nth_value:{create(e){return e=+e,e>0||pt("nth_value nth must be greater than zero."),{init:$s,value:(t,n)=>{const i=t.i0+(e-1);return i<t.i1?t.value(i,n):Re}}},param:[1,1]},fill_down:{create(e=Re){let t;return{init:()=>t=e,value:(n,i)=>{const r=n.value(n.index,i);return rr(r)?t=r:t}}},param:[1,1]},fill_up:{create(e=Re){let t,n;return{init:()=>(t=e,n=-1),value:(i,r)=>i.index<=n?t:(n=W2e(i,r,i.index))>=0?t=i.value(n,r):(n=i.size,t=e)}},param:[1,1]}};function W2e(e,t,n){for(const i=e.size;n<i;++n)if(rr(e.value(n,t)))return n;return-1}function eC(e){return Object.hasOwn(vz,e)}function tC(e){return Object.hasOwn(bz,e)}function wz(e){return Object.hasOwn(_l,e)||e==="row_object"}function _z(e){return eC(e)&&vz[e]}function Ez(e){return tC(e)&&bz[e]}function Zd(e,t=(i,r)=>i,n=""){const i=e.length;if(!i)return"";let r=t(e[0],0);for(let s=1;s<i;++s)r+=n+t(e[s],s);return r}function Gc(e,t,...n){const i=["_","$"],r=i.slice(0,n.length);return r.push('"use strict"; const '+n.map((s,a)=>s.map((o,u)=>`${i[a]}${u} = ${i[a]}[${u}]`).join(", ")).join(", ")+`; return (${e}) => ${t};`),Function(...r)(...n)}function nC(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function H2e(e,t=0,n=e.length){let i=n?e[t++]:Re;for(let r=t;r<n;++r)i<e[r]&&(i=e[r]);return i}function G2e(e,t=0,n=e.length){let i=n?e[t++]:Re;for(let r=t;r<n;++r)i>e[r]&&(i=e[r]);return i}function Qp(e){return Jh(e)?e:+e}function Y2e(e,t){const n=e.length;if(!n)return Re;if((t=+t)<=0||n<2)return Qp(e[0]);if(t>=1)return Qp(e[n-1]);const i=(n-1)*t,r=Math.floor(i),s=Qp(e[r]);return Jh(s)?s:s+(Qp(e[r+1])-s)*(i-r)}class X2e{constructor(t){this._values=t||[],this._sorted=null,this._start=0}values(t){return this._start&&(this._values=this._values.slice(this._start),this._start=0),t?this._values.slice():this._values}add(t){this._values.push(t),this._sorted=null}rem(){this._start+=1,this._sorted=null}min(){return this._sorted&&this._sorted.length?this._sorted[0]:G2e(this._values,this._start)}max(){return this._sorted&&this._sorted.length?this._sorted[this._sorted.length-1]:H2e(this._values,this._start)}quantile(t){return this._sorted||(this._sorted=this.values(!0),this._sorted.sort(nC)),Y2e(this._sorted,t)}}class K2e{constructor(t){this._outputs=t}size(){return this._outputs.length}outputs(){return this._outputs}init(t){return{}}add(t,n,i){}rem(t,n,i){}write(t,n,i){}}const hm=(e,t,n)=>Gc(t,"{"+Zd(e,(i,r)=>`_${r}.${n}(${t});`)+"}",e);function Q2e(e,t){const{ops:n,output:i}=J2e(e,t),r=e[0].fields,s=r.length,a=s===0?iC:s===1?Z2e:s===2?ewe:pt("Unsupported field count: "+s);return new a(r,n,i,t)}function J2e(e,t){const n={},i=[];function r(a,o=[]){const u=a+":"+o;if(n[u])return n[u];const l=_z(a),c=l.create(...o);return t<0&&l.stream&&l.stream.forEach(f=>r(f,[])),l.req&&l.req.forEach(f=>r(f,[])),n[u]=c,i.push(c),c}const s=e.map(a=>{const o=r(a.name,a.params);return o.output=a.id,o});return{ops:i,output:s}}class iC extends K2e{constructor(t,n,i,r){super(i),this._op=n,this._fields=t,this._stream=!!r}init(){const t={count:0,valid:0,stream:this._stream};return this._op.forEach(n=>n.init(t)),t.values&&(t.list=new X2e),t}write(t,n,i){const r=this._outputs,s=r.length;for(let a=0;a<s;++a)n[r[a].output][i]=r[a].value(t);return 1}_add(){}_rem(){}add(t){++t.count}rem(t){--t.count}}class Z2e extends iC{constructor(t,n,i,r){super(t,n,i,r);const s=["state","v1","v2"];this._add=hm(n,s,"add"),this._rem=hm(n,s,"rem")}add(t,n,i){const r=this._fields[0](n,i);++t.count,rr(r)&&(++t.valid,t.list&&t.list.add(r),this._add(t,r))}rem(t,n,i){const r=this._fields[0](n,i);--t.count,rr(r)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r))}}class ewe extends iC{constructor(t,n,i,r){super(t,n,i,r);const s=["state","v1","v2"];this._add=hm(n,s,"add"),this._rem=hm(n,s,"rem")}add(t,n,i){const r=this._fields[0](n,i),s=this._fields[1](n,i);++t.count,rr(r)&&rr(s)&&(++t.valid,t.list&&t.list.add([r,s]),this._add(t,r,s))}rem(t,n,i){const r=this._fields[0](n,i),s=this._fields[1](n,i);--t.count,rr(r)&&rr(s)&&(--t.valid,t.list&&t.list.rem(),this._rem(t,r,s))}}function Gu(e,t,n){if(t.length){const i=e.data(),{keys:r}=e.groups()||{},s=Yc(e,t),a=r?(o,u)=>s[o][r[u]]:o=>s[o][0];n=n.map(o=>u=>o(u,i,a))}return n}function Yc(e,t,n){if(!t.length)return n;const i=Sz(t),r=e.groups(),s=r?r.size:1;return n=n||Hc(t.length,()=>Array(s)),s>1?i.forEach(a=>{const o=Az(e,a,r);for(let u=0;u<s;++u)a.write(o[u],n,u)}):i.forEach(a=>{const o=kz(e,a);a.write(o,n,0)}),n}function Sz(e,t){const n=[],i={};for(const r of e){const s=r.fields.map(a=>a+"").join(",");(i[s]||(i[s]=[])).push(r)}for(const r in i)n.push(Q2e(i[r],t));return n}function kz(e,t){const n=t.init(),i=e.totalRows(),r=e.data(),s=e.mask();if(e.isOrdered()){const a=e.indices();for(let o=0;o<i;++o)t.add(n,a[o],r)}else if(s)for(let a=s.next(0);a>=0;a=s.next(a+1))t.add(n,a,r);else for(let a=0;a<i;++a)t.add(n,a,r);return n}function Az(e,t,n){const{keys:i,size:r}=n,s=Hc(r,()=>t.init()),a=e.data();if(e.isOrdered()){const o=e.indices(),u=o.length;for(let l=0;l<u;++l){const c=o[l];t.add(s[i[c]],c,a)}}else if(e.isFiltered()){const o=e.mask();for(let u=o.next(0);u>=0;u=o.next(u+1))t.add(s[i[u]],u,a)}else{const o=e.totalRows();for(let u=0;u<o;++u)t.add(s[i[u]],u,a)}return s}function Cz(e,t){const{get:n,names:i,rows:r,size:s}=t,a=i.length;for(let o=0;o<a;++o){const u=e.add(i[o],Array(s)),l=n[o];for(let c=0;c<s;++c)u[c]=l(r[c])}}function rC(e){return In(e)?e:JA(e)?e.entries():e?Object.entries(e):[]}const twe="ArrayPattern",nwe="ArrowFunctionExpression",iwe="FunctionExpression",Ua="Identifier",Xc="Literal",$z="MemberExpression",rwe="ObjectExpression",Tz="ObjectPattern",Fz="Property",Mz="Column",swe="Constant",awe="Dictionary",owe="Function",uwe="Parameter",Oz="Op";function Me(e,t,n,i){const r=n[e.type]||n.Default;if(r&&r(e,t,i)===!1)return;const s=lwe[e.type];s&&s(e,t,n)}const Jp=(e,t,n)=>{Me(e.argument,t,n,e)},Lv=(e,t,n)=>{Me(e.left,t,n,e),Me(e.right,t,n,e)},TO=(e,t,n)=>{Me(e.test,t,n,e),Me(e.consequent,t,n,e),e.alternate&&Me(e.alternate,t,n,e)},zv=(e,t,n)=>{Or(e.params,t,n,e),Me(e.body,t,n,e)},FO=(e,t,n)=>{Me(e.callee,t,n,e),Or(e.arguments,t,n,e)},Or=(e,t,n,i)=>{e.forEach(r=>Me(r,t,n,i))},lwe={TemplateLiteral:(e,t,n)=>{Or(e.expressions,t,n,e),Or(e.quasis,t,n,e)},MemberExpression:(e,t,n)=>{Me(e.object,t,n,e),Me(e.property,t,n,e)},CallExpression:FO,NewExpression:FO,ArrayExpression:(e,t,n)=>{Or(e.elements,t,n,e)},AssignmentExpression:Lv,AwaitExpression:Jp,BinaryExpression:Lv,LogicalExpression:Lv,UnaryExpression:Jp,UpdateExpression:Jp,ConditionalExpression:TO,ObjectExpression:(e,t,n)=>{Or(e.properties,t,n,e)},Property:(e,t,n)=>{Me(e.key,t,n,e),Me(e.value,t,n,e)},ArrowFunctionExpression:zv,FunctionExpression:zv,FunctionDeclaration:zv,VariableDeclaration:(e,t,n)=>{Or(e.declarations,t,n,e)},VariableDeclarator:(e,t,n)=>{Me(e.id,t,n,e),Me(e.init,t,n,e)},SpreadElement:(e,t,n)=>{Me(e.argument,t,n,e)},BlockStatement:(e,t,n)=>{Or(e.body,t,n,e)},ExpressionStatement:(e,t,n)=>{Me(e.expression,t,n,e)},IfStatement:TO,ForStatement:(e,t,n)=>{Me(e.init,t,n,e),Me(e.test,t,n,e),Me(e.update,t,n,e),Me(e.body,t,n,e)},WhileStatement:(e,t,n)=>{Me(e.test,t,n,e),Me(e.body,t,n,e)},DoWhileStatement:(e,t,n)=>{Me(e.body,t,n,e),Me(e.test,t,n,e)},SwitchStatement:(e,t,n)=>{Me(e.discriminant,t,n,e),Or(e.cases,t,n,e)},SwitchCase:(e,t,n)=>{e.test&&Me(e.test,t,n,e),Or(e.consequent,t,n,e)},ReturnStatement:Jp,Program:(e,t,n)=>{Me(e.body[0],t,n,e)}};function Nz(e){delete e.start,delete e.end,delete e.optional}function MO(e){Nz(e),delete e.object,delete e.property,delete e.computed,e.table||delete e.table}function cwe(e){return Me(e,null,{Column:MO,Constant:MO,Default:Nz}),e}function kt(e,t){return t&&t.type===e}function fwe(e){return kt(iwe,e)||kt(nwe,e)}const Qe=(e,t)=>{const n=dwe[e.type];return n?n(e,t):pt(`Unsupported expression construct: ${e.type}`)},Bv=(e,t)=>"("+Qe(e.left,t)+" "+e.operator+" "+Qe(e.right,t)+")",Uv=(e,t)=>"("+Nr(e.params,t)+")=>"+Qe(e.body,t),OO=(e,t)=>Qe(e.callee,t)+"("+Nr(e.arguments,t)+")",Nr=(e,t,n=",")=>e.map(i=>Qe(i,t)).join(n),sC=e=>e.computed?`[${Js(e.name)}]`:`.${e.name}`,NO=(e,t,n)=>{const i=e.table||"";return`data${i}${sC(e)}.${n}(${t.index}${i})`},hwe=(e,t)=>{const n=e.table||"";return`data${n}${sC(e)}[${t.index}${n}]`},dwe={Constant:e=>e.raw,Column:(e,t)=>e.array?hwe(e,t):NO(e,t,"at"),Dictionary:(e,t)=>NO(e,t,"key"),Function:e=>`fn.${e.name}`,Parameter:e=>`$${sC(e)}`,Op:(e,t)=>`op(${Js(e.name)},${t.op||t.index})`,Literal:e=>e.raw,Identifier:e=>e.name,TemplateLiteral:(e,t)=>{const{quasis:n,expressions:i}=e,r=i.length;let s=n[0].value.raw;for(let a=0;a<r;)s+="${"+Qe(i[a],t)+"}"+n[++a].value.raw;return"`"+s+"`"},MemberExpression:(e,t)=>{const n=!e.computed,i=Qe(e.object,t),r=Qe(e.property,t);return i+(n?"."+r:"["+r+"]")},CallExpression:OO,NewExpression:(e,t)=>"new "+OO(e,t),ArrayExpression:(e,t)=>"["+Nr(e.elements,t)+"]",AssignmentExpression:Bv,BinaryExpression:Bv,LogicalExpression:Bv,UnaryExpression:(e,t)=>"("+e.operator+Qe(e.argument,t)+")",ConditionalExpression:(e,t)=>"("+Qe(e.test,t)+"?"+Qe(e.consequent,t)+":"+Qe(e.alternate,t)+")",ObjectExpression:(e,t)=>"({"+Nr(e.properties,t)+"})",Property:(e,t)=>{const n=Qe(e.key,t);return(e.computed?`[${n}]`:n)+":"+Qe(e.value,t)},ArrowFunctionExpression:Uv,FunctionExpression:Uv,FunctionDeclaration:Uv,ArrayPattern:(e,t)=>"["+Nr(e.elements,t)+"]",ObjectPattern:(e,t)=>"{"+Nr(e.properties,t)+"}",VariableDeclaration:(e,t)=>e.kind+" "+Nr(e.declarations,t,","),VariableDeclarator:(e,t)=>Qe(e.id,t)+"="+Qe(e.init,t),SpreadElement:(e,t)=>"..."+Qe(e.argument,t),BlockStatement:(e,t)=>"{"+Nr(e.body,t,";")+";}",BreakStatement:()=>"break",ExpressionStatement:(e,t)=>Qe(e.expression,t),IfStatement:(e,t)=>"if ("+Qe(e.test,t)+")"+Qe(e.consequent,t)+(e.alternate?" else "+Qe(e.alternate,t):""),SwitchStatement:(e,t)=>"switch ("+Qe(e.discriminant,t)+") {"+Nr(e.cases,t,"")+"}",SwitchCase:(e,t)=>(e.test?"case "+Qe(e.test,t):"default")+": "+Nr(e.consequent,t,";")+";",ReturnStatement:(e,t)=>"return "+Qe(e.argument,t),Program:(e,t)=>Qe(e.body[0],t)};function dm(e,t={index:"row"}){return Qe(e,t)}function Ff(e,t,n){return e=`"use strict"; return ${e};`,Function("fn","$",e)(t,n)}const aC={escape:(e,t,n)=>Ff(e,t,n),expr:(e,t)=>Ff(`(row,data,op)=>${e}`,_l,t),expr2:(e,t)=>Ff(`(row0,data0,row,data)=>${e}`,_l,t),join:(e,t)=>Ff(`(row1,data1,row2,data2)=>${e}`,_l,t),param:(e,t)=>Ff(e,_l,t)},pwe={"==":1,"!=":1,"===":1,"!==":1};function Rz(e,t,n=0,i=void 0,r=void 0){if(e.type=Mz,e.name=t,e.table=n,_o(i)&&(e.array=!0),r&&i&&en(i.keyFor)){const s=pwe[r.operator]?r.left===e?r.right:r.left:r.callee&&r.callee.name==="equal"?r.arguments[r.arguments[0]===e?1:0]:null;s&&s.type===Xc&&gwe(r,e,s,i.keyFor(s.value))}return e}function gwe(e,t,n,i){return i<0?(e.type=Xc,e.value=!1,e.raw="false"):(t.type=awe,n.value=i,n.raw=i+""),!0}const Dz="row_object";function Iz(e,t,n=t.columnNames()){e.type=rwe;const i=e.properties=[];for(const r of rC(n)){const[s,a]=In(r)?r:[r,r];i.push({type:Fz,key:{type:Xc,raw:Js(a)},value:Rz({computed:!0},s,0,t.column(s))})}return e}function Pz(e,t){return dm(Iz({},e,t))}function Lz(e,t){return aC.expr(Pz(e,t))}function mwe(e){return en(e)?e:()=>e}const ywe="Escaped functions are not valid as rollup or pivot values.";function xwe(e,t,n){e.aggronly&&pt(ywe);const i=`(row,data)=>fn(${Pz(e.table)},$)`;return{escape:aC.escape(i,mwe(t.expr),n)}}var vwe=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],zz=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],bwe="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࢗ-࢟࣊-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄ఼ా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ೳഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-໎໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜕ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠏-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿ-ᫎᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷿‌‍‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯・꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿･",Bz="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࡰ-ࢇࢉ-ࢎࢠ-ࣉऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౝౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೝೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜑᜟ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭌᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲊᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꟍꟐꟑꟓꟕ-Ƛꟲ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",jv={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},qv="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",wwe={5:qv,"5module":qv+" export import",6:qv+" const class extends export import super"},_we=/^in(stanceof)?$/,Ewe=new RegExp("["+Bz+"]"),Swe=new RegExp("["+Bz+bwe+"]");function pw(e,t){for(var n=65536,i=0;i<t.length;i+=2){if(n+=t[i],n>e)return!1;if(n+=t[i+1],n>=e)return!0}return!1}function Zs(e,t){return e<65?e===36:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&Ewe.test(String.fromCharCode(e)):t===!1?!1:pw(e,zz)}function yc(e,t){return e<48?e===36:e<58?!0:e<65?!1:e<91?!0:e<97?e===95:e<123?!0:e<=65535?e>=170&&Swe.test(String.fromCharCode(e)):t===!1?!1:pw(e,zz)||pw(e,vwe)}var Ne=function(t,n){n===void 0&&(n={}),this.label=t,this.keyword=n.keyword,this.beforeExpr=!!n.beforeExpr,this.startsExpr=!!n.startsExpr,this.isLoop=!!n.isLoop,this.isAssign=!!n.isAssign,this.prefix=!!n.prefix,this.postfix=!!n.postfix,this.binop=n.binop||null,this.updateContext=null};function vi(e,t){return new Ne(e,{beforeExpr:!0,binop:t})}var bi={beforeExpr:!0},Ln={startsExpr:!0},oC={};function $e(e,t){return t===void 0&&(t={}),t.keyword=e,oC[e]=new Ne(e,t)}var S={num:new Ne("num",Ln),regexp:new Ne("regexp",Ln),string:new Ne("string",Ln),name:new Ne("name",Ln),privateId:new Ne("privateId",Ln),eof:new Ne("eof"),bracketL:new Ne("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ne("]"),braceL:new Ne("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ne("}"),parenL:new Ne("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ne(")"),comma:new Ne(",",bi),semi:new Ne(";",bi),colon:new Ne(":",bi),dot:new Ne("."),question:new Ne("?",bi),questionDot:new Ne("?."),arrow:new Ne("=>",bi),template:new Ne("template"),invalidTemplate:new Ne("invalidTemplate"),ellipsis:new Ne("...",bi),backQuote:new Ne("`",Ln),dollarBraceL:new Ne("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ne("=",{beforeExpr:!0,isAssign:!0}),assign:new Ne("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ne("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ne("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:vi("||",1),logicalAND:vi("&&",2),bitwiseOR:vi("|",3),bitwiseXOR:vi("^",4),bitwiseAND:vi("&",5),equality:vi("==/!=/===/!==",6),relational:vi("</>/<=/>=",7),bitShift:vi("<</>>/>>>",8),plusMin:new Ne("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:vi("%",10),star:vi("*",10),slash:vi("/",10),starstar:new Ne("**",{beforeExpr:!0}),coalesce:vi("??",1),_break:$e("break"),_case:$e("case",bi),_catch:$e("catch"),_continue:$e("continue"),_debugger:$e("debugger"),_default:$e("default",bi),_do:$e("do",{isLoop:!0,beforeExpr:!0}),_else:$e("else",bi),_finally:$e("finally"),_for:$e("for",{isLoop:!0}),_function:$e("function",Ln),_if:$e("if"),_return:$e("return",bi),_switch:$e("switch"),_throw:$e("throw",bi),_try:$e("try"),_var:$e("var"),_const:$e("const"),_while:$e("while",{isLoop:!0}),_with:$e("with"),_new:$e("new",{beforeExpr:!0,startsExpr:!0}),_this:$e("this",Ln),_super:$e("super",Ln),_class:$e("class",Ln),_extends:$e("extends",bi),_export:$e("export"),_import:$e("import",Ln),_null:$e("null",Ln),_true:$e("true",Ln),_false:$e("false",Ln),_in:$e("in",{beforeExpr:!0,binop:7}),_instanceof:$e("instanceof",{beforeExpr:!0,binop:7}),_typeof:$e("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:$e("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:$e("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},ji=/\r\n?|\n|\u2028|\u2029/,kwe=new RegExp(ji.source,"g");function Kc(e){return e===10||e===13||e===8232||e===8233}function Uz(e,t,n){n===void 0&&(n=e.length);for(var i=t;i<n;i++){var r=e.charCodeAt(i);if(Kc(r))return i<n-1&&r===13&&e.charCodeAt(i+1)===10?i+2:i+1}return-1}var jz=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,_i=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,qz=Object.prototype,Awe=qz.hasOwnProperty,Cwe=qz.toString,Qc=Object.hasOwn||function(e,t){return Awe.call(e,t)},RO=Array.isArray||function(e){return Cwe.call(e)==="[object Array]"},DO=Object.create(null);function Na(e){return DO[e]||(DO[e]=new RegExp("^(?:"+e.replace(/ /g,"|")+")$"))}function ea(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10)+55296,(e&1023)+56320))}var $we=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Zh=function(t,n){this.line=t,this.column=n};Zh.prototype.offset=function(t){return new Zh(this.line,this.column+t)};var My=function(t,n,i){this.start=n,this.end=i,t.sourceFile!==null&&(this.source=t.sourceFile)};function Vz(e,t){for(var n=1,i=0;;){var r=Uz(e,i,t);if(r<0)return new Zh(n,t-i);++n,i=r}}var gw={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},IO=!1;function Twe(e){var t={};for(var n in gw)t[n]=e&&Qc(e,n)?e[n]:gw[n];if(t.ecmaVersion==="latest"?t.ecmaVersion=1e8:t.ecmaVersion==null?(!IO&&typeof console=="object"&&console.warn&&(IO=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),t.ecmaVersion=11):t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),t.allowReserved==null&&(t.allowReserved=t.ecmaVersion<5),(!e||e.allowHashBang==null)&&(t.allowHashBang=t.ecmaVersion>=14),RO(t.onToken)){var i=t.onToken;t.onToken=function(r){return i.push(r)}}return RO(t.onComment)&&(t.onComment=Fwe(t,t.onComment)),t}function Fwe(e,t){return function(n,i,r,s,a,o){var u={type:n?"Block":"Line",value:i,start:r,end:s};e.locations&&(u.loc=new My(this,a,o)),e.ranges&&(u.range=[r,s]),t.push(u)}}var ed=1,Jc=2,uC=4,Wz=8,Hz=16,Gz=32,lC=64,Yz=128,ep=256,cC=ed|Jc|ep;function fC(e,t){return Jc|(e?uC:0)|(t?Wz:0)}var pm=0,hC=1,ha=2,Xz=3,Kz=4,Qz=5,Tt=function(t,n,i){this.options=t=Twe(t),this.sourceFile=t.sourceFile,this.keywords=Na(wwe[t.ecmaVersion>=6?6:t.sourceType==="module"?"5module":5]);var r="";t.allowReserved!==!0&&(r=jv[t.ecmaVersion>=6?6:t.ecmaVersion===5?5:3],t.sourceType==="module"&&(r+=" await")),this.reservedWords=Na(r);var s=(r?r+" ":"")+jv.strict;this.reservedWordsStrict=Na(s),this.reservedWordsStrictBind=Na(s+" "+jv.strictBind),this.input=String(n),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf(`
`,i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(ji).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=S.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=t.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&t.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ed),this.regexpState=null,this.privateNameStack=[]},ys={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};Tt.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)};ys.inFunction.get=function(){return(this.currentVarScope().flags&Jc)>0};ys.inGenerator.get=function(){return(this.currentVarScope().flags&Wz)>0&&!this.currentVarScope().inClassFieldInit};ys.inAsync.get=function(){return(this.currentVarScope().flags&uC)>0&&!this.currentVarScope().inClassFieldInit};ys.canAwait.get=function(){for(var e=this.scopeStack.length-1;e>=0;e--){var t=this.scopeStack[e];if(t.inClassFieldInit||t.flags&ep)return!1;if(t.flags&Jc)return(t.flags&uC)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};ys.allowSuper.get=function(){var e=this.currentThisScope(),t=e.flags,n=e.inClassFieldInit;return(t&lC)>0||n||this.options.allowSuperOutsideMethod};ys.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Yz)>0};ys.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};ys.allowNewDotTarget.get=function(){var e=this.currentThisScope(),t=e.flags,n=e.inClassFieldInit;return(t&(Jc|ep))>0||n};ys.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&ep)>0};Tt.extend=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];for(var i=this,r=0;r<t.length;r++)i=t[r](i);return i};Tt.parse=function(t,n){return new this(n,t).parse()};Tt.parseExpressionAt=function(t,n,i){var r=new this(i,t,n);return r.nextToken(),r.parseExpression()};Tt.tokenizer=function(t,n){return new this(n,t)};Object.defineProperties(Tt.prototype,ys);var Pn=Tt.prototype,Mwe=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;Pn.strictDirective=function(e){if(this.options.ecmaVersion<5)return!1;for(;;){_i.lastIndex=e,e+=_i.exec(this.input)[0].length;var t=Mwe.exec(this.input.slice(e));if(!t)return!1;if((t[1]||t[2])==="use strict"){_i.lastIndex=e+t[0].length;var n=_i.exec(this.input),i=n.index+n[0].length,r=this.input.charAt(i);return r===";"||r==="}"||ji.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(r)||r==="!"&&this.input.charAt(i+1)==="=")}e+=t[0].length,_i.lastIndex=e,e+=_i.exec(this.input)[0].length,this.input[e]===";"&&e++}};Pn.eat=function(e){return this.type===e?(this.next(),!0):!1};Pn.isContextual=function(e){return this.type===S.name&&this.value===e&&!this.containsEsc};Pn.eatContextual=function(e){return this.isContextual(e)?(this.next(),!0):!1};Pn.expectContextual=function(e){this.eatContextual(e)||this.unexpected()};Pn.canInsertSemicolon=function(){return this.type===S.eof||this.type===S.braceR||ji.test(this.input.slice(this.lastTokEnd,this.start))};Pn.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};Pn.semicolon=function(){!this.eat(S.semi)&&!this.insertSemicolon()&&this.unexpected()};Pn.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0};Pn.expect=function(e){this.eat(e)||this.unexpected()};Pn.unexpected=function(e){this.raise(e??this.start,"Unexpected token")};var Oy=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};Pn.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,t?"Assigning to rvalue":"Parenthesized pattern")}};Pn.checkExpressionErrors=function(e,t){if(!e)return!1;var n=e.shorthandAssign,i=e.doubleProto;if(!t)return n>=0||i>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),i>=0&&this.raiseRecoverable(i,"Redefinition of __proto__ property")};Pn.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};Pn.isSimpleAssignTarget=function(e){return e.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(e.expression):e.type==="Identifier"||e.type==="MemberExpression"};var se=Tt.prototype;se.parseTopLevel=function(e){var t=Object.create(null);for(e.body||(e.body=[]);this.type!==S.eof;){var n=this.parseStatement(null,!0,t);e.body.push(n)}if(this.inModule)for(var i=0,r=Object.keys(this.undefinedExports);i<r.length;i+=1){var s=r[i];this.raiseRecoverable(this.undefinedExports[s].start,"Export '"+s+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var dC={kind:"loop"},Owe={kind:"switch"};se.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;_i.lastIndex=this.pos;var t=_i.exec(this.input),n=this.pos+t[0].length,i=this.input.charCodeAt(n);if(i===91||i===92)return!0;if(e)return!1;if(i===123||i>55295&&i<56320)return!0;if(Zs(i,!0)){for(var r=n+1;yc(i=this.input.charCodeAt(r),!0);)++r;if(i===92||i>55295&&i<56320)return!0;var s=this.input.slice(n,r);if(!_we.test(s))return!0}return!1};se.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;_i.lastIndex=this.pos;var e=_i.exec(this.input),t=this.pos+e[0].length,n;return!ji.test(this.input.slice(this.pos,t))&&this.input.slice(t,t+8)==="function"&&(t+8===this.input.length||!(yc(n=this.input.charCodeAt(t+8))||n>55295&&n<56320))};se.parseStatement=function(e,t,n){var i=this.type,r=this.startNode(),s;switch(this.isLet(e)&&(i=S._var,s="let"),i){case S._break:case S._continue:return this.parseBreakContinueStatement(r,i.keyword);case S._debugger:return this.parseDebuggerStatement(r);case S._do:return this.parseDoStatement(r);case S._for:return this.parseForStatement(r);case S._function:return e&&(this.strict||e!=="if"&&e!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(r,!1,!e);case S._class:return e&&this.unexpected(),this.parseClass(r,!0);case S._if:return this.parseIfStatement(r);case S._return:return this.parseReturnStatement(r);case S._switch:return this.parseSwitchStatement(r);case S._throw:return this.parseThrowStatement(r);case S._try:return this.parseTryStatement(r);case S._const:case S._var:return s=s||this.value,e&&s!=="var"&&this.unexpected(),this.parseVarStatement(r,s);case S._while:return this.parseWhileStatement(r);case S._with:return this.parseWithStatement(r);case S.braceL:return this.parseBlock(!0,r);case S.semi:return this.parseEmptyStatement(r);case S._export:case S._import:if(this.options.ecmaVersion>10&&i===S._import){_i.lastIndex=this.pos;var a=_i.exec(this.input),o=this.pos+a[0].length,u=this.input.charCodeAt(o);if(u===40||u===46)return this.parseExpressionStatement(r,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===S._import?this.parseImport(r):this.parseExport(r,n);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(r,!0,!e);var l=this.value,c=this.parseExpression();return i===S.name&&c.type==="Identifier"&&this.eat(S.colon)?this.parseLabeledStatement(r,l,c,e):this.parseExpressionStatement(r,c)}};se.parseBreakContinueStatement=function(e,t){var n=t==="break";this.next(),this.eat(S.semi)||this.insertSemicolon()?e.label=null:this.type!==S.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var r=this.labels[i];if((e.label==null||r.name===e.label.name)&&(r.kind!=null&&(n||r.kind==="loop")||e.label&&n))break}return i===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")};se.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")};se.parseDoStatement=function(e){return this.next(),this.labels.push(dC),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(S._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(S.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")};se.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(dC),this.enterScope(0),this.expect(S.parenL),this.type===S.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var n=this.isLet();if(this.type===S._var||this.type===S._const||n){var i=this.startNode(),r=n?"let":this.value;return this.next(),this.parseVar(i,!0,r),this.finishNode(i,"VariableDeclaration"),(this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&i.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===S._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,i)):(t>-1&&this.unexpected(t),this.parseFor(e,i))}var s=this.isContextual("let"),a=!1,o=this.containsEsc,u=new Oy,l=this.start,c=t>-1?this.parseExprSubscripts(u,"await"):this.parseExpression(!0,u);return this.type===S._in||(a=this.options.ecmaVersion>=6&&this.isContextual("of"))?(t>-1?(this.type===S._in&&this.unexpected(t),e.await=!0):a&&this.options.ecmaVersion>=8&&(c.start===l&&!o&&c.type==="Identifier"&&c.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(e.await=!1)),s&&a&&this.raise(c.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(c,!1,u),this.checkLValPattern(c),this.parseForIn(e,c)):(this.checkExpressionErrors(u,!0),t>-1&&this.unexpected(t),this.parseFor(e,c))};se.parseFunctionStatement=function(e,t,n){return this.next(),this.parseFunction(e,yh|(n?0:mw),!1,t)};se.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(S._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")};se.parseReturnStatement=function(e){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(S.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")};se.parseSwitchStatement=function(e){this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(S.braceL),this.labels.push(Owe),this.enterScope(0);for(var t,n=!1;this.type!==S.braceR;)if(this.type===S._case||this.type===S._default){var i=this.type===S._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),i?t.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,t.test=null),this.expect(S.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")};se.parseThrowStatement=function(e){return this.next(),ji.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var Nwe=[];se.parseCatchClauseParam=function(){var e=this.parseBindingAtom(),t=e.type==="Identifier";return this.enterScope(t?Gz:0),this.checkLValPattern(e,t?Kz:ha),this.expect(S.parenR),e};se.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===S._catch){var t=this.startNode();this.next(),this.eat(S.parenL)?t.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0)),t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(S._finally)?this.parseBlock():null,!e.handler&&!e.finalizer&&this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")};se.parseVarStatement=function(e,t,n){return this.next(),this.parseVar(e,!1,t,n),this.semicolon(),this.finishNode(e,"VariableDeclaration")};se.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(dC),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")};se.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")};se.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")};se.parseLabeledStatement=function(e,t,n,i){for(var r=0,s=this.labels;r<s.length;r+=1){var a=s[r];a.name===t&&this.raise(n.start,"Label '"+t+"' is already declared")}for(var o=this.type.isLoop?"loop":this.type===S._switch?"switch":null,u=this.labels.length-1;u>=0;u--){var l=this.labels[u];if(l.statementStart===e.start)l.statementStart=this.start,l.kind=o;else break}return this.labels.push({name:t,kind:o,statementStart:this.start}),e.body=this.parseStatement(i?i.indexOf("label")===-1?i+"label":i:"label"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")};se.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")};se.parseBlock=function(e,t,n){for(e===void 0&&(e=!0),t===void 0&&(t=this.startNode()),t.body=[],this.expect(S.braceL),e&&this.enterScope(0);this.type!==S.braceR;){var i=this.parseStatement(null);t.body.push(i)}return n&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")};se.parseFor=function(e,t){return e.init=t,this.expect(S.semi),e.test=this.type===S.semi?null:this.parseExpression(),this.expect(S.semi),e.update=this.type===S.parenR?null:this.parseExpression(),this.expect(S.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")};se.parseForIn=function(e,t){var n=this.type===S._in;return this.next(),t.type==="VariableDeclaration"&&t.declarations[0].init!=null&&(!n||this.options.ecmaVersion<8||this.strict||t.kind!=="var"||t.declarations[0].id.type!=="Identifier")&&this.raise(t.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"),e.left=t,e.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(S.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,n?"ForInStatement":"ForOfStatement")};se.parseVar=function(e,t,n,i){for(e.declarations=[],e.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(S.eq)?r.init=this.parseMaybeAssign(t):!i&&n==="const"&&!(this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!i&&r.id.type!=="Identifier"&&!(t&&(this.type===S._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):r.init=null,e.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(S.comma))break}return e};se.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLValPattern(e.id,t==="var"?hC:ha,!1)};var yh=1,mw=2,Jz=4;se.parseFunction=function(e,t,n,i,r){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(this.type===S.star&&t&mw&&this.unexpected(),e.generator=this.eat(S.star)),this.options.ecmaVersion>=8&&(e.async=!!i),t&yh&&(e.id=t&Jz&&this.type!==S.name?null:this.parseIdent(),e.id&&!(t&mw)&&this.checkLValSimple(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?hC:ha:Xz));var s=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(fC(e.async,e.generator)),t&yh||(e.id=this.type===S.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n,!1,r),this.yieldPos=s,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(e,t&yh?"FunctionDeclaration":"FunctionExpression")};se.parseFunctionParams=function(e){this.expect(S.parenL),e.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};se.parseClass=function(e,t){this.next();var n=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var i=this.enterClassBody(),r=this.startNode(),s=!1;for(r.body=[],this.expect(S.braceL);this.type!==S.braceR;){var a=this.parseClassElement(e.superClass!==null);a&&(r.body.push(a),a.type==="MethodDefinition"&&a.kind==="constructor"?(s&&this.raiseRecoverable(a.start,"Duplicate constructor in the same class"),s=!0):a.key&&a.key.type==="PrivateIdentifier"&&Rwe(i,a)&&this.raiseRecoverable(a.key.start,"Identifier '#"+a.key.name+"' has already been declared"))}return this.strict=n,this.next(),e.body=this.finishNode(r,"ClassBody"),this.exitClassBody(),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")};se.parseClassElement=function(e){if(this.eat(S.semi))return null;var t=this.options.ecmaVersion,n=this.startNode(),i="",r=!1,s=!1,a="method",o=!1;if(this.eatContextual("static")){if(t>=13&&this.eat(S.braceL))return this.parseClassStaticBlock(n),n;this.isClassElementNameStart()||this.type===S.star?o=!0:i="static"}if(n.static=o,!i&&t>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===S.star)&&!this.canInsertSemicolon()?s=!0:i="async"),!i&&(t>=9||!s)&&this.eat(S.star)&&(r=!0),!i&&!s&&!r){var u=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?a=u:i=u)}if(i?(n.computed=!1,n.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),n.key.name=i,this.finishNode(n.key,"Identifier")):this.parseClassElementName(n),t<13||this.type===S.parenL||a!=="method"||r||s){var l=!n.static&&gm(n,"constructor"),c=l&&e;l&&a!=="method"&&this.raise(n.key.start,"Constructor can't have get/set modifier"),n.kind=l?"constructor":a,this.parseClassMethod(n,r,s,c)}else this.parseClassField(n);return n};se.isClassElementNameStart=function(){return this.type===S.name||this.type===S.privateId||this.type===S.num||this.type===S.string||this.type===S.bracketL||this.type.keyword};se.parseClassElementName=function(e){this.type===S.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),e.computed=!1,e.key=this.parsePrivateIdent()):this.parsePropertyName(e)};se.parseClassMethod=function(e,t,n,i){var r=e.key;e.kind==="constructor"?(t&&this.raise(r.start,"Constructor can't be a generator"),n&&this.raise(r.start,"Constructor can't be an async method")):e.static&&gm(e,"prototype")&&this.raise(r.start,"Classes may not have a static property named prototype");var s=e.value=this.parseMethod(t,n,i);return e.kind==="get"&&s.params.length!==0&&this.raiseRecoverable(s.start,"getter should have no params"),e.kind==="set"&&s.params.length!==1&&this.raiseRecoverable(s.start,"setter should have exactly one param"),e.kind==="set"&&s.params[0].type==="RestElement"&&this.raiseRecoverable(s.params[0].start,"Setter cannot use rest params"),this.finishNode(e,"MethodDefinition")};se.parseClassField=function(e){if(gm(e,"constructor")?this.raise(e.key.start,"Classes can't have a field named 'constructor'"):e.static&&gm(e,"prototype")&&this.raise(e.key.start,"Classes can't have a static field named 'prototype'"),this.eat(S.eq)){var t=this.currentThisScope(),n=t.inClassFieldInit;t.inClassFieldInit=!0,e.value=this.parseMaybeAssign(),t.inClassFieldInit=n}else e.value=null;return this.semicolon(),this.finishNode(e,"PropertyDefinition")};se.parseClassStaticBlock=function(e){e.body=[];var t=this.labels;for(this.labels=[],this.enterScope(ep|lC);this.type!==S.braceR;){var n=this.parseStatement(null);e.body.push(n)}return this.next(),this.exitScope(),this.labels=t,this.finishNode(e,"StaticBlock")};se.parseClassId=function(e,t){this.type===S.name?(e.id=this.parseIdent(),t&&this.checkLValSimple(e.id,ha,!1)):(t===!0&&this.unexpected(),e.id=null)};se.parseClassSuper=function(e){e.superClass=this.eat(S._extends)?this.parseExprSubscripts(null,!1):null};se.enterClassBody=function(){var e={declared:Object.create(null),used:[]};return this.privateNameStack.push(e),e.declared};se.exitClassBody=function(){var e=this.privateNameStack.pop(),t=e.declared,n=e.used;if(this.options.checkPrivateFields)for(var i=this.privateNameStack.length,r=i===0?null:this.privateNameStack[i-1],s=0;s<n.length;++s){var a=n[s];Qc(t,a.name)||(r?r.used.push(a):this.raiseRecoverable(a.start,"Private field '#"+a.name+"' must be declared in an enclosing class"))}};function Rwe(e,t){var n=t.key.name,i=e[n],r="true";return t.type==="MethodDefinition"&&(t.kind==="get"||t.kind==="set")&&(r=(t.static?"s":"i")+t.kind),i==="iget"&&r==="iset"||i==="iset"&&r==="iget"||i==="sget"&&r==="sset"||i==="sset"&&r==="sget"?(e[n]="true",!1):i?!0:(e[n]=r,!1)}function gm(e,t){var n=e.computed,i=e.key;return!n&&(i.type==="Identifier"&&i.name===t||i.type==="Literal"&&i.value===t)}se.parseExportAllDeclaration=function(e,t){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseModuleExportName(),this.checkExport(t,e.exported,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==S.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,"ExportAllDeclaration")};se.parseExport=function(e,t){if(this.next(),this.eat(S.star))return this.parseExportAllDeclaration(e,t);if(this.eat(S._default))return this.checkExport(t,"default",this.lastTokStart),e.declaration=this.parseExportDefaultDeclaration(),this.finishNode(e,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())e.declaration=this.parseExportDeclaration(e),e.declaration.type==="VariableDeclaration"?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==S.string&&this.unexpected(),e.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause());else{for(var n=0,i=e.specifiers;n<i.length;n+=1){var r=i[n];this.checkUnreserved(r.local),this.checkLocalExport(r.local),r.local.type==="Literal"&&this.raise(r.local.start,"A string literal cannot be used as an exported binding without `from`.")}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")};se.parseExportDeclaration=function(e){return this.parseStatement(null)};se.parseExportDefaultDeclaration=function(){var e;if(this.type===S._function||(e=this.isAsyncFunction())){var t=this.startNode();return this.next(),e&&this.next(),this.parseFunction(t,yh|Jz,!1,e)}else if(this.type===S._class){var n=this.startNode();return this.parseClass(n,"nullableID")}else{var i=this.parseMaybeAssign();return this.semicolon(),i}};se.checkExport=function(e,t,n){e&&(typeof t!="string"&&(t=t.type==="Identifier"?t.name:t.value),Qc(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)};se.checkPatternExport=function(e,t){var n=t.type;if(n==="Identifier")this.checkExport(e,t,t.start);else if(n==="ObjectPattern")for(var i=0,r=t.properties;i<r.length;i+=1){var s=r[i];this.checkPatternExport(e,s)}else if(n==="ArrayPattern")for(var a=0,o=t.elements;a<o.length;a+=1){var u=o[a];u&&this.checkPatternExport(e,u)}else n==="Property"?this.checkPatternExport(e,t.value):n==="AssignmentPattern"?this.checkPatternExport(e,t.left):n==="RestElement"&&this.checkPatternExport(e,t.argument)};se.checkVariableExport=function(e,t){if(e)for(var n=0,i=t;n<i.length;n+=1){var r=i[n];this.checkPatternExport(e,r.id)}};se.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};se.parseExportSpecifier=function(e){var t=this.startNode();return t.local=this.parseModuleExportName(),t.exported=this.eatContextual("as")?this.parseModuleExportName():t.local,this.checkExport(e,t.exported,t.exported.start),this.finishNode(t,"ExportSpecifier")};se.parseExportSpecifiers=function(e){var t=[],n=!0;for(this.expect(S.braceL);!this.eat(S.braceR);){if(n)n=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;t.push(this.parseExportSpecifier(e))}return t};se.parseImport=function(e){return this.next(),this.type===S.string?(e.specifiers=Nwe,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===S.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(e.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(e,"ImportDeclaration")};se.parseImportSpecifier=function(){var e=this.startNode();return e.imported=this.parseModuleExportName(),this.eatContextual("as")?e.local=this.parseIdent():(this.checkUnreserved(e.imported),e.local=e.imported),this.checkLValSimple(e.local,ha),this.finishNode(e,"ImportSpecifier")};se.parseImportDefaultSpecifier=function(){var e=this.startNode();return e.local=this.parseIdent(),this.checkLValSimple(e.local,ha),this.finishNode(e,"ImportDefaultSpecifier")};se.parseImportNamespaceSpecifier=function(){var e=this.startNode();return this.next(),this.expectContextual("as"),e.local=this.parseIdent(),this.checkLValSimple(e.local,ha),this.finishNode(e,"ImportNamespaceSpecifier")};se.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===S.name&&(e.push(this.parseImportDefaultSpecifier()),!this.eat(S.comma)))return e;if(this.type===S.star)return e.push(this.parseImportNamespaceSpecifier()),e;for(this.expect(S.braceL);!this.eat(S.braceR);){if(t)t=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;e.push(this.parseImportSpecifier())}return e};se.parseWithClause=function(){var e=[];if(!this.eat(S._with))return e;this.expect(S.braceL);for(var t={},n=!0;!this.eat(S.braceR);){if(n)n=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var i=this.parseImportAttribute(),r=i.key.type==="Identifier"?i.key.name:i.key.value;Qc(t,r)&&this.raiseRecoverable(i.key.start,"Duplicate attribute key '"+r+"'"),t[r]=!0,e.push(i)}return e};se.parseImportAttribute=function(){var e=this.startNode();return e.key=this.type===S.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(S.colon),this.type!==S.string&&this.unexpected(),e.value=this.parseExprAtom(),this.finishNode(e,"ImportAttribute")};se.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===S.string){var e=this.parseLiteral(this.value);return $we.test(e.value)&&this.raise(e.start,"An export name cannot include a lone surrogate."),e}return this.parseIdent(!0)};se.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)};se.isDirectiveCandidate=function(e){return this.options.ecmaVersion>=5&&e.type==="ExpressionStatement"&&e.expression.type==="Literal"&&typeof e.expression.value=="string"&&(this.input[e.start]==='"'||this.input[e.start]==="'")};var qi=Tt.prototype;qi.toAssignable=function(e,t,n){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&e.name==="await"&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var i=0,r=e.properties;i<r.length;i+=1){var s=r[i];this.toAssignable(s,t),s.type==="RestElement"&&(s.argument.type==="ArrayPattern"||s.argument.type==="ObjectPattern")&&this.raise(s.argument.start,"Unexpected token")}break;case"Property":e.kind!=="init"&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),e.argument.type==="AssignmentPattern"&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":e.operator!=="="&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,n);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return e};qi.toAssignableList=function(e,t){for(var n=e.length,i=0;i<n;i++){var r=e[i];r&&this.toAssignable(r,t)}if(n){var s=e[n-1];this.options.ecmaVersion===6&&t&&s&&s.type==="RestElement"&&s.argument.type!=="Identifier"&&this.unexpected(s.argument.start)}return e};qi.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")};qi.parseRestBinding=function(){var e=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==S.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")};qi.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case S.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(S.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case S.braceL:return this.parseObj(!0)}return this.parseIdent()};qi.parseBindingList=function(e,t,n,i){for(var r=[],s=!0;!this.eat(e);)if(s?s=!1:this.expect(S.comma),t&&this.type===S.comma)r.push(null);else{if(n&&this.afterTrailingComma(e))break;if(this.type===S.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),r.push(a),this.type===S.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}else r.push(this.parseAssignableListItem(i))}return r};qi.parseAssignableListItem=function(e){var t=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(t),t};qi.parseBindingListItem=function(e){return e};qi.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(S.eq))return n;var i=this.startNodeAt(e,t);return i.left=n,i.right=this.parseMaybeAssign(),this.finishNode(i,"AssignmentPattern")};qi.checkLValSimple=function(e,t,n){t===void 0&&(t=pm);var i=t!==pm;switch(e.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(i?"Binding ":"Assigning to ")+e.name+" in strict mode"),i&&(t===ha&&e.name==="let"&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),n&&(Qc(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),t!==Qz&&this.declareName(e.name,t,e.start));break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":i&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ParenthesizedExpression":return i&&this.raiseRecoverable(e.start,"Binding parenthesized expression"),this.checkLValSimple(e.expression,t,n);default:this.raise(e.start,(i?"Binding":"Assigning to")+" rvalue")}};qi.checkLValPattern=function(e,t,n){switch(t===void 0&&(t=pm),e.type){case"ObjectPattern":for(var i=0,r=e.properties;i<r.length;i+=1){var s=r[i];this.checkLValInnerPattern(s,t,n)}break;case"ArrayPattern":for(var a=0,o=e.elements;a<o.length;a+=1){var u=o[a];u&&this.checkLValInnerPattern(u,t,n)}break;default:this.checkLValSimple(e,t,n)}};qi.checkLValInnerPattern=function(e,t,n){switch(t===void 0&&(t=pm),e.type){case"Property":this.checkLValInnerPattern(e.value,t,n);break;case"AssignmentPattern":this.checkLValPattern(e.left,t,n);break;case"RestElement":this.checkLValPattern(e.argument,t,n);break;default:this.checkLValPattern(e,t,n)}};var Gi=function(t,n,i,r,s){this.token=t,this.isExpr=!!n,this.preserveSpace=!!i,this.override=r,this.generator=!!s},nt={b_stat:new Gi("{",!1),b_expr:new Gi("{",!0),b_tmpl:new Gi("${",!1),p_stat:new Gi("(",!1),p_expr:new Gi("(",!0),q_tmpl:new Gi("`",!0,!0,function(e){return e.tryReadTemplateToken()}),f_stat:new Gi("function",!1),f_expr:new Gi("function",!0),f_expr_gen:new Gi("function",!0,!1,null,!0),f_gen:new Gi("function",!1,!1,null,!0)},Zc=Tt.prototype;Zc.initialContext=function(){return[nt.b_stat]};Zc.curContext=function(){return this.context[this.context.length-1]};Zc.braceIsBlock=function(e){var t=this.curContext();return t===nt.f_expr||t===nt.f_stat?!0:e===S.colon&&(t===nt.b_stat||t===nt.b_expr)?!t.isExpr:e===S._return||e===S.name&&this.exprAllowed?ji.test(this.input.slice(this.lastTokEnd,this.start)):e===S._else||e===S.semi||e===S.eof||e===S.parenR||e===S.arrow?!0:e===S.braceL?t===nt.b_stat:e===S._var||e===S._const||e===S.name?!1:!this.exprAllowed};Zc.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if(t.token==="function")return t.generator}return!1};Zc.updateContext=function(e){var t,n=this.type;n.keyword&&e===S.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr};Zc.overrideContext=function(e){this.curContext()!==e&&(this.context[this.context.length-1]=e)};S.parenR.updateContext=S.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var e=this.context.pop();e===nt.b_stat&&this.curContext().token==="function"&&(e=this.context.pop()),this.exprAllowed=!e.isExpr};S.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?nt.b_stat:nt.b_expr),this.exprAllowed=!0};S.dollarBraceL.updateContext=function(){this.context.push(nt.b_tmpl),this.exprAllowed=!0};S.parenL.updateContext=function(e){var t=e===S._if||e===S._for||e===S._with||e===S._while;this.context.push(t?nt.p_stat:nt.p_expr),this.exprAllowed=!0};S.incDec.updateContext=function(){};S._function.updateContext=S._class.updateContext=function(e){e.beforeExpr&&e!==S._else&&!(e===S.semi&&this.curContext()!==nt.p_stat)&&!(e===S._return&&ji.test(this.input.slice(this.lastTokEnd,this.start)))&&!((e===S.colon||e===S.braceL)&&this.curContext()===nt.b_stat)?this.context.push(nt.f_expr):this.context.push(nt.f_stat),this.exprAllowed=!1};S.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0};S.backQuote.updateContext=function(){this.curContext()===nt.q_tmpl?this.context.pop():this.context.push(nt.q_tmpl),this.exprAllowed=!1};S.star.updateContext=function(e){if(e===S._function){var t=this.context.length-1;this.context[t]===nt.f_expr?this.context[t]=nt.f_expr_gen:this.context[t]=nt.f_gen}this.exprAllowed=!0};S.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==S.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var pe=Tt.prototype;pe.checkPropClash=function(e,t,n){if(!(this.options.ecmaVersion>=9&&e.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var i=e.key,r;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var s=e.kind;if(this.options.ecmaVersion>=6){r==="__proto__"&&s==="init"&&(t.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0);return}r="$"+r;var a=t[r];if(a){var o;s==="init"?o=this.strict&&a.init||a.get||a.set:o=a.init||a[s],o&&this.raiseRecoverable(i.start,"Redefinition of property")}else a=t[r]={init:!1,get:!1,set:!1};a[s]=!0}};pe.parseExpression=function(e,t){var n=this.start,i=this.startLoc,r=this.parseMaybeAssign(e,t);if(this.type===S.comma){var s=this.startNodeAt(n,i);for(s.expressions=[r];this.eat(S.comma);)s.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(s,"SequenceExpression")}return r};pe.parseMaybeAssign=function(e,t,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var i=!1,r=-1,s=-1,a=-1;t?(r=t.parenthesizedAssign,s=t.trailingComma,a=t.doubleProto,t.parenthesizedAssign=t.trailingComma=-1):(t=new Oy,i=!0);var o=this.start,u=this.startLoc;(this.type===S.parenL||this.type===S.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=e==="await");var l=this.parseMaybeConditional(e,t);if(n&&(l=n.call(this,l,o,u)),this.type.isAssign){var c=this.startNodeAt(o,u);return c.operator=this.value,this.type===S.eq&&(l=this.toAssignable(l,!1,t)),i||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=l.start&&(t.shorthandAssign=-1),this.type===S.eq?this.checkLValPattern(l):this.checkLValSimple(l),c.left=l,this.next(),c.right=this.parseMaybeAssign(e),a>-1&&(t.doubleProto=a),this.finishNode(c,"AssignmentExpression")}else i&&this.checkExpressionErrors(t,!0);return r>-1&&(t.parenthesizedAssign=r),s>-1&&(t.trailingComma=s),l};pe.parseMaybeConditional=function(e,t){var n=this.start,i=this.startLoc,r=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return r;if(this.eat(S.question)){var s=this.startNodeAt(n,i);return s.test=r,s.consequent=this.parseMaybeAssign(),this.expect(S.colon),s.alternate=this.parseMaybeAssign(e),this.finishNode(s,"ConditionalExpression")}return r};pe.parseExprOps=function(e,t){var n=this.start,i=this.startLoc,r=this.parseMaybeUnary(t,!1,!1,e);return this.checkExpressionErrors(t)||r.start===n&&r.type==="ArrowFunctionExpression"?r:this.parseExprOp(r,n,i,-1,e)};pe.parseExprOp=function(e,t,n,i,r){var s=this.type.binop;if(s!=null&&(!r||this.type!==S._in)&&s>i){var a=this.type===S.logicalOR||this.type===S.logicalAND,o=this.type===S.coalesce;o&&(s=S.logicalAND.binop);var u=this.value;this.next();var l=this.start,c=this.startLoc,f=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,r),l,c,s,r),h=this.buildBinary(t,n,e,f,u,a||o);return(a&&this.type===S.coalesce||o&&(this.type===S.logicalOR||this.type===S.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(h,t,n,i,r)}return e};pe.buildBinary=function(e,t,n,i,r,s){i.type==="PrivateIdentifier"&&this.raise(i.start,"Private identifier can only be left side of binary expression");var a=this.startNodeAt(e,t);return a.left=n,a.operator=r,a.right=i,this.finishNode(a,s?"LogicalExpression":"BinaryExpression")};pe.parseMaybeUnary=function(e,t,n,i){var r=this.start,s=this.startLoc,a;if(this.isContextual("await")&&this.canAwait)a=this.parseAwait(i),t=!0;else if(this.type.prefix){var o=this.startNode(),u=this.type===S.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0,u,i),this.checkExpressionErrors(e,!0),u?this.checkLValSimple(o.argument):this.strict&&o.operator==="delete"&&Zz(o.argument)?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):o.operator==="delete"&&yw(o.argument)?this.raiseRecoverable(o.start,"Private fields can not be deleted"):t=!0,a=this.finishNode(o,u?"UpdateExpression":"UnaryExpression")}else if(!t&&this.type===S.privateId)(i||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),a=this.parsePrivateIdent(),this.type!==S._in&&this.unexpected();else{if(a=this.parseExprSubscripts(e,i),this.checkExpressionErrors(e))return a;for(;this.type.postfix&&!this.canInsertSemicolon();){var l=this.startNodeAt(r,s);l.operator=this.value,l.prefix=!1,l.argument=a,this.checkLValSimple(a),this.next(),a=this.finishNode(l,"UpdateExpression")}}if(!n&&this.eat(S.starstar))if(t)this.unexpected(this.lastTokStart);else return this.buildBinary(r,s,a,this.parseMaybeUnary(null,!1,!1,i),"**",!1);else return a};function Zz(e){return e.type==="Identifier"||e.type==="ParenthesizedExpression"&&Zz(e.expression)}function yw(e){return e.type==="MemberExpression"&&e.property.type==="PrivateIdentifier"||e.type==="ChainExpression"&&yw(e.expression)||e.type==="ParenthesizedExpression"&&yw(e.expression)}pe.parseExprSubscripts=function(e,t){var n=this.start,i=this.startLoc,r=this.parseExprAtom(e,t);if(r.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return r;var s=this.parseSubscripts(r,n,i,!1,t);return e&&s.type==="MemberExpression"&&(e.parenthesizedAssign>=s.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=s.start&&(e.parenthesizedBind=-1),e.trailingComma>=s.start&&(e.trailingComma=-1)),s};pe.parseSubscripts=function(e,t,n,i,r){for(var s=this.options.ecmaVersion>=8&&e.type==="Identifier"&&e.name==="async"&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start===5&&this.potentialArrowAt===e.start,a=!1;;){var o=this.parseSubscript(e,t,n,i,s,a,r);if(o.optional&&(a=!0),o===e||o.type==="ArrowFunctionExpression"){if(a){var u=this.startNodeAt(t,n);u.expression=o,o=this.finishNode(u,"ChainExpression")}return o}e=o}};pe.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(S.arrow)};pe.parseSubscriptAsyncArrow=function(e,t,n,i){return this.parseArrowExpression(this.startNodeAt(e,t),n,!0,i)};pe.parseSubscript=function(e,t,n,i,r,s,a){var o=this.options.ecmaVersion>=11,u=o&&this.eat(S.questionDot);i&&u&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var l=this.eat(S.bracketL);if(l||u&&this.type!==S.parenL&&this.type!==S.backQuote||this.eat(S.dot)){var c=this.startNodeAt(t,n);c.object=e,l?(c.property=this.parseExpression(),this.expect(S.bracketR)):this.type===S.privateId&&e.type!=="Super"?c.property=this.parsePrivateIdent():c.property=this.parseIdent(this.options.allowReserved!=="never"),c.computed=!!l,o&&(c.optional=u),e=this.finishNode(c,"MemberExpression")}else if(!i&&this.eat(S.parenL)){var f=new Oy,h=this.yieldPos,d=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var g=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1,f);if(r&&!u&&this.shouldParseAsyncArrow())return this.checkPatternErrors(f,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=d,this.awaitIdentPos=p,this.parseSubscriptAsyncArrow(t,n,g,a);this.checkExpressionErrors(f,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=d||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var m=this.startNodeAt(t,n);m.callee=e,m.arguments=g,o&&(m.optional=u),e=this.finishNode(m,"CallExpression")}else if(this.type===S.backQuote){(u||s)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var y=this.startNodeAt(t,n);y.tag=e,y.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(y,"TaggedTemplateExpression")}return e};pe.parseExprAtom=function(e,t,n){this.type===S.slash&&this.readRegexp();var i,r=this.potentialArrowAt===this.start;switch(this.type){case S._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),i=this.startNode(),this.next(),this.type===S.parenL&&!this.allowDirectSuper&&this.raise(i.start,"super() call outside constructor of a subclass"),this.type!==S.dot&&this.type!==S.bracketL&&this.type!==S.parenL&&this.unexpected(),this.finishNode(i,"Super");case S._this:return i=this.startNode(),this.next(),this.finishNode(i,"ThisExpression");case S.name:var s=this.start,a=this.startLoc,o=this.containsEsc,u=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&u.name==="async"&&!this.canInsertSemicolon()&&this.eat(S._function))return this.overrideContext(nt.f_expr),this.parseFunction(this.startNodeAt(s,a),0,!1,!0,t);if(r&&!this.canInsertSemicolon()){if(this.eat(S.arrow))return this.parseArrowExpression(this.startNodeAt(s,a),[u],!1,t);if(this.options.ecmaVersion>=8&&u.name==="async"&&this.type===S.name&&!o&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return u=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(S.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(s,a),[u],!0,t)}return u;case S.regexp:var l=this.value;return i=this.parseLiteral(l.value),i.regex={pattern:l.pattern,flags:l.flags},i;case S.num:case S.string:return this.parseLiteral(this.value);case S._null:case S._true:case S._false:return i=this.startNode(),i.value=this.type===S._null?null:this.type===S._true,i.raw=this.type.keyword,this.next(),this.finishNode(i,"Literal");case S.parenL:var c=this.start,f=this.parseParenAndDistinguishExpression(r,t);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(f)&&(e.parenthesizedAssign=c),e.parenthesizedBind<0&&(e.parenthesizedBind=c)),f;case S.bracketL:return i=this.startNode(),this.next(),i.elements=this.parseExprList(S.bracketR,!0,!0,e),this.finishNode(i,"ArrayExpression");case S.braceL:return this.overrideContext(nt.b_expr),this.parseObj(!1,e);case S._function:return i=this.startNode(),this.next(),this.parseFunction(i,0);case S._class:return this.parseClass(this.startNode(),!1);case S._new:return this.parseNew();case S.backQuote:return this.parseTemplate();case S._import:return this.options.ecmaVersion>=11?this.parseExprImport(n):this.unexpected();default:return this.parseExprAtomDefault()}};pe.parseExprAtomDefault=function(){this.unexpected()};pe.parseExprImport=function(e){var t=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===S.parenL&&!e)return this.parseDynamicImport(t);if(this.type===S.dot){var n=this.startNodeAt(t.start,t.loc&&t.loc.start);return n.name="import",t.meta=this.finishNode(n,"Identifier"),this.parseImportMeta(t)}else this.unexpected()};pe.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(S.parenR)?e.options=null:(this.expect(S.comma),this.afterTrailingComma(S.parenR)?e.options=null:(e.options=this.parseMaybeAssign(),this.eat(S.parenR)||(this.expect(S.comma),this.afterTrailingComma(S.parenR)||this.unexpected())));else if(!this.eat(S.parenR)){var t=this.start;this.eat(S.comma)&&this.eat(S.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")};pe.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="meta"&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")};pe.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),t.raw.charCodeAt(t.raw.length-1)===110&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")};pe.parseParenExpression=function(){this.expect(S.parenL);var e=this.parseExpression();return this.expect(S.parenR),e};pe.shouldParseArrow=function(e){return!this.canInsertSemicolon()};pe.parseParenAndDistinguishExpression=function(e,t){var n=this.start,i=this.startLoc,r,s=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a=this.start,o=this.startLoc,u=[],l=!0,c=!1,f=new Oy,h=this.yieldPos,d=this.awaitPos,p;for(this.yieldPos=0,this.awaitPos=0;this.type!==S.parenR;)if(l?l=!1:this.expect(S.comma),s&&this.afterTrailingComma(S.parenR,!0)){c=!0;break}else if(this.type===S.ellipsis){p=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===S.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else u.push(this.parseMaybeAssign(!1,f,this.parseParenItem));var g=this.lastTokEnd,m=this.lastTokEndLoc;if(this.expect(S.parenR),e&&this.shouldParseArrow(u)&&this.eat(S.arrow))return this.checkPatternErrors(f,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=h,this.awaitPos=d,this.parseParenArrowList(n,i,u,t);(!u.length||c)&&this.unexpected(this.lastTokStart),p&&this.unexpected(p),this.checkExpressionErrors(f,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=d||this.awaitPos,u.length>1?(r=this.startNodeAt(a,o),r.expressions=u,this.finishNodeAt(r,"SequenceExpression",g,m)):r=u[0]}else r=this.parseParenExpression();if(this.options.preserveParens){var y=this.startNodeAt(n,i);return y.expression=r,this.finishNode(y,"ParenthesizedExpression")}else return r};pe.parseParenItem=function(e){return e};pe.parseParenArrowList=function(e,t,n,i){return this.parseArrowExpression(this.startNodeAt(e,t),n,!1,i)};var Dwe=[];pe.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===S.dot){var t=this.startNodeAt(e.start,e.loc&&e.loc.start);t.name="new",e.meta=this.finishNode(t,"Identifier"),this.next();var n=this.containsEsc;return e.property=this.parseIdent(!0),e.property.name!=="target"&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(e.start,"'new.target' can only be used in functions and class static block"),this.finishNode(e,"MetaProperty")}var i=this.start,r=this.startLoc;return e.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),i,r,!0,!1),this.eat(S.parenL)?e.arguments=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1):e.arguments=Dwe,this.finishNode(e,"NewExpression")};pe.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===S.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),n.tail=this.type===S.backQuote,this.finishNode(n,"TemplateElement")};pe.parseTemplate=function(e){e===void 0&&(e={});var t=e.isTagged;t===void 0&&(t=!1);var n=this.startNode();this.next(),n.expressions=[];var i=this.parseTemplateElement({isTagged:t});for(n.quasis=[i];!i.tail;)this.type===S.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(S.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(S.braceR),n.quasis.push(i=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(n,"TemplateLiteral")};pe.isAsyncProp=function(e){return!e.computed&&e.key.type==="Identifier"&&e.key.name==="async"&&(this.type===S.name||this.type===S.num||this.type===S.string||this.type===S.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===S.star)&&!ji.test(this.input.slice(this.lastTokEnd,this.start))};pe.parseObj=function(e,t){var n=this.startNode(),i=!0,r={};for(n.properties=[],this.next();!this.eat(S.braceR);){if(i)i=!1;else if(this.expect(S.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(S.braceR))break;var s=this.parseProperty(e,t);e||this.checkPropClash(s,r,t),n.properties.push(s)}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")};pe.parseProperty=function(e,t){var n=this.startNode(),i,r,s,a;if(this.options.ecmaVersion>=9&&this.eat(S.ellipsis))return e?(n.argument=this.parseIdent(!1),this.type===S.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(n,"RestElement")):(n.argument=this.parseMaybeAssign(!1,t),this.type===S.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(n,"SpreadElement"));this.options.ecmaVersion>=6&&(n.method=!1,n.shorthand=!1,(e||t)&&(s=this.start,a=this.startLoc),e||(i=this.eat(S.star)));var o=this.containsEsc;return this.parsePropertyName(n),!e&&!o&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(n)?(r=!0,i=this.options.ecmaVersion>=9&&this.eat(S.star),this.parsePropertyName(n)):r=!1,this.parsePropertyValue(n,e,i,r,s,a,t,o),this.finishNode(n,"Property")};pe.parseGetterSetter=function(e){e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var t=e.kind==="get"?0:1;if(e.value.params.length!==t){var n=e.value.start;e.kind==="get"?this.raiseRecoverable(n,"getter should have no params"):this.raiseRecoverable(n,"setter should have exactly one param")}else e.kind==="set"&&e.value.params[0].type==="RestElement"&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")};pe.parsePropertyValue=function(e,t,n,i,r,s,a,o){(n||i)&&this.type===S.colon&&this.unexpected(),this.eat(S.colon)?(e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),e.kind="init"):this.options.ecmaVersion>=6&&this.type===S.parenL?(t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,i)):!t&&!o&&this.options.ecmaVersion>=5&&!e.computed&&e.key.type==="Identifier"&&(e.key.name==="get"||e.key.name==="set")&&this.type!==S.comma&&this.type!==S.braceR&&this.type!==S.eq?((n||i)&&this.unexpected(),this.parseGetterSetter(e)):this.options.ecmaVersion>=6&&!e.computed&&e.key.type==="Identifier"?((n||i)&&this.unexpected(),this.checkUnreserved(e.key),e.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=r),e.kind="init",t?e.value=this.parseMaybeDefault(r,s,this.copyNode(e.key)):this.type===S.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),e.value=this.parseMaybeDefault(r,s,this.copyNode(e.key))):e.value=this.copyNode(e.key),e.shorthand=!0):this.unexpected()};pe.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(S.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(S.bracketR),e.key;e.computed=!1}return e.key=this.type===S.num||this.type===S.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};pe.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)};pe.parseMethod=function(e,t,n){var i=this.startNode(),r=this.yieldPos,s=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=e),this.options.ecmaVersion>=8&&(i.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(fC(t,i.generator)|lC|(n?Yz:0)),this.expect(S.parenL),i.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1,!0,!1),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=a,this.finishNode(i,"FunctionExpression")};pe.parseArrowExpression=function(e,t,n,i){var r=this.yieldPos,s=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(fC(n,!1)|Hz),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1,i),this.yieldPos=r,this.awaitPos=s,this.awaitIdentPos=a,this.finishNode(e,"ArrowFunctionExpression")};pe.parseFunctionBody=function(e,t,n,i){var r=t&&this.type!==S.braceL,s=this.strict,a=!1;if(r)e.body=this.parseMaybeAssign(i),e.expression=!0,this.checkParams(e,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);(!s||o)&&(a=this.strictDirective(this.end),a&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var u=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(e,!s&&!a&&!t&&!n&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLValSimple(e.id,Qz),e.body=this.parseBlock(!1,void 0,a&&!s),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=u}this.exitScope()};pe.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1){var i=n[t];if(i.type!=="Identifier")return!1}return!0};pe.checkParams=function(e,t){for(var n=Object.create(null),i=0,r=e.params;i<r.length;i+=1){var s=r[i];this.checkLValInnerPattern(s,hC,t?null:n)}};pe.parseExprList=function(e,t,n,i){for(var r=[],s=!0;!this.eat(e);){if(s)s=!1;else if(this.expect(S.comma),t&&this.afterTrailingComma(e))break;var a=void 0;n&&this.type===S.comma?a=null:this.type===S.ellipsis?(a=this.parseSpread(i),i&&this.type===S.comma&&i.trailingComma<0&&(i.trailingComma=this.start)):a=this.parseMaybeAssign(!1,i),r.push(a)}return r};pe.checkUnreserved=function(e){var t=e.start,n=e.end,i=e.name;if(this.inGenerator&&i==="yield"&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&i==="await"&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.currentThisScope().inClassFieldInit&&i==="arguments"&&this.raiseRecoverable(t,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(i==="arguments"||i==="await")&&this.raise(t,"Cannot use "+i+" in class static initialization block"),this.keywords.test(i)&&this.raise(t,"Unexpected keyword '"+i+"'"),!(this.options.ecmaVersion<6&&this.input.slice(t,n).indexOf("\\")!==-1)){var r=this.strict?this.reservedWordsStrict:this.reservedWords;r.test(i)&&(!this.inAsync&&i==="await"&&this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+i+"' is reserved"))}};pe.parseIdent=function(e){var t=this.parseIdentNode();return this.next(!!e),this.finishNode(t,"Identifier"),e||(this.checkUnreserved(t),t.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=t.start)),t};pe.parseIdentNode=function(){var e=this.startNode();return this.type===S.name?e.name=this.value:this.type.keyword?(e.name=this.type.keyword,(e.name==="class"||e.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=S.name):this.unexpected(),e};pe.parsePrivateIdent=function(){var e=this.startNode();return this.type===S.privateId?e.name=this.value:this.unexpected(),this.next(),this.finishNode(e,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(e.start,"Private field '#"+e.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(e)),e};pe.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===S.semi||this.canInsertSemicolon()||this.type!==S.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(S.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")};pe.parseAwait=function(e){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0,!1,e),this.finishNode(t,"AwaitExpression")};var mm=Tt.prototype;mm.raise=function(e,t){var n=Vz(this.input,e);t+=" ("+n.line+":"+n.column+")";var i=new SyntaxError(t);throw i.pos=e,i.loc=n,i.raisedAt=this.pos,i};mm.raiseRecoverable=mm.raise;mm.curPosition=function(){if(this.options.locations)return new Zh(this.curLine,this.pos-this.lineStart)};var Eo=Tt.prototype,Iwe=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[],this.inClassFieldInit=!1};Eo.enterScope=function(e){this.scopeStack.push(new Iwe(e))};Eo.exitScope=function(){this.scopeStack.pop()};Eo.treatFunctionsAsVarInScope=function(e){return e.flags&Jc||!this.inModule&&e.flags&ed};Eo.declareName=function(e,t,n){var i=!1;if(t===ha){var r=this.currentScope();i=r.lexical.indexOf(e)>-1||r.functions.indexOf(e)>-1||r.var.indexOf(e)>-1,r.lexical.push(e),this.inModule&&r.flags&ed&&delete this.undefinedExports[e]}else if(t===Kz){var s=this.currentScope();s.lexical.push(e)}else if(t===Xz){var a=this.currentScope();this.treatFunctionsAsVar?i=a.lexical.indexOf(e)>-1:i=a.lexical.indexOf(e)>-1||a.var.indexOf(e)>-1,a.functions.push(e)}else for(var o=this.scopeStack.length-1;o>=0;--o){var u=this.scopeStack[o];if(u.lexical.indexOf(e)>-1&&!(u.flags&Gz&&u.lexical[0]===e)||!this.treatFunctionsAsVarInScope(u)&&u.functions.indexOf(e)>-1){i=!0;break}if(u.var.push(e),this.inModule&&u.flags&ed&&delete this.undefinedExports[e],u.flags&cC)break}i&&this.raiseRecoverable(n,"Identifier '"+e+"' has already been declared")};Eo.checkLocalExport=function(e){this.scopeStack[0].lexical.indexOf(e.name)===-1&&this.scopeStack[0].var.indexOf(e.name)===-1&&(this.undefinedExports[e.name]=e)};Eo.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};Eo.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&cC)return t}};Eo.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(t.flags&cC&&!(t.flags&Hz))return t}};var Ny=function(t,n,i){this.type="",this.start=n,this.end=0,t.options.locations&&(this.loc=new My(t,i)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[n,0])},tp=Tt.prototype;tp.startNode=function(){return new Ny(this,this.start,this.startLoc)};tp.startNodeAt=function(e,t){return new Ny(this,e,t)};function eB(e,t,n,i){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=i),this.options.ranges&&(e.range[1]=n),e}tp.finishNode=function(e,t){return eB.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)};tp.finishNodeAt=function(e,t,n,i){return eB.call(this,e,t,n,i)};tp.copyNode=function(e){var t=new Ny(this,e.start,this.startLoc);for(var n in e)t[n]=e[n];return t};var Pwe="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",tB="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",nB=tB+" Extended_Pictographic",iB=nB,rB=iB+" EBase EComp EMod EPres ExtPict",sB=rB,Lwe=sB,zwe={9:tB,10:nB,11:iB,12:rB,13:sB,14:Lwe},Bwe="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",Uwe={9:"",10:"",11:"",12:"",13:"",14:Bwe},PO="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",aB="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",oB=aB+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",uB=oB+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",lB=uB+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",cB=lB+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",jwe=cB+" "+Pwe,qwe={9:aB,10:oB,11:uB,12:lB,13:cB,14:jwe},fB={};function Vwe(e){var t=fB[e]={binary:Na(zwe[e]+" "+PO),binaryOfStrings:Na(Uwe[e]),nonBinary:{General_Category:Na(PO),Script:Na(qwe[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}for(var Vv=0,LO=[9,10,11,12,13,14];Vv<LO.length;Vv+=1){var Wwe=LO[Vv];Vwe(Wwe)}var ne=Tt.prototype,ym=function(t,n){this.parent=t,this.base=n||this};ym.prototype.separatedFrom=function(t){for(var n=this;n;n=n.parent)for(var i=t;i;i=i.parent)if(n.base===i.base&&n!==i)return!0;return!1};ym.prototype.sibling=function(){return new ym(this.parent,this.base)};var xs=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":"")+(t.options.ecmaVersion>=13?"d":"")+(t.options.ecmaVersion>=15?"v":""),this.unicodeProperties=fB[t.options.ecmaVersion>=14?14:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};xs.prototype.reset=function(t,n,i){var r=i.indexOf("v")!==-1,s=i.indexOf("u")!==-1;this.start=t|0,this.source=n+"",this.flags=i,r&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=s&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=s&&this.parser.options.ecmaVersion>=9)};xs.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)};xs.prototype.at=function(t,n){n===void 0&&(n=!1);var i=this.source,r=i.length;if(t>=r)return-1;var s=i.charCodeAt(t);if(!(n||this.switchU)||s<=55295||s>=57344||t+1>=r)return s;var a=i.charCodeAt(t+1);return a>=56320&&a<=57343?(s<<10)+a-56613888:s};xs.prototype.nextIndex=function(t,n){n===void 0&&(n=!1);var i=this.source,r=i.length;if(t>=r)return r;var s=i.charCodeAt(t),a;return!(n||this.switchU)||s<=55295||s>=57344||t+1>=r||(a=i.charCodeAt(t+1))<56320||a>57343?t+1:t+2};xs.prototype.current=function(t){return t===void 0&&(t=!1),this.at(this.pos,t)};xs.prototype.lookahead=function(t){return t===void 0&&(t=!1),this.at(this.nextIndex(this.pos,t),t)};xs.prototype.advance=function(t){t===void 0&&(t=!1),this.pos=this.nextIndex(this.pos,t)};xs.prototype.eat=function(t,n){return n===void 0&&(n=!1),this.current(n)===t?(this.advance(n),!0):!1};xs.prototype.eatChars=function(t,n){n===void 0&&(n=!1);for(var i=this.pos,r=0,s=t;r<s.length;r+=1){var a=s[r],o=this.at(i,n);if(o===-1||o!==a)return!1;i=this.nextIndex(i,n)}return this.pos=i,!0};ne.validateRegExpFlags=function(e){for(var t=e.validFlags,n=e.flags,i=!1,r=!1,s=0;s<n.length;s++){var a=n.charAt(s);t.indexOf(a)===-1&&this.raise(e.start,"Invalid regular expression flag"),n.indexOf(a,s+1)>-1&&this.raise(e.start,"Duplicate regular expression flag"),a==="u"&&(i=!0),a==="v"&&(r=!0)}this.options.ecmaVersion>=15&&i&&r&&this.raise(e.start,"Invalid regular expression flag")};function Hwe(e){for(var t in e)return!0;return!1}ne.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&Hwe(e.groupNames)&&(e.switchN=!0,this.regexp_pattern(e))};ne.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames=Object.create(null),e.backReferenceNames.length=0,e.branchID=null,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,n=e.backReferenceNames;t<n.length;t+=1){var i=n[t];e.groupNames[i]||e.raise("Invalid named capture referenced")}};ne.regexp_disjunction=function(e){var t=this.options.ecmaVersion>=16;for(t&&(e.branchID=new ym(e.branchID,null)),this.regexp_alternative(e);e.eat(124);)t&&(e.branchID=e.branchID.sibling()),this.regexp_alternative(e);t&&(e.branchID=e.branchID.parent),this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")};ne.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););};ne.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))?(this.regexp_eatQuantifier(e),!0):!1};ne.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!n,!0}return e.pos=t,!1};ne.regexp_eatQuantifier=function(e,t){return t===void 0&&(t=!1),this.regexp_eatQuantifierPrefix(e,t)?(e.eat(63),!0):!1};ne.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)};ne.regexp_eatBracedQuantifier=function(e,t){var n=e.pos;if(e.eat(123)){var i=0,r=-1;if(this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue),e.eat(125)))return r!==-1&&r<i&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=n}return!1};ne.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)};ne.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1};ne.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)){if(this.options.ecmaVersion>=16){var n=this.regexp_eatModifiers(e),i=e.eat(45);if(n||i){for(var r=0;r<n.length;r++){var s=n.charAt(r);n.indexOf(s,r+1)>-1&&e.raise("Duplicate regular expression modifiers")}if(i){var a=this.regexp_eatModifiers(e);!n&&!a&&e.current()===58&&e.raise("Invalid regular expression modifiers");for(var o=0;o<a.length;o++){var u=a.charAt(o);(a.indexOf(u,o+1)>-1||n.indexOf(u)>-1)&&e.raise("Duplicate regular expression modifiers")}}}}if(e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}}e.pos=t}return!1};ne.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):e.current()===63&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1};ne.regexp_eatModifiers=function(e){for(var t="",n=0;(n=e.current())!==-1&&Gwe(n);)t+=ea(n),e.advance();return t};function Gwe(e){return e===105||e===109||e===115}ne.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)};ne.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1};ne.regexp_eatSyntaxCharacter=function(e){var t=e.current();return hB(t)?(e.lastIntValue=t,e.advance(),!0):!1};function hB(e){return e===36||e>=40&&e<=43||e===46||e===63||e>=91&&e<=94||e>=123&&e<=125}ne.regexp_eatPatternCharacters=function(e){for(var t=e.pos,n=0;(n=e.current())!==-1&&!hB(n);)e.advance();return e.pos!==t};ne.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return t!==-1&&t!==36&&!(t>=40&&t<=43)&&t!==46&&t!==63&&t!==91&&t!==94&&t!==124?(e.advance(),!0):!1};ne.regexp_groupSpecifier=function(e){if(e.eat(63)){this.regexp_eatGroupName(e)||e.raise("Invalid group");var t=this.options.ecmaVersion>=16,n=e.groupNames[e.lastStringValue];if(n)if(t)for(var i=0,r=n;i<r.length;i+=1){var s=r[i];s.separatedFrom(e.branchID)||e.raise("Duplicate capture group name")}else e.raise("Duplicate capture group name");t?(n||(e.groupNames[e.lastStringValue]=[])).push(e.branchID):e.groupNames[e.lastStringValue]=!0}};ne.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1};ne.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=ea(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=ea(e.lastIntValue);return!0}return!1};ne.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,i=e.current(n);return e.advance(n),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(i=e.lastIntValue),Ywe(i)?(e.lastIntValue=i,!0):(e.pos=t,!1)};function Ywe(e){return Zs(e,!0)||e===36||e===95}ne.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,i=e.current(n);return e.advance(n),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(i=e.lastIntValue),Xwe(i)?(e.lastIntValue=i,!0):(e.pos=t,!1)};function Xwe(e){return yc(e,!0)||e===36||e===95||e===8204||e===8205}ne.regexp_eatAtomEscape=function(e){return this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e)?!0:(e.switchU&&(e.current()===99&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)};ne.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var n=e.lastIntValue;if(e.switchU)return n>e.maxBackReference&&(e.maxBackReference=n),!0;if(n<=e.numCapturingParens)return!0;e.pos=t}return!1};ne.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1};ne.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)};ne.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1};ne.regexp_eatZero=function(e){return e.current()===48&&!Ry(e.lookahead())?(e.lastIntValue=0,e.advance(),!0):!1};ne.regexp_eatControlEscape=function(e){var t=e.current();return t===116?(e.lastIntValue=9,e.advance(),!0):t===110?(e.lastIntValue=10,e.advance(),!0):t===118?(e.lastIntValue=11,e.advance(),!0):t===102?(e.lastIntValue=12,e.advance(),!0):t===114?(e.lastIntValue=13,e.advance(),!0):!1};ne.regexp_eatControlLetter=function(e){var t=e.current();return dB(t)?(e.lastIntValue=t%32,e.advance(),!0):!1};function dB(e){return e>=65&&e<=90||e>=97&&e<=122}ne.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){t===void 0&&(t=!1);var n=e.pos,i=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var r=e.lastIntValue;if(i&&r>=55296&&r<=56319){var s=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var a=e.lastIntValue;if(a>=56320&&a<=57343)return e.lastIntValue=(r-55296)*1024+(a-56320)+65536,!0}e.pos=s,e.lastIntValue=r}return!0}if(i&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&Kwe(e.lastIntValue))return!0;i&&e.raise("Invalid unicode escape"),e.pos=n}return!1};function Kwe(e){return e>=0&&e<=1114111}ne.regexp_eatIdentityEscape=function(e){if(e.switchU)return this.regexp_eatSyntaxCharacter(e)?!0:e.eat(47)?(e.lastIntValue=47,!0):!1;var t=e.current();return t!==99&&(!e.switchN||t!==107)?(e.lastIntValue=t,e.advance(),!0):!1};ne.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do e.lastIntValue=10*e.lastIntValue+(t-48),e.advance();while((t=e.current())>=48&&t<=57);return!0}return!1};var pB=0,ta=1,Si=2;ne.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(Qwe(t))return e.lastIntValue=-1,e.advance(),ta;var n=!1;if(e.switchU&&this.options.ecmaVersion>=9&&((n=t===80)||t===112)){e.lastIntValue=-1,e.advance();var i;if(e.eat(123)&&(i=this.regexp_eatUnicodePropertyValueExpression(e))&&e.eat(125))return n&&i===Si&&e.raise("Invalid property name"),i;e.raise("Invalid property name")}return pB};function Qwe(e){return e===100||e===68||e===115||e===83||e===119||e===87}ne.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var n=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,n,i),ta}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,r)}return pB};ne.regexp_validateUnicodePropertyNameAndValue=function(e,t,n){Qc(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(n)||e.raise("Invalid property value")};ne.regexp_validateUnicodePropertyNameOrValue=function(e,t){if(e.unicodeProperties.binary.test(t))return ta;if(e.switchV&&e.unicodeProperties.binaryOfStrings.test(t))return Si;e.raise("Invalid property name")};ne.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";gB(t=e.current());)e.lastStringValue+=ea(t),e.advance();return e.lastStringValue!==""};function gB(e){return dB(e)||e===95}ne.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";Jwe(t=e.current());)e.lastStringValue+=ea(t),e.advance();return e.lastStringValue!==""};function Jwe(e){return gB(e)||Ry(e)}ne.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)};ne.regexp_eatCharacterClass=function(e){if(e.eat(91)){var t=e.eat(94),n=this.regexp_classContents(e);return e.eat(93)||e.raise("Unterminated character class"),t&&n===Si&&e.raise("Negated character class may contain strings"),!0}return!1};ne.regexp_classContents=function(e){return e.current()===93?ta:e.switchV?this.regexp_classSetExpression(e):(this.regexp_nonEmptyClassRanges(e),ta)};ne.regexp_nonEmptyClassRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var n=e.lastIntValue;e.switchU&&(t===-1||n===-1)&&e.raise("Invalid character class"),t!==-1&&n!==-1&&t>n&&e.raise("Range out of order in character class")}}};ne.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var n=e.current();(n===99||xB(n))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var i=e.current();return i!==93?(e.lastIntValue=i,e.advance(),!0):!1};ne.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)};ne.regexp_classSetExpression=function(e){var t=ta,n;if(!this.regexp_eatClassSetRange(e))if(n=this.regexp_eatClassSetOperand(e)){n===Si&&(t=Si);for(var i=e.pos;e.eatChars([38,38]);){if(e.current()!==38&&(n=this.regexp_eatClassSetOperand(e))){n!==Si&&(t=ta);continue}e.raise("Invalid character in character class")}if(i!==e.pos)return t;for(;e.eatChars([45,45]);)this.regexp_eatClassSetOperand(e)||e.raise("Invalid character in character class");if(i!==e.pos)return t}else e.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(e)){if(n=this.regexp_eatClassSetOperand(e),!n)return t;n===Si&&(t=Si)}};ne.regexp_eatClassSetRange=function(e){var t=e.pos;if(this.regexp_eatClassSetCharacter(e)){var n=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassSetCharacter(e)){var i=e.lastIntValue;return n!==-1&&i!==-1&&n>i&&e.raise("Range out of order in character class"),!0}e.pos=t}return!1};ne.regexp_eatClassSetOperand=function(e){return this.regexp_eatClassSetCharacter(e)?ta:this.regexp_eatClassStringDisjunction(e)||this.regexp_eatNestedClass(e)};ne.regexp_eatNestedClass=function(e){var t=e.pos;if(e.eat(91)){var n=e.eat(94),i=this.regexp_classContents(e);if(e.eat(93))return n&&i===Si&&e.raise("Negated character class may contain strings"),i;e.pos=t}if(e.eat(92)){var r=this.regexp_eatCharacterClassEscape(e);if(r)return r;e.pos=t}return null};ne.regexp_eatClassStringDisjunction=function(e){var t=e.pos;if(e.eatChars([92,113])){if(e.eat(123)){var n=this.regexp_classStringDisjunctionContents(e);if(e.eat(125))return n}else e.raise("Invalid escape");e.pos=t}return null};ne.regexp_classStringDisjunctionContents=function(e){for(var t=this.regexp_classString(e);e.eat(124);)this.regexp_classString(e)===Si&&(t=Si);return t};ne.regexp_classString=function(e){for(var t=0;this.regexp_eatClassSetCharacter(e);)t++;return t===1?ta:Si};ne.regexp_eatClassSetCharacter=function(e){var t=e.pos;if(e.eat(92))return this.regexp_eatCharacterEscape(e)||this.regexp_eatClassSetReservedPunctuator(e)?!0:e.eat(98)?(e.lastIntValue=8,!0):(e.pos=t,!1);var n=e.current();return n<0||n===e.lookahead()&&Zwe(n)||e_e(n)?!1:(e.advance(),e.lastIntValue=n,!0)};function Zwe(e){return e===33||e>=35&&e<=38||e>=42&&e<=44||e===46||e>=58&&e<=64||e===94||e===96||e===126}function e_e(e){return e===40||e===41||e===45||e===47||e>=91&&e<=93||e>=123&&e<=125}ne.regexp_eatClassSetReservedPunctuator=function(e){var t=e.current();return t_e(t)?(e.lastIntValue=t,e.advance(),!0):!1};function t_e(e){return e===33||e===35||e===37||e===38||e===44||e===45||e>=58&&e<=62||e===64||e===96||e===126}ne.regexp_eatClassControlLetter=function(e){var t=e.current();return Ry(t)||t===95?(e.lastIntValue=t%32,e.advance(),!0):!1};ne.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1};ne.regexp_eatDecimalDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;Ry(n=e.current());)e.lastIntValue=10*e.lastIntValue+(n-48),e.advance();return e.pos!==t};function Ry(e){return e>=48&&e<=57}ne.regexp_eatHexDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;mB(n=e.current());)e.lastIntValue=16*e.lastIntValue+yB(n),e.advance();return e.pos!==t};function mB(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function yB(e){return e>=65&&e<=70?10+(e-65):e>=97&&e<=102?10+(e-97):e-48}ne.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var n=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=t*64+n*8+e.lastIntValue:e.lastIntValue=t*8+n}else e.lastIntValue=t;return!0}return!1};ne.regexp_eatOctalDigit=function(e){var t=e.current();return xB(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)};function xB(e){return e>=48&&e<=55}ne.regexp_eatFixedHexDigits=function(e,t){var n=e.pos;e.lastIntValue=0;for(var i=0;i<t;++i){var r=e.current();if(!mB(r))return e.pos=n,!1;e.lastIntValue=16*e.lastIntValue+yB(r),e.advance()}return!0};var pC=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new My(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},Ce=Tt.prototype;Ce.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new pC(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};Ce.getToken=function(){return this.next(),new pC(this)};typeof Symbol<"u"&&(Ce[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===S.eof,value:t}}}});Ce.nextToken=function(){var e=this.curContext();if((!e||!e.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(S.eof);if(e.override)return e.override(this);this.readToken(this.fullCharCodeAtPos())};Ce.readToken=function(e){return Zs(e,this.options.ecmaVersion>=6)||e===92?this.readWord():this.getTokenFromCode(e)};Ce.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);if(e<=55295||e>=56320)return e;var t=this.input.charCodeAt(this.pos+1);return t<=56319||t>=57344?e:(e<<10)+t-56613888};Ce.skipBlockComment=function(){var e=this.options.onComment&&this.curPosition(),t=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(n===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations)for(var i=void 0,r=t;(i=Uz(this.input,r,this.pos))>-1;)++this.curLine,r=this.lineStart=i;this.options.onComment&&this.options.onComment(!0,this.input.slice(t+2,n),t,this.pos,e,this.curPosition())};Ce.skipLineComment=function(e){for(var t=this.pos,n=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!Kc(i);)i=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,n,this.curPosition())};Ce.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(e>8&&e<14||e>=5760&&jz.test(String.fromCharCode(e)))++this.pos;else break e}}};Ce.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)};Ce.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&e===46&&t===46?(this.pos+=3,this.finishToken(S.ellipsis)):(++this.pos,this.finishToken(S.dot))};Ce.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):e===61?this.finishOp(S.assign,2):this.finishOp(S.slash,1)};Ce.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,i=e===42?S.star:S.modulo;return this.options.ecmaVersion>=7&&e===42&&t===42&&(++n,i=S.starstar,t=this.input.charCodeAt(this.pos+2)),t===61?this.finishOp(S.assign,n+1):this.finishOp(i,n)};Ce.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12){var n=this.input.charCodeAt(this.pos+2);if(n===61)return this.finishOp(S.assign,3)}return this.finishOp(e===124?S.logicalOR:S.logicalAND,2)}return t===61?this.finishOp(S.assign,2):this.finishOp(e===124?S.bitwiseOR:S.bitwiseAND,1)};Ce.readToken_caret=function(){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(S.assign,2):this.finishOp(S.bitwiseXOR,1)};Ce.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?t===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||ji.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(S.incDec,2):t===61?this.finishOp(S.assign,2):this.finishOp(S.plusMin,1)};Ce.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=e===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+n)===61?this.finishOp(S.assign,n+1):this.finishOp(S.bitShift,n)):t===33&&e===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(t===61&&(n=2),this.finishOp(S.relational,n))};Ce.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return t===61?this.finishOp(S.equality,this.input.charCodeAt(this.pos+2)===61?3:2):e===61&&t===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(S.arrow)):this.finishOp(e===61?S.eq:S.prefix,1)};Ce.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(t===46){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(S.questionDot,2)}if(t===63){if(e>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(S.assign,3)}return this.finishOp(S.coalesce,2)}}return this.finishOp(S.question,1)};Ce.readToken_numberSign=function(){var e=this.options.ecmaVersion,t=35;if(e>=13&&(++this.pos,t=this.fullCharCodeAtPos(),Zs(t,!0)||t===92))return this.finishToken(S.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+ea(t)+"'")};Ce.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(S.parenL);case 41:return++this.pos,this.finishToken(S.parenR);case 59:return++this.pos,this.finishToken(S.semi);case 44:return++this.pos,this.finishToken(S.comma);case 91:return++this.pos,this.finishToken(S.bracketL);case 93:return++this.pos,this.finishToken(S.bracketR);case 123:return++this.pos,this.finishToken(S.braceL);case 125:return++this.pos,this.finishToken(S.braceR);case 58:return++this.pos,this.finishToken(S.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(S.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(t===120||t===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(t===111||t===79)return this.readRadixNumber(8);if(t===98||t===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(S.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+ea(e)+"'")};Ce.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)};Ce.readRegexp=function(){for(var e,t,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var i=this.input.charAt(this.pos);if(ji.test(i)&&this.raise(n,"Unterminated regular expression"),e)e=!1;else{if(i==="[")t=!0;else if(i==="]"&&t)t=!1;else if(i==="/"&&!t)break;e=i==="\\"}++this.pos}var r=this.input.slice(n,this.pos);++this.pos;var s=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(s);var o=this.regexpState||(this.regexpState=new xs(this));o.reset(n,r,a),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var u=null;try{u=new RegExp(r,a)}catch{}return this.finishToken(S.regexp,{pattern:r,flags:a,value:u})};Ce.readInt=function(e,t,n){for(var i=this.options.ecmaVersion>=12&&t===void 0,r=n&&this.input.charCodeAt(this.pos)===48,s=this.pos,a=0,o=0,u=0,l=t??1/0;u<l;++u,++this.pos){var c=this.input.charCodeAt(this.pos),f=void 0;if(i&&c===95){r&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),o===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),u===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),o=c;continue}if(c>=97?f=c-97+10:c>=65?f=c-65+10:c>=48&&c<=57?f=c-48:f=1/0,f>=e)break;o=c,a=a*e+f}return i&&o===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===s||t!=null&&this.pos-s!==t?null:a};function n_e(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}function vB(e){return typeof BigInt!="function"?null:BigInt(e.replace(/_/g,""))}Ce.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var n=this.readInt(e);return n==null&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(n=vB(this.input.slice(t,this.pos)),++this.pos):Zs(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,n)};Ce.readNumber=function(e){var t=this.pos;!e&&this.readInt(10,void 0,!0)===null&&this.raise(t,"Invalid number");var n=this.pos-t>=2&&this.input.charCodeAt(t)===48;n&&this.strict&&this.raise(t,"Invalid number");var i=this.input.charCodeAt(this.pos);if(!n&&!e&&this.options.ecmaVersion>=11&&i===110){var r=vB(this.input.slice(t,this.pos));return++this.pos,Zs(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,r)}n&&/[89]/.test(this.input.slice(t,this.pos))&&(n=!1),i===46&&!n&&(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),(i===69||i===101)&&!n&&(i=this.input.charCodeAt(++this.pos),(i===43||i===45)&&++this.pos,this.readInt(10)===null&&this.raise(t,"Invalid number")),Zs(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var s=n_e(this.input.slice(t,this.pos),n);return this.finishToken(S.num,s)};Ce.readCodePoint=function(){var e=this.input.charCodeAt(this.pos),t;if(e===123){this.options.ecmaVersion<6&&this.unexpected();var n=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(n,"Code point out of bounds")}else t=this.readHexChar(4);return t};Ce.readString=function(e){for(var t="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var i=this.input.charCodeAt(this.pos);if(i===e)break;i===92?(t+=this.input.slice(n,this.pos),t+=this.readEscapedChar(!1),n=this.pos):i===8232||i===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(Kc(i)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(n,this.pos++),this.finishToken(S.string,t)};var bB={};Ce.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e===bB)this.readInvalidTemplateToken();else throw e}this.inTemplateElement=!1};Ce.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw bB;this.raise(e,t)};Ce.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(n===96||n===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===S.template||this.type===S.invalidTemplate)?n===36?(this.pos+=2,this.finishToken(S.dollarBraceL)):(++this.pos,this.finishToken(S.backQuote)):(e+=this.input.slice(t,this.pos),this.finishToken(S.template,e));if(n===92)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(Kc(n)){switch(e+=this.input.slice(t,this.pos),++this.pos,n){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:e+=`
`;break;default:e+=String.fromCharCode(n);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}};Ce.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(S.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")};Ce.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ea(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),e){var n=this.pos-1;this.invalidStringToken(n,"Invalid escape sequence in template string")}default:if(t>=48&&t<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],r=parseInt(i,8);return r>255&&(i=i.slice(0,-1),r=parseInt(i,8)),this.pos+=i.length-1,t=this.input.charCodeAt(this.pos),(i!=="0"||t===56||t===57)&&(this.strict||e)&&this.invalidStringToken(this.pos-1-i.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(r)}return Kc(t)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(t)}};Ce.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return n===null&&this.invalidStringToken(t,"Bad character escape sequence"),n};Ce.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,n=this.pos,i=this.options.ecmaVersion>=6;this.pos<this.input.length;){var r=this.fullCharCodeAtPos();if(yc(r,i))this.pos+=r<=65535?1:2;else if(r===92){this.containsEsc=!0,e+=this.input.slice(n,this.pos);var s=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(t?Zs:yc)(a,i)||this.invalidStringToken(s,"Invalid Unicode escape"),e+=ea(a),n=this.pos}else break;t=!1}return e+this.input.slice(n,this.pos)};Ce.readWord=function(){var e=this.readWord1(),t=S.name;return this.keywords.test(e)&&(t=oC[e]),this.finishToken(t,e)};var i_e="8.14.0";Tt.acorn={Parser:Tt,version:i_e,defaultOptions:gw,Position:Zh,SourceLocation:My,getLineInfo:Vz,Node:Ny,TokenType:Ne,tokTypes:S,keywordTypes:oC,TokContext:Gi,tokContexts:nt,isIdentifierChar:yc,isIdentifierStart:Zs,Token:pC,isNewLine:Kc,lineBreak:ji,lineBreakG:kwe,nonASCIIwhitespace:jz};function r_e(e,t){return Tt.parse(e,t)}const gC={undefined:"void(0)",Infinity:"Number.POSITIVE_INFINITY",NaN:"Number.NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"};function So(e){return typeof e=="number"}const s_e={ecmaVersion:11},zO="$",a_e="d",o_e="d1",u_e="d2",Vt=e=>(t,n)=>n.error(t,e+" not allowed"),l_e=Vt("Aggregate function"),c_e=Vt("Window function"),f_e="Invalid argument",mC="Invalid column reference",h_e=mC+" (must be input to an aggregate function)",wB="Invalid function call",d_e="Invalid member expression",p_e="Invalid operator parameter",g_e="Invalid param reference",m_e="Invalid variable reference",y_e="Variable not accessible in operator call",x_e="Unsupported variable declaration",v_e="Unsupported destructuring pattern",_B="Table expressions do not support closures",EB="Use aq.escape(fn) to use a function as-is (including closures)",b_e="use table.params({ name: value }) to define dynamic parameters",w_e="use aq.addFunction(name, fn) to add new op functions",__e=`
Note: ${_B}. ${EB}, or ${b_e}.`,SB=`
Note: ${_B}. ${EB}, or ${w_e}.`,E_e=`The ${Dz} method is not valid in multi-table expressions.`;function S_e(e,t){const n=k_e(t);let i=e.root=n;return e.spec=t,e.tuple=null,e.tuple1=null,e.tuple2=null,e.$param=null,e.$op=0,e.scope=new Set,e.paramsRef=new Map,e.columnRef=new Map,fwe(i)?(C_e(i,e),i=i.body):e.join?(e.scope.add(e.tuple1=o_e),e.scope.add(e.tuple2=u_e),e.scope.add(e.$param=zO)):(e.scope.add(e.tuple=a_e),e.scope.add(e.$param=zO)),Me(i,e,yC),e.root}function k_e(e){try{const t=e.field?A_e(e):In(e)?Js(e):e;return r_e(`expr=(${t})`,s_e).body[0].expression.right}catch{pt(`Expression parse error: ${e+""}`)}}function A_e(e){const t=JSON.stringify(e+"");return e.table?`(a,b)=>b[${t}]`:`d=>d[${t}]`}const yC={FunctionDeclaration:Vt("Function definitions"),ForStatement:Vt("For loops"),ForOfStatement:Vt("For-of loops"),ForInStatement:Vt("For-in loops"),WhileStatement:Vt("While loops"),DoWhileStatement:Vt("Do-while loops"),AwaitExpression:Vt("Await expressions"),ArrowFunctionExpression:Vt("Function definitions"),AssignmentExpression:Vt("Assignments"),FunctionExpression:Vt("Function definitions"),NewExpression:Vt('Use of "new"'),UpdateExpression:Vt("Update expressions"),VariableDeclarator(e,t){bw(e.id,t)},Identifier(e,t,n){CB(e,t,n)&&!t.scope.has(e.name)&&t.error(e,m_e,__e)},CallExpression(e,t){const n=kB(e.callee),i=_z(n)||Ez(n);if(i){if((t.join||t.aggregate===!1)&&eC(n)&&l_e(e,t),(t.join||t.window===!1)&&tC(n)&&c_e(e,t),t.$op=1,t.ast)vw(e,n,t),e.arguments.forEach(r=>Me(r,t,xw));else{const r=t.op($_e(t,i,n,e.arguments));Object.assign(e,{type:Oz,name:r.id})}return t.$op=0,!1}else wz(n)?vw(e,n,t):t.error(e,wB,SB)},MemberExpression(e,t,n){const{object:i,property:r}=e;if(!kt(Ua,i))return;const{name:s}=i;if(AB(e)&&kt(Ua,r)&&Object.hasOwn(gC,r.name)){FB(e,r.name);return}const a=s===t.tuple?0:s===t.tuple1?1:s===t.tuple2?2:-1;if(a>=0)return BO(e,a,t,$B,n);if(s===t.$param)return BO(e,a,t,F_e);t.paramsRef.has(s)?td(e,t.paramsRef.get(s)):t.columnRef.has(s)?TB(i,s,t,e):Object.hasOwn(t.params,s)&&td(i,s)}};function BO(e,t,n,i,r){const{property:s,computed:a}=e;let o;if(!a)o=s.name;else if(kt(Xc,s))o=s.value;else try{Me(s,n,yC,e),o=n.param(s)}catch{n.error(e,d_e)}return i(e,o,t,n,r),!1}const xw={...yC,VariableDeclarator:Vt("Variable declaration in operator call"),Identifier(e,t,n){CB(e,t,n)&&t.error(e,y_e)},CallExpression(e,t){const n=kB(e.callee);wz(n)?vw(e,n,t):t.error(e,wB,SB)}};function C_e(e,t){e.generator&&Vt("Generator functions")(e,t),e.async&&Vt("Async functions")(e,t);const{params:n}=e,i=n.length,r=a=>(o,u)=>t.columnRef.set(o,[u,a]),s=(a,o)=>t.paramsRef.set(a,o);i&&(t.join?(Mf(t,n[0],"tuple1",r(1)),i>1&&Mf(t,n[1],"tuple2",r(2)),i>2&&Mf(t,n[2],"$param",s)):(Mf(t,n[0],"tuple",r(0)),i>1&&Mf(t,n[1],"$param",s))),t.root=e.body}function Mf(e,t,n,i){kt(Ua,t)?(e.scope.add(t.name),e[n]=t.name):kt(Tz,t)&&t.properties.forEach(r=>{const s=kt(Ua,r.key)?r.key.name:kt(Xc,r.key)?r.key.value:e.error(r,f_e);kt(Ua,r.value)||e.error(r.value,v_e),i(r.value.name,s)})}function $_e(e,t,n,i){const r=[],s=[],a=t.param[0]||0,o=a+(t.param[1]||0);return i.forEach((u,l)=>{l<a?(Me(u,e,xw),r.push(e.field(u))):l<o?(Me(u,e,xw),s.push(e.param(u))):e.error(u,p_e)}),{name:n,fields:r,params:s,...e.spec.window||{}}}function kB(e){return kt(Ua,e)?e.name:kt($z,e)?AB(e)?T_e(e.property.name):e.property.name:null}function AB(e){return kt(Ua,e.object)&&e.object.name==="Math"}function T_e(e){return e==="max"?"greatest":e==="min"?"least":e}function CB(e,t,n){const{name:i}=e;if(!(kt($z,n)&&n.property===e)){if(!(kt(Fz,n)&&n.key===e))if(t.paramsRef.has(i))td(e,t.paramsRef.get(i));else if(t.columnRef.has(i))TB(e,i,t,n);else if(Object.hasOwn(t.params,i))td(e,i);else if(Object.hasOwn(gC,i))FB(e,i);else return!0}}function $B(e,t,n,i,r){const s=n===0?i.table:n>0?i.join[n-1]:null,a=s&&s.column(t);s&&!a&&i.error(e,mC),i.aggronly&&!i.$op&&i.error(e,h_e),Rz(e,t,n,a,r)}function TB(e,t,n,i){const[r,s]=n.columnRef.get(t);$B(e,r,s,n,i)}function F_e(e,t,n,i){i.params&&!Object.hasOwn(i.params,t)&&i.error(e,g_e),td(e,t)}function td(e,t){e.type=uwe,e.name=t}function FB(e,t){e.type=swe,e.name=t,e.raw=gC[t]}function vw(e,t,n){if(t===Dz){const i=n.table;i||n.error(e,E_e),Iz(e,i,e.arguments.length?e.arguments.map(r=>{const s=n.param(r),a=So(s)?i.columnName(s):s;return i.column(a)||n.error(r,mC),a}):i.columnNames())}else e.callee={type:owe,name:t}}function bw(e,t){kt(Ua,e)?t.scope.add(e.name):kt(twe,e)?e.elements.forEach(n=>bw(n,t)):kt(Tz,e)?e.properties.forEach(n=>bw(n.value,t)):t.error(e.id,x_e)}const M_e={[Mz]:1,[Oz]:1};function gi(e,t={}){const n=t.generate||dm,i=t.compiler||aC,r=N_e(t),s={},a={},o=[],u=[];let l=0,c=-1;const f=t.join?i.join:t.index==1?i.expr2:i.expr,h={op(g){const m=O_e(g);return a[m]||(g.id=++c,a[m]=g)},field(g){const m=n(g);return s[m]||(s[m]=++l)},param(g){return kt(Xc,g)?g.value:i.param(n(g),r)},value(g,m){o.push(g);const y=m.escape||(t.ast?cwe(m):f(n(m),r));u.push(y),M_e[m.type]&&y!==m&&ro(y)&&(y.field=m.name)},error(g,m,y=""){const x=g.start-6,v=g.end-6,b=String(h.spec).slice(x,v);pt(`${m}: "${b}"${y}`)}};Object.assign(h,t,{params:r});for(const[g,m]of rC(e))h.value(g+"",m.escape?xwe(h,m,r):S_e(h,m));if(t.ast)return{names:o,exprs:u};const d=[];for(const g in s)d[s[g]]=i.expr(g,r);const p=Object.values(a);return p.forEach(g=>g.fields=g.fields.map(m=>d[m])),{names:o,exprs:u,ops:p}}function O_e(e){let t=`${e.name}(${e.fields.concat(e.params).join(",")})`;if(e.frame){const n=e.frame.map(i=>Number.isFinite(i)?Math.abs(i):-1);t+=`[${n},${!!e.peers}]`}return t}function N_e(e){return(e.table?Wv(e.table):e.join?{...Wv(e.join[1]),...Wv(e.join[0])}:{})||{}}function Wv(e){return e&&en(e.params)?e.params():{}}function R_e(e,t){return e&&e.expr?new UO({...e,...t}):new UO(t,e)}class UO{constructor(t,n){this.expr=n,Object.assign(this,t)}toString(){return String(this.expr)}toObject(){return{...this,expr:this.toString(),...en(this.expr)?{func:!0}:{}}}}function xm(e,t,n=0){const i=n?{field:!0,table:n}:{field:!0};return R_e(e,t?{expr:t,...i}:i)}function MB(e,t){for(const[n,i]of rC(t))e.set(n,i);return e}function na(e,t,n=new Map){return t=So(t)?e.columnName(t):t,Sr(t)?n.set(t,t):In(t)?t.forEach(i=>na(e,i,n)):en(t)?na(e,t(e),n):ro(t)?MB(n,t):pt(`Invalid column selection: ${Js(t)}`),n}function OB(e,t){return e.toObject=t,e}function NB(e){return In(e)?e.map(NB):e&&e.toObject?e.toObject():e}function nd(){return OB(e=>e.columnNames(),()=>({all:[]}))}function RB(...e){return e=e.flat(),OB(t=>{const n=na(t,e);return t.columnNames(i=>!n.has(i))},()=>({not:NB(e)}))}function gr(e,t,n,i={window:!1}){const r=new Map,s=a=>{a=So(a)?t.columnName(a):a,Sr(a)?r.set(a,xm(a)):en(a)?na(t,a).forEach(s):ro(a)?MB(r,a):pt(`Invalid ${e} value: ${a+""}`)};return is(n).forEach(s),i.preparse&&i.preparse(r),gi(r,{table:t,...i})}function xC(e,...t){return D_e(e,gr("groupby",e,t.flat()))}function D_e(e,t){return e.create({groups:I_e(e,t)})}function I_e(e,{names:t=[],exprs:n=[],ops:i=[]}){const r=t.length;if(r===0)return null;if(r===1&&!e.isFiltered()&&n[0].field){const d=e.column(n[0].field);if(d.groups)return d.groups(t)}let s=Gu(e,i,n);const a=fm(s),o=e.totalRows(),u=new Uint32Array(o),l={},c=[],f=e.data(),h=e.mask();if(h)for(let d=h.next(0);d>=0;d=h.next(d+1)){const p=a(d,f)+"";u[d]=l[p]??=c.push(d)-1}else for(let d=0;d<o;++d){const p=a(d,f)+"";u[d]=l[p]??=c.push(d)-1}return i.length||(s=s.map(d=>p=>d(p,f))),{keys:u,get:s,names:t,rows:c,size:c.length}}function mi(e){return e?new jO({...e.data()},e.columnNames()):new jO}class jO{constructor(t,n){this.data=t||{},this.names=n||[]}add(t,n){return this.has(t)||this.names.push(t+""),this.data[t]=n}has(t){return Object.hasOwn(this.data,t)}groupby(t){return this.groups=t,this}new(t){const{data:n,names:i,groups:r=null}=this;return t.create({data:n,names:i,groups:r,filter:null,order:null})}derive(t){return t.create(this)}}function vm(e,t){return vC(e,gi(t,{table:e,aggronly:!0,window:!1}))}function vC(e,{names:t,exprs:n,ops:i=[]}){const r=mi(),s=e.groups();return s&&Cz(r,s),P_e(t,n,s,Yc(e,i),r),r.new(e)}function P_e(e,t,n,i=[],r){if(!t.length)return;const s=n?n.size:1,a=(u,l)=>i[u][l],o=e.length;for(let u=0;u<o;++u){const l=t[u];if(l.field!=null)r.add(e[u],i[l.field]);else if(s>1){const c=r.add(e[u],Array(s));for(let f=0;f<s;++f)c[f]=l(f,null,a)}else r.add(e[u],[l(0,null,a)])}}function DB(e,...t){return bC(e,na(e,t.flat()))}function bC(e,t){const n=mi();return t.forEach((i,r)=>{const s=Sr(i)?i:r;if(s){const a=e.column(r)||pt(`Unrecognized column: ${r}`);n.add(s,a)}}),n.derive(e)}function L_e(e,t){if(!e||!t)return e;const{keys:n,rows:i,size:r}=e,s=new Uint32Array(r);t.scan(c=>s[n[c]]=1);const a=s.reduce((c,f)=>c+f,0);if(a===r)return e;const o=Array(a);let u=0;for(let c=0;c<r;++c)s[c]&&(o[s[c]=u++]=i[c]);const l=new Uint32Array(n.length);return t.scan(c=>l[c]=s[n[c]]),{...e,keys:l,rows:o,size:u}}function z_e(e,t,n,i){const{keys:r,rows:s,size:a}=e;let o=s,u=a,l=null;if(n){l=new Int32Array(a),t(p=>l[r[p]]=1);const d=l.reduce((p,g)=>p+g,0);if(d!==a){o=Array(d),u=0;for(let p=0;p<a;++p)l[p]&&(o[l[p]=u++]=s[p])}}let c=-1;const f=new Uint32Array(i);return t(u!==a?d=>f[++c]=l[r[d]]:d=>f[++c]=r[d]),{...e,keys:f,rows:o,size:u}}function B_e(e,t,n,i){const r=i==="map"||i===!0?mz:i==="entries"?xz:i==="object"?yz:pt('groups option must be "map", "entries", or "object".'),{names:s}=e.groups(),a=B2e(e.columnNames(),"_");let o=DB(e,{}).reify(t).create({data:{[a]:n}});o=vm(o,{[a]:pz(a)});for(let u=s.length;--u>=0;)o=vm(xC(o,s.slice(0,u)),{[a]:r(s[u],a)});return o.get(a)}function U_e(e){return $y(e)?e.constructor:Array}let ww=class{constructor(t,n,i,r,s,a){const o=Object.freeze({...t});n=n?.slice()??Object.keys(o);const u=n.length?o[n[0]].length:0;this._names=Object.freeze(n),this._data=o,this._total=u,this._nrows=i?.count()??u,this._mask=i??null,this._group=r??null,this._order=s??null,this._params=a,this._index=null,this._partitions=null}create({data:t=void 0,names:n=void 0,filter:i=void 0,groups:r=void 0,order:s=void 0}={}){const a=i!==void 0?i:this.mask();return new this.constructor(t||this._data,n||(t?null:this._names),a,r!==void 0?r:L_e(this._group,i&&a),s!==void 0?s:this._order,this._params)}params(t){return arguments.length?(t&&(this._params={...this._params,...t}),this):this._params}get[Symbol.toStringTag](){if(!this._names)return"Object";const t=this.numRows(),n=this.numCols(),i=r=>r!==1?"s":"";return`Table: ${n} col${i(n)} x ${t} row${i(t)}`+(this.isFiltered()?` (${this.totalRows()} backing)`:"")+(this.isGrouped()?`, ${this._group.size} groups`:"")+(this.isOrdered()?", ordered":"")}isFiltered(){return!!this._mask}isGrouped(){return!!this._group}isOrdered(){return!!this._order}data(){return this._data}mask(){return this._mask}groups(){return this._group}comparator(){return this._order}totalRows(){return this._total}numRows(){return this._nrows}get size(){return this._nrows}numCols(){return this._names.length}columnNames(t){return t?this._names.filter(t):this._names.slice()}columnName(t){return this._names[t]}columnIndex(t){return this._names.indexOf(t)}column(t){return this._data[t]}columnAt(t){return this._data[this._names[t]]}array(t,n=Array){const i=this.column(t),r=new n(this.numRows());let s=-1;return this.scan(a=>r[++s]=i.at(a),!0),r}get(t,n=0){const i=this.column(t);return this.isFiltered()||this.isOrdered()?i.at(this.indices()[n]):i.at(n)}getter(t){const n=this.column(t),i=this.isFiltered()||this.isOrdered()?this.indices():null;if(i)return r=>n.at(i[r]);if(n)return r=>n.at(r);pt(`Unrecognized column: ${t}`)}object(t=0){return qO(this)(t)}objects(t={}){const{grouped:n,limit:i,offset:r}=t,s=na(this,t.columns||nd()),a=Lz(this,s),o=[];if(this.scan((u,l)=>o.push(a(u,l)),!0,i,r),n&&this.isGrouped()){const u=[];return this.scan(l=>u.push(l),!0,i,r),B_e(this,u,o,n)}return o}*[Symbol.iterator](){const t=qO(this),n=this.numRows();for(let i=0;i<n;++i)yield t(i)}*values(t){const n=this.getter(t),i=this.numRows();for(let r=0;r<i;++r)yield n(r)}print(t={}){const n=So(t)?{limit:+t}:{...t,limit:10},i=this.objects({...n,grouped:!1}),r=`${this[Symbol.toStringTag]}. Showing ${i.length} rows.`;return console.log(r),console.table(i),this}indices(t=!0){if(this._index)return this._index;const n=this.numRows(),i=new Uint32Array(n),r=this.isOrdered(),s=this.mask();let a=-1;if(s)for(let o=s.next(0);o>=0;o=s.next(o+1))i[++a]=o;else for(let o=0;o<n;++o)i[++a]=o;if(t&&r){const{_order:o,_data:u}=this;i.sort((l,c)=>o(l,c,u))}return(t||!r)&&(this._index=i),i}partitions(t=!0){if(this._partitions)return this._partitions;if(!this.isGrouped())return[this.indices(t)];const{keys:n,size:i}=this._group,r=Hc(i,()=>[]),s=this._index,a=this.mask(),o=this.numRows();if(s&&this.isOrdered())for(let u=0,l;u<o;++u)l=s[u],r[n[l]].push(l);else if(a)for(let u=a.next(0);u>=0;u=a.next(u+1))r[n[u]].push(u);else for(let u=0;u<o;++u)r[n[u]].push(u);if(t&&!s&&this.isOrdered()){const u=this._order,l=this._data;for(let c=0;c<i;++c)r[c].sort((f,h)=>u(f,h,l))}return(t||!this.isOrdered())&&(this._partitions=r),r}reify(t){const n=t?t.length:this.numRows(),i=this._names;let r,s;if(!t&&!this.isOrdered())if(this.isFiltered())n===this.totalRows()&&(r=this.data());else return this;if(!r){const a=t?u=>t.forEach(u):u=>this.scan(u,!0),o=i.length;r={};for(let u=0;u<o;++u){const l=i[u],c=this.column(l),f=r[l]=new(U_e(c))(n);let h=-1;_o(c)?a(d=>f[++h]=c[d]):a(d=>f[++h]=c.at(d))}this.isGrouped()&&(s=z_e(this.groups(),a,!!t,n))}return this.create({data:r,names:i,groups:s,filter:null,order:null})}scan(t,n,i=1/0,r=0){const s=this._mask,a=this._nrows,o=this._data;let u=r||0;if(u>a)return;const l=Math.min(a,u+i),c=()=>u=this._total;if(n&&this.isOrdered()||s&&this._index){const f=this.indices(),h=this._data;for(;u<l;++u)t(f[u],h,c)}else if(s){let f=l-u+1;for(u=s.nth(u);--f&&u>-1;u=s.next(u+1))t(u,o,c)}else for(;u<l;++u)t(u,o,c)}};function qO(e){let t=e._builder;if(!t){const n=Lz(e),i=e.data();if(e.isOrdered()||e.isFiltered()){const r=e.indices();t=s=>n(r[s],i)}else t=r=>n(r,i);e._builder=t}return t}function j_e(e,...t){t=t.flat();const n=e.numRows(),i=e.reify(),r=mi(i).groupby(i.groups());return t.forEach(s=>{s=s instanceof ww?s:new ww(s),s.numRows()!==n&&pt("Assign row counts do not match"),s=s.reify(),s.columnNames(a=>r.add(a,s.column(a)))}),r.new(e)}function IB(e,...t){t=t.flat();const n=e.numRows(),i=n+t.reduce((a,o)=>a+o.numRows(),0);if(n===i)return e;const r=[e,...t],s=mi();return e.columnNames().forEach(a=>{const o=Array(i);let u=0;r.forEach(l=>{const c=l.column(a)||{at:()=>Re};l.scan(f=>o[u++]=c.at(f))}),s.add(a,o)}),s.new(e)}function PB(e,t,{before:n=void 0,after:i=void 0}={}){const r=n!=null,s=i!=null;r||s||pt("relocate requires a before or after option."),r&&s&&pt("relocate accepts only one of the before or after options."),t=na(e,t);const a=[...na(e,r?n:i).keys()],o=r?a[0]:a.pop(),u=new Map;return e.columnNames().forEach(l=>{const c=!t.has(l);if(l===o){s&&c&&u.set(l,l);for(const[f,h]of t)u.set(f,h);if(s)return}c&&u.set(l,l)}),bC(e,u)}function LB(e){return{left(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){const s=i+r>>>1;e(t[s],n)<0?i=s+1:r=s}return i},right(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){const s=i+r>>>1;e(t[s],n)>0?r=s:i=s+1}return i}}}const VO=LB(nC);function q_e(e,t,n,i,r){let s,a,o,u,l;const c=g=>a[g-1]===a[g],f=i.length,h=r.length,d=i.length?Gc(["w","r","k"],"{"+Zd(i,(g,m)=>`r[_${m}.id][k]=_${m}.value(w,_${m}.get);`)+"}",i):()=>{},p={i0:0,i1:0,index:0,size:0,peer:c,init(g,m,y,x){p.index=p.i0=p.i1=0,p.size=m.length,s=g,a=m,u=y,l=x,o=r?r.map(v=>v.init()):null;for(let v=0;v<f;++v)i[v].init();return p},value(g,m){return m(s[g],e)},step(g){const[m,y]=t,x=p.size,v=p.i0,b=p.i1;p.i0=m!=null?Math.max(0,g-Math.abs(m)):0,p.i1=y!=null?Math.min(x,g+Math.abs(y)+1):x,p.index=g,n&&(p.i0>0&&c(p.i0)&&(p.i0=VO.left(a,a[p.i0])),p.i1<x&&c(p.i1)&&(p.i1=VO.right(a,a[p.i1-1])));for(let w=0;w<h;++w){const E=r[w],_=o[w];for(let k=v;k<p.i0;++k)E.rem(_,s[k],e);for(let k=b;k<p.i1;++k)E.add(_,s[k],e);E.write(_,u,l)}return d(p,u,l),u}};return p}const V_e=e=>(e.frame||[null,null]).map(t=>Number.isFinite(t)?Math.abs(t):null),W_e=e=>!!e.peers;function H_e(e){const{id:t,name:n,fields:i=[],params:r=[]}=e;return{...Ez(n).create(...r),get:i.length?i[0]:null,id:t}}function G_e(e,t,n,i={},r){const s=e.data(),a=Y_e(r,s),o=a.length,u=Gc(["r","d","op"],"{"+Zd(t,(l,c)=>`_${c}[r] = $${c}(r, d, op);`)+"}",t,n);e.partitions().forEach((l,c)=>{const f=l.length,h=X_e(e,l);for(let p=0;p<o;++p)a[p].init(l,h,i,c);const d=p=>i[p][c];for(let p=0;p<f;++p){for(let g=0;g<o;++g)a[g].step(p);u(l[p],s,d)}})}function Y_e(e,t){const n={};return e.forEach(i=>{const r=V_e(i),s=W_e(i),a=`${r},${s}`,{aggOps:o,winOps:u}=n[a]||(n[a]={frame:r,peers:s,aggOps:[],winOps:[]});eC(i.name)?o.push(i):u.push(H_e(i))}),Object.values(n).map(i=>q_e(t,i.frame,i.peers,i.winOps,Sz(i.aggOps,i.frame[0]!=null?-1:1)))}function X_e(e,t){if(e.isOrdered()){const n=e.comparator(),i=e.data(),r=t.length,s=new Uint32Array(r);for(let a=1,o=0;a<r;++a)s[a]=n(t[a-1],t[a],i)?++o:o;return s}else return t}function K_e(e){return tC(e.name)||e.frame&&(Number.isFinite(e.frame[0])||Number.isFinite(e.frame[1]))}function Q_e(e,t,n={}){const i=wC(e,gi(t,{table:e}),n);return n.drop||n.before==null&&n.after==null?i:PB(i,Object.keys(t).filter(r=>!e.column(r)),n)}function wC(e,{names:t,exprs:n,ops:i=[]},r={}){const s=e.totalRows(),a=mi(r.drop?null:e),o=t.map(h=>a.add(h,Array(s))),[u,l]=J_e(i),c=e.isGrouped()?e.groups().size:1,f=Yc(e,u,Hc(i.length,()=>Array(c)));return l.length?G_e(e,o,n,f,l):Z_e(e,o,n,f),a.derive(e)}function J_e(e){const t=[],n=[],i=e.length;for(let r=0;r<i;++r){const s=e[r];s.id=r,(K_e(s)?n:t).push(s)}return[t,n]}function Z_e(e,t,n,i){const r=e.mask(),s=e.data(),{keys:a}=e.groups()||{},o=a?(l,c)=>i[l][a[c]]:l=>i[l][0],u=t.length;for(let l=0;l<u;++l){const c=n[l],f=t[l];if(r)for(let h=r.next(0);h>=0;h=r.next(h+1))f[h]=c(h,s,o);else{const h=e.totalRows();for(let d=0;d<h;++d)f[d]=c(d,s,o)}}}function _C(e,t){const n=gi({p:t},{table:e});let i=n.exprs[0];if(n.ops.length){const r=wC(e,n,{drop:!0}).column("p");i=s=>r.at(s)}return eEe(e,i)}function eEe(e,t){const n=e.totalRows(),i=e.mask(),r=e.data(),s=new KA(n);if(i)for(let a=i.next(0);a>=0;a=i.next(a+1))t(a,r)&&s.set(a);else for(let a=0;a<n;++a)t(a,r)&&s.set(a);return e.create({filter:s})}function Dy(e,...t){t=t.flat();const n=xC(e,t.length?t:e.columnNames());return _C(n,"row_number() === 1").ungroup().reify()}function zB(e,t){const n=new Map;return e.scan((i,r)=>{const s=t(i,r);s!=null&&s===s&&n.set(s,i)}),n}function tEe(e,t,n){const i=new Map,r=e.length;for(let s=0;s<r;++s){const a=e[s],o=n(a,t);o!=null&&o===o&&(i.has(o)?i.get(o).push(s):i.set(o,[s]))}return i}function nEe(e,t){const n=new Set(t);return e.filter(i=>n.has(i))}function bm(e,t,n){const i=new Map;is(n).forEach((s,a)=>{s=So(s)?t.columnName(s):s,Sr(s)?i.set(a,xm(s)):en(s)||ro(s)&&s.expr?i.set(a,s):pt(`Invalid ${e} key value: ${s+""}`)});const r=gi(i,{table:t,aggregate:!1,window:!1});return fm(r.exprs,!0)}function EC(e,t,n){if(n)Sr(n)?n=[n,n]:In(n)&&n.length===1&&(n=[n[0],n[0]]);else{const i=nEe(e.columnNames(),t.columnNames());i.length||pt("Natural join requires shared column names."),n=[i,i]}return n}function BB(e,t,n,i){return n.length!==i.length&&pt("Mismatched number of join keys"),[bm("join",e,n),bm("join",t,i)]}function UB(e,t,n){return qB(e,t,n,{anti:!1})}function jB(e,t,n){return qB(e,t,n,{anti:!0})}function qB(e,t,n,i){n=EC(e,t,n);const r=In(n)?BB(e,t,...n.map(is)):gi({on:n},{join:[e,t]}).exprs[0];return iEe(e,t,r,i)}function iEe(e,t,n,i={}){const r=new KA(e.totalRows());return(In(n)?rEe:sEe)(r,e,t,n),i.anti&&r.not().and(e.mask()),e.create({filter:r})}function rEe(e,t,n,[i,r]){const s=zB(n,r);t.scan((a,o)=>{s.get(i(a,o))>=0&&e.set(a)})}function sEe(e,t,n,i){const r=t.numRows(),s=n.numRows(),a=t.data(),o=n.data();if(t.isFiltered()||n.isFiltered()){const u=t.indices(!1),l=n.indices(!1);for(let c=0;c<r;++c){const f=u[c];for(let h=0;h<s;++h)if(i(f,a,l[h],o)){e.set(f);break}}}else for(let u=0;u<r;++u)for(let l=0;l<s;++l)if(i(u,a,l,o)){e.set(u);break}}function aEe(e,...t){if(t=t.flat(),t.length===0)return e;const n=e.columnNames();return Dy(t.reduce((i,r)=>jB(i,r.select(n)),e))}function oEe(e,t,n){return VB(e,gr("unroll",e,t),n&&n.drop?{...n,drop:gr("unroll",e,n.drop).names}:n)}function VB(e,{names:t=[],exprs:n=[],ops:i=[]},r={}){if(!t.length)return e;const s=r.limit>0?+r.limit:1/0,a=r.index?r.index===!0?"index":r.index+"":null,o=new Set(r.drop),u=Gu(e,i,n),l=mi(),c=new Set(t),f=[],h=[],d=[];e.columnNames().forEach(b=>{if(!o.has(b)){const w=l.add(b,[]);c.has(b)||(f.push(e.column(b)),h.push(w))}}),t.forEach(b=>{o.has(b)||(l.has(b)||l.add(b,[]),d.push(l.data[b]))});const p=a?l.add(a,[]):null;let g=0;const m=f.length,y=d.length,x=(b,w)=>{for(let E=0;E<m;++E)h[E].length=g+w,h[E].fill(f[E].at(b),g,g+w)},v=p?(b,w)=>{for(let E=0;E<w;++E)p[b+E]=E}:()=>{};if(y===1){const b=u[0],w=d[0];e.scan((E,_)=>{const k=is(b(E,_)),A=Math.min(k.length,s);x(E,A);for(let T=0;T<A;++T)w[g+T]=k[T];v(g,A),g+=A})}else e.scan((b,w)=>{let E=0;const _=u.map(k=>{const A=is(k(b,w));return E=Math.min(Math.max(E,A.length),s),A});x(b,E);for(let k=0;k<y;++k){const A=d[k],T=_[k];for(let $=0;$<E;++$)A[g+$]=T[$]}v(g,E),g+=E});return l.new(e)}function uEe(e,t,n){return lEe(e,gr("fold",e,t),n)}function lEe(e,{names:t=[],exprs:n=[],ops:i=[]},r={}){if(t.length===0)return e;const[s="key",a="value"]=r.as||[],o=Gu(e,i,n);return VB(e,{names:[s,a],exprs:[()=>t,(u,l)=>o.map(c=>c(u,l))]},{...r,drop:t})}function SC(e){return e.isGrouped()?e.create({groups:null}):e}function cEe(e,t,n={}){if(t=gi(t,{table:e}),t.names.forEach(i=>e.column(i)?0:pt(`Invalid impute column ${Js(i)}`)),n.expand){const i={preparse:fEe,window:!1,aggronly:!0},r=gr("impute",e,n.expand,i),s=vC(SC(e),r);return WO(e,t,r.names,r.names.map(a=>s.get(a,0)))}else return WO(e,t)}function fEe(e){e.forEach((t,n)=>t.field?e.set(n,gz(t+"")):0)}function WO(e,t,n,i){const r=n&&n.length;e=r?hEe(e,n,i):e;const{names:s,exprs:a,ops:o}=t,u=Gu(e,o,a),l=r?null:mi(e),c=e.totalRows();return s.forEach((f,h)=>{const d=e.column(f),p=r?d:l.add(f,Array(c)),g=u[h];e.scan(m=>{const y=d.at(m);p[m]=rr(y)?y:g(m)})}),r?e:e.create(l)}function hEe(e,t,n){const i=e.groups(),r=e.data(),s=(i?i.names:[]).concat(t),a=(i?i.get:[]).concat(t.map(p=>e.getter(p))),o=new Set,u=fm(a);e.scan((p,g)=>o.add(u(p,g)));const l=e.columnNames(),c=mi(),f=l.map(p=>c.add(p,[]));l.forEach((p,g)=>{const m=r[p],y=f[g];e.scan(x=>y.push(m.at(x)))});const h=fm(a.map((p,g)=>m=>m[g])),d=Gc("v","{"+f.map((p,g)=>`_${g}.push(v[$${g}]);`).join("")+"}",f,l.map(p=>s.indexOf(p)));if(i){let p=i.keys.length;const g=n.reduce((y,x)=>y*x.length,i.size),m=new Uint32Array(g+(p-o.size));m.set(i.keys),HO(i,n,(y,x)=>{o.has(h(y))||(d(y),m[p++]=x[0])}),c.groupby({...i,keys:m})}else HO(i,n,p=>{o.has(h(p))||d(p)});return c.new(e)}function HO(e,t,n){const i=e?e.get.length:0,r=e?1:0,s=r+t.length,a=new Int32Array(s),o=new Int32Array(s),u=[];if(e){const{get:c,rows:f,size:h}=e;a[0]=h,u.push((d,p)=>{const g=f[p];for(let m=0;m<i;++m)d[m]=c[m](g)})}t.forEach((c,f)=>{const h=f+i;a[f+r]=c.length,u.push((d,p)=>d[h]=c[p])});const l=Array(i+t.length);for(let c=0;c<s;++c)u[c](l,0);n(l,o);for(let c=s-1;c>=0;){const f=++o[c];f<a[c]?(u[c](l,f),n(l,o),c=s-1):(o[c]=0,u[c](l,0),--c)}}function dEe(e,...t){t=t.flat();const n=e.columnNames();return t.length?Dy(t.reduce((i,r)=>UB(i,r.select(n)),e)):e.reify([])}const pEe={aggregate:!1,window:!1},gEe={...pEe,index:1},GO=-1/0;function mEe(e,t,n,i){return nh(e,t,()=>!0,n,{...i,left:!0,right:!0})}function nh(e,t,n,i,r={}){n=EC(e,t,n);const s={join:[e,t]};let a;if(In(n)){const[o,u]=n.map(is);a=BB(e,t,o,u),i||(i=yEe(e,o,u,r))}else a=gi({on:n},s).exprs[0],i||(i=[nd(),nd()]);return bEe(e,t,a,xEe(e,t,i,s,r&&r.suffix),r)}function yEe(e,t,n,i){const r=[];t.forEach((a,o)=>Sr(a)&&a===n[o]?r.push(a):0);const s=RB(r);if(i.left&&i.right){const a=new Set(r);return[e.columnNames().map(o=>{const u=`[${Js(o)}]`;return a.has(o)?{[o]:`(a, b) => a${u} == null ? b${u} : a${u}`}:o}),s]}return i.right?[s,nd()]:[nd(),s]}function xEe(e,t,n,i,r=[]){if(In(n)){let s,a,o,u=n.length;s=a=o={names:[],exprs:[]},u--&&(s=gr("join",e,n[0],i)),u--&&(a=gr("join",t,n[1],gEe)),u--&&(o=gi(n[2],i));const l=new Set,c=new Set(s.names);return a.names.forEach(f=>{c.has(f)&&l.add(f)}),l.size&&(r[0]!==""&&YO(s.names,l,r[0]||"_1"),r[1]!==""&&YO(a.names,l,r[1]||"_2")),{names:s.names.concat(a.names,o.names),exprs:s.exprs.concat(a.exprs,o.exprs)}}else return gi(n,i)}function YO(e,t,n){e.forEach((i,r)=>t.has(i)?e[r]=i+n:0)}function vEe(e,t){const n=["i","a","j","b"];return Gc(n,"{"+Zd(e,(i,r)=>`_${r}.push($${r}(${n}));`)+"}",e,t)}function bEe(e,t,n,{names:i,exprs:r},s={}){const a=e.data(),o=e.indices(!1),u=o.length,l=new Int32Array(u),c=t.data(),f=t.indices(!1),h=f.length,d=new Int32Array(h),p=i.length,g=mi(),m=Array(p),y=Array(p);for(let b=0;b<i.length;++b)m[b]=g.add(i[b],[]),y[b]=r[b];const x=vEe(m,y);if((In(n)?_Ee:wEe)(x,n,a,c,o,f,l,d,u,h),s.left)for(let b=0;b<u;++b)l[b]||x(o[b],a,GO,c);if(s.right)for(let b=0;b<h;++b)d[b]||x(GO,a,f[b],c);return g.new(e)}function wEe(e,t,n,i,r,s,a,o,u,l){for(let c=0;c<u;++c){const f=r[c];for(let h=0;h<l;++h){const d=s[h];t(f,n,d,i)&&(e(f,n,d,i),a[c]=1,o[h]=1)}}}function _Ee(e,[t,n],i,r,s,a,o,u,l,c){let f,h,d,p,g,m,y,x,v=e;l>=c?(f=i,h=t,d=o,p=s,g=r,m=n,y=u,x=a):(f=r,h=n,d=u,p=a,g=i,m=t,y=o,x=s,v=(E,_,k,A)=>e(k,A,E,_));const b=tEe(x,g,m),w=p.length;for(let E=0;E<w;++E){const _=p[E],k=b.get(h(_,f));if(k){const A=k.length;for(let T=0;T<A;++T){const $=k[T];v(_,f,x[$],g),y[$]=1}d[E]=1}}}function EEe(e,t,n,...i){return n=EC(e,t,n),i=i.length===0?[RB(e.columnNames())]:i.flat(),SEe(e,t,[bm("lookup",e,n[0]),bm("lookup",t,n[1])],gr("lookup",t,i))}function SEe(e,t,[n,i],{names:r,exprs:s,ops:a=[]}){const o=mi(e),u=e.totalRows();r.forEach(h=>o.add(h,Array(u).fill(Re)));const l=zB(t,i),c=Gc(["lr","rr","data"],"{"+Zd(r,(h,d)=>`_[${d}][lr] = $[${d}](rr, data);`)+"}",r.map(h=>o.data[h]),Gu(t,a,s)),f=t.data();return e.scan((h,d)=>{const p=l.get(n(h,d));p>=0&&c(h,p,f)}),o.derive(e)}const kEe=(e,t,n,i)=>`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n} : (u > v || v == null) && u != null ? ${i} : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n} : v !== v && u === u ? ${i} : `,AEe=(e,t,n,i,r)=>`(v = ${t}, (u = ${e}) == null && v == null) ? 0 : v == null ? ${i} : u == null ? ${n} : (u = ${r}(u,v)) ? u : `;function CEe(e,t){const n=[],i=[],r=[];let s=null,a="0",o="0";e.isGrouped()&&(s=e.groups().keys,a="ka",o="kb");const{ops:u}=gi(t,{table:e,value:(d,p)=>{if(n.push(d),p.escape){const g=m=>`fn[${r.length}](${m}, data)`;i.push([g("a"),g("b")]),r.push(p.escape)}else i.push([dm(p,{index:"a",op:a}),dm(p,{index:"b",op:o})])},window:!1}),l=Yc(e,u),c=(d,p)=>l[d][p],f=n.length;let h="return (a, b) => {"+(c&&e.isGrouped()?"const ka = keys[a], kb = keys[b];":"")+"let u, v; return ";for(let d=0;d<f;++d){const p=t.get(n[d]),g=p.desc?-1:1,[m,y]=i[d];p.collate?(h+=AEe(m,y,-g,g,`${g<0?"-":""}fn[${r.length}]`),r.push(p.collate)):h+=kEe(m,y,-g,g)}return h+="0;};",Function("op","keys","fn","data",h)(c,s,r,e.data())}function $Ee(e,...t){return FEe(e,TEe(e,t.flat()))}function TEe(e,t){let n=-1;const i=new Map,r=s=>i.set(++n+"",s);return t.forEach(s=>{const a=s.expr!=null?s.expr:s;if(ro(a)&&!en(a))for(const o in a)r(a[o]);else r(So(a)?xm(s,e.columnName(a)):Sr(a)?xm(s):en(a)?s:pt(`Invalid orderby field: ${s+""}`))}),CEe(e,i)}function FEe(e,t){return e.create({order:t})}function MEe(e,t,n,i){return NEe(e,gr("fold",e,t),gr("fold",e,n,{preparse:OEe,window:!1,aggronly:!0}),i)}function OEe(e){e.forEach((t,n)=>t.field?e.set(n,hz(t+"")):0)}const _w=(e,t)=>e??t;function NEe(e,t,n,i={}){const{keys:r,keyColumn:s}=REe(e,t,i),a=_w(i.valueSeparator,"_"),o=n.names.length>1?(l,c)=>c+a+r[l]:l=>r[l],u=r.map(l=>Yc(e,n.ops.map(c=>{if(c.name==="count"){const h=d=>l===s[d]?1:NaN;return h.toString=()=>l+":1",{...c,name:"sum",fields:[h]}}const f=c.fields.map(h=>{const d=(p,g)=>l===s[p]?h(p,g):NaN;return d.toString=()=>l+":"+h,d});return{...c,fields:f}})));return DEe(n,o,e.groups(),u).new(e)}function REe(e,t,n){const i=n.limit>0?+n.limit:1/0,r=_w(n.sort,!0),s=_w(n.keySeparator,"_"),a=Gu(e,t.ops,t.exprs),o=a.length===1?a[0]:(f,h)=>a.map(d=>d(f,h)).join(s),u=Array(e.totalRows());e.scan((f,h)=>u[f]=o(f,h));const l=Yc(SC(e),[{id:0,name:"array_agg_distinct",fields:[f=>u[f]],params:[]}])[0][0],c=r?l.sort():l;return{keys:Number.isFinite(i)?c.slice(0,i):c,keyColumn:u}}function DEe({names:e,exprs:t},n,i,r){const s=i?i.size:1,a=mi(),o=r.length,u=e.length;let l;const c=(f,h)=>l[f][h];i&&Cz(a,i);for(let f=0;f<u;++f){const h=t[f];if(h.field!=null)for(let d=0;d<o;++d)a.add(n(d,e[f]),r[d][h.field]);else if(s>1)for(let d=0;d<o;++d){l=r[d];const p=a.add(n(d,e[f]),Array(s));for(let g=0;g<s;++g)p[g]=h(g,null,c)}else for(let d=0;d<o;++d)l=r[d],a.add(n(d,e[f]),[h(0,null,c)])}return a}function IEe(e,t){const n=mi(),i=e.groups(),{get:r,names:s=[],rows:a,size:o=1}=i||{},u=new Uint32Array(o+1);s.forEach(h=>n.add(h,null));const l=i?Az(e,t,i):[kz(e,t)];t.outputs().map(h=>n.add(h,[]));const c=u.length-1;let f=0;for(let h=0;h<c;++h)f+=u[h+1]=t.write(l[h],n.data,u[h]);if(i){const h=e.data();s.forEach((d,p)=>{const g=n.data[d]=Array(f),m=r[p];for(let y=0,x=0;y<o;++y)g.fill(m(a[y],h),x,x+=u[y+1])})}return n.new(e)}function PEe(e,...t){const n=new Map;return e.columnNames(i=>(n.set(i,i),0)),bC(e,na(e,t.flat(),n))}function LEe(e,t,n,i){return(t?i?BEe:zEe:i?jEe:UEe)(e.length,e,n,i)}function zEe(e,t,n){const i=n.length;for(let r=0;r<e;++r)t[r]=n[i*Wc()|0];return t}function BEe(e,t,n,i){const r=n.length,s=new Float64Array(r);let a=0;for(let u=0;u<r;++u)s[u]=a+=i(n[u]);const o=LB(nC).right;for(let u=0;u<e;++u)t[u]=n[o(s,a*Wc())];return t}function UEe(e,t,n){const i=n.length;if(e>=i)return n;for(let r=0;r<e;++r)t[r]=n[r];for(let r=e;r<i;++r){const s=r*Wc();s<e&&(t[s|0]=n[r])}return t}function jEe(e,t,n,i){const r=n.length;if(e>=r)return n;const s=new Float32Array(r),a=new Uint32Array(r);for(let o=0;o<r;++o)a[o]=o,s[o]=-Math.log(Wc())/i(n[o]);a.sort((o,u)=>s[o]-s[u]);for(let o=0;o<e;++o)t[o]=n[a[o]];return t}function qEe(e,t=0,n=e.length){let i=n-(t=+t);for(;i;){const r=Wc()*i--|0,s=e[i+t];e[i+t]=e[r+t],e[r+t]=s}return e}function VEe(e,t,n={}){return GEe(e,WEe(e,t),HEe(e,n.weight),n)}const WB=e=>t=>e.at(t)||0;function WEe(e,t){return So(t)?()=>t:WB(vC(e,gi({size:t},{table:e,window:!1})).column("size"))}function HEe(e,t){return t==null?null:(t=So(t)?e.columnName(t):t,WB(Sr(t)?e.column(t):wC(e,gi({w:t},{table:e}),{drop:!0}).column("w")))}function GEe(e,t,n,i={}){const{replace:r,shuffle:s}=i,a=e.partitions(!1);let o=0;t=a.map((c,f)=>{let h=t(f);return o+=h=r?h:Math.min(c.length,h),h});const u=new Uint32Array(o);let l=0;return a.forEach((c,f)=>{const h=t[f],d=u.subarray(l,l+=h);!r&&h===c.length?d.set(c):LEe(d,r,c,n)}),s!==!1&&(a.length>1||!r)&&qEe(u),e.reify(u)}function YEe(e=0,t=1/0){return`${XO(e)} < row_number() && row_number() <= ${XO(t)}`}function XO(e){return e<0?`count() + ${e}`:e}function XEe(e,t=0,n=1/0){if(e.isGrouped())return _C(e,YEe(t,n)).reify();const i=[],r=e.numRows();return t=Math.max(0,t+(t<0?r:0)),n=Math.min(r,Math.max(0,n+(n<0?r:0))),e.scan(s=>i.push(s),!0,n-t,t),e.reify(i)}function KEe(e,t,n){return QEe(e,gr("spread",e,t),n)}function QEe(e,{names:t,exprs:n,ops:i=[]},r={}){if(t.length===0)return e;const s=t.length===1&&r.as||[],a=r.drop==null?!0:!!r.drop,o=r.limit==null?s.length||1/0:Math.max(1,+r.limit||1),u=Gu(e,i,n),l=mi(),c=t.reduce((h,d,p)=>h.set(d,p),new Map),f=(h,d)=>{const p=JEe(e,u[h],o),g=p.length;for(let m=0;m<g;++m)l.add(s[m]||`${d}_${m+1}`,p[m])};return e.columnNames().forEach(h=>{c.has(h)?(a||l.add(h,e.column(h)),f(c.get(h),h),c.delete(h)):l.add(h,e.column(h))}),c.forEach(f),l.derive(e)}function JEe(e,t,n){const i=e.totalRows(),r=[];return e.scan((s,a)=>{const o=is(t(s,a)),u=Math.min(o.length,n);for(;r.length<u;)r.push(Array(i).fill(Re));for(let l=0;l<u;++l)r[l][s]=o[l]}),r}function ZEe(e,...t){return Dy(IB(e,t.flat()))}function eSe(e){return e.isOrdered()?e.create({order:null}):e}const HB=Uint8Array.of(65,82,82,79,87,49),tSe=Uint8Array.of(255,255,255,255,0,0,0,0),id={V1:0,V5:4},nSe={Little:0},$g={NONE:0,Schema:1,DictionaryBatch:2,RecordBatch:3},U={Dictionary:-1,NONE:0,Null:1,Int:2,Float:3,Binary:4,Utf8:5,Bool:6,Decimal:7,Date:8,Time:9,Timestamp:10,Interval:11,List:12,Struct:13,Union:14,FixedSizeBinary:15,FixedSizeList:16,Map:17,Duration:18,LargeBinary:19,LargeUtf8:20,LargeList:21,RunEndEncoded:22,BinaryView:23,Utf8View:24,ListView:25,LargeListView:26},Iy={HALF:0,SINGLE:1,DOUBLE:2},rd={DAY:0,MILLISECOND:1},or={SECOND:0,MILLISECOND:1,MICROSECOND:2,NANOSECOND:3},sd={YEAR_MONTH:0,DAY_TIME:1,MONTH_DAY_NANO:2},GB={Sparse:0,Dense:1},ef=Uint8Array,kC=Uint16Array,AC=Uint32Array,CC=BigUint64Array,$C=Int8Array,YB=Int16Array,tf=Int32Array,nf=BigInt64Array,XB=Float32Array,np=Float64Array;function iSe(e,t){const n=Math.log2(e)-3;return(t?[$C,YB,tf,nf]:[ef,kC,AC,CC])[n]}const rSe=Object.getPrototypeOf(Int8Array);function KB(e){return e instanceof rSe}function QB(e){return Array.isArray(e)||KB(e)}function TC(e){return e===nf||e===CC}function FC(e,t){let n=0,i=e.length;if(i<=2147483648)do{const r=n+i>>>1;e[r]<=t?n=r+1:i=r}while(n<i);else do{const r=Math.trunc((n+i)/2);e[r]<=t?n=r+1:i=r}while(n<i);return n}function sSe(e,t=1){return(e*t+7&-8)/t}function aSe(e,t=e.length){const n=sSe(t,e.BYTES_PER_ELEMENT);return e.length>n?e.subarray(0,n):e.length<n?JB(e,n):e}function JB(e,t,n=0){const i=new e.constructor(t);return i.set(e,n),i}function ZB(e,t,n){for(;e.length<=t;)e=JB(e,e.length<<1,n?e.length:0);return e}function oSe(e){return e instanceof Date}function uSe(e){return typeof e[Symbol.iterator]=="function"}function eU(e,t,n){if(t(e))return e;throw new Error(n(e))}function ip(e,t,n){return t=Array.isArray(t)?t:Object.values(t),eU(e,i=>t.includes(i),n??(()=>`${e} must be one of ${t}`))}function lSe(e,t){for(const[n,i]of Object.entries(e))if(i===t)return n;return"<Unknown>"}const Py=e=>`Unsupported data type: "${lSe(U,e)}" (id ${e})`,Ly=(e,t,n=!0,i=null)=>({name:e,type:t,nullable:n,metadata:i});function tU(e){return Object.hasOwn(e,"name")&&nU(e.type)}function nU(e){return typeof e?.typeId=="number"}function iU(e,t="",n=!0){return tU(e)?e:Ly(t,eU(e,nU,()=>"Data type expected."),n)}const rU=e=>({typeId:e}),cSe=(e,t,n=!1,i=-1)=>({typeId:U.Dictionary,id:i,dictionary:e,indices:t||MC(),ordered:n}),fSe=()=>rU(U.Null),ko=(e=32,t=!0)=>({typeId:U.Int,bitWidth:ip(e,[8,16,32,64]),signed:t,values:iSe(e,t)}),sU=()=>ko(8),aU=()=>ko(16),MC=()=>ko(32),oU=()=>ko(64),hSe=()=>ko(8,!1),dSe=()=>ko(16,!1),pSe=()=>ko(32,!1),gSe=()=>ko(64,!1),uU=(e=2)=>({typeId:U.Float,precision:ip(e,Iy),values:[kC,XB,np][e]}),mSe=()=>uU(Iy.SINGLE),OC=()=>uU(Iy.DOUBLE),ySe=()=>({typeId:U.Utf8,offsets:tf}),xSe=()=>rU(U.Bool),vSe=e=>({typeId:U.Date,unit:ip(e,rd),values:e===rd.DAY?tf:nf}),bSe=()=>vSe(rd.DAY),wSe=(e=or.MILLISECOND,t=null)=>({typeId:U.Timestamp,unit:ip(e,or),timezone:t,values:nf}),_Se=e=>({typeId:U.List,children:[iU(e)],offsets:tf}),ESe=e=>({typeId:U.Struct,children:Array.isArray(e)&&tU(e[0])?e:Object.entries(e).map(([t,n])=>Ly(t,n))}),SSe=(e,t)=>({typeId:U.FixedSizeList,stride:t,children:[iU(e)]}),lU=new np(2),zy=lU.buffer,kSe=new nf(zy),ll=new AC(zy),KO=new tf(zy),ASe=new ef(zy);function CSe(e){return e}function Ps(e){return BigInt(e)}function cU(e){return TC(e)?Ps:CSe}function $Se(e){return e/864e5|0}function TSe(e){return e===or.SECOND?t=>Ps(t/1e3):e===or.MILLISECOND?Ps:e===or.MICROSECOND?t=>Ps(t*1e3):t=>Ps(t*1e6)}function FSe([e,t,n]){return KO[0]=e,KO[1]=t,kSe[1]=Ps(n),ASe}function so(e){if(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)throw Error(`BigInt exceeds integer number representation: ${e}`);return Number(e)}function NC(e,t){return Number(e/t)+Number(e%t)/Number(t)}function MSe(e,t,n,i,r){const s=typeof e=="bigint"?e:Ps(Math.trunc(e*r));t[n]=s,t[n+1]=s>>64n,i>2&&(t[n+2]=s>>128n,t[n+3]=s>>192n)}const El=e=>BigInt.asUintN(64,e);function OSe(e,t){const n=t<<1;let i;return BigInt.asIntN(64,e[n+1])<0?(i=El(~e[n])|El(~e[n+1])<<64n,i=-(i+1n)):i=e[n]|e[n+1]<<64n,i}function NSe(e,t){const n=t<<2;let i;return BigInt.asIntN(64,e[n+3])<0?(i=El(~e[n])|El(~e[n+1])<<64n|El(~e[n+2])<<128n|El(~e[n+3])<<192n,i=-(i+1n)):i=e[n]|e[n+1]<<64n|e[n+2]<<128n|e[n+3]<<192n,i}function RSe(e){if(e!==e)return 32256;lU[0]=e;const t=(ll[1]&2147483648)>>16&65535;let n=ll[1]&2146435072,i=0;return n>=1089470464?ll[0]>0?n=31744:(n=(n&2080374784)>>16,i=(ll[1]&1048575)>>10):n<=1056964608?(i=1048576+(ll[1]&1048575),i=1048576+(i<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,i=(ll[1]&1048575)+512>>10),t|n|i&65535}const DSe=new TextDecoder("utf-8"),ISe=new TextEncoder;function RC(e){return DSe.decode(e)}function fU(e){return ISe.encode(e)}function By(e){return`${typeof e!="object"||!e?e??null:oSe(e)?+e:QB(e)?`[${e.map(By)}]`:PSe(e)}`}function PSe(e){let t="",n=-1;for(const i in e)++n>0&&(t+=","),t+=`"${i}":${By(e[i])}`;return`{${t}}`}const pl=4,Hv=2;function hU(e,t){return(e[t>>3]&1<<t%8)!==0}function Gv(e,t){return LSe(e,t)<<16>>16}function LSe(e,t){return e[t]|e[t+1]<<8}function Rl(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}function QO(e,t){return Rl(e,t)>>>0}function zSe(e,t){return so(BigInt.asIntN(64,BigInt(QO(e,t))+(BigInt(QO(e,t+pl))<<32n)))}const Yv=Symbol("rowIndex");function Ew(e,t){class n{constructor(s){this[Yv]=s}toJSON(){return pU(e,t,this[Yv])}}const i=n.prototype;for(let r=0;r<e.length;++r){if(Object.hasOwn(i,e[r]))continue;const s=t[r];Object.defineProperty(i,e[r],{get(){return s.at(this[Yv])},enumerable:!0})}return r=>new n(r)}function dU(e,t){return n=>pU(e,t,n)}function pU(e,t,n){const i={};for(let r=0;r<e.length;++r)i[e[r]]=t[r].at(n);return i}function BSe(e){return e instanceof xh}class rp{constructor({length:t,nullCount:n,type:i,validity:r,values:s,offsets:a,sizes:o,children:u}){this.length=t,this.nullCount=n,this.type=i,this.validity=r,this.values=s,this.offsets=a,this.sizes=o,this.children=u,(!n||!this.validity)&&(this.at=l=>this.value(l))}get[Symbol.toStringTag](){return"Batch"}at(t){return this.isValid(t)?this.value(t):null}isValid(t){return hU(this.validity,t)}value(t){return this.values[t]}slice(t,n){const i=n-t,r=Array(i);for(let s=0;s<i;++s)r[s]=this.at(t+s);return r}*[Symbol.iterator](){for(let t=0;t<this.length;++t)yield this.at(t)}}Xu(rp,"ArrayType",null);class xh extends rp{constructor(t){super(t);const{length:n,values:i}=this;this.values=i.subarray(0,n)}slice(t,n){return this.nullCount?super.slice(t,n):this.values.subarray(t,n)}[Symbol.iterator](){return this.nullCount?super[Symbol.iterator]():this.values[Symbol.iterator]()}}class Uy extends rp{}Xu(Uy,"ArrayType",np);class gt extends rp{}Xu(gt,"ArrayType",Array);class gU extends gt{value(t){return null}}class Yu extends Uy{value(t){return so(this.values[t])}}class USe extends Uy{value(t){const n=this.values[t],i=(n&31744)>>10,r=(n&1023)/1024,s=(-1)**((n&32768)>>15);switch(i){case 31:return s*(r?Number.NaN:1/0);case 0:return s*(r?6103515625e-14*r:0)}return s*2**(i-15)*(1+r)}}class jSe extends gt{value(t){return hU(this.values,t)}}class mU extends rp{constructor(t){super(t);const{bitWidth:n,scale:i}=this.type;this.decimal=n===128?OSe:NSe,this.scale=10n**BigInt(i)}}class yU extends mU{value(t){return NC(this.decimal(this.values,t),this.scale)}}Xu(yU,"ArrayType",np);class xU extends mU{value(t){return this.decimal(this.values,t)}}Xu(xU,"ArrayType",Array);class JO extends gt{constructor(t){super(t),this.source=t}value(t){return new Date(this.source.value(t))}}class qSe extends Uy{value(t){return 864e5*this.values[t]}}const VSe=Yu;class WSe extends Yu{value(t){return super.value(t)*1e3}}const HSe=Yu;class GSe extends Yu{value(t){return NC(this.values[t],1000n)}}class YSe extends Yu{value(t){return NC(this.values[t],1000000n)}}class XSe extends gt{value(t){return this.values.subarray(t<<1,t+1<<1)}}class KSe extends gt{value(t){const n=this.values,i=t<<4;return Float64Array.of(Rl(n,i),Rl(n,i+4),zSe(n,i+8))}}const vU=({values:e,offsets:t},n)=>e.subarray(t[n],t[n+1]),bU=({values:e,offsets:t},n)=>e.subarray(so(t[n]),so(t[n+1]));class QSe extends gt{value(t){return vU(this,t)}}class JSe extends gt{value(t){return bU(this,t)}}class ZSe extends gt{value(t){return RC(vU(this,t))}}class eke extends gt{value(t){return RC(bU(this,t))}}class tke extends gt{value(t){const n=this.offsets;return this.children[0].slice(n[t],n[t+1])}}class nke extends gt{value(t){const n=this.offsets;return this.children[0].slice(so(n[t]),so(n[t+1]))}}class ike extends gt{value(t){const n=this.offsets[t],i=n+this.sizes[t];return this.children[0].slice(n,i)}}class rke extends gt{value(t){const n=this.offsets[t],i=n+this.sizes[t];return this.children[0].slice(so(n),so(i))}}class wU extends gt{constructor(t){super(t),this.stride=this.type.stride}}class ske extends wU{value(t){const{stride:n,values:i}=this;return i.subarray(t*n,(t+1)*n)}}class ake extends wU{value(t){const{children:n,stride:i}=this;return n[0].slice(t*i,(t+1)*i)}}function _U({children:e,offsets:t},n){const[i,r]=e[0].children,s=t[n],a=t[n+1],o=[];for(let u=s;u<a;++u)o.push([i.at(u),r.at(u)]);return o}class oke extends gt{value(t){return _U(this,t)}}class uke extends gt{value(t){return new Map(_U(this,t))}}class EU extends gt{constructor({typeIds:t,...n}){super(n),this.typeIds=t,this.typeMap=this.type.typeMap}value(t,n=t){const{typeIds:i,children:r,typeMap:s}=this;return r[s[i[t]]].at(n)}}class lke extends EU{value(t){return super.value(t,this.offsets[t])}}class SU extends gt{constructor(t,n=dU){super(t),this.names=this.type.children.map(i=>i.name),this.factory=n(this.names,this.children)}value(t){return this.factory(t)}}class cke extends SU{constructor(t){super(t,Ew)}}class fke extends gt{value(t){const[{values:n},i]=this.children;return i.at(FC(n,t))}}class hke extends gt{setDictionary(t){return this.dictionary=t,this.cache=t.cache(),this}value(t){return this.cache[this.key(t)]}key(t){return this.values[t]}}class kU extends gt{constructor({data:t,...n}){super(n),this.data=t}view(t){const{values:n,data:i}=this,r=t<<4;let s=r+4,a=n;const o=Rl(a,r);return o>12&&(s=Rl(a,r+12),a=i[Rl(a,r+8)]),a.subarray(s,s+o)}}class dke extends kU{value(t){return this.view(t)}}class pke extends kU{value(t){return RC(this.view(t))}}class DC{constructor(t,n=t[0]?.type){this.type=n,this.length=t.reduce((s,a)=>s+a.length,0),this.nullCount=t.reduce((s,a)=>s+a.nullCount,0),this.data=t;const i=t.length,r=new Int32Array(i+1);if(i===1){const[s]=t;r[1]=s.length,this.at=a=>s.at(a)}else for(let s=0,a=0;s<i;++s)r[s+1]=a+=t[s].length;this.offsets=r}get[Symbol.toStringTag](){return"Column"}[Symbol.iterator](){const t=this.data;return t.length===1?t[0][Symbol.iterator]():gke(t)}at(t){const{data:n,offsets:i}=this,r=FC(i,t)-1;return n[r]?.at(t-i[r])}get(t){return this.at(t)}toArray(){const{length:t,nullCount:n,data:i}=this,r=!n&&BSe(i[0]),s=i.length;if(r&&s===1)return i[0].values;const a=!s||n>0?Array:i[0].constructor.ArrayType??i[0].values.constructor,o=new a(t);return r?mke(o,i):yke(o,i)}cache(){return this._cache??(this._cache=this.toArray())}}function*gke(e){for(let t=0;t<e.length;++t){const n=e[t][Symbol.iterator]();for(let i=n.next();!i.done;i=n.next())yield i.value}}function mke(e,t){for(let n=0,i=0;n<t.length;++n){const{values:r}=t[n];e.set(r,i),i+=r.length}return e}function yke(e,t){let n=-1;for(let i=0;i<t.length;++i){const r=t[i];for(let s=0;s<r.length;++s)e[++n]=r.at(s)}return e}class IC{constructor(t,n,i=!1){const r=t.fields.map(a=>a.name);this.schema=t,this.names=r,this.children=n,this.factory=i?Ew:dU;const s=[];this.getFactory=a=>s[a]??(s[a]=this.factory(r,n.map(o=>o.data[a])))}get[Symbol.toStringTag](){return"Table"}get numCols(){return this.names.length}get numRows(){return this.children[0]?.length??0}getChildAt(t){return this.children[t]}getChild(t){const n=this.names.findIndex(i=>i===t);return n>-1?this.children[n]:void 0}selectAt(t,n=[]){const{children:i,factory:r,schema:s}=this,{fields:a}=s;return new IC({...s,fields:t.map((o,u)=>xke(a[o],n[u]))},t.map(o=>i[o]),r===Ew)}select(t,n){const i=this.names,r=t.map(s=>i.indexOf(s));return this.selectAt(r,n)}toColumns(){const{children:t,names:n}=this,i={};return n.forEach((r,s)=>i[r]=t[s]?.toArray()??[]),i}toArray(){const{children:t,getFactory:n,numRows:i}=this,r=t[0]?.data??[],s=Array(i);for(let a=0,o=-1;a<r.length;++a){const u=n(a);for(let l=0;l<r[a].length;++l)s[++o]=u(l)}return s}*[Symbol.iterator](){const{children:t,getFactory:n}=this,i=t[0]?.data??[];for(let r=0;r<i.length;++r){const s=n(r);for(let a=0;a<i[r].length;++a)yield s(a)}}at(t){const{children:n,getFactory:i,numRows:r}=this;if(t<0||t>=r)return null;const[{offsets:s}]=n,a=FC(s,t)-1;return i(a)(t-s[a])}get(t){return this.at(t)}}function xke(e,t){return t!=null&&t!==e.name?{...e,name:t}:e}function AU(e,t={}){const{typeId:n,bitWidth:i,precision:r,unit:s}=e,{useBigInt:a,useDate:o,useDecimalBigInt:u,useMap:l,useProxy:c}=t;switch(n){case U.Null:return gU;case U.Bool:return jSe;case U.Int:case U.Time:case U.Duration:return a||i<64?xh:Yu;case U.Float:return r?xh:USe;case U.Date:return ZO(s===rd.DAY?qSe:VSe,o&&JO);case U.Timestamp:return ZO(s===or.SECOND?WSe:s===or.MILLISECOND?HSe:s===or.MICROSECOND?GSe:YSe,o&&JO);case U.Decimal:return u?xU:yU;case U.Interval:return s===sd.DAY_TIME?XSe:s===sd.YEAR_MONTH?xh:KSe;case U.FixedSizeBinary:return ske;case U.Utf8:return ZSe;case U.LargeUtf8:return eke;case U.Binary:return QSe;case U.LargeBinary:return JSe;case U.BinaryView:return dke;case U.Utf8View:return pke;case U.List:return tke;case U.LargeList:return nke;case U.Map:return l?uke:oke;case U.ListView:return ike;case U.LargeListView:return rke;case U.FixedSizeList:return ake;case U.Struct:return c?cke:SU;case U.RunEndEncoded:return fke;case U.Dictionary:return hke;case U.Union:return e.mode?lke:EU}throw new Error(Py(n))}function ZO(e,t){return t?class extends t{constructor(i){super(new e(i))}}:e}function Sw(e,t,n){e[t]=n,e[t+1]=n>>8,e[t+2]=n>>16,e[t+3]=n>>24}const Zp=1024;class vke{constructor(t){this.sink=t,this.minalign=1,this.buf=new Uint8Array(Zp),this.space=Zp,this.vtables=[],this.outputBytes=0}offset(){return this.buf.length-this.space}writeInt8(t){this.buf[this.space-=1]=t}writeInt16(t){this.buf[this.space-=2]=t,this.buf[this.space+1]=t>>8}writeInt32(t){Sw(this.buf,this.space-=4,t)}writeInt64(t){const n=BigInt(t);this.writeInt32(Number(BigInt.asIntN(32,n>>BigInt(32)))),this.writeInt32(Number(BigInt.asIntN(32,n)))}addInt8(t){Es(this,1,0),this.writeInt8(t)}addInt16(t){Es(this,2,0),this.writeInt16(t)}addInt32(t){Es(this,4,0),this.writeInt32(t)}addInt64(t){Es(this,8,0),this.writeInt64(t)}addOffset(t){Es(this,pl,0),this.writeInt32(this.offset()-t+pl)}addObject(t,n){const i=bke(this,t);return n?.(i),i.finish()}addVector(t,n,i,r){const s=t?.length;if(!s)return 0;Es(this,pl,n*s),Es(this,i,n*s);for(let a=s;--a>=0;)r(this,t[a]);return this.writeInt32(s),this.offset()}addOffsetVector(t){return this.addVector(t,4,4,(n,i)=>n.addOffset(i))}addString(t){if(t==null)return 0;const n=fU(t),i=n.length;return this.addInt8(0),Es(this,pl,i),this.buf.set(n,this.space-=i),this.writeInt32(i),this.offset()}finish(t){Es(this,this.minalign,pl),this.addOffset(t)}flush(){const{buf:t,sink:n}=this,i=t.subarray(this.space,t.length);n.write(i),this.outputBytes+=i.byteLength,this.minalign=1,this.vtables=[],this.buf=new Uint8Array(Zp),this.space=Zp}addBuffer(t){const n=t.byteLength;if(!n)return 0;this.sink.write(t),this.outputBytes+=n;const i=(n+7&-8)-n;return this.addPadding(i),n+i}addPadding(t){t>0&&(this.sink.write(new Uint8Array(t)),this.outputBytes+=t)}}function Es(e,t,n){let{buf:i,space:r,minalign:s}=e;t>s&&(e.minalign=t);const a=i.length,o=a-r+n,u=~o+1&t-1;i=ZB(i,o+u+t-1,!0),r+=i.length-a;for(let l=0;l<u;++l)i[--r]=0;e.buf=i,e.space=r}function bke(e,t){const n=Array(t).fill(0),i=e.offset();function r(s){n[s]=e.offset()}return{addInt8(s,a,o){a!=o&&(e.addInt8(a),r(s))},addInt16(s,a,o){a!=o&&(e.addInt16(a),r(s))},addInt32(s,a,o){a!=o&&(e.addInt32(a),r(s))},addInt64(s,a,o){a!=o&&(e.addInt64(a),r(s))},addOffset(s,a,o){a!=o&&(e.addOffset(a),r(s))},finish(){e.addInt32(0);const s=e.offset();let a=t;for(;--a>=0&&n[a]===0;);const o=a+1;for(;a>=0;--a)e.addInt16(n[a]?s-n[a]:0);const u=2;e.addInt16(s-i);const l=(o+u)*Hv;e.addInt16(l);let c=0;const{buf:f,vtables:h,space:d}=e;e:for(a=0;a<h.length;++a){const p=f.length-h[a];if(l==Gv(f,p)){for(let g=Hv;g<l;g+=Hv)if(Gv(f,d+g)!=Gv(f,p+g))continue e;c=h[a];break}}if(c)e.space=f.length-s,Sw(f,e.space,c-s);else{const p=e.offset();h.push(p),Sw(f,f.length-s,p-s)}return s}}}function CU(e,t){const{nodes:n,regions:i,variadic:r}=t,s=e.addVector(n,16,8,(u,l)=>(u.writeInt64(l.nullCount),u.writeInt64(l.length),u.offset())),a=e.addVector(i,16,8,(u,l)=>(u.writeInt64(l.length),u.writeInt64(l.offset),u.offset())),o=e.addVector(r,8,8,(u,l)=>u.addInt64(l));return e.addObject(5,u=>{u.addInt64(0,n[0].length,0),u.addOffset(1,s,0),u.addOffset(2,a,0),u.addOffset(4,o,0)})}function wke(e,t){const n=CU(e,t.data);return e.addObject(3,i=>{i.addInt64(0,t.id,0),i.addOffset(1,n,0),i.addInt8(2,+t.isDelta,0)})}function PC(e,t){return t?.size>0?e.addOffsetVector(Array.from(t,([n,i])=>{const r=e.addString(`${n}`),s=e.addString(`${i}`);return e.addObject(2,a=>{a.addOffset(0,r,0),a.addOffset(1,s,0)})})):0}function Tg(e,t){switch(ip(t.typeId,U,Py)){case U.Dictionary:return Nke(e,t);case U.Int:return Cke(e,t);case U.Float:return Ake(e,t);case U.Decimal:return Eke(e,t);case U.Date:return _ke(e,t);case U.Time:return Fke(e,t);case U.Timestamp:return Mke(e,t);case U.Interval:return $ke(e,t);case U.Duration:return Ske(e,t);case U.FixedSizeBinary:case U.FixedSizeList:return kke(e,t);case U.Map:return Tke(e,t);case U.Union:return Oke(e,t)}return e.addObject(0)}function _ke(e,t){return e.addObject(1,n=>{n.addInt16(0,t.unit,rd.MILLISECOND)})}function Eke(e,t){return e.addObject(3,n=>{n.addInt32(0,t.precision,0),n.addInt32(1,t.scale,0),n.addInt32(2,t.bitWidth,128)})}function Ske(e,t){return e.addObject(1,n=>{n.addInt16(0,t.unit,or.MILLISECOND)})}function kke(e,t){return e.addObject(1,n=>{n.addInt32(0,t.stride,0)})}function Ake(e,t){return e.addObject(1,n=>{n.addInt16(0,t.precision,Iy.HALF)})}function Cke(e,t){return e.addObject(2,n=>{n.addInt32(0,t.bitWidth,0),n.addInt8(1,+t.signed,0)})}function $ke(e,t){return e.addObject(1,n=>{n.addInt16(0,t.unit,sd.YEAR_MONTH)})}function Tke(e,t){return e.addObject(1,n=>{n.addInt8(0,+t.keysSorted,0)})}function Fke(e,t){return e.addObject(2,n=>{n.addInt16(0,t.unit,or.MILLISECOND),n.addInt32(1,t.bitWidth,32)})}function Mke(e,t){const n=e.addString(t.timezone);return e.addObject(2,i=>{i.addInt16(0,t.unit,or.SECOND),i.addOffset(1,n,0)})}function Oke(e,t){const n=e.addVector(t.typeIds,4,4,(i,r)=>i.addInt32(r));return e.addObject(2,i=>{i.addInt16(0,t.mode,GB.Sparse),i.addOffset(1,n,0)})}function Nke(e,t){return e.addObject(4,n=>{n.addInt64(0,t.id,0),n.addOffset(1,Tg(e,t.indices),0),n.addInt8(2,+t.ordered,0)})}const Rke=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;function $U(e,t){const{fields:n,metadata:i}=t,r=n.map(o=>TU(e,o)),s=e.addOffsetVector(r),a=PC(e,i);return e.addObject(4,o=>{o.addInt16(0,+!Rke,0),o.addOffset(1,s,0),o.addOffset(2,a,0)})}function TU(e,t){const{name:n,nullable:i,type:r,metadata:s}=t;let{typeId:a}=r,o=0,u=0;if(a!==U.Dictionary)o=Tg(e,r);else{const d=r.dictionary;a=d.typeId,u=Tg(e,r),o=Tg(e,d)}const l=(r.children||[]).map(d=>TU(e,d)),c=e.addOffsetVector(l),f=PC(e,s),h=e.addString(n);return e.addObject(7,d=>{d.addOffset(0,h,0),d.addInt8(1,+i,0),d.addInt8(2,a,U.NONE),d.addOffset(3,o,0),d.addOffset(4,u,0),d.addOffset(5,c,0),d.addOffset(6,f,0)})}function Dke(e,t,n,i,r){const s=PC(e,r),a=e.addVector(i,24,8,eN),o=e.addVector(n,24,8,eN),u=$U(e,t);e.finish(e.addObject(5,c=>{c.addInt16(0,id.V5,id.V1),c.addOffset(1,u,0),c.addOffset(2,o,0),c.addOffset(3,a,0),c.addOffset(4,s,0)}));const l=e.offset();e.addInt32(0),e.addInt32(-1),e.flush(),e.sink.write(new Uint8Array(Int32Array.of(l).buffer)),e.sink.write(HB)}function eN(e,{offset:t,metadataLength:n,bodyLength:i}){return e.writeInt64(i),e.writeInt32(0),e.writeInt32(n),e.writeInt64(t),e.offset()}function Xv(e,t,n,i,r){e.finish(e.addObject(5,u=>{u.addInt16(0,id.V5,id.V1),u.addInt8(1,t,$g.NONE),u.addOffset(2,n,0),u.addInt64(3,i,0)}));const s=8,a=e.offset(),o=a+s+7&-8;r?.push({offset:e.outputBytes,metadataLength:o,bodyLength:i}),e.addInt32(o-s),e.addInt32(-1),e.flush(),e.addPadding(o-a-s)}class Ike{write(t){}pad(t){this.write(new Uint8Array(t))}finish(){return null}}class Pke extends Ike{constructor(){super(),this.buffers=[]}write(t){this.buffers.push(t)}finish(){const t=this.buffers,n=t.reduce((r,s)=>r+s.byteLength,0),i=new Uint8Array(n);for(let r=0,s=0;r<t.length;++r)i.set(t[r],s),s+=t[r].byteLength;return i}}const tN="stream",nN="file";function Lke(e,{sink:t,format:n=tN}={}){if(n!==tN&&n!==nN)throw new Error(`Unrecognized Arrow IPC format: ${n}`);const{schema:i,dictionaries:r=[],records:s=[],metadata:a}=e,o=new vke(t||new Pke),u=n===nN,l=[],c=[];u&&o.addBuffer(HB),i&&Xv(o,$g.Schema,$U(o,i),0);for(const f of r){const{data:h}=f;Xv(o,$g.DictionaryBatch,wke(o,f),h.byteLength,l),iN(o,h.buffers)}for(const f of s)Xv(o,$g.RecordBatch,CU(o,f),f.byteLength,c),iN(o,f.buffers);return o.addBuffer(tSe),u&&Dke(o,i,l,c,a),o.sink}function iN(e,t){for(let n=0;n<t.length;++n)e.addBuffer(t[n])}function zke(e,t){typeof t=="string"&&(t={format:t});const n=e.children;Bke(n);const{dictionaries:i,idMap:r}=jke(n),s=Vke(n),o={schema:qke(e.schema,r),dictionaries:i,records:s};return Lke(o,t).finish()}function Bke(e){const t=e[0]?.data.map(n=>n.length);e.forEach(({data:n})=>{if(n.length!==t.length||n.some((i,r)=>i.length!==t[r]))throw new Error("Columns have inconsistent batch sizes.")})}function Uke(){let e=0;const t=[],n=[],i=[],r=[];return{node(s,a){t.push({length:s,nullCount:a})},buffer(s){const a=s.byteLength,o=a+7&-8;n.push({offset:e,length:o}),e+=o,i.push(new Uint8Array(s.buffer,s.byteOffset,a))},variadic(s){r.push(s)},children(s,a){s.children.forEach((o,u)=>{MU(o.type,a.children[u],this)})},done(){return{byteLength:e,nodes:t,regions:n,variadic:r,buffers:i}}}}function jke(e){const t=[],n=new Map,i=new Map;let r=-1;const s=a=>{if(n.has(a))i.set(a.type,n.get(a));else{n.set(a,++r);for(let o=0;o<a.data.length;++o)t.push({id:r,isDelta:o>0,data:FU([a],o)});i.set(a.type,r)}};return e.forEach(a=>kw(a.data[0],s)),{dictionaries:t,idMap:i}}function kw(e,t){if(e?.type.typeId===U.Dictionary){const n=e.dictionary;t(n),kw(n.data[0],t)}e?.children?.forEach(n=>kw(n,t))}function qke(e,t){if(!t.size)return e;const n=s=>{s.typeId===U.Dictionary&&(s.id=t.get(s.dictionary),r(s)),s.children&&(s.children=s.children.slice()).forEach(i)},i=(s,a,o)=>{const u={...s.type};o[a]={...s,type:u},n(u)},r=s=>{const a={...s.dictionary};s.dictionary=a,n(a)};return e={...e,fields:e.fields.slice()},e.fields.forEach(i),e}function Vke(e){return(e[0]?.data||[]).map((t,n)=>FU(e,n))}function FU(e,t=0){const n=Uke();return e.forEach(i=>{MU(i.type,i.data[t],n)}),n.done()}function MU(e,t,n){const{typeId:i}=e;if(i!==U.Null)switch(n.node(t.length,t.nullCount),i){case U.Bool:case U.Int:case U.Time:case U.Duration:case U.Float:case U.Date:case U.Timestamp:case U.Decimal:case U.Interval:case U.FixedSizeBinary:case U.Dictionary:n.buffer(t.validity),n.buffer(t.values);return;case U.Utf8:case U.LargeUtf8:case U.Binary:case U.LargeBinary:n.buffer(t.validity),n.buffer(t.offsets),n.buffer(t.values);return;case U.BinaryView:case U.Utf8View:n.buffer(t.validity),n.buffer(t.values),n.variadic(t.data.length),t.data.forEach(r=>n.buffer(r));return;case U.List:case U.LargeList:case U.Map:n.buffer(t.validity),n.buffer(t.offsets),n.children(e,t);return;case U.ListView:case U.LargeListView:n.buffer(t.validity),n.buffer(t.offsets),n.buffer(t.sizes),n.children(e,t);return;case U.FixedSizeList:case U.Struct:n.buffer(t.validity),n.children(e,t);return;case U.RunEndEncoded:n.children(e,t);return;case U.Union:{n.buffer(t.typeIds),e.mode===GB.Dense&&n.buffer(t.offsets),n.children(e,t);return}default:throw new Error(Py(i))}}function Li(e){return new OU(e)}let OU=class{constructor(t=ef){this.buf=new t(512)}array(t){return aSe(this.buf,t)}prep(t){t>=this.buf.length&&(this.buf=ZB(this.buf,t))}get(t){return this.buf[t]}set(t,n){this.prep(n),this.buf[n]=t}write(t,n){this.prep(n+t.length),this.buf.set(t,n)}};function NU(){return new Wke}class Wke extends OU{set(t){const n=t>>3;this.prep(n),this.buf[n]|=1<<t%8}}class LC{constructor(t,n){this.type=t,this.ctx=n,this.batchClass=n.batchType(t)}init(){return this.index=-1,this}set(t,n){return this.index=n,!1}done(){return null}batch(){const t=new this.batchClass(this.done());return this.init(),t}}class kr extends LC{constructor(t,n){super(t,n)}init(){return this.nullCount=0,this.validity=NU(),super.init()}set(t,n){this.index=n;const i=t!=null;return i?this.validity.set(n):this.nullCount++,i}done(){const{index:t,nullCount:n,type:i,validity:r}=this;return{length:t+1,nullCount:n,type:i,validity:n?r.array((t>>3)+1):new ef(0)}}}function Hke(){const e=new Map,t=new Set;return{get(n,i){const r=n.id;if(r>=0&&e.has(r))return e.get(r);{const s=Gke(n,i);return r>=0&&e.set(r,s),t.add(s),s}},finish(n){t.forEach(i=>i.finish(n))}}}function Gke(e,t){const n=Object.create(null),i=t.builder(e.dictionary),r=[];i.init();let s=-1;return{type:e,values:i,add(a){return r.push(a),a},key(a){const o=By(a);let u=n[o];return u===void 0&&(n[o]=u=++s,i.set(a,u)),u},finish(a){const o=e.dictionary,u=new(AU(o,a))(i.done()),l=new DC([u]);r.forEach(c=>c.setDictionary(l))}}}class Yke extends kr{constructor(t,n){super(t,n),this.dict=n.dictionary(t)}init(){return this.values=Li(this.type.indices.values),super.init()}set(t,n){super.set(t,n)&&this.values.set(this.dict.key(t),n)}done(){return{...super.done(),values:this.values.array(this.index+1)}}batch(){return this.dict.add(super.batch())}}function Xke(e){const t=Aw();return e(n=>t.add(n)),t.type()}function Aw(){let e=0,t=0,n=0,i=0,r=0,s=0,a=0,o=0,u=0,l=0,c=0,f=1/0,h=-1/0,d=1/0,p=-1/0,g,m,y,x={};return{add(v){if(e++,v==null){t++;return}switch(typeof v){case"string":u++;break;case"number":i++,v<f&&(f=v),v>h&&(h=v),Number.isInteger(v)&&r++;break;case"bigint":s++,g===void 0?g=m=v:(v<g&&(g=v),v>m&&(m=v));break;case"boolean":n++;break;case"object":if(v instanceof Date)a++,+v%864e5===0&&o++;else if(QB(v)){l++;const b=v.length;b<d&&(d=b),b>p&&(p=b),y??=Aw(),v.forEach(y.add)}else{c++;for(const b in v)(x[b]??(x[b]=Aw())).add(v[b])}}},type(){const v=e-t;return v===0?fSe():r===v?Qke(f,h):i===v?OC():s===v?Jke(g,m):n===v?xSe():o===v?bSe():a===v?wSe():u===v?cSe(ySe()):l===v?Kke(y.type(),d,p):c===v?ESe(Object.entries(x).map(b=>Ly(b[0],b[1].type()))):Zke()}}}function Kke(e,t,n){return n===t?SSe(e,t):_Se(e)}function Qke(e,t){const n=Math.max(Math.abs(e)-1,t);return n<128?sU():n<32768?aU():n<2**31?MC():OC()}function Jke(e,t){const n=-e>t?-e-1n:t;if(n>=2**63)throw new Error(`BigInt exceeds 64 bits: ${n}`);return oU()}function Zke(){throw new Error("Mixed types detected, please define a union type.")}class RU extends kr{constructor(t,n){super(t,n),this.toOffset=cU(t.offsets)}init(){return this.offsets=Li(this.type.offsets),this.values=Li(),this.pos=0,super.init()}set(t,n){const{offsets:i,values:r,toOffset:s}=this;super.set(t,n)&&(r.write(t,this.pos),this.pos+=t.length),i.set(s(this.pos),n+1)}done(){return{...super.done(),offsets:this.offsets.array(this.index+2),values:this.values.array(this.pos+1)}}}class eAe extends kr{constructor(t,n){super(t,n)}init(){return this.values=NU(),super.init()}set(t,n){super.set(t,n),t&&this.values.set(n)}done(){return{...super.done(),values:this.values.array((this.index>>3)+1)}}}class tAe extends kr{constructor(t,n){super(t,n),this.scale=10**t.scale,this.stride=t.bitWidth>>6}init(){return this.values=Li(this.type.values),super.init()}set(t,n){const{scale:i,stride:r,values:s}=this;super.set(t,n)&&(s.prep((n+1)*r),MSe(t,s.buf,n*r,r,i))}done(){const{index:t,stride:n,values:i}=this;return{...super.done(),values:i.array((t+1)*n)}}}class nAe extends kr{constructor(t,n){super(t,n),this.stride=t.stride}init(){return this.values=Li(),super.init()}set(t,n){super.set(t,n)&&this.values.write(t,n*this.stride)}done(){const{stride:t,values:n}=this;return{...super.done(),values:n.array(t*(this.index+1))}}}class iAe extends kr{constructor(t,n){super(t,n),this.child=n.builder(this.type.children[0].type),this.stride=t.stride}init(){return this.child.init(),super.init()}set(t,n){const{child:i,stride:r}=this,s=n*r;if(super.set(t,n))for(let a=0;a<r;++a)i.set(t[a],s+a);else i.index=s+r}done(){const{child:t}=this;return{...super.done(),children:[t.batch()]}}}class rAe extends kr{init(){return this.values=Li(this.type.values),super.init()}set(t,n){if(super.set(t,n)){const i=n<<1;this.values.set(t[0],i),this.values.set(t[1],i+1)}}done(){return{...super.done(),values:this.values.array(this.index+1<<1)}}}class sAe extends kr{init(){return this.values=Li(),super.init()}set(t,n){super.set(t,n)&&this.values.write(FSe(t),n<<4)}done(){return{...super.done(),values:this.values.array(this.index+1<<4)}}}class DU extends kr{constructor(t,n,i){super(t,n),this.child=i}init(){this.child.init();const t=this.type.offsets;return this.offsets=Li(t),this.toOffset=cU(t),this.pos=0,super.init()}done(){return{...super.done(),offsets:this.offsets.array(this.index+2),children:[this.child.batch()]}}}class aAe extends DU{constructor(t,n){super(t,n,n.builder(t.children[0].type))}set(t,n){const{child:i,offsets:r,toOffset:s}=this;super.set(t,n)&&t.forEach(a=>i.set(a,this.pos++)),r.set(s(this.pos),n+1)}}class IU extends kr{constructor(t,n){super(t,n),this.children=t.children.map(i=>n.builder(i.type))}init(){return this.children.forEach(t=>t.init()),super.init()}done(){const{children:t}=this;return t.forEach(n=>n.index=this.index),{...super.done(),children:t.map(n=>n.batch())}}}class oAe extends IU{constructor(t,n){super(t,n),this.setters=this.children.map((i,r)=>{const s=t.children[r].name;return(a,o)=>i.set(a?.[s],o)})}set(t,n){super.set(t,n);const i=this.setters;for(let r=0;r<i.length;++r)i[r](t,n)}}class uAe extends DU{constructor(t,n){super(t,n,new lAe(t.children[0].type,n))}set(t,n){const{child:i,offsets:r,toOffset:s}=this;if(super.set(t,n))for(const a of t)i.set(a,this.pos++);r.set(s(this.pos),n+1)}}class lAe extends IU{set(t,n){super.set(t,n);const[i,r]=this.children;i.set(t[0],n),r.set(t[1],n)}}const cAe={};class fAe extends LC{constructor(t,n){super(t,n),this.children=t.children.map(i=>n.builder(i.type))}init(){return this.pos=0,this.key=null,this.value=cAe,this.children.forEach(t=>t.init()),super.init()}next(){const[t,n]=this.children;t.set(this.index+1,this.pos),n.set(this.value,this.pos++)}set(t,n){if(t!==this.value){const i=By(t);i!==this.key&&(this.key&&this.next(),this.key=i,this.value=t)}this.index=n}done(){this.next();const{children:t,index:n,type:i}=this;return{length:n+1,nullCount:0,type:i,children:t.map(r=>r.batch())}}}class PU extends LC{constructor(t,n){super(t,n),this.children=t.children.map(i=>n.builder(i.type)),this.typeMap=t.typeMap,this.lookup=t.typeIdForValue}init(){return this.nullCount=0,this.typeIds=Li($C),this.children.forEach(t=>t.init()),super.init()}set(t,n){const{children:i,lookup:r,typeMap:s,typeIds:a}=this;this.index=n;const o=r(t,n),u=i[s[o]];a.set(o,n),t==null&&++this.nullCount,this.update(t,n,u)}done(){const{children:t,nullCount:n,type:i,typeIds:r}=this,s=this.index+1;return{length:s,nullCount:n,type:i,typeIds:r.array(s),children:t.map(a=>a.batch())}}}class hAe extends PU{update(t,n,i){i.set(t,n),this.children.forEach(r=>{r!==i&&r.set(null,n)})}}class dAe extends PU{init(){return this.offsets=Li(this.type.offsets),super.init()}update(t,n,i){const r=i.index+1;i.set(t,r),this.offsets.set(r,n)}done(){return{...super.done(),offsets:this.offsets.array(this.index+1)}}}class pAe extends RU{set(t,n){super.set(t&&fU(t),n)}}class vh extends kr{constructor(t,n){super(t,n),this.values=Li(t.values)}init(){return this.values=Li(this.type.values),super.init()}set(t,n){super.set(t,n)&&this.values.set(t,n)}done(){return{...super.done(),values:this.values.array(this.index+1)}}}class gAe extends vh{set(t,n){super.set(t==null?t:Ps(t),n)}}class Kv extends vh{constructor(t,n,i){super(t,n),this.transform=i}set(t,n){super.set(t==null?t:this.transform(t),n)}}function LU(e={},t=Hke()){return{batchType:n=>AU(n,e),builder(n){return zU(n,this)},dictionary(n){return t.get(n,this)},finish:()=>t.finish(e)}}function zU(e,t=LU()){const{typeId:n}=e;switch(n){case U.Int:case U.Time:case U.Duration:return TC(e.values)?new gAe(e,t):new vh(e,t);case U.Float:return e.precision?new vh(e,t):new Kv(e,t,RSe);case U.Binary:case U.LargeBinary:return new RU(e,t);case U.Utf8:case U.LargeUtf8:return new pAe(e,t);case U.Bool:return new eAe(e,t);case U.Decimal:return new tAe(e,t);case U.Date:return new Kv(e,t,e.unit?Ps:$Se);case U.Timestamp:return new Kv(e,t,TSe(e.unit));case U.Interval:switch(e.unit){case sd.DAY_TIME:return new rAe(e,t);case sd.MONTH_DAY_NANO:return new sAe(e,t)}return new vh(e,t);case U.List:case U.LargeList:return new aAe(e,t);case U.Struct:return new oAe(e,t);case U.Union:return e.mode?new dAe(e,t):new hAe(e,t);case U.FixedSizeBinary:return new nAe(e,t);case U.FixedSizeList:return new iAe(e,t);case U.Map:return new uAe(e,t);case U.RunEndEncoded:return new fAe(e,t);case U.Dictionary:return new Yke(e,t)}throw new Error(Py(n))}function BU(e,t,n={},i){const r=uSe(e)?u=>{for(const l of e)u(l)}:e;t??=Xke(r);const{maxBatchRows:s=1/0,...a}=n;let o;if(t.typeId===U.Null){let u=0;r(()=>++u),o=mAe(t,u,s)}else{const u=LU(a,i),l=zU(t,u).init(),c=h=>o.push(h.batch());o=[];let f=0;r(h=>{l.set(h,f++),f>=s&&(c(l),f=0)}),f&&c(l),u.finish()}return new DC(o,t)}function mAe(e,t,n){const i=[],r=o=>new gU({length:o,nullCount:o,type:e}),s=Math.floor(t/n);for(let o=0;o<s;++o)i.push(r(n));const a=t%n;return a&&i.push(r(a)),i}function yAe(e,t,n={},i){return!t&&KB(e)?xAe(e,n):BU(r=>e.forEach(r),t,n,i)}function xAe(e,{maxBatchRows:t,useBigInt:n}){const i=e.constructor,r=vAe(i),s=e.length,a=Math.min(t||1/0,s),o=Math.floor(s/a),u=[],l=TC(i)&&!n?Yu:xh,c=(h,d)=>u.push(new l({length:d-h,nullCount:0,type:r,validity:new ef(0),values:e.subarray(h,d)}));let f=0;for(let h=0;h<o;++h)c(f,f+=a);return f<s&&c(f,s),new DC(u)}function vAe(e){switch(e){case XB:return mSe();case np:return OC();case $C:return sU();case YB:return aU();case tf:return MC();case nf:return oU();case ef:return hSe();case kC:return dSe();case AC:return pSe();case CC:return gSe()}}function bAe(e,t){const n=[],i=Array.isArray(e)?e:Object.entries(e),r=i[0]?.[1].length,s=i.map(([o,u])=>{if(u.length!==r)throw new Error("All columns must have the same length.");return n.push(Ly(o,u.type)),u}),a={version:id.V5,endianness:nSe.Little,fields:n,metadata:null};return new IC(a,s,t)}function sp(e,t){return en(t)?t(e):t||e.columnNames()}function UU(e,t={}){const{columns:n,limit:i=1/0,offset:r=0,types:s={},...a}=t,o=sp(e,n),u=e.data(),l=r===0&&e.numRows()<=i&&!e.isFiltered()&&!e.isOrdered();return bAe(o.map(c=>{const f=u[c],h=s[c],d=_o(f);let p;if(l&&(d||en(f.toArray)))p=yAe(d?f:f.toArray(),h,a);else{const g=d?m=>f[m]:m=>f.at(m);p=BU(m=>e.scan(y=>m(g(y)),!0,i,r),h,a)}return[c,p]}))}function wAe(e,t={}){const{format:n="stream",...i}=t;return zke(UU(e,i),{format:n})}function $u(e){return e}function zC(e,t,n=100,i,r){const{start:s=$u,cell:a,end:o=$u}=r,u=e.data(),l=t.length;e.scan(c=>{s(c);for(let f=0;f<l;++f){const h=t[f];a(u[h].at(c),h,f)}o(c)},!0,n,i)}function _Ae(e,t={}){const n=sp(e,t.columns),i=t.format||{},r=t.delimiter||",",s=t.header??!0,a=new RegExp(`["${r}
\r]`),o=c=>c==null?"":io(c)?Ty(c,!0):a.test(c+="")?'"'+c.replace(/"/g,'""')+'"':c,u=n.map(o);let l=s?u.join(r)+`
`:"";return zC(e,n,t.limit||1/0,t.offset,{cell(c,f,h){u[h]=o(i[f]?i[f](c):c)},end(){l+=u.join(r)+`
`}}),l}function EAe(e,t,n={}){for(const i in e)n[i]=t(e[i],i);return n}function SAe(e){return e.getUTCHours()===0&&e.getUTCMinutes()===0&&e.getUTCSeconds()===0&&e.getUTCMilliseconds()===0}function kAe(e,t={}){let n=0,i=0,r=0,s=0,a=0,o=0;return e(u=>{if(++n,u==null){++i;return}const l=typeof u;if(l==="object"&&io(u))++r,SAe(u)&&++s;else if(l==="number"&&(++a,u===u&&(u|0)!==u)){const c=u+"",f=c.indexOf(".");if(f>=0){const h=c.indexOf("e"),d=h>0?h:c.length;o=Math.max(o,d-f-1)}}}),{align:(i+a+r)/n>.5?"r":"l",format:{utc:r===s,digits:Math.min(o,t.maxdigits||6)}}}function jU(e,t,n){const i=n.format||{},r=n.align||{},s={},a={};return t.forEach(o=>{const u=kAe(AAe(e,o),n);a[o]=r[o]||u.align,s[o]=i[o]||u.format}),{align:a,format:s}}function AAe(e,t){const n=e.column(t);return i=>e.scan(r=>i(n.at(r)))}function qU(e,t={}){if(en(t))return t(e)+"";const n=typeof e;if(n==="object"){if(io(e))return t.utc?Ty(e):oz(e);{const i=JSON.stringify(e,(s,a)=>$y(a)?Array.from(a):a),r=t.maxlen||30;return i.length>r?i.slice(0,28)+"…"+(i[0]==="["?"]":"}"):i}}else if(n==="number"){const i=t.digits||0;let r;return e!==0&&((r=Math.abs(e))>=1e18||r<Math.pow(10,-i))?e.toExponential(i):e.toFixed(i)}else return e+""}function CAe(e,t={}){const n=sp(e,t.columns),{align:i,format:r}=jU(e,n,t),s=$Ae(t),a=t.null,o=g=>g==="c"?"center":g==="r"?"right":"left",u=g=>g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l=(g,m)=>u(qU(g,m)),c=a?(g,m)=>g==null?a(g):l(g,m):l;let f=-1,h=-1;const d=(g,m,y)=>{const x=y?o(i[m]):"",v=s[g]&&s[g](m,h,f)||"",b=(x?`text-align: ${x};`+(v?" ":""):"")+v;return`<${g}${b?` style="${b}"`:""}>`};let p=d("table")+d("thead")+d("tr",f)+n.map(g=>`${d("th",g,1)}${g}</th>`).join("")+"</tr></thead>"+d("tbody");return zC(e,n,t.limit,t.offset,{start(g){f=g,++h,p+=d("tr")},cell(g,m){p+=d("td",m,1)+c(g,r[m])+"</td>"},end(){p+="</tr>"}}),p+"</tbody></table>"}function $Ae(e){return EAe(e.style,t=>en(t)?t:()=>t)}const rN={},cl={},eg=34,Of=10,sN=13,TAe="columns",FAe="ndjson",MAe=e=>io(e)?Ty(e,!0):e;function OAe(e,{type:t,columns:n,format:i={},limit:r,offset:s}={}){const a=sp(e,n),o=a.map(l=>i[l]||MAe),u=l=>e.scan(l,!0,r,s);return t===TAe?NAe(e,a,o,u):RAe(e,a,o,u,t===FAe)}function NAe(e,t,n,i){let r="{";return t.forEach((s,a)=>{r+=(a?",":"")+JSON.stringify(s)+":[";const o=e.column(s),u=n[a];let l=-1;i(c=>{const f=o.at(c);r+=(++l?",":"")+JSON.stringify(u(f))}),r+="]"}),r+"}"}function RAe(e,t,n,i,r=!1){const s=t.length,a=t.map(h=>`"${h}":`),o=t.map(h=>e.column(h)),u=r?h=>h.replaceAll(`
`,""):$u,l=r?`
`:",";let c=r?"":"[",f=-1;return i(h=>{const d=[];for(let p=0;p<s;++p)d.push(a[p]+JSON.stringify(n[p](o[p].at(h))));c+=(++f?l:"")+u(`{${d.join(",")}}`)}),c+(r?"":"]")}function DAe(e,t={}){const n=sp(e,t.columns),{align:i,format:r}=jU(e,n,t),s=u=>u==="c"?":-:":u==="r"?"-:":":-",a=u=>u.replace(/\|/g,"\\|");let o="|"+n.map(a).join("|")+`|
|`+n.map(u=>s(i[u])).join("|")+`|
`;return zC(e,n,t.limit,t.offset,{start(){o+="|"},cell(u,l){o+=a(qU(u,r[l]))+"|"},end(){o+=`
`}}),o}class VU extends ww{assign(...t){return j_e(this,...t)}count(t={}){const{as:n="count"}=t;return vm(this,{[n]:dz()})}derive(t,n){return Q_e(this,t,n)}filter(t){return _C(this,t)}slice(t,n){return XEe(this,t,n)}groupby(...t){return xC(this,...t)}orderby(...t){return $Ee(this,...t)}relocate(t,n){return PB(this,is(t),n)}rename(...t){return PEe(this,...t)}reduce(t){return IEe(this,t)}rollup(t){return vm(this,t)}sample(t,n){return VEe(this,t,n)}select(...t){return DB(this,...t)}ungroup(){return SC(this)}unorder(){return eSe(this)}dedupe(...t){return Dy(this,...t)}impute(t,n){return cEe(this,t,n)}fold(t,n){return uEe(this,t,n)}pivot(t,n,i){return MEe(this,t,n,i)}spread(t,n){return KEe(this,t,n)}unroll(t,n){return oEe(this,t,n)}lookup(t,n,...i){return EEe(this,t,n,...i)}join(t,n,i,r){return nh(this,t,n,i,r)}join_left(t,n,i,r){const s={...r,left:!0,right:!1};return nh(this,t,n,i,s)}join_right(t,n,i,r){const s={...r,left:!1,right:!0};return nh(this,t,n,i,s)}join_full(t,n,i,r){const s={...r,left:!0,right:!0};return nh(this,t,n,i,s)}cross(t,n,i){return mEe(this,t,n,i)}semijoin(t,n){return UB(this,t,n)}antijoin(t,n){return jB(this,t,n)}concat(...t){return IB(this,...t)}union(...t){return ZEe(this,...t)}intersect(...t){return dEe(this,...t)}except(...t){return aEe(this,...t)}toArrow(t){return UU(this,t)}toArrowIPC(t){return wAe(this,t)}toCSV(t){return _Ae(this,t)}toHTML(t){return CAe(this,t)}toJSON(t){return OAe(this,t)}toMarkdown(t){return DAe(this,t)}}function IAe(e){const t=e.slice(-3).toLowerCase();return t===".gz"?"gzip":t===".zz"?"deflate":null}async function PAe(e,{fetch:t=void 0,decompress:n=IAe(e)}={}){const i=await fetch(e,t).then(r=>r.body);return n?i.pipeThrough(new DecompressionStream(n)):i}function LAe(e){if(en(e[Symbol.asyncIterator]))return e[Symbol.asyncIterator]();{const t=e.getReader();return{next(){return t.read()},[Symbol.asyncIterator](){return this}}}}function zAe(e){return e.slice(1,-1).replace(/""/g,'"')}function BAe(e=","){e.length!==1&&pt(`Text delimiter should be a single character, found "${e}"`);const t=e.charCodeAt(0);let n=0,i=0,r=!1,s=!1,a=!1,o=!1,u=null,l=null,c=[];function f(d){l=l?l+d:d}function h(){if(r)return r=!1,rN;const d=n;let p;if(a||u.charCodeAt(d)===eg){let m=o&&u.charCodeAt(d)!==eg;if(o=!1,a=!0,!m){for(;++n<i;)if(u.charCodeAt(n)===eg)if(++n<i){if(u.charCodeAt(n)!==eg){m=!0;break}}else return f(u.slice(d,i)),o=!0,cl;if(!m)return f(u.slice(d,i)),cl}const y=zAe((l??"")+u.slice(d,n));return a=!1,l=null,n>=i?(l=y,cl):(p=u.charCodeAt(n++),p===Of?r=!0:p===sN&&(r=!0,n>=i?s=!0:u.charCodeAt(n)===Of&&++n),y)}let g;for(;n<i;){if(p=u.charCodeAt(g=n++),p===Of)r=!0;else if(p===sN)r=!0,n>=i?s=!0:u.charCodeAt(n)===Of&&++n;else if(p!==t)continue;return u.slice(d,g)}return f(u.slice(d,i)),cl}return{start(){},transform(d,p){u=d,i=u.length,n=0;const g=[];let m;if(s&&(u.charCodeAt(n)===Of&&++n,s=!1),l!=null)if((m=h())===cl){p.enqueue(g);return}else c.push((l??"")+m),l=null;for(;;)if((m=h())===cl){p.enqueue(g);return}else m===rN?(g.push(c),c=[]):c.push(m)},flush(d){(c.length||l)&&(l!=null&&c.push(l),d.enqueue([c]))}}}function UAe(e,t,n){return e>0?t?(i,r)=>r<e||n(i).startsWith(t):(i,r)=>r<e:t?i=>n(i).startsWith(t):null}function jAe(e,t,n=$u){const i=UAe(e,t,n);if(!i)return null;let r=0;return{start(){},flush(){},transform(s,a){const o=s.length,u=new KA(o);for(let l=0;l<s.length;++l,++r)i(s[l],r)&&u.set(l);a.enqueue(u.count()?s.filter((l,c)=>!u.get(c)):s)}}}const qAe=[e=>e==="true"||e==="false",e=>e!=="false"],aN=[e=>e==="NaN"||(e=+e)===e,e=>+e],VAe=[uz,e=>new Date(Date.parse(e))];function WAe(e){return e&&e!=="."?aN.map(t=>n=>t(n&&n.replace(e,"."))):aN}function HAe(e,t){const{decimal:n,limit:i=e.length}=t,r=[qAe,WAe(n),VAe],s=r.length;for(let a=0;a<s;++a){const[o,u]=r[a];if(GAe(e,o,i))return u}return $u}function GAe(e,t,n){for(let i=0;i<n;++i){const r=e[i];if(r!=null&&!t(r))return!1}return!0}function YAe(e,t){let n=e;return t.forEach(i=>{i&&(n=n.pipeThrough(new TransformStream(i)))}),n}function XAe(e,t){const n={};return e.forEach((i,r)=>n[i]=t[r]),new VU(n,e)}async function KAe(e,t,n={}){const i=YAe(e,t),r=+n.autoMax||1e3,s=LAe(i),a=[];let o=0;for(;o<r;){const h=await s.next(),d=h.value;if(d?.length>0&&(a.push(d),o+=d.length),h.done)break}const{names:u,values:l,parsers:c}=QAe(a,n),f=u.length;for await(const h of s)for(let d=0;d<h.length;++d){const p=h[d];for(let g=0;g<f;++g)l[g].push(p[g]?c[g](p[g]):null)}return XAe(u,l)}function QAe(e,t){const[n]=e,i=n[0].length,r=+t.autoMax||1e3,s=Hc(i,()=>[]);let a=t.header!==!1?n.shift():t.names;a=a?a.length<i?[...a,oN(i,a.length)]:a:oN(i);for(const u of e)for(let l=0;l<u.length;++l){const c=u[l];for(let f=0;f<i;++f)s[f].push(c[f]===""?null:c[f])}const o=JAe(a,s,{...t,limit:r});return o.forEach((u,l)=>{if(u===$u)return;const c=s[l];for(let f=0;f<c.length;++f)c[f]!=null&&(c[f]=u(c[f]))}),{names:a,values:s,parsers:o}}function oN(e,t=0){return Hc(e-t,n=>`col${n+t+1}`)}function JAe(e,t,n){const{parse:i={}}=n,r=n.autoType===!1;return e.map((s,a)=>en(i[s])?i[s]:r?$u:HAe(t[a],n))}async function ZAe(e,t){return(await PAe(e,t)).pipeThrough(new TextDecoderStream)}async function eCe(e,t){return KAe(e,nCe(t),t)}async function tCe(e,t){return eCe(await ZAe(e,t),t)}function nCe({delimiter:e=",",skip:t=0,comment:n=void 0}={}){return[BAe(e),jAe(t,n,i=>i[0])]}function uN(e,t={}){const n=`d[${JSON.stringify(e)}]`,{maxbins:i,nice:r,minstep:s,step:a,offset:o}=t,u=[i,r,s,a];let l=u.length;for(;l&&u[--l]==null;)u.pop();const c=u.length?", "+u.map(f=>f+"").join(", "):"";return`d => op.bin(${n}, ...op.bins(${n}${c}), ${o||0})`}function iCe(e,t){const n=i=>pt(`Illegal argument type: ${i||typeof e}`);return e instanceof Map?lN(e.entries(),t):io(e)?n("Date"):cm(e)?n("RegExp"):Sr(e)?n():In(e)?rCe(e,t):en(e[Symbol.iterator])?sCe(e,t):ro(e)?lN(Object.entries(e),t):n()}function lN(e,t=["key","value"]){const n=[],i=[];for(const[s,a]of e)n.push(s),i.push(a);const r={};return t[0]&&(r[t[0]]=n),t[1]&&(r[t[1]]=i),r}function rCe(e,t){const n=e.length,i={},r=s=>i[s]=Array(n);if(n){t=t||Object.keys(e[0]);const s=t.map(r),a=s.length;for(let o=0;o<n;++o){const u=e[o];for(let l=0;l<a;++l)s[l][o]=u[t[l]]}}else t&&t.forEach(r);return i}function sCe(e,t){const n={},i=a=>n[a]=[];let r,s;for(const a of e){r||(t=t||Object.keys(a),r=t.map(i),s=r.length);for(let o=0;o<s;++o)r[o].push(a[t[o]])}return!r&&t&&t.forEach(i),n}function aCe(e,t){return new VU(iCe(e,t),t)}const oCe=rj("DataSourcesStore",()=>{const e=ri({}),t=ri(!0);async function n(u){const l=u.map(c=>i(c));await Promise.all(l),t.value=!1}async function i(u){if(r(u.name))return;const l=await tCe(u.source);e.value[u.name]={source:u,dest:l}}function r(u){return u in e.value?e.value[u]??null:null}function s(u,l){if(t.value)return null;const c=new Map;for(const h of u){const d=r(h);if(d===null)throw new Error(`key not found in data sources: [${h}]`);c.set(h,aCe(d.dest.reify()))}return a(c,l??[]).objects()}function a(u,l){console.log("perform data transforations");const c=u.keys().next().value??"",f=u.get(c);if(!f)throw new Error("table not found");const h={key:c,table:f},d=g=>{const m=g?u.get(g):h.table;if(!m)throw new Error("in table not found");return m},p=g=>{g.out?h.key=g.out:g.in&&!Array.isArray(g.in)&&(h.key=g.in),u.set(h.key,h.table)};for(const g of l){if("groupby"in g){const m=d(g.in);Array.isArray(g.groupby)?h.table=m.groupby(...g.groupby):h.table=m.groupby(g.groupby)}else if("binby"in g){const m=d(g.in),{field:y,bins:x=10,nice:v=!0,bin_start:b="bin_start",bin_end:w="bin_end"}=g.binby,E={};E[b]=uN(y,{maxbins:x,nice:v}),E[w]=uN(y,{maxbins:x,nice:v,offset:1}),h.table=m.groupby(E)}else if("rollup"in g){const m=d(g.in),y={},x=[];for(const[v,b]of Object.entries(g.rollup))y[v]=o(b),b.op==="frequency"&&x.push(v);h.table=m.rollup(y);for(const v of x){const b={};b[v]=(w,E)=>w[E.freqKey]/ul.sum(w[E.freqKey]),h.table=h.table.params({freqKey:v}).derive(b)}}else if("orderby"in g){const m=d(g.in);h.table=m.orderby(g.orderby)}else if("derive"in g){const m=d(g.in);h.table=m.derive(g.derive)}else if("filter"in g){const m=d(g.in);h.table=m.filter(g.filter)}else if("join"in g){const[m,y]=g.in,x=u.get(m),v=u.get(y);if(!x||!v)throw new Error("join table not found");h.table=x.join(v,g.join.on)}p(g)}return h.table}function o(u){switch(u.op){case"count":return ul.count();case"min":if(!u.field)throw new Error("Field is required for min operation");return ul.min(u.field);case"max":if(!u.field)throw new Error("Field is required for max operation");return ul.max(u.field);case"mean":return ul.mean(u.field);case"frequency":return ul.count();default:throw new Error("unsupported Aggregate Function"+JSON.stringify(u))}}return{dataSources:e,loading:t,initDataSources:n,getDataObject:s}}),uCe=wm({__name:"ParserComponent",props:{spec:{}},setup(e){const t=oCe(),{loading:n}=sj(t),i=e,r=ri(null),s=ri(!1),a=ri("");cN(()=>{o()});function o(){r.value=Mve(i.spec),t.initDataSources(r.value.source),u()}bh(()=>i.spec,()=>{o()}),bh(n,()=>u());function u(){r.value&&l(r.value)&&(a.value=c(r.value),s.value=!0)}function l(h){return!h.representation.map(d=>d.mark).includes("row")}function c(h){const d={$schema:"https://vega.github.io/schema/vega-lite/v5.json",data:{values:[]}};try{d.data.values=t.getDataObject(h.source.map(m=>m.name),h.transformation)}catch(m){console.error("Failed to complete data transformation",m)}f.value=d.data.values;const p=h.representation;if(!Array.isArray(p))throw new Error("invalid spec passed to vega conversion");const g=p.map(m=>{const y=Array.isArray(m.mapping)?m.mapping:[m.mapping],x={};for(const v of y){const{encoding:b}=v;"value"in v?x[b]={value:v.value}:x[b]={field:v.field,type:v.type}}return{mark:m.mark,encoding:x}});return d.layer=g,JSON.stringify(d)}const f=ri();return(h,d)=>s.value?(Ra(),Mg(Tve,{key:0,spec:a.value},null,8,["spec"])):(Ra(),Mg(Fve,{key:1}))}}),lCe={key:1},cCe=wm({__name:"EditorPage",setup(e){const t={automaticLayout:!0,formatOnType:!0,formatOnPaste:!0},n=ri(`{
  "source": {
    "name": "donors",
    "source": "./data/example_donors.csv"
  },
  "representation": {
    "mark": "point",
    "mapping": [
      { "encoding": "y", "field": "height", "type": "quantitative" },
      { "encoding": "x", "field": "weight", "type": "quantitative" }
    ]
  }
}`),i=aj();if(i.query.spec)try{n.value=fj.decompressFromEncodedURIComponent(i.query.spec)}catch(c){console.error("Failed to decode spec from URL parameter:",c)}const r=oj(),s=ri(50);function a(c){r.value=c}const o=ks(()=>JSON.parse(n.value)),u=ks(()=>{try{return JSON.parse(n.value),""}catch(c){return c instanceof Error?c.message:"Error parsing specification."}}),l=ks(()=>{try{return JSON.parse(n.value),!0}catch{return!1}});return(c,f)=>{const h=uj("vue-monaco-editor");return Ra(),Mg(pj,{class:"flex row"},{default:Wy(()=>[UC(bj,{modelValue:s.value,"onUpdate:modelValue":f[1]||(f[1]=d=>s.value=d),class:"flex-grow-1 q-mt-lg"},{before:Wy(()=>[UC(h,{value:n.value,"onUpdate:value":f[0]||(f[0]=d=>n.value=d),language:"json",theme:"vs-light",options:t,onMount:a},null,8,["value"])]),after:Wy(()=>[l.value?(Ra(),Mg(uCe,{key:0,spec:o.value},null,8,["spec"])):(Ra(),Fg("div",lCe,fN(u.value),1))]),_:1},8,["modelValue"])]),_:1})}}}),s$e=hN(cCe,[["__scopeId","data-v-681dae78"]]);export{s$e as default};
